function autostt(){$(".stt").each(function(n){$(this).text(n+1)})}function getDataCriteriaInfringe(n){var t,i;for($("#tbodyemployeeinfringed").html(""),criterias={data:n},t=0;t<criterias.data.length;t++)criterias.data[t].ParentId==null?(i=new RateEmployee(criterias.data[t]),listcriterias.add(i)):(i=new RateEmployee(criterias.data[t]),listcriteriaschildren.add(i))}function checkdepartment(n,t){var r=n,i=0;return r==t&&i++,i==0?!1:!0}var department,criterias,userlist=[],userid,listcriterias=new ListRateEmployee,listcriteriaschildren=new ListRateEmployee,AppView=Backbone.View.extend({el:$("#bodycriteria"),events:{"click #savechangeinfringe":"savechange"},initialize:function(){console.log();this.listenTo(listcriterias,"add",this.addOneCriteria);this.listenTo(listcriterias,"reset",this.resetCriteria)},addOneCriteria:function(n){var t=new CriteriaView({model:n});this.$("#tbodyemployeeinfringed").append(t.render().el)},resetCriteria:function(){this.$("#tbodyemployeeinfringed").html("")},savechange:function(){var i=userid,n=$("#namecriteria :selected").val(),r=new Date($("#datetimepicker").datepicker("getDate").getTime()-$("#datetimepicker").datepicker("getDate").getTimezoneOffset()*6e4).toJSON(),u=$("#detailinfringe").val(),t;i!==undefined&&n&&r!=""?(console.log(n),t=new InfringeEmployee,t.set({Date:r,InfringeUserId:Number(i),RateEmployeeId:Number(n),Detail:u}),$("#InfringeModal").modal("hide"),AddInfringeUsers(JSON.stringify(t),function(){egov.pubsub.publish(egov.events.status.success,"Thêm thành công đánh giá")})):($("#dialogerror").fadeIn(),$("#dialogerror").fadeOut(5e3))}}),App=new AppView,accounteventsearch;$(document).ready(function(){$("#InfringeModal").draggable({handle:".modal-header"});GetDepartments(function(n){department=n;var t={datadepartment:n},i=$("#InfoDepartmentRateTemplate").tmpl(t);$("#choosedepartment").html(i)});$("#datetimepicker").datepicker({dateFormat:"dd-mm-yy",defaultDate:new Date});GetCriterias(function(n){getDataCriteriaInfringe(n);autostt()});GetAllUser(function(n){for(var t=0;t<n.length;t++)userlist.push({UserId:n[t].UserId,UserName:n[t].UserName+" - "+n[t].FullName})});var accountevent=$("#accountname").tautocomplete({width:"300px",columns:["UserName"],data:function(){var data,filterData,searchData;try{data=userlist}catch(e){alert(e)}return filterData=[],searchData=eval("/"+accountevent.searchdata()+"/gi"),$.each(data,function(n,t){t.UserName.search(new RegExp(searchData))!=-1&&filterData.push(t)}),filterData},onchange:function(){var n=JSON.stringify(accountevent.all()),t=JSON.parse(n);userid=t.UserName;GetDepartmentByuser(userid,function(n){var i,r,e;if(n.length>0){console.log(n);var o=n[0].DepartmentIdExt,u=o.split("."),f=0,t='{"data":[';for(i=0;i<criterias.data.length;i++)for(r=0;r<u.length;r++)criterias.data[i].ParentId==rateemployeechooser&&checkdepartment(criterias.data[i].DepartmentId,u[r])&&(t=t+JSON.stringify(criterias.data[i])+",",f++);t=t.substring(0,t.length-1);t=f==0?t+"[]}":t+"]}";e=JSON.parse(t);$("#namecriteria").html($("#NameCriteriaTemplate").tmpl(e))}})}})});$(document).load(function(){$("td").tooltip()});accounteventsearch=$(".criterianame").tautocomplete({width:"400px",columns:["Tên tiêu chí"],data:function(){var criterialisttmp,listobj,i,data,filterData,searchData;try{for($("#notall").prop("checked",!0),criterialisttmp=[],listobj=listcriterias.toJSON(),i=0;i<listobj.length;i++)criterialisttmp.push({id:i,Name:listobj[i].Name});data=criterialisttmp}catch(e){alert(e)}return filterData=[],searchData=eval("/"+accounteventsearch.searchdata()+"/gi"),$.each(data,function(n,t){t.Name.search(new RegExp(searchData))!=-1&&filterData.push(t)}),filterData},onchange:function(){var t=listcriterias.where({Name:accounteventsearch.text()}),n;if(t.length>0){for(listcriterias.reset(),n=0;n<t.length;n++)listcriterias.add(t[n].toJSON());autostt()}else listcriterias.reset(),GetCriterias(function(n){getDataCriteriaInfringe(n);autostt()})}});$("#InfringeModal").on("shown.bs.modal",function(){$(this).find(".acontainer").find("input").eq(1).focus()});$(".criterianame").parent().find("input").eq(1).keydown(function(){var n=$(this).val();console.log(n);n==""&&(listcriterias.reset(),GetCriterias(function(n){getDataCriteriaInfringe(n);autostt()}))});$(function(){$("#bodycriteria").layout({resizable:!0,closable:!1})});