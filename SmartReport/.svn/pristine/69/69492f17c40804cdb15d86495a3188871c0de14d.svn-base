define([],function(){"use strict";function r(n,t,i,r,u){var f;if(egov.isMobile){if(typeof t=="string"&&"luusonoiboluusovaphathanhnoiboluusovaphathanhrangoai".indexOf(t.toString().toLowerCase())>-1)return;f=$.tmpl('<li class="mdl-menu__item"><a href="#" value="${value}"><span class="icon ${icon}"><\/span>${name}<\/a>',{value:t,name:n,icon:i})}else f=$.tmpl('<li><a href="#" value="${value}"><span class="icon ${icon}"><\/span>${name}<\/a>',{value:t,name:n,icon:i});u||f.attr("disabled","disabled");f.on("click",function(n){typeof r=="function"&&r(t,n)});return f}function t(n,t){return(n&t)===t}function f(n){var t=n.model.toJSON();return(t.CategoryBusinessId=1&&t.DocTypeId=="00000000-0000-0000-0000-000000000000"&&t.Original==2)?!0:!1}function u(n){var t=egov.enum.actionSpecial;switch(n){case t.luuSoVaPhatHanhNoiBo.name:case t.luuSoVaPhatHanhRaNgoai.name:return"icon-archive";case t.luuSoNoiBo.name:return"icon-disk2";case t.chuyenYKienDongGopVbDxl.name:case t.chuyenYKienDongGopVbXinYKien.name:return"icon-comment";case t.chuyenNguoiGui.name:case t.chuyenNguoiKhoiTao.name:case t.chuyenNguoiCoQuyenDongGopYKien.name:return"icon-back";default:return"icon-forward4"}}var n,i;return n=egov.resources,i=egov.setting.fileUploadSettings,Backbone.View.extend({printer:null,emptyDocTypeId:"00000000-0000-0000-0000-000000000000",totalSelectedFiles:0,viewIcon:{viewIconBangiao:!1,viewIconPhanloai:!1,viewIconSua:!1,viewIconXinykien:!1,viewIconKetthuc:!1,viewIconLuu:!1,viewIconThongbao:!1,viewIconTraloi:!1,viewIconTraloiHSMC:!1,viewIconGuiykien:!1,viewIconKyDuyet:!1,viewIconGiaHanXuLy:!1,viewIconTraKetQua:!1,viewIconDatLichHenTiep:!1,viewIconYeuCauBoSung:!1,viewIconTiepNhanBoSung:!1,viewIconLuuvanban:!1,viewIconHuyVanBan:!1,viewIconXuLyTheoLo:!1,viewIconGiayPhep:!1,viewIconCBCL:!1,viewIconXacNhanBanGiao:!1,viewIconSendMail:!1,viewIconSendSms:!1,viewIconLuuDuThao:!1,viewIconPrint:!1,viewIconOther:!1,viewIconAttach:!1,viewIconEditDocInfo:!1,viewIconDuplicate:!1,viewIconDaPhatHanhOrKetThuc:!1,viewIconUndoKetThuc:!1,viewIconPhatHanhLai:!1,viewIconCollapseForm:!1,viewIconPrintXLVB:!1,viewIconInvoice:!0},events:{"click .btnTransfer":"_show2","click .btnInsertRelation":"_insertRelation","click .btnInsertScan":"_insertScan","click .btnInsertAnticipate":"_insertAnticipateTransfer","click .btnReload":"reload","click .btnApprover":"_approver","click .btnDestroy":"destroy","click .btnFinish":"_finish","click .btnFinishNotice":"_finishNotice","click .btnQuestion":"_sendQuestion","click .btnAnnouncement":"_announcement","click .btnSendAnswer":"_sendAnswer","click .btnSaveStore":"_saveStore","click .btnSupplementary":"_showSupplementary","click .requiredSupplementaryItem":"_sendSupplementary","click .btnAddRequiredSupplementary":"_addRequiredSupplementary","click .btnReceiveSupplmentary":"_receiveSupplementary","click .btnAnticipatePublish":"_configPublishPlan","click .btnRenewals":"_renewals","click .btnReturn":"_return","click .btnAppoint":"_appointment","click .btnCBCL":"_cbcl","click .btnConfirmTransferOrProcess":"_confirmTransferOrProcess","click .btnSaveDraft":"_saveDraft","click .btnphatHanhSoLieu":"_phatHanhTHSoLieuVaKetThuc","click .btnDinhChinhSoLieu":"_dinhChinhSoLieu","click .btnSave":"_saveDocument","click .btnEditDocInfo":"_editDocInfo","click .btnDuplicate":"_duplicateDocument","click .btnBusinessLicense":"_businessLicense","click .btnUndoFinish":"_undoFinish","click .btnRePublish":"_rePublish","click .btnCodeManager":"_showCodeTemp","click .btnUpdateLastResult":"_updateResult","click .btnBookCalendar":"_bookCalendar","click .btnFinishAndPublish":"_finishAndPublish","mouseover .btnSendMail":"_renderMailTemplate","hover .btnSendSms":"_renderSmsTemplate","click .btnInvoiceImport":"_importInvoice","click .btnExportExcel":"_exportExcel","click .btnExportPDF":"_exportPdf","click .btnExportWord":"_exportDoc","click .btnImportExcel":"_importExcel","click .btnViewLeaff":"_viewLeaf","click .btnImportWord":"_importWord","click .btnSurveyReleased":"_surveyReleased","click .btnExportSurveyPDF":"_surveyPDF"},initialize:function(n){this.$el=n.el;this.viewIcon=$.extend({},this.viewIcon);this.document=n.document;egov.mobile&&(this.viewIcon.docId=n.document.id);this.isQuickRender=n.isQuickRender;this.render()},render:function(){var n=this,i;i=n._getTemplate();n.defaultToolbarType?this._setDefaultViewIcon(n.defaultToolbarType):this.checkPermissions();var r=n.document.model.get("CategoryBusinessId"),t=n.document.model.get("Status"),u=n.document.model.get("StatusReport"),o=n.document.model.get("UserCurrentId"),f=n.document.model.get("UserCreatedId"),e=egov.userId,s=n.document.transferType===egov.locache.get("documentTransferType").taoMoiThongThuong;n.viewIcon.viewLuongChuyen=!0;n.document.isCreate&&(n.viewIcon.viewLuongChuyen=!1);r==4&&n.document.isCreate&&t==1&&(n.viewIcon.phatHanhTHSoLieu=!1);t==4&&u==4&&(n.viewIcon.phatHanhTHSoLieu=!1);r==4&&t==2&&u==2&&f!=e&&(n.viewIcon.phatHanhTHSoLieu=!0);require([i],function(t){var i,r;(n.document.model.get("CategoryBusinessId")==32?(i=n.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai,n.document.isCreate||i?egov.request.getDocumentCreateAction({data:{documentTypeId:i?n.document.newDoctype:n.document.model.get("DocTypeId"),isPhanloai:n.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai},success:function(i){if(i){n.actionSurvey=i.filter(function(n){return`${n.id}`.includes("LuuSoVaPhatHanh")});var r=n.document.model.get("StatusReport")||0;n.viewIcon.phatHanhSurvey=n.actionSurvey.length>0&&r===2;n.$el.html($.tmpl(t,n.viewIcon))}}}):egov.request.getDocumentEditAction({data:{documentCopyId:n.document.model.get("DocumentCopyId")},success:function(i){if(i){if(i.error)return egov.isMobile||egov.pubsub.publish(egov.events.status.error,i.error),n.$el.html($.tmpl(t,n.viewIcon)),null;n.actionSurvey=i.filter(function(n){return`${n.id}`.includes("LuuSoVaPhatHanh")});var r=n.document.model.get("StatusReport")||0;n.viewIcon.phatHanhSurvey=n.actionSurvey.length>0&&r===2;n.$el.html($.tmpl(t,n.viewIcon))}}})):n.$el.html($.tmpl(t,n.viewIcon)),n.defaultToolbarType)||(n.document.documentViewType!==egov.enum.documentViewType.default&&n.$el.find(".qtooltip").etip(),n.renderDoctypes(),n.renderDocContents(),n.viewIcon.viewIconDaPhatHanhOrKetThuc?n._insertAttachmentDaPhatHanhOrKetThuc():n._insertAttachment(),n._insertXMLAttachment(),n._insertImagePacket(),n._renderPrints(),r=egov.setting.transfer.isfiletag,r===!0&&$("#tagfile").removeClass("hidden"),n.$el.bindResources(),n.viewIcon.viewIconGiaHanXuLy||n.document.$(".changeDateAppointed").hide())})},renderDoctypes:function(){var n=this,t=egov.doctypes,e,i,f,u;if(t&&t.length>0)for(e=t.length,i=0;i<e;i++)f=t[i],u=r(f.DocTypeName,f.DocTypeId,"icon-text2",function(t,i){$(i.target).closest("ul.doctypeAnswer").length>0?n._answer(t):$(i.target).closest("ul.changeDoctypes").length>0&&n._changeDoctype(t)}),n.$(".ddlDoctypes").append(u);this.viewIcon.viewIconTraloiHSMC&&egov.request.getDocTypes({success:function(t){var f,i,u,e;if(t&&t.length>0)for(f=t.length,i=0;i<f;i++)(u=t[i],u.CategoryBusinessId!=4)&&(e=r(u.DocTypeName,u.DocTypeId,"icon-text2",function(t,i){$(i.target).closest("ul.doctypeAnswerHSMC").length>0&&n._answerHSMC(t)}),n.$(".ddlDoctypes").append(e))}});egov.isPrivateVersion&&(this.$kqkl=$("#kqklmrForm"),u=r("Trả lời bằng KQKLMR","00000000","icon-text2",function(){n._answerKQKLMR()}),this.$(".doctypeAnswer").prepend(u),this._closeKQKLMRAndReloadRelation())},renderDocContents:function(){var e,n,u,o;if(this.viewIcon.viewIconBangiao){var f=this,t=this.document.model.get("DocumentContents"),i=t.length;if(i==1)this.$(".btnEdit").on("click",function(n){n.preventDefault();f.document.editContent(t[0].DocumentContentId)});else if(i>1)for(this.$(".btnEdit").addClass("dropdown-toggle").attr("data-toggle","dropdown"),this.$(".btnEdit .caret").show(),e=this.$(".documentContents"),n=0;n<i;n++)u=t[n],o=r(u.ContentName,u.DocumentContentId,"icon-history2",function(n){f.document.editContent(n)}),e.append(o)}},checkPermissions:function(){var n=egov.enum.permission,i=this;this._setDefaultViewIcon();this.document.model.get("DocumentCopyId")!==0&&this.document.model.get("DocumentCopyId")!=="0"?(this.viewIcon.viewIconBangiao=t(this.model,n.bangiao),this.viewIcon.viewIconPhanloai=t(this.model,n.phanloai),this.viewIcon.viewIconSua=t(this.model,n.suavanban),this.viewIcon.viewIconXinykien=t(this.model,n.xinykien),this.viewIcon.viewIconKetthuc=t(this.model,n.ketthucxuly)||f(i.document),this.viewIcon.viewIconLuu=t(this.model,n.luuhosocanhan),this.viewIcon.viewIconThongbao=t(this.model,n.thongbao),this.viewIcon.viewIconTraloi=t(this.model,n.traloivanban),this.viewIcon.viewIconGuiykien=t(this.model,n.guiykien),this.viewIcon.viewIconKyDuyet=t(this.model,n.kyduyet),this.viewIcon.viewIconTraKetQua=t(this.model,n.traketqua),this.viewIcon.viewIconYeuCauBoSung=t(this.model,n.yeucaubosung),this.viewIcon.viewIconTiepNhanBoSung=t(this.model,n.tiepnhanbosung),this.viewIcon.viewIconGiaHanXuLy=t(this.model,n.giahanxuly),this.viewIcon.viewIconLuuvanban=t(this.model,n.luuvanban),this.viewIcon.viewIconHuyVanBan=t(this.model,n.huyvanban),this.viewIcon.viewIconCBCL=egov.isPrivateVersion,this.viewIcon.viewIconXacNhanBanGiao=t(this.model,n.xacnhanbangiao),this.viewIcon.viewIconDatLichHenTiep=t(this.model,n.hentiep),this.viewIcon.viewIconDuplicate=!0,this.viewIcon.viewIconCollapseForm=!0):(this.viewIcon.viewIconBangiao=!0,this.viewIcon.viewIconLuuDuThao=!0,this.viewIcon.viewIconKetthuc=this.document.newDoctype!=this.emptyDocTypeId);this.document.model.get("TransferTypeInEnum")==="PhanLoai"&&(this.viewIcon.viewIconBangiao=!0,this.viewIcon.viewIconLuuDuThao=!0,this.viewIcon.viewIconKetthuc=this.document.newDoctype!=this.emptyDocTypeId);this.document.model.get("CategoryBusinessId")!=1&&(this.viewIcon.viewIconTraloi=!1);this.document.model.get("DocTypeId")==this.emptyDocTypeId&&this.document.newDoctype==null&&(this.viewIcon.viewIconBangiao=!1);this.document.isInsertImagePacket&&(this.viewIcon.viewIconOther=!1);this.viewIcon.viewIconTraloiHSMC=!1;egov.setting.isNotAllowFinishDocument&&(this.viewIcon.viewIconHuyVanBan=!1);this.viewIcon.viewIconGiaHanXuLy=!0;this.viewIcon.viewIconInvoice=this.viewIcon.viewIconYeuCauBoSung;egov.setting.isNotAllowRenewal&&(this.viewIcon.viewIconGiaHanXuLy=!1);this.viewIcon.viewTuongMinh=this.document.model.get("CategoryBusinessId")==8?!0:!1;this.viewIcon.phatHanhSurvey=!1;this.viewIcon.viewSurvey=this.document.model.get("CategoryBusinessId")==32},_setIconSurvey:function(n){this.viewIcon.phatHanhSurvey=n.filter(function(n){return`${n.id}`.includes("LuuSoVaPhatHanh")}).length>0},checkDisable:function(n){return $(n.target).hasClass("disabled")||$(n.target).parents().hasClass("disabled")},_setDefaultViewIcon:function(n){var i,t,r;if(this.viewIcon.viewIconBangiao=!1,this.viewIcon.viewIconPhanloai=!1,this.viewIcon.viewIconSua=!1,this.viewIcon.viewIconXinykien=!1,this.viewIcon.viewIconKetthuc=!1,this.viewIcon.viewIconLuu=!1,this.viewIcon.viewIconThongbao=!1,this.viewIcon.viewIconTraloi=!1,this.viewIcon.viewIconGuiykien=!1,this.viewIcon.viewIconKyDuyet=!1,this.viewIcon.viewIconTraKetQua=!1,this.viewIcon.viewIconYeuCauBoSung=!1,this.viewIcon.viewIconTiepNhanBoSung=!1,this.viewIcon.viewIconGiaHanXuLy=!1,this.viewIcon.viewIconLuuvanban=!1,this.viewIcon.viewIconHuyVanBan=!1,this.viewIcon.viewIconXacNhanBanGiao=!1,this.viewIcon.viewIconXuLyTheoLo=!1,this.viewIcon.viewIconSendMail=!1,this.viewIcon.viewIconSendSms=!1,this.viewIcon.viewIconDatLichHenTiep=!1,this.viewIcon.viewIconPrint=!0,this.viewIcon.viewIconOther=!0,this.viewIcon.viewIconAttach=!0,this.viewIcon.viewIconLuuDuThao=!1,this.viewIcon.viewIconDuplicate=!1,this.viewIcon.viewIconDaPhatHanhOrKetThuc==!1,n===egov.enum.defaultToolbar.Create){this.viewIcon.viewIconBangiao=!0;return}if(n===egov.enum.defaultToolbar.Edit){this.viewIcon.viewIconBangiao=!0;return}if(n===egov.enum.defaultToolbar.InsertImagePacket){this.viewIcon.viewIconPrint=!1;this.viewIcon.viewIconOther=!1;return}i=this.document.model.get("CategoryBusinessId");this.viewIcon.viewIconXuLyTheoLo=this.document.model.get("DocumentCopyId")===0&&i===egov.enum.categoryBusiness.vbden;this.viewIcon.viewIconGiayPhep=this.document.model.get("DocumentCopyId")!=0&&i===egov.enum.categoryBusiness.hsmc;t=i===egov.enum.categoryBusiness.hsmc;this.viewIcon.viewIconSendMail=t;this.viewIcon.viewIconSendSms=t;this.viewIcon.viewIconPrint=t;this.viewIcon.viewIconPrintXLVB=!t;r=this.document.model.get("DocCopyStatus")==4&&egov.userId==this.document.model.get("UserCurrentId");this.viewIcon.viewIconDaPhatHanhOrKetThuc=r;r&&(this.viewIcon.viewIconAttach=!0,this.viewIcon.dinhChinhSoLieu=!0);this.viewIcon.viewIconUndoKetThuc=!1;this.viewIcon.viewIconPhatHanhLai=!1;(r||this.document.model.get("CategoryBusinessId")===2&&this.document.model.get("DocCode")&&this.document.model.get("DocCopyStatus")==0&&egov.userId==this.document.model.get("UserCurrentId"))&&(this.viewIcon.viewIconUndoKetThuc=!0,this.document.model.get("CategoryBusinessId")===2&&this.document.model.get("DocCode")&&(this.viewIcon.viewIconPhatHanhLai=!0,this.viewIcon.viewIconUndoKetThuc=!0))},_updateResult:function(){var n=this;n.document.updateLastResult("Cập nhật hồ sơ",function(){egov.pubsub.publish(egov.events.status.susscess,"Thêm dữ liệu thành công");n.document.tab.close(!0);n.document._reloadDocumentTree()})},_show2:function(n){var t=this,i,r;if(n){if(r=$(n.target).closest("a"),!this.viewIcon.viewIconBangiao)return;if(!t.document.isValid()){egov.helper.destroyClickEvent(n);return}if(t.actionList!==undefined&&t.document.transferType!==egov.locache.get("documentTransferType").banGiaoKhiPhanLoai){r.parent().toggleClass("open");egov.helper.destroyClickEvent(n);return}}if(t.actionElement=t.$(".transferActions"),t.actionListForShortKey!==undefined){t.actionList=t.actionListForShortKey;t._showActionResult(t.actionList);return}t.actionElement.append($("<li>").html(egov.helper.loading));i=t.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai;t.document.isCreate||i?egov.request.getDocumentCreateAction({data:{documentTypeId:i?t.document.newDoctype:t.document.model.get("DocTypeId"),isPhanloai:t.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai},success:function(n){n&&t._showActionResult(n)},complete:function(){t.actionElement.find(".loading").parent().remove()}}):this._getEditActions()},_showActions:function(n){var t=this,i,r;if(n){if(r=$(n.target).closest("a"),!this.viewIcon.viewIconBangiao)return;if(!t.document.isValid()){egov.helper.destroyClickEvent(n);return}if(t.actionList!==undefined&&t.document.transferType!==egov.locache.get("documentTransferType").banGiaoKhiPhanLoai){r.parent().toggleClass("open");egov.helper.destroyClickEvent(n);return}}if(t.actionElement=t.$(".transferActions"),t.actionListForShortKey!==undefined){t.actionList=t.actionListForShortKey;t._showActionResult(t.actionList);return}t.actionElement.append($("<li>").html(egov.helper.loading));i=t.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai;t.document.isCreate||i?egov.request.getDocumentCreateAction({data:{documentTypeId:i?t.document.newDoctype:t.document.model.get("DocTypeId"),isPhanloai:t.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai},success:function(n){n&&t._showActionResult(n)},complete:function(){t.actionElement.find(".loading").parent().remove()}}):this._getEditActions()},_getEditActions:function(){var n=this;egov.request.getDocumentEditAction({data:{documentCopyId:n.document.model.get("DocumentCopyId")},success:function(t){if(t){if(t.error)return egov.isMobile||egov.pubsub.publish(egov.events.status.error,t.error),null;n._showActionResult(t)}},complete:function(){n.actionElement.find(".loading").parent().remove()}})},_showActionResult:function(n){if(n.length===0){this.actionElement.html($("<li>").text(egov.resources.document.toolbar.noaction));return}this.actionList=_.sortBy(n,function(n){return n.priority});this._insertTransferActions()},_getActionList:function(){var n,i,r;(this.actionListForShortKey===undefined||this.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai)&&(n=this,i=this.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai,this.document.isCreate||i?egov.request.getDocumentCreateAction({data:{documentTypeId:i?this.document.newDoctype:this.document.model.get("DocTypeId"),isPhanloai:this.document.transferType===egov.locache.get("documentTransferType").banGiaoKhiPhanLoai},success:function(t){if(t.error)return egov.pubsub.publish(egov.events.status.error,t.error),null;t.length!==0&&(n.actionListForShortKey=_.sortBy(t,function(n){return n.priority}))}}):(r=egov.enum.permission,t(this.model,r.bangiao)&&egov.request.getDocumentEditAction({data:{documentCopyId:this.document.model.get("DocumentCopyId")},success:function(t){if(t.error)return null;(t.length!==0||n.actionElement===undefined)&&(n.actionListForShortKey=_.sortBy(t,function(n){return n.priority}))}})))},_insertTransferActions:function(){var i=this,s,f,h,o,t,c=8,l,v,a,e,y;for(this.actionElement.empty(),this.secondActionElement&&this.secondActionElement.empty(),this.document.plan&&this.document.plan.transfer&&(this.actionElement.append(r(n.document.toolbar.transferByDk,0,"icon-paperplane",function(){v=JSON.parse(i.document.plan.transfer);i._transferPlan(v)},!1)),this.actionElement.append($("<li>").addClass("divider"))),t=egov.enum.actionSpecial,s=this.actionList.length,s>c&&(this.secondActionElement=$("<ul class='dropdown-menu transferActions' role='menu'><\/ul>")),a=i.document.model.get("CategoryBusinessId"),e=0;e<s;e++)f=this.actionList[e],f.id=="LienThong"&&(f.name="Gửi phát hành báo cáo"),h=u(f.id),o=e<c?this.actionElement:this.secondActionElement,o.append(r(f.name,f.id,h,function(n,r){if(n===t.tiepTucXuLy.name||n===t.capNhatKetQuaDungXuLy.name||n===t.tiepNhanBoSung.name||n===t.lienThong.name){if(i.document.isCreate)return;n===t.lienThong.name&&i._lienThongHs(n);n===t.capNhatKetQuaDungXuLy.name&&i._continueProcess(n)}else n===t.tiepNhanHoSo.name||n===t.tiepNhanHoSoVaTiepTuc.name||n===t.chuyenNguoiCoQuyenDongGopYKien.name||n===t.chuyenNguoiGui.name||n===t.chuyenNguoiKhoiTao.name?n===t.tiepNhanHoSo.name||n===t.tiepNhanHoSoVaTiepTuc.name?i._transferSpecialCreate(n):i._transfer(n):n===t.luuSoNoiBo.name||(n===t.luuSoVaPhatHanhNoiBo.name?i._privatePublish(!0):n===t.luuSoVaPhatHanhRaNgoai.name?i._publishment():n===t.chuyenYKienDongGopVbDxl.name||n===t.chuyenYKienDongGopVbXinYKien.name?i._transferChuyenYKien(n):a!=32?i._transfer(n):i._transferSurvey(n));egov.helper.destroyClickEvent(r)},f.isAllow)),y=$(o.children()).find("a").filter(function(){return $(this).attr("value")==16}).length>0,a!==32&&!y&&this.actionList.filter(function(n){return`${n.id}`.includes("LuuSoVaPhatHanh")}).length>0&&(h=u(t.luuSoVaPhatHanhRaNgoai.id),o.append(r("Phát hành báo cáo lên VP chính phủ",16,h,function(n,t){i._publishmentGov();egov.helper.destroyClickEvent(t)},f.isAllow))),e!==s-1&&e!=c-1&&(l=this.actionList[e+1],l!=undefined&&f.priority!=l.priority&&o.append($("<li>").addClass("divider")));this.secondActionElement&&(this.actionElement.parent().find(this.secondActionElement).length==0&&(egov.isMobile?(this.actionElement.append($("<li>").addClass("divider")),this.actionElement.append(this.secondActionElement.children())):this.actionElement.parent().append(this.secondActionElement)),this.secondActionElement.css("left",this.actionElement.width()+1));this.document.newtransferplan&&this.actionElement.append(r(n.document.toolbar.transferUserDk,0,"icon-paperplane",function(){},!1))},_transfer:function(n){var t=_.find(this.actionList,function(t){return t.id===n});t&&this.document.transfer(t)},_transferSpecialCreate:function(n){var t=_.find(this.actionList,function(t){return t.id===n});t===undefined&&(t=_.find(this.actionListForShortKey,function(t){return t.id===n}));t&&this.document.transferSpecialCreate(t)},_transferChuyenYKien:function(n){this.document.sendAnswer(n)},_transferPlan:function(n){if(n){var t=_.find(this.actionList,function(t){return t.id===n.ActionId});this.document.transferPlan(t,n)}},_lienThongHs:function(){var n=this;require(["lienthong"],function(t){new t({document:n.document})})},_continueProcess:function(){var n=this;require(["continueProcess"],function(t){new t({document:n.document})})},_publishment:function(){this.document&&this.document.publishPlan?this.document.publishmentPlan(JSON.parse(this.document.publishPlan)):this.document.publishment()},_publishmentGov:function(){this.document&&this.document.publishPlan?this.document.publishmentPlan(JSON.parse(this.document.publishPlan)):this.document.publishmentGov()},_transferSurvey:function(n){var t=_.find(this.actionList,function(t){return t.id===n}),i;if(t){if(i=egov.views.survey.getDestination(),i.length==0){egov.pubsub.publish(egov.events.status.error,"Bạn chưa chọn đơn vị nhận . Vui lòng thử lại");return}this.document.transferSurvey(t)}},_publishmentSurvey:function(){this.document.publishmentSurvey()},_privatePublish:function(){this.document.privatePublishment()},_updateAttachment:function(){},_insertXMLAttachment:function(){var t=this;this.$(".fileuploadXML").fileupload({dataType:"json",start:function(){egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing)},stop:function(){},done:function(n,i){$.each(i.result,function(n,r){r.error!==""?($(i.id).remove(),egov.pubsub.publish(egov.events.status.error,r.name+": "+r.error)):$.ajax({type:"POST",url:"/Document/GetXMLFile2",data:{filename:r.key,doctypeId:t.document.model.get("DocTypeId")},success:function(){egov.pubsub.publish(egov.events.status.susscess,"Thêm dữ liệu thành công");t.document.tab.close(!0);t.document._reloadDocumentTree()},error:function(){egov.pubsub.publish(egov.events.status.error,"Không đọc được file")}})})},fail:function(t,i){egov.pubsub.publish(egov.events.status.error,n.file.errorUpload);$(i.id).remove()}})},_insertAttachment:function(){var t=this,r;this.$(".fileupload").fileupload({dataType:"json",dropZone:t.$(".divFiles"),pasteZone:null,add:function(u,f){var e=f.files[0],o="";i.maxFileSize&&e.size>i.maxFileSize?o+=e.name+": "+n.file.lenghtIsNotAllow+n.file.maxLength+i.maxFileSize/1048576+"Mb":egov.setting.acceptFileTypes.test(e.type)||egov.setting.acceptFileTypes.test("."+e.name.split(".").pop())?(r=new egov.models.attachment({Id:0,Name:e.name,Size:e.size,Extension:"."+e.name.split(".").pop(),Versions:[{Version:1,User:egov.setting.fullName+" ("+egov.setting.userName+")"}],isNew:!0,isUploading:!0}),f.attachment=r,t.document.attachments.model.add(r)):o+=e.name+": "+n.file.typeIsNotAllow;o!==""?egov.pubsub.publish(egov.events.status.error,o):f.submit()},start:function(){},progress:function(n,t){var i=parseInt(t.loaded/t.total*100,10);t.attachment&&t.attachment.view&&t.attachment.view.$(".progress-bar").css("width",i+"%")},stop:function(){egov.pubsub.publish(egov.events.status.destroy)},done:function(n,i){$.each(i.result,function(n,r){if(r.error!=="")$(i.id).remove(),t.document.attachments.model.remove(i.attachment),egov.pubsub.publish(egov.events.status.error,r.name+": "+r.error);else{var u=t.document.attachments.model.detect(function(n){return n.get("isNew")&&n.get("Name")===r.name});u&&(u.set("Id",r.key),u.set("isUploading",!1))}})},fail:function(t,i){egov.pubsub.publish(egov.events.status.error,n.file.errorUpload);$(i.id).remove()}})},_insertAttachmentDaPhatHanhOrKetThuc:function(){var t=this,r;this.$(".fileupload").fileupload({formData:{documentCopyId:t.document.model.get("DocumentCopyId")},dataType:"json",dropZone:t.$(".divFiles"),pasteZone:null,add:function(u,f){var e=f.files[0],o="";i.maxFileSize&&e.size>i.maxFileSize?o+=e.name+": "+n.file.lenghtIsNotAllow+n.file.maxLength+i.maxFileSize/1048576+"Mb":egov.setting.acceptFileTypes.test(e.type)||egov.setting.acceptFileTypes.test("."+e.name.split(".").pop())?(r=new egov.models.attachment({Id:e.key?e.key:0,Name:e.name,Size:e.size,Extension:"."+e.name.split(".").pop(),Versions:[{Version:1,User:egov.setting.fullName+" ("+egov.setting.userName+")"}],isNew:!0,isPhatHanhOrKetThuc:!0}),t.document.attachments.model.add(r)):o+=e.name+": "+n.file.typeIsNotAllow;o!==""?egov.pubsub.publish(egov.events.status.error,o):f.submit()},start:function(){egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing)},stop:function(){egov.pubsub.publish(egov.events.status.destroy)},done:function(n,i){$.each(i.result,function(n,r){if(r.error!=="")$(i.id).remove(),egov.pubsub.publish(egov.events.status.error,r.name+": "+r.error);else{var u=t.document.attachments.model.detect(function(n){return n.get("isNew")&&n.get("Name")===r.name});u&&u.set("Id",r.key)}})},fail:function(t,i){egov.pubsub.publish(egov.events.status.error,n.file.errorUpload);$(i.id).remove()}})},_insertRelation:function(){var t=this;require(["egovSearch"],function(i){var r=new i({currentDoc:t.document,isRelationDoc:!0});r.openDialog({height:"400px",width:"850px",draggable:!0,title:n.document.relation.titleDialog,buttons:[{text:n.common.addButton,className:"btn-primary",click:function(){var i=r.getSelected(),u,n;if(i&&!(i.length<=0)){var e=r.$el.parents(".modal-dialog").find("#isHoiBao"),f=e.is(":checked"),o=i.length;for(r.$el.dialog("hide"),r.$el.empty(),u=0;u<o;u++)n=i[u],t.document.relations.model.add(new egov.models.relation({RelationCopyId:n.get("DocumentCopyId"),RelationId:n.get("DocumentId"),RelationType:f&f==!0?3:1,IsAddNext:!1,Compendium:n.get("DocumentCompendium"),CitizenName:n.get("DocumentCompendium"),DocCode:n.get("ExtendInfo").DocCode,DateCreated:n.get("ExtendInfo").DateCreate,CategoryName:n.get("ExtendInfo").CategoryName}))}}},{text:n.common.closeButton,className:"btn-close",click:function(){r.$el.dialog("hide");r.$el.empty()}}],addCallBack:function(n){n.parent().next().prepend('<div class="pull-left"><label class="checkbox document-color"><input id="isHoiBao" name="checkbox[]" value="2378" type="checkbox" ><span class="document-color-1"><i class="icon-check"><\/i><\/span><\/label><span for="isHoiBao">Là văn bản hồi báo<\/span><\/div>')}})})},_insertScan:function(){var n=this;require(["scanner"],function(t){var i;n.isLoadedScanner?i=new t({parent:n,isLoaded:!0}):(i=new t({isLoaded:!1,parent:n}),n.isLoadedScanner=!0)})},_insertPacket:function(){var t=this,s,h=!1,r,u,f,e,o;egov.waitingPacket||(egov.waitingPacket=[]);e=0;o=0;t.$(".packetFileupload").fileupload({dataType:"json",dropZone:t.$(".divFiles"),pasteZone:null,add:function(t,o){e++;r=o.files[0];u="";f="."+r.name.split(".").pop();i.maxFileSize&&r.size>i.maxFileSize?u+=r.name+": "+n.file.lenghtIsNotAllow:egov.setting.acceptFileTypes.test(r.type)||egov.setting.acceptFileTypes.test(f)||f===".pdf"||f===".PDF"||(u+=r.name+": "+n.file.typeIsNotAllow);u!==""?egov.pubsub.publish(egov.events.status.error,u):o.submit()},start:function(){egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing)},stop:function(){egov.pubsub.publish(egov.events.status.destroy)},done:function(n,i){o++;$.each(i.result,function(n,r){r.error!==""?($(i.id).remove(),egov.pubsub.publish(egov.events.status.error,r.name+": "+r.error)):(s=new egov.models.attachment({Id:r.key,Name:r.name,Size:r.size,Extension:"."+r.name.split(".").pop(),Versions:[{Version:1,User:egov.setting.fullName+" ("+egov.setting.userName+")"}],isNew:!0}),egov.waitingPacket.push({docTypeId:t.document.model.get("DocTypeId"),title:t.document.model.get("DocTypeName"),attachment:s,opened:!1,fileName:r.name}),egov.waitingPacket=_.sortBy(egov.waitingPacket,function(n){return n.fileName}),h||o!==e||(t.document.isPacket=!0,egov.views.home.tab.createDocInWaitingPacket(t.document),h=!0))})},fail:function(){egov.pubsub.publish(egov.events.status.error,n.file.errorUpload)}})},_insertImagePacket:function(){var t=this,e,o=!1,r,u,f,s,h;egov.waitingPacket||(egov.waitingPacket=[]);s=0;h=0;t.$(".imagePacketFileupload").fileupload({dataType:"json",dropZone:t.$(".divFiles"),pasteZone:null,singleFileUploads:!1,add:function(t,e){r=e.files[0];u="";f="."+r.name.split(".").pop();f=f.toLowerCase();i.maxFileSize&&r.size>i.maxFileSize?u+=r.name+": "+n.file.lenghtIsNotAllow:egov.setting.acceptFileTypes.test(r.type)||egov.setting.acceptFileTypes.test(f)||f===".pdf"||(u+=r.name+": "+n.file.typeIsNotAllow);s++;u!==""?egov.pubsub.publish(egov.events.status.error,u):e.submit()},start:function(){egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing)},stop:function(){egov.pubsub.publish(egov.events.status.destroy)},done:function(n,i){h++;var r=[];$.each(i.result,function(n,u){u.error!==""?($(i.id).remove(),egov.pubsub.publish(egov.events.status.error,u.name+": "+u.error)):(e=new egov.models.attachment({Id:u.key,Name:u.name,Size:u.size,Extension:"."+u.name.split(".").pop(),Versions:[{Version:1,User:egov.setting.fullName+" ("+egov.setting.userName+")"}],isNew:!0}),r.push(u.key),egov.waitingPacket.push({docTypeId:t.document.model.get("DocTypeId"),title:t.document.model.get("DocTypeName"),attachment:e,opened:!1,fileName:u.name}),egov.waitingPacket=_.sortBy(egov.waitingPacket,function(n){return n.fileName}),egov.hasImagePacket=!0,o||(t.document.isPacket=!0,egov.views.home.tab.createDocInWaitingPacket(t.document),o=!0))})},fail:function(){egov.pubsub.publish(egov.events.status.error,n.file.errorUpload)}})},_insertAnticipateTransfer:function(){this.document.anticipate()},_finishAndPublish:function(){this.document.finishAndPublishData()},_changeDoctype:function(n){var i=this,u=egov.enum.permission,r;this.document.newDoctype=n;this.document.hasChangeInfo=!0;this.document.transferType=egov.locache.get("documentTransferType").banGiaoKhiPhanLoai;t(this.model,u.doihanxulykhiphanloai)&&egov.message.show(egov.resources.document.ChangeDoctype.hasChangeDateAppoint,egov.resources.common.alert,egov.message.messageButtons.YesNo,function(){i.document.hasChangeDateAppoint=!0});this.document.model.get("DocTypeId")&&this.document.model.get("DocTypeId")!=this.emptyDocTypeId?egov.message.show("Bạn có muốn đánh lại số đến cho văn bản này không?",egov.resources.common.alert,egov.message.messageButtons.YesNo,function(){i.document.model.set("HasChangeInoutCode",!0);i.document.renderStoreWhenChangeDocType(n)}):(i.document.model.set("HasChangeInoutCode",!0),i.document.renderStoreWhenChangeDocType(n));this.document.model.set("TransferTypeInEnum","PhanLoai");this.viewIcon.viewIconBangiao||(r=this.document.model.get("DocumentContents"),r[0].IsEdited=!0,this.document.model.set("DocumentContents",r),this.model=0,this.render())},_sendQuestion:function(){this.document.sendQuestion()},_announcement:function(){this.document.announcement()},_sendAnswer:function(){this.document.sendComment()},_saveStore:function(){this.document.saveStore()},_answerHSMC:function(n){var t=this.document.model.toJSON().Attachments,i=_.each(t,function(n){n.isNew=!0});this.document.answerHSMC(n,i)},_answer:function(n){this.document.answer(n)},_finish:function(n){var t,r,i;if(!this.checkDisable(n)){if(this.document.$("#Comment").next(".error").remove(),t=this.document.$("#Comment").val(),egov.setting.transfer.requireCommentWhenFinish&&t===""){this.document.$("#Comment").after('<label class="error">Bạn cần nhập lý do kết thúc văn bản.<\/span>');return}if(this.document.model.get("DocumentCopyType")==2){r=egov.enum.actionSpecial.chuyenYKienDongGopVbDxl.name;this._transferChuyenYKien(r);return}if(!this.document.model.get("DocumentCopyId")==0){this.document.finish();return}i=this.document;require(["docStoreView"],function(n){egov.views.home.documents.storePrivate||(egov.views.home.documents.storePrivate=new n);var r=egov.setting.hasHideLuuSo;egov.pubsub.publish(egov.events.status.processing,egov.resources.document.finish.processing);i.saveDocument(function(n){egov.request.finish({data:{documentCopyId:n.documentCopyId,storePrivateId:storeId,comment:t,isThongBao:!1},success:function(n){n.error?(egov.pubsub.publish(egov.events.status.error,egov.resources.document.finish.error),i.tab.close(!0)):egov.pubsub.publish(egov.events.status.success,"Kết thúc văn bản thành công.")},error:function(){}})})})}},_finishNotice:function(n){this.checkDisable(n)||this.document.finishNotification()},_approver:function(n){if(!this.checkDisable(n)){var t=$(n.target).closest(".btnApprover"),i=t.hasClass("yes");this.document._approve(i);this._showActions(n)}},_showSupplementary:function(n){var t=this;this.checkDisable(n)||this.document.receiveSupplementary()},_sendSupplementary:function(n){var t=$(n.target).closest(".requiredSupplementaryItem");this.document.model.get("Supplementary").add({UserSendName:egov.userName,Comment:t.text()})},_addRequiredSupplementary:function(){var n=this,t;egov.message.prompt(egov.resources.requiredSupplementary.addRequiredTitle,egov.resources.common.addButton,function(i){i!=null&&i!==""&&egov.request.createRequiredSupplementary({data:{content:i},success:function(i){i&&(n.requiredSupplementary.push(i),t=$("<a  href='#' class='requiredSupplementaryItem'>").text(i.Name),n.suppElement.prepend($("<li>").append(t)),n.$(".btnSupplementary").click())}})},!0)},_receiveSupplementary:function(){var n=this;this.document.receiveSupplementary()},reload:function(n){egov.helper.destroyClickEvent(n);this.document.reload()},_configPublishPlan:function(){if(this.document&&this.document.publishPlan){var n=JSON.parse(this.document.publishPlan);this.document.publishmentPlan(n,!0)}else this.document.comfigPublishmentPlan()},_getTemplate:function(){var n=egov.template.toolbar;return egov.isMobile?n.mobile:this.document.documentViewType===egov.enum.documentViewType.default?n.desktop:egov.setting.userSetting.quickView===egov.enum.quickViewType.right?n.quickViewRight:egov.setting.userSetting.quickView===egov.enum.quickViewType.below?n.quickViewBelow:""},_renewals:function(n){this.checkDisable(n)||this.document.renewals()},_return:function(n){this.checkDisable(n)||this.document.isHsmc&&this.document.returnResult()},_appointment:function(n){this.checkDisable(n)||this.document.isHsmc&&this.document.createNewAppoint()},destroy:function(t){this.checkDisable(t)||confirm(n.document.confirmDestroy)&&this.document.RemoveDocument()},_renderPrints:function(){var n=this,t,i;egov.isMobile||(n.printList=n.document.model.get("CategoryBusinessId")!=4?n.$(".ddl-printListXlvb"):n.$(".ddl-printList"),egov.request.getPrintByDocCopys({data:{docCopyIds:JSON.stringify([n.document.model.get("DocumentCopyId")]),docTypeId:n.document.model.get("DocTypeId")},success:function(u){i=u.length;i>0&&_.each(u,function(i){t=r(i.Name,i.Id,"icon-print",function(t){n._openPrint(t)});n.printList.append(t)})}}))},_openPrint:function(n){var t,i;if(t=this,i=t.document.model.get("DocumentCopyId"),i==0){t.document.printReceiptShortKey(!0,n);return}require(["print"],function(r){r=new r({docCopyId:[parseInt(i)],docId:t.document.model.get("DocumentId"),paperAddIds:"",feeAddIds:"",displayPreview:!0,printId:n})})},_confirmTransferOrProcess:function(){var n=this;require(["confirmTransferOrProcess"],function(t){new t({docCopyId:n.document.model.get("DocumentCopyId"),isTransfer:!0})})},_renderMailTemplate:function(){var n=this;this.viewIcon.viewIconSendMail&&!this.isLoadedMailTmp&&(this.$mailTmpList=this.$(".sendMails"),this.$mailTmpList.append($("<li>").html(egov.helper.loading)),egov.request.getMailTemplates({data:{documentCopyId:n.document.model.get("DocumentCopyId")},success:function(t){if(t.error){egov.pubsub.publish(egov.events.status.error,t.error);return}n.isLoadedMailTmp=!0;t.length>0&&(n.$mailTmpList.addClass("active"),_.each(t,function(t){var i=r(t.Name,t.TemplateId,"icon-mail2",function(){n._getTempMail(t.TemplateId,t.Name)},!0);n.$mailTmpList.append(i)}))},complete:function(){n.$mailTmpList.find(".loading").parent().remove()}}))},_getTempMail:function(n,t){this.viewIcon.viewIconSendMail&&this.document.getTempMailOrSms(n,t,!0)},_renderSmsTemplate:function(){if(this.viewIcon.viewIconSendSms&&!this.isLoadedSmsTmp){var n=this;this.$sendSmsList=this.$(".sendSmss");this.$sendSmsList.append($("<li>").html(egov.helper.loading));egov.request.getSmsTemplates({data:{documentCopyId:n.document.model.get("DocumentCopyId")},success:function(t){if(t.error){egov.pubsub.publish(egov.events.status.error,t.error);return}n.isLoadedSmsTmp=!0;t.length>0&&(n.$sendSmsList.addClass("active"),_.each(t,function(t){var i=r(t.Name,t.TemplateId,"icon-phone",function(){n._getTempSms(t.TemplateId,t.Name)},!0);n.$sendSmsList.append(i)}))},complete:function(){n.$sendSmsList.find(".loading").parent().remove()}})}},_getTempSms:function(n,t){this.viewIcon.viewIconSendSms&&this.document.getTempMailOrSms(n,t,!1)},_saveDraft:function(){var n=this.document;n.saveDocument(function(t){egov.pubsub.publish(egov.events.status.success,egov.resources.document.saveSuccess);var i=_.find(egov.waitingPacket,function(t){return t.attachment.get("Id")==n.attachmentIdInWaitingPacket});if(i){n.tab.close(!0);i.saved=!0;i.documentCopyId=t.documentCopyId;i.title=n.model.get("Compendium");egov.waitingPacket.remove(i);egov.waitingPacket.push(i);return}n.tab.close(!0);n.model.get("CategoryBusinessId")===egov.enum.categoryBusiness.vbden&&egov.views.home.tab.addDocument(n.model.get("DocTypeId"),n.model.get("DocTypeName"));location.reload()})},_phatHanhTHSoLieuVaKetThuc:function(){var t=this,i=t.document.model.get("DocumentCopyId"),r=t.document.model.get("WorkflowId"),n;egov.pubsub.publish(egov.events.status.processing,"Đang xử lý");n=$("<strong>Bạn có muốn phát hành không?<\/strong>");n.dialog({title:"Phát hành",height:"auto",width:600,buttons:[{text:"Có",className:"btn-success",click:function(){t._sendPublish(i,r);n.dialog("destroy")}},{text:egov.resources.common.closeButton,className:"btn-close",click:function(){n.dialog("destroy")}}]})},_sendPublish:function(n){var t=this,i=t.document.serialize();egov.request.fiAndPub({data:{documentCopyId:n,storePrivateId:i.StoreId,comment:"Đã phát hành và kết thúc",isThongBao:!1},success:function(i){i.success?(t._closeTab(n),t.document._reloadDocumentTree(n),egov.pubsub.publish(egov.events.status.success,"Phát hành thành công.")):egov.pubsub.publish(egov.events.status.error,i.message)},error:function(){}})},_dinhchinh:function(){var n={},r=egov.enum.transferType,i=[],t=this;egov.request.getAction({data:{documentCopyId:_docCopyId},success:function(u){var e=u.length,f=$.grep(u,function(n){return n.id==="ChuyenNguoiKhoiTao"});egov.request.getUserByAction({data:{actionId:f.id,workflowId:_workflowId,documentCopyId:_docCopyId,userId:egov.userId},success:function(u){i.push({label:u[0].fullname,department:u[0].department,value:"",type:r.xulychinh});n.UserIdXlc=u[0].value;n.UserIdsDxl=[];n.IsThongbao=!1;n.IsDxl=!0;n.IsAttachYk=!1;n.UserIdsDg=[];n.UserTb=[];n.NextNodeId=t.document.documentInfo.get("NodeCurrentId")+1;n.CurrentNodeId=t.document.documentInfo.get("NodeCurrentId");n.WorkflowId=t.document.model.get("WorkflowId");n.NewDocTypeId=t.document?t.document.newDoctype:undefined;n.TargetComment=JSON.stringify(i);n.ActionId=_actionId.id;n.ExtInfo="";n.PublishPlanId=t.document?t.document.publishPlanId:0;t._publishQD(n,_docCopyId)},error:function(n){console.log("Lỗi khi lấy wordflowId "+n)}})},error:function(n){egov.pubsub.publish(egov.events.status.error,"Lỗi khi lấy actionId "+n)}})},_publishQD:function(n,t){var o=this,i=this.document.serialize(),f,e,r,u;this.storeId&&this.code&&(i.StoreId=this.storeId,i.DocCode=this.code,i.CodeId=this.codeId);f={};this.document.attachments.model.each(function(n){n.get("isNew")&&!n.get("isRemoved")&&(f[n.get("Id")]={name:n.get("Name")})});e=this.document.attachments.model.select(function(n){return n.get("isRemoved")});e=_.map(e,function(n){return n.get("Id")});r=this.document.attachments.modifiedFiles;$.each(f,function(n,t){r[n]&&(t.content=r[n],delete r[n])});u=this.document.getDestinationPlan();u&&(u=JSON.stringify(u));egov.request.publishAndFinish({data:{doc:JSON.stringify(i),destination:n?JSON.stringify(n):"",files:JSON.stringify(f),modifiedFiles:JSON.stringify(r),removeAttachmentIds:e,storePrivateId:i.StoreId==null?0:i.StoreId,destinationPlan:u},success:function(){egov.request.fiAndPub({data:{documentCopyId:t,storePrivateId:i.StoreId,comment:"Đã phát hành và kết thúc",isThongBao:!1},success:function(n){n.error||n==null?egov.pubsub.publish(egov.events.status.error,egov.resources.document.finish.error):(egov.pubsub.publish(egov.events.status.success,"Phát hành thành công."),o._closeTab(t),o.document._reloadDocumentTree(t))},error:function(){}})},error:function(n){egov.pubsub.publish(egov.events.status.error,"Lỗi khi phát hành "+n)}})},_closeTab:function(n){var t=this,r="Normal",i,u=t.document.model.get("DocumentCopyId"),f=function(){if(t.document.isSaveChanged=!0,r=="TiepNhanHoSoVaTiepTuc")egov.pubsub.publish(egov.events.status.success,"Tiếp nhận hồ sơ thành công.");else{if(t.document.isPopUp)return;t.document.$el.removeClass("display");egov.isMobile||(t.document.tab.display(!1),egov.views.home.tab.activeTab(0));var n;i&&i.TransferTypeInEnum=="TraLoi"&&(n=parseInt(i.relationAnswerId),egov.views.home.tab.closeTab([n]));t._reloadDocumentList(n&&isNaN(n)?[t.document.model.get("DocumentCopyId"),n]:[t.document.model.get("DocumentCopyId")]);egov.callback(t.callback)}};if(this.document)this.document.isSaveChanged=!0,this.document.tab&&this.document.tab.close2(!1);else if(egov.views.home&&egov.views.home.tab){if(!n)return;n instanceof Array||(n=[n]);egov.views.home.tab.closeTab(n)}},showDinhChinh:function(){},_dinhChinhSoLieu:function(){alert("oke")},_saveDocument:function(){var n=this.document;n.updateDocument(function(){})},_editDocInfo:function(){egov.views.home.tab.openDocument(this.document.model.get("DocumentCopyId"),this.document.model.get("Compendium"))},_duplicateDocument:function(){var t,n;t=this;n=this.document;n.model.get("DocTypeId")&&egov.views.home.tab.duplicateDocument(n.model)},_businessLicense:function(n){this.checkDisable(n)||this.document._businessLicense()},_importInvoice:function(n){this.checkDisable(n)||this.document._importInvoice()},_exportExcel:function(n){this.checkDisable(n)||this.document._exportExcel()},_exportPdf:function(){this.document._exportPdf()},_exportDoc:function(){this.document._exportDoc()},_importExcel:function(n){this.checkDisable(n)||this.document._importExcel()},_viewLeaf:function(){this.document.showLeaf()},_importWord:function(n){this.checkDisable(n)||this.document._importWord()},_surveyReleased:function(){var n=this;egov.views.survey._onReleased(n.document,n.actionSurvey.length>0?n.actionSurvey[0]:{})},_surveyPDF:function(){var n=this,t=n.document.model.get("Compendium")+".pdf",i=JSON.parse(n.document.model.get("Note")||"{}");egov.views.survey._saveSurveyToPdf(t,i)},_undoFinish:function(n){var t,i;this.checkDisable(n)||(t=confirm("Bạn có muốn lấy lại văn bản?"),t!=!1)&&(i=this.document,this.document.undoFinish(i.model.get("DocumentCopyId")))},_rePublish:function(n){if(!this.checkDisable(n)){var t=this.document;this.document.rePublish(t.model.get("DocumentCopyId"))}},_bookCalendar:function(){var i=this.document.model.get("Compendium"),r=this.document.model.get("Organization"),n=$("<div>"),t;n.dialog({height:"350px",width:"900px",draggable:!0,title:"Tạo lịch họp",buttons:[{text:"Tạo lịch",className:"btn-primary",click:function(){n.find("#createCalendar")[0].contentWindow.createFromDocument(function(){egov.pubsub.publish(egov.events.status.success,"Tạo lịch thành công.");n.dialog("hide");n.remove()})}},{text:"Bỏ qua",className:"btn-default",click:function(){n.dialog("hide");n.remove()}},]});n.html('<iframe src="/Calendar/IndexFromDocument" id="createCalendar" style="width: 870px; height: 344px; border:none"><\/iframe>');t=n.find("#createCalendar")[0];t.onload=function(){$(t.contentDocument).find(".title").val(i);$(t.contentDocument).find(".department").val(r)}}})});