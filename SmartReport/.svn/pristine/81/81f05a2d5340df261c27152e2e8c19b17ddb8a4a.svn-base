(function(n){function f(n){if(typeof n!="undefined"&&n&&n!="")return n.replace(/<script.*?>.*?<\/script>/igm,"")}function e(n){if(typeof n!="undefined"&&n&&n!=""){var t=this.noscript(n),i=document.createElement("div");return i.innerHTML=t.replace(/(<br\/>|<br>|<\/div>|<\/p>)/igm,"\n").replace(/(<div>|<p>)/igm,""),t=i.textContent||i.innerText||"",this.htmlEnc(t)}}function o(){var u=[],i=self.location.href,n,t,r;if(i=i.split("?"),i.length>1)for(n=i[1],n=n.split("&"),t=0;t<n.length;t++)r=n[t],r=n[t].split("="),u[decodeURIComponent(r[0])]=decodeURIComponent(r[1]);return u}function s(n){if(typeof n!="undefined"&&n){var t=n;return t.indexOf("/")!=-1&&(t=t.substring(0,t.indexOf("/"))),t}}function h(n){if(typeof n!="undefined"&&n){var t=n,i="";return t.indexOf("/")!=-1&&(i=t.substring(t.indexOf("/")+1,t.length)),i}}function c(n){if(typeof n!="undefined"&&n&&n!="")return n=n.replace(/%/g,"%25"),n=n.replace(/\n/g,"%0A"),n=n.replace(/\r/g,"%0D"),n=n.replace(/ /g,"%20"),n=n.replace(/\"/g,"%22"),n=n.replace(/#/g,"%23"),n=n.replace(/\$/g,"%24"),n=n.replace(/&/g,"%26"),n=n.replace(/\(/g,"%28"),n=n.replace(/\)/g,"%29"),n=n.replace(/\+/g,"%2B"),n=n.replace(/,/g,"%2C"),n=n.replace(/\//g,"%2F"),n=n.replace(/\:/g,"%3A"),n=n.replace(/\;/g,"%3B"),n=n.replace(/</g,"%3C"),n=n.replace(/=/g,"%3D"),n=n.replace(/>/g,"%3E"),n.replace(/@/g,"%40")}function l(n){return n=n.replace(/@/,"at"),n=n.replace(/\./g,"dot"),n=n.replace(/\//g,"slash"),n=n.replace(/&/g,"amp"),n=n.replace(/\'/g,"tick"),n=n.replace(/=/g,"equals"),n=n.replace(/#/g,"pound"),n=n.replace(/:/g,"colon"),n=n.replace(/%/g,"percent"),n=n.replace(/-/g,"dash"),n=n.replace(/ /g,"blank"),n.replace(/\*/g,"asterix")}function a(n){return n?(n=n.replace(/&/g,"&amp;"),n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;"),n.replace(/\"/g,"&quot;")):""}function v(n){return n?(n=n.replace(/&amp;/g,"&"),n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n.replace(/&quot;/g,'"')):""}function y(n){var i,r,t;if(!n)return null;if(n=this.htmlEnc(n),typeof emoticons!="undefined")for(i in emoticons)emoticons.hasOwnProperty(i)&&(r=i.replace(/\\/g,""),t=new Image,t.src=emoticonpath+emoticons[i],n=t.width>0&&t.height>0?n.replace(eval("/(\\s|^)"+i+"(\\s|$)/g"),'$1<img src="'+t.src+"\" width='"+t.width+"' height='"+t.height+"' alt=\""+r+'" title="'+r+'">$2'):n.replace(eval("/(\\s|^)"+i+"(\\s|$)/g"),'$1<img src="'+t.src+'" alt="'+r+'" title="'+r+'">$2'));return n=n.replace(/(\s|^)(https?:\/\/\S+)/gi,'$1<a href="$2" target="_blank">$2<\/a>'),n=n.replace(/(\s|^)(ftp:\/\/\S+)/gi,'$1<a href="$2" target="_blank">$2<\/a>'),n=n.replace(/(\s|^)(\w+\@\S+\.\S+)/g,'$1<a href="mailto:$2">$2<\/a>'),n=n.replace(/(\s|^)\*([^\*\r\n]+)\*/g,"$1<b>$2<\/b>"),n=n.replace(/(\s|^)\_([^\*\r\n]+)\_/g,"$1<u>$2<\/u>"),n.replace(/\n/g,"<br>")}function p(n){for(var r=n.substring(0,n.lastIndexOf("@")),i=0;i<t.length;i++)if(r.indexOf(t[i])!=-1)return alert("Invalid JID\n'"+t[i]+"' not allowed in JID.\nChoose another one!"),!1;return!0}function w(n){var i=new Date(Date.UTC(n.substr(0,4),n.substr(5,2)-1,n.substr(8,2),n.substr(11,2),n.substr(14,2),n.substr(17,2))),t;return n.substr(n.length-6,1)!="Z"&&(t=new Date,t.setTime(0),t.setUTCHours(n.substr(n.length-5,2)),t.setUTCMinutes(n.substr(n.length-2,2)),n.substr(n.length-6,1)=="+"?i.setTime(i.getTime()-t.getTime()):n.substr(n.length-6,1)=="-"&&i.setTime(i.getTime()+t.getTime())),i}function b(n){return this.jab2date(n).toLocaleString()}function k(n){if(n.getUTCFullYear){var t=n.getUTCFullYear()+"-";return t+=(n.getUTCMonth()+1<10?"0":"")+(n.getUTCMonth()+1)+"-",t+=(n.getUTCDate()<10?"0":"")+n.getUTCDate()+"T",t+=(n.getUTCHours()<10?"0":"")+n.getUTCHours()+":",t+=(n.getUTCMinutes()<10?"0":"")+n.getUTCMinutes()+":",t+((n.getUTCSeconds()<10?"0":"")+n.getUTCSeconds()+"Z")}}function d(n){var t,i,r;window.getSelection?(t=window.getSelection(),t.getRangeAt&&t.rangeCount&&(i=t.getRangeAt(0),i.deleteContents(),r=document.createTextNode(n),i.insertNode(r),i.setStartAfter(r),t.removeAllRanges(),t.addRange(i))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=n)}function g(){var t=null,n;return window.getSelection?(n=window.getSelection(),n.getRangeAt&&n.rangeCount&&(t=n.getRangeAt(0))):document.selection&&document.selection.createRange&&(t=document.selection.createRange()),t}function nt(n){if(n)if(window.getSelection){var t=window.getSelection();t.removeAllRanges();t.addRange(n)}else document.selection&&n.select&&n.select()}function tt(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function it(n,t){return Math.round(Math.abs((n.getTime()-t.getTime())/36e5))}function rt(n){var t=new Date,i=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),r=n.getHours()<10?"0"+n.getHours():n.getHours();return n.getDate()===t.getDate()?r+":"+i:n.getDate()===t.getDate()-1?"Hôm qua":n.getWeek()===t.getWeek()?["Chủ nhật","T2","T3","Thứ 4","Thứ 5","Thứ 6","Thứ 7"][n.getDay()]:n.getFullYear()==t.getFullYear()?n.getDate()+"/"+(n.getMonth()+1):n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear()}function ut(n){var r=new Date,t=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),i=n.getHours()<10?"0"+n.getHours():n.getHours();return n.getDate()===r.getDate()?i+":"+t:n.getDate()===r.getDate()-1?"Hôm qua, "+i+":"+t:n.getWeek()===r.getWeek()?["Chủ nhật","Thứ 2","Thứ 3","Thứ 4","Thứ 5","Thứ 6","Thứ 7"][n.getDay()]+", "+i+":"+t:n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear()+", "+i+":"+t}function ft(n){var t=new Date,i=this.diffDays(n,t);return i==0?"Hôm nay":i==1?"Hôm qua":n.getWeek()==t.getWeek()?["Chủ nhật","Thứ 2","Thứ 3","Thứ 4","Thứ 5","Thứ 6","Thứ 7"][n.getDay()]:n.getWeek()<t.getWeek()?n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear():void 0}function et(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,function(n,t){return String.fromCharCode("0x"+t)}))}function ot(n){for(var i=n.toString(),r="",t=0;t<i.length;t+=2)r+=String.fromCharCode(parseInt(i.substr(t,2),16));return r}function st(n){for(var i,u=window.location.search.substring(1),r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return i[1]}function ht(n){return n>=48&&n<=57||n>=65&&n<=90||n>=96&&n<=105?!0:!1}function ct(n,t,r){this._user=n;this._contentMsg=r;this._time=t;this._seletor=$("#input_replymsg");var f=i.getCoolTime2(new Date(this._time)),u=this;this.showQuote=function(){var n="<table><tr><td><i id='content_msg_reply' class='contentreply'>"+u._contentMsg+"<\/i><\/td><\/tr><tr><td id='sender_msg' data-time = "+u._time+"  data-sender="+u._user+" >"+u._user+", "+f+"<\/td><\/tr><\/table>";u._seletor.html(n)};this.hiddeQuote=function(){u._seletor.html("")}}var r,u,t,i;n.btalk||(r="1.0.0",u="Bkav coporation",t=['"'," ","&","'","/",":","<",">","@"],Date.prototype.getWeek=function(){var n=new Date(this.getFullYear(),0,1);return Math.ceil(((this-n)/864e5+n.getDay()+1)/7)},i={version:r,author:u,ROSTER:null,noscript:f,htmlEnc:a,htmlDec:v,text:e,getArgs:o,cutResource:s,getResource:h,msgEscape:c,makeWindowName:l,msgFormat:y,isValidJID:p,jab2date:w,hrTime:b,jabberDate:k,insertTextAtCursor:d,saveSelection:g,restoreSelection:nt,clearSelection:tt,diffDays:it,getCoolTime:rt,getCoolTime2:ut,getCoolDay:ft,b64EncodeUnicode:et,hex2string:ot,getQueryVariable:st,isAlphanumericKeycode:ht,QuoteObject:ct,temporaryQuote:null,listSeenCache:[],VIEWED_CACHE_LIST:{},APPVIEW:null,WINDOWFOCUS:!1,FILETYPE:{IMAGE:"image",FILE:"file"},CHATTYPE:{CHAT:"chat",GROUPCHAT:"groupchat"},CONSTANT:{DEFAULT_ROOM_NAME:"New group chat"},IS_REFRESH_SHARE_FILE:"isRefreshShareFile",STATUS_PREVIEWIMAGE:!1,SEARCH:{IS_STATUS_SEARCH:!1,TYPE_SEARCH:null,TOP_LOAD_MSG:!1,CAN_NEXT_RESULT:!0,CAN_PREVIOUS_RESULT:!0,INDEX_RESULT:0},getSelectionHtml:function(){var t,f,i,s,r,e,u,o,n;if(this.CAN_QUOTE=!0,t="",typeof getSelection!="undefined"){if(f=window.getSelection(),f.rangeCount){for(i=document.createElement("div"),n=0,s=f.rangeCount;n<s;++n)i.appendChild(f.getRangeAt(n).cloneContents());for(r=$(i).find(".chat-detail-row-message"),n=0;n<r.length;n++)for(e=n+1;e<r.length;e++)if($(r[n]).attr("data-account")!=$(r[e]).attr("data-account")){this.CAN_QUOTE=!1;break}if(u=$(i).find(".chat-detail-row-message .enableSelectText"),u&&u.length>1){for(o="",n=0;n<u.length;n++)o=o+u[n].innerHTML+"\n";t=o}else t=i.innerHTML}}else typeof document.selection!="undefined"&&document.selection.type=="Text"&&(t=document.selection.createRange().htmlText);return t},CAN_QUOTE:!0,MAX_MEMBERS:15,isMobile:!1},n.btalk=i)})(typeof window!="undefined"?window:this),function(n,t){"use strict";t.alert||(t.alert={html:'<div class="alert" style="display:none;"> <strong>{title}<\/strong> {message} <\/div>',instance:null,_count:15,_lastcount:15,$count:null,callback:null,title:"",message:"",timer:null,options:{target:"body",callbackAfterShow:function(){}},init:function(t){this.options=n.extend(!0,{},this.options,t)},startCountdown:function(){this.$count&&(this._count=this._count||15,this._count-1>=0&&(this._count=this._count-1,this.$count.text(this._count),this._count>0?this.timer=window.setTimeout(t.alert.startCountdown.bind(this),1e3):(this.callback(this.title,this.message),this.clear())))},make:function(t,i,r,u){if(this.instance&&this.clear(),i){this.title=t||"";this.message=i;var f=this.html.replace("{title}",this.title).replace("{message}",this.message);this.instance=n(f).addClass("alert-"+u);typeof r=="function"&&(this.callback=r,this.instance.find("a.reconnect").bind("click",function(){this.callback(this.title,this.message);this.clear()}.bind(this)));u==="success"&&window.setTimeout(function(){this.clear()}.bind(this),5e3);this.$count=this.instance.find("a.count");this.$count&&parseInt(this.$count.text())>0&&(this._count=parseInt(this.$count.text())>300?300:parseInt(this.$count.text()))}},show:function(){this.instance&&(n(this.options.target).append(this.instance),this.instance.show(),this.startCountdown(),this.options.callbackAfterShow())},info:function(n,t,i){n=n||"";this.make(n,t,i,"info");this.show()},warning:function(n,t,i){n=n||"";this.make(n,t,i,"warning");this.show()},error:function(n,t,i){n=n||"";this.make(n,t,i,"error");this.show()},success:function(n,t,i){n=n||"";this.make(n,t,i,"success");this.show()},danger:function(){},clear:function(){window.clearTimeout(this.timer);this.callback=null;n("div.alert").remove();this.instance=null}})}(window.jQuery,window.btalk=window.btalk||{}),function(n,t){"use strict";t.reconnection||(t.reconnection={_count:3,timer:null,callback:null,connection:function(n,t){t==="success"&&this.clear();typeof n=="function"&&(this.callback=n)},startCountdown:function(){this._count=this._count||3;this._count-1>=0&&(this._count=this._count-1,this._count>0?this.timer=window.setTimeout(t.reconnection.startCountdown.bind(this),1e3):(typeof this.callback=="function"&&this.callback(),this.clear()))},reconnectionError:function(n){this.connection(n,"error");this.startCountdown()},reconnectionSuccess:function(n){this.connection(n,"success");this.startCountdown()},clear:function(){window.clearTimeout(this.timer);this.callback=null}})}(window.jQuery,window.btalk),function(n,t){if(typeof JSJaCMessage=="undefined")throw"Chưa tải thư viện jsjac.js";var i="urn:xmpp:receipts",r={_message:null,init:function(t){return this._message=new window.JSJaCMessage(t),this._message.JSON=function(){return n.xml2json(this.doc)},this},setId:function(n){return this._message.setID(n),this},setType:function(n){return this._message.setType(n),this},setFrom:function(n){return this._message.setFrom(n),this},setTo:function(n){return this._message.setTo(n),this},setBody:function(n){return this._message.setBody(n),this},setAttr:function(n,t){return this._message.getNode().setAttribute(n,t),this},appendChild:function(n,t,i){if(String.isNullOrEmpty(n))return this;var r=this._message.getDoc().createElement(n);return t&&typeof t=="object"&&_.each(_.keys(t),function(n){r.setAttribute(n,t[n])}),i&&typeof i=="object",this._message.getNode().appendChild(r),this},get:function(){return this.setAttr("clienttime",(new Date).getTime().toString()),this._message}},u={_iqmessage:null,_newElement:null,init:function(t,i,r){return this._iqmessage=new window.JSJaCIQ,this.setIq(t,i,r),this._iqmessage.JSON=function(){return n.xml2json(this.doc)},this},setIq:function(n,t,i){return t=t||"get",i=i||null,this._iqmessage.setIQ(i,t,n),this},appendChild:function(n,t,i){return this._newElement=this._iqmessage.buildNode(n,t,i),this._iqmessage.getNode().appendChild(this._newElement),this},appendNodeChild:function(n,t,i,r){if(String.isNullOrEmpty(n))return this;var u=this._iqmessage.getNode().getElementsByTagName(n).item(0);return n?(this._newElement=this._iqmessage.buildNode(t,i,r),u.appendChild(this._newElement),this):this},setQuery:function(n){return this._iqmessage.setQuery(n),this},setType:function(n){return this._iqmessage.setType(n),this},get:function(){return this._iqmessage}};t.messageFactory={_messageBase:function(n,t,i,u){var f=r.init(n);return f.setId(n).setFrom(t).setTo(i).setType(u),f},_iqMessage:function(n,t,i){return u.init(n,t,i)},sendMessage:function(n,t,i,r,u,f){var e=new this._messageBase(n,t,i,r);return e.setBody(u),f&&typeof f=="object"&&e.appendChild("quote",f),e.get()},sendStatusMessage:function(n,t,r,u,f,e){var o=new this._messageBase(n,t,r,u);return o.appendChild("received",{xmlns:i,id:n,status:f,secs:e}),o.get()},sendComposingMessage:function(n,t,i,r){var u=new this._messageBase(n,t,i,r);return u.appendChild("composing",{xmlns:"http://jabber.org/protocol/chatstates",jid:t}),u.get()},sendConfigMessage:function(n,t,i,r,u){var f,e,o;if(!u)return null;f=new this._messageBase(n,t,i,r);f.setBody("Room Config");for(e in u)o={},o[u[e].key]=u[e].value,f.appendChild("config",o);return f.get()},sendAttachmentMessage:function(n,t,i,r,u){var f="",s="file",e,o;if(u){e=new this._messageBase(n,t,i,r);for(o in u)f=f+u[o].name,o<_.keys(u).length-1&&(f=f+this.options.file.seperatekey);return e.setBody(f),u[_.keys(u)[0]].type.indexOf("image")>-1&&(s="image"),e.setAttr("msgContentType",s),_.each(u,function(n){var t={id:n.id,name:n.name,object:n.object,type:n.type,percentage:101,messageid:n.messageid,sentDate:n.sentDate,fileServerType:n.fileServerType};n.size&&parseInt(n.size)&&(t.size=n.size);n.lastModified&&(t.lastModified=n.lastModified);n.lastModifiedDate&&(t.lastModifiedDate=n.lastModifiedDate);n.tenantid&&(t.tenantid=n.tenantid);n.dimension&&(t=_.extend(t,n.dimension));e.appendChild("attachment",t)}),e.get()}},getRosterIqRequest:function(){var n=new this._iqMessage("roster_1","get");return n.setQuery("jabber:iq:roster"),n.get()},getOnlineIqRequest:function(){var t="enable_auto_send_presence"+(new Date).getTime().toString(),n=new this._iqMessage(t,"set");return n.appendChild("mobile",{enable:"false",xmlns:"http://btalk.vn/protocol/btalk_mobile#v2"}),n.get()},getHistoryIqRequest:function(n,t,i){var r=new this._iqMessage("jwchat_history","get"),u="list";return t=t||0,i=i||10,r.appendChild(u,{start:n,xmlns:"urn:xmpp:archive"}).appendNodeChild(u,"set",{xmlns:"http://jabber.org/protocol/rsm"}).appendNodeChild("set","max",null,i).appendNodeChild("set","after",null,t),r.get()},GetMembersIqRequest:function(n){var r="get_members"+(new Date).getTime().toString(),u=t.cutResource(n),i=new this._iqMessage(r,"get",u);return i.appendChild("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).appendNodeChild("query","item",{affiliation:"owner"}),i.get()},GetMessageHistoriesIqRequest:function(n,i,r,u,f){var e,o;return u=u||0,f=f||30,e=new this._iqMessage("jwchat_get_history","get"),o=i===t.CHATTYPE.GROUPCHAT?"groupchat":"retrieve",e.appendChild(o,{xmlns:"urn:xmpp:archive",start:r,"with":n}).appendNodeChild(o,"set",{xmlns:"http://jabber.org/protocol/rsm"}).appendNodeChild("set","max",null,f).appendNodeChild("set","after",null,u-1+""),e.get()}}}($,window.btalk=window.btalk||{}),function(n,t){"use strict";t.auth||(t.auth={options:{xmppTokenKey:"bkavAuthen",keystoneTokenKey:"keystoneAuth",loginPage:"index.html",authorizedPage:"jwchat.html",rXmppToken:{domain:"",path:"/"},rKeystoneToken:{domain:"",path:"/"},wXmppToken:{expires:7,domain:"",path:"/"},wKeystoneToken:{expires:7,domain:"",path:"/"},domain:"",FILE_ACTIVE:!1,remember:!1},keystoneAuth:!1,xmppAuth:!1,init:function(t){this.options=n.extend(!0,{},this.options,t)},isReadyCm:!1,_initCm:function(n){this.isReadyCm!=!0&&(this.isReadyCm=!0,t.cm._init(this.getJID()||n,t.config.CM))},isReadyCmRoster:!1,_initCmRoster:function(n){if(this.xmppAuth==!0){if(this.isReadyCmRoster==!0){typeof n=="function"&&n();return}this.isReadyCmRoster=!0;typeof n=="function"&&n()}},firstLogin:!0,login:function(n,i,r,u){var f;this.options.remember=r||!1;f=n.indexOf("@")==-1?n+"@"+this.options.domain:n;this._initCm(f);u=u||function(){};var s=function(){this.keystoneAuth=!0},e=function(n){var t=n.textContent||n.text||n.innerText;t?this.saveXmppToken(b64decode(t)):u("Server khong tra ve token, hoac loi khi ghi token ra cookie.")},o=function(){var n=this.getXmppToken();n&&n.length>0?(this.xmppAuth=!0,window.location.href=this.options.authorizedPage):u("Server khong tra ve token, hoac loi khi ghi token ra cookie.")};this.firstLogin==!0?(this.firstLogin=!1,t.cm.login(n,i,o.bind(this),u,e.bind(this))):t.cm.login(n,i)},firstReconnect:!0,firstFileReconnect:!0,reconnect:function(n,i){if(this._initCm(),i=i||function(){},n=n||function(){},this.hasXmppToken()){var r=function(){if(this.xmppAuth=!0,this._initCmRoster(n),t.VIEWED_CACHE_LIST=new t.cache.CacheManager,this.options.FILE_ACTIVE===!0)this.firstFileReconnect==!0&&(this.firstFileReconnect=!1)},u=function(n){i(n);switch(n.getAttribute("code")){case"401":return this.logout(),!1}},f=function(){this.keystoneAuth=!0;window.JSTACK.Keystone.params.token=this.getXmppToken()};this.firstReconnect==!0?(this.firstReconnect=!1,t.cm.reconnect(this.getXmppToken(),r.bind(this),u.bind(this))):t.cm.reconnect(this.getXmppToken())}else return this.logout(),!1},logout:function(){this.xmppAuth=!1;return},available:function(){t.cm.changeStatus("available")},unavailable:function(){t.cm.changeStatus("offline")},hasXmppToken:function(){var n=this.getXmppToken();return n&&n.length>0},getExpiresOfXmppToken:function(){return this.options.remember?this.options.wXmppToken:{expires:null}},saveXmppToken:function(t){n.cookie(this.options.xmppTokenKey,t,this.getExpiresOfXmppToken())},getXmppToken:function(){return n.cookie(this.options.xmppTokenKey)},getExpiresOfKeystoneToken:function(){return this.options.remember?this.options.wKeystoneToken:{expires:null}},saveKeystoneToken:function(t){n.cookie(this.options.keystoneTokenKey,t,this.getExpiresOfKeystoneToken())},getKeystoneToken:function(){return n.cookie(this.options.keystoneTokenKey)},_removeToken:function(){},getJID:function(){var n=this.getXmppToken();return n&&n.length>0?this.findKey(n,"user").toLowerCase():""},findKey:function(n,i){for(var u=t.hex2string(n.split("_")[2]).split(";"),r=0;r<u.length;r++)if(u[r].split("=")[0]==i&&u[r].split(":").length==2)return u[r].split(":")[1];return""},getFullJID:function(){return this.getJID+"/"+this.getResource()},getResource:function(){return t.cm.getResource()}})}(window.jQuery,window.btalk=window.btalk||{}),function(n,t){"use strict";t.cm||(t.cm={JSJACCON:null,DEBUG:null,disco:null,MUC_SERVICE_JID:undefined,options:{debug:{Debugger:null,active:!1,useDebugJid:!1,debugJid:"admin@btalk.vn",debugLvl:2},xmpp:{connect_port:5222,connect_host:"192.168.140.133",connect_secure:!0,domain:"",conference:"",backendType:"binding",defaultResource:"btalk",httpbase:"/bosh/",baseDatetimeQuery:"2015-01-01T00:00:00Z",chatterNextCounts:15,messageNextCounts:40},cookie:{expiredDay:7,resourceKey:"br"},client:{version:""},file:{seperatekey:"!@!"},loginPage:"index.html"},savedStates:{onlstat:"",onlmsg:"",onlprio:"8",openedDepartments:[]},savedPrefs:{timerval:3e4,autoPopup:!0,autoPopupAway:!1,playSounds:!0,forcusWindows:!0,timestamps:!1,enablelog:!1},onlineStatus:{available:"online",chat:"free for chat",away:"away",xa:"not available",dnd:"do not disturb",invisible:"invisible",unavailable:"offline"},logoutCalled:!1,_events:[],isReady:!1,_init:function(t,i){if(!this.isReady){this.isReady=!0;this.options=n.extend(!0,{},this.options,i);this.DEBUG&&typeof this.DEBUG!="undefined"&&this.DEBUG.start||(this.options.debug.active&&(!this.options.debug.useDebugJid||this.options.debug.debugJid==t)?typeof this.options.debug.Debugger!="undefined"?(this.DEBUG=new this.options.debug.Debugger(this.options.debug.debugLvl,"Btalk "+t),this.DEBUG.start()):this.DEBUG=new window.JSJaCConsoleLogger(this.options.debug.debugLvl):this.DEBUG={log:function(){}});var r={oDbg:this.DEBUG,httpbase:new URL(egov.connections.ChatLink).origin+"/bosh/",timerval:this.savedPrefs.timerval};this.JSJACCON=this.options.xmpp.backendType=="binding"?new window.JSJaCHttpBindingConnection(r):new window.JSJaCHttpPollingConnection(r);this.JSJACCON.registerHandler("presence",this.handlePresence.bind(this));this.JSJACCON.registerHandler("ondisconnect",this.handleDisconnect.bind(this));this.JSJACCON.registerHandler("onconnect",this.handleConnected.bind(this));this.JSJACCON.registerHandler("onerror",this.handleConError.bind(this));this.JSJACCON.registerHandler("ontoken",this.handleToken.bind(this));this.JSJACCON.registerHandler("message",this.handleReceiveMessage.bind(this))}},handleConError:function(n){this._handleEvent("onerror",n);switch(n.getAttribute("code")){case"401":this.JSJACCON.connected()||this._handleEvent("con_error_authorization_failed");break;case"402":this._handleEvent("con_error_invalid_sid_error");break;case"409":this._handleEvent("con_error_conflict_name");break;case"503":this._handleEvent("con_error_xmpp_server_unavailable");break;case"500":this.JSJACCON.connected()||this.logoutCalled||this.savedStates.onlstat=="offline"||this._handleEvent("con_error_internal_server_error");break;default:this._handleEvent("con_error_default")}},handleDisconnect:function(){this.logoutCalled||this.savedStates.onlstat=="offline"||this._handleEvent("ondisconnect")},handleConnected:function(){this._handleEvent("onconnect");this.DEBUG.log("Connected",0)},handleToken:function(n){this._handleEvent("ontoken",n)},login:function(n,t,i,r,u){var e,o,f;n&&t&&(i&&typeof i=="function"&&(this.registerHandler("onconnect",i),this.registerHandler("ontoken",u)),r&&typeof r=="function"&&this.registerHandler("onerror",r),e=this.options.xmpp.domain,n.indexOf("@")!=-1&&(o=n.split("@"),n=o[0],e=o[1]),f={domain:e,username:n,pass:t,resource:this.getResource(),register:!1,version:this.options.client.version,allow_plain:!0,allow_token:!1},this.options.xmpp.backendType=="binding"&&(f.port=this.options.xmpp.connect_port,f.host=this.options.xmpp.connect_host,f.secure=this.options.xmpp.connect_secure),this.JSJACCON.connect(f))},reconnect:function(n,t,i){t&&typeof t=="function"&&this.registerHandler("onconnect",t);i&&typeof i=="function"&&this.registerHandler("onerror",i);var r={domain:this.options.xmpp.domain,token:n,resource:this.getResource(),register:!1,version:this.options.client.version,allow_plain:!1,allow_token:!0};this.options.xmpp.backendType=="binding"&&(r.port=this.options.xmpp.connect_port,r.secure=this.options.xmpp.connect_secure);this.JSJACCON.connect(r)},getResource:function(){var i=n.cookie(this.options.cookie.resourceKey);return i||(i=t.browser.OSName+"_"+t.browser.browserName+"_"+t.browser.fullVersion+Date.now(),n.cookie(this.options.cookie.resourceKey,i,this.options.cookie.expiredDay)),i||this.options.xmpp.defaultResource},_handle_logined:function(){this._handleEvent("_handle_logined")},logout:function(n){var t,f,i,r,e,u;if(this.logoutCalled=!0,this.JSJACCON.connected()){if(t=new window.JSJaCIQ,t.setIQ(null,"set"),f=t.setQuery("jabber:iq:private"),i=f.appendChild(t.buildNode("jwchat",{xmlns:"jwchat:state"})),n&&(n.onlstat&&n.onlstat!="offline"&&i.appendChild(t.buildNode("presence",n.onlstat)),n.onlmsg&&n.onlmsg!=""&&i.appendChild(t.buildNode("onlmsg",n.onlmsg)),n.openedDepartments&&n.openedDepartments.length>0)){r="";for(e in n.openedDepartments)r+=e+",";r!=""&&i.appendChild(t.buildNode("openedDepartments",r))}this.DEBUG.log(t.xml(),2);this.JSJACCON.send(t);u=new window.JSJaCPresence;u.setType("unavailable");this.JSJACCON.send(u);this.JSJACCON.disconnect()}},registerHandler:function(n){var t,r,i;if(n=n.toLowerCase(),t={handler:arguments[arguments.length-1],childName:"*",childNS:"*",type:"*"},arguments.length>2&&(t.childName=arguments[1]),arguments.length>3&&(t.childNS=arguments[2]),arguments.length>4&&(t.type=arguments[3]),this._events[n])for(r=this._events[n],i=0;i<r.length;i++)if(r[i].handler==t.handler)return;return this._events[n]=this._events[n]?this._events[n].concat(t):[t],this._events[n]=this._events[n].sort(function(n,t){var i=0,r=0;return(n.type=="*"&&i++,n.childNS=="*"&&i++,n.childName=="*"&&i++,t.type=="*"&&r++,t.childNS=="*"&&r++,t.childName=="*"&&r++,i>r)?1:i<r?-1:0}),this.DEBUG.log("registered handler for event '"+n+"'",2),this},unregisterHandler:function(n,t){var i,r,u;if(n=n.toLowerCase(),!this._events[n])return this;if(i=this._events[n],r=[],typeof t=="undefined")this._events[n]=r;else{for(u=0;u<i.length;u++)i[u].handler!=t&&r.push(i[u]);i.length!=r.length&&(this._events[n]=r,this.DEBUG.log("unregistered handler for event '"+n+"'",2))}return this},_handleEvent:function(n,t){var r,i;if(n=n.toLowerCase(),this.DEBUG.log("incoming event '"+n+"'",3),this._events[n])for(this.DEBUG.log("handling event '"+n+"'",2),r=0;r<this._events[n].length;r++)if(i=this._events[n][r],typeof i.handler=="function")if(t){if(t.pType){if(!t.getNode().hasChildNodes()&&i.childName!="*"||t.getNode().hasChildNodes()&&!t.getChild(i.childName,i.childNS))continue;if(i.type!="*"&&t.getType()!=i.type)continue;this.DEBUG.log(i.childName+"/"+i.childNS+"/"+i.type+" => match for handler "+i.handler,3)}if(i.handler(t))break}else if(i.handler())break},getRoster:function(){var n=t.messageFactory.getRosterIqRequest();this.JSJACCON.send(n,this.getRosterResult.bind(this))},getRosterResult:function(n){if(!n||n.getType()!="result"){n?this.DEBUG.log("Error fetching roster:\n"+n.xml(),1):this.DEBUG.log("Error fetching roster",1);return}this._handleEvent("_handle_iq_roster_result",this._parseResultToJson(n)[0])},getOnline:function(){var n=t.messageFactory.getOnlineIqRequest();this.JSJACCON.send(n,this.getOnlineResult.bind(this))},getOnlineResult:function(n){n&&n.getType()=="result"&&(this._handle_iq_online_result(n),this._handle_logined())},_handle_iq_online_result:function(n){var i=this._parseResultToJson(n)[0],r;i&&i.presences&&i.presences.presence&&(r=_.pluck(i.presences.presence,"from"),t.ROSTER.updateOnlines(r),this._handleEvent("_handle_iq_online_result",r))},getHistories:function(n,i){var r=this.options.xmpp.baseDatetimeQuery,u=t.messageFactory.getHistoryIqRequest(r,n,i);this.JSJACCON.send(u,this.getHistoriesResult.bind(this))},getHistoriesResult:function(n){if(n&&n.getType()=="result"){var t=this._parseResultToJson(n)[0],i=_.isArray(t.list.chat)?t.list.chat:[t.list.chat];this._handleEvent("_handle_iq_list_result",i||[])}},getMembers:function(n){var i=t.messageFactory.GetMembersIqRequest(n);this.JSJACCON.send(i,this._getMembersResult.bind(this))},_getMembersResult:function(n){var t=this._parseResultToJson(n),i={};t&&t.query&&t.query.item&&(i.groupId=t.from,i.members=_.pluck(t.query.item,"jid"),this._handleEvent("_handle_getMembersGroup",i))},_handle_getMembersGroup:function(t){if(t&&t.getType()=="result"){var i=n.xml2json(t.doc);this._handleEvent("_handle_getMembersGroup",i)}},_handle_addMembersGroup:function(t){if(t&&t.getType()=="result"){var i=n.xml2json(t.doc);this._handleEvent("_handle_addMembersGroup",i)}},_handle_reanameGroup:function(t){if(t&&t.getType()=="result"){var i=n.xml2json(t.doc);this._handleEvent("_handle_reanameGroup",i)}},_handle_removeMemberGroup:function(t){if(t&&t.getType()=="result"){var i=n.xml2json(t.doc);this._handleEvent("_handle_removeMemberGroup",i)}},sendMessage:function(i,r,u,f){var o=null,s,h,i,c,l,e;(typeof i=="object"&&(o=i,i=o.body),i!=="")&&(s=t.ROSTER.currentJid,r=t.cutResource(r),h=u||(new Date).getTime().toString(),c=r.split("@")[1]==this.options.xmpp.conference?t.CHATTYPE.GROUPCHAT:t.CHATTYPE.CHAT,i=t.messageFactory.sendMessage(h,s,r,c,i,o),l=this.JSJACCON.send(i),e=n.xml2json(i.doc),_.isFunction(f)&&(e.status="client",e.unread=!1,e.isSent=l,e.chatterJid=t.cutResource(r),f(e)))},sendReceived:function(n,i){var r,f=n.to,u=t.cutResource(n.from);n.carbons!=!0&&u!=t.ROSTER.currentJid&&(r=t.messageFactory.sendStatusMessage(n.id,f,u,n.type,i,n.secs),this.JSJACCON.send(r))},sendConfigs:function(n,i,r,u){var o,s,e,f;!n||Object.keys(n).length<=0||(o=(new Date).getTime().toString(),s=t.ROSTER.currentJid,i=t.cutResource(i),e=t.messageFactory.sendConfigMessage(o,s,i,r,n),this.JSJACCON.send(e),typeof u=="function"&&(f=e.JSON(),f.status="client",f.unread=!1,f.chatterJid=t.cutResource(i),u(f)))},sendAttachments:function(n,t){var r=this,i;this.JSJACCON.send(n);typeof t=="function"&&(i=n.JSON(),i.status="client",t(i))},sendComposing:function(n,i){var r,n,u,f=(new Date).getTime().toString();r=t.ROSTER.currentJid;n=t.cutResource(n);u=t.messageFactory.sendComposingMessage(f,r,n,i);this.JSJACCON.send(u)},handleReceiveMessage:function(t){var i=n.xml2json(t.doc),r;if(t.getType()==="error")return this._handleEvent("message_error",i);if(r=t.getChild("x","http://jabber.org/protocol/muc#user"),r)return this._handleInviteToGroup(i,r);this._handleChatMessage(t,i)},_handleChatMessage:function(n,i){for(var f,h=t.cutResource(n.getFrom()),s=n.getType(),e=n.getNode().getElementsByTagName("x"),r,u=0,o=e.length;u<o;u++)if(e.item(u).getAttribute("xmlns")==="jabber:x:delay"){f=e.item(u);break}if(f?(r=f.getAttribute("stamp"),n.jwcTimestamp=new Date(Date.UTC(r.substring(0,4),r.substring(4,6)-1,r.substring(6,8),r.substring(9,11),r.substring(12,14),r.substring(15,17)))):n.jwcTimestamp=new Date,i.received)return this._handleStatusMessage(i);if(i.filename)return this._handleFileMessage(i);i.sent&&i.sent.forwarded&&i.sent.forwarded.message&&(i=i.sent.forwarded.message,i.carbons=!0);i=this._parseRealtimeMessage(i);i.isContentMessage&&this._handle_roster_message(i);this._handleEvent("message",i);i.body&&i.carbons!=!0&&s===t.CHATTYPE.CHAT&&this.sendReceived(i,"success")},_handle_roster_message:function(n){this._handleEvent("_handle_update_roster",n)},_handleStatusMessage:function(n){this._handleEvent("_handle_status_message",n)},_handleFileMessage:function(n){this._handleEvent("_handle_file_message",n)},handleMessageConfig:function(t){var i=n.xml2json(t.doc);this._handleEvent("_handle_oMsg_configMemberGroup",i)},_handleInviteToGroup:function(n,i){var f,e,o,r=i.getElementsByTagName("invite").item(0),u;return f=r.getAttribute("from"),r.firstChild&&r.firstChild.nodeName=="reason"&&r.firstChild.firstChild&&(e=r.firstChild.firstChild.nodeValue),i.getElementsByTagName("password").item(0)&&(o=i.getElementsByTagName("password").item(0).firstChild.nodeValue),u=t.ROSTER.getUserByJID(t.cutResource(f)),u||(u=t.ROSTER.addUser(t.cutResource(f))),u.iwArr=u.iwArr||[],this._handleEvent("group_invite",n)},_parseRealtimeMessage:function(n){var f=this,i,r,u;return n.body=t.text(n.body),n.chatterJid=n.carbons===!0?n.to:n.from,n.chatterJid=t.cutResource(n.chatterJid),n.received&&(n.status=n.received.status||"viewed"),n.unread=!0,n.processType=this._checkProcessTypeOfMessage(n),n.secs||(i=new Date(this.options.baseDatetimeQuery),r=((new Date).getTime()-i.getTime())/1e3,n.secs=r),n.senderJid=t.cutResource(n.from),n.receiverJid=t.cutResource(n.to),n.attachment&&!_.isArray(n.attachment)&&(n.attachment=[n.attachment]),u=n.receiverJid,_.each(n.attachment,function(n){var i=n.tenantid||"";n.extension=_.last(n.name.split("."));n.name=egov.fileExtension.getFileName(n.name);n.size=egov.fileExtension.getSizeText(n.size);n.url=t.fm.geturl(i,u,n.object,String.format("{0}.{1}",n.name,n.extension),n.sentDate,101)}),this._parseConfigMessage(n),n.isContentMessage=this.isContentMessage(n.processType),n},_checkProcessTypeOfMessage:function(n){if(n.received)return"received";if(n.msgContentType==="file")return"file";if(n.msgContentType==="image")return"image";if(n.config!=undefined)return"roomconfig";var i=n.attachment?_.isArray(n.attachment)?n.attachment:[n.attachment]:null;return n.type==t.CHATTYPE.CHAT&&n.body&&!i||n.type==t.CHATTYPE.GROUPCHAT&&n.body&&!i?t.CHATTYPE.CHAT:(n.type==t.CHATTYPE.CHAT||n.type==t.CHATTYPE.GROUPCHAT)&&i&&i[0].type&&i[0].type.startWith("image")?"image":(n.type==t.CHATTYPE.CHAT||n.type==t.CHATTYPE.GROUPCHAT)&&i?"file":n.type==t.CHATTYPE.CHAT&&n.percentage!=undefined||n.type==t.CHATTYPE.GROUPCHAT&&n.percentage?"percentage":(n.type==t.CHATTYPE.CHAT||n.type==t.CHATTYPE.GROUPCHAT)&&n.composing!=undefined?"composing":(console.log("WARNING: MESSAGE NAY KHONG DUOC NHAN DIEN"),"")},_parseConfigMessage:function(n){var o,u,f,s,r,h,e,i;if(n.config&&n.processType==="roomconfig"){if(n.config.body_msg_suggest_chatBmail&&(h=n.config.body_msg_suggest_chatBmail),_.each(n.config,function(n){n.edit_by&&(o=n.edit_by);n.roomconfig_roomname&&(u=n.roomconfig_roomname);n.new_members&&(f=n.new_members);n.remove_member&&(s=n.remove_member);n.start_conversion&&(r=n.start_conversion)}),n.isConfigMsg=!0,r){n.config={value:new Date(parseInt(r)).format("HH:mm dd/MM/yyyy")};return}(e=t.ROSTER.getUserByJID(o),e)&&(i={userEdit:e.fullname,icon:"",reason:"",value:""},u?(i.icon="border_color",i.reason=" đã đổi tên nhóm thành ",i.value=u):f?(i.icon="group_add",i.reason=" đã thêm ",i.value=f):r?(i.icon="",i.reason="",i.value=new Date(r).format("HH:mm dd/MM/YYYY")):(i.icon="block",i.reason=" đã xoá ",i.value=s),n.config=i)}},getNextPageOfMessages:function(n,i,r,u){var f=this.options.xmpp.baseDatetimeQuery,e=t.messageFactory.GetMessageHistoriesIqRequest(n,u,f,i,r);this.JSJACCON.send(e,this.handle_iq_retrieve_result.bind(this))},handle_iq_retrieve_result:function(t){if(t&&t.getType()=="result"){var i=n.xml2json(t.doc);this._handleEvent("handle_iq_retrieve_result",i)}},addRoster:function(n){var r=new window.JSJaCIQ,f,u,i;r.setType("set");f=r.setQuery("jabber:iq:roster");u=f.appendChild(r.getDoc().createElement("item"));u.setAttribute("jid",n);u.setAttribute("name",n);u.setAttribute("subscription","both");this.JSJACCON.send(r,this.addRosterResult.bind(this));i=t.ROSTER.getUserByJID(n);i||(n.substring(n.indexOf("@")+1)==this.options.xmpp.conference?(i=t.ROSTER.addUser(n,n.substring(0,n.indexOf("@")),"",["Chat Rooms"]),i.status="available",i.roster=new window.GroupchatRoster,i.roster.nick=n.substring(0,n.indexOf("@"))):i=t.ROSTER.addUser(n))},addRosterResult:function(){},addRosters:function(n){var t,u,i,r;if(n&&!(n.length<=0)){for(t=new window.JSJaCIQ,t.setType("set"),t.setID("add_rosters_"+(new Date).getTime()),u=t.setQuery("jabber:iq:roster"),i=0;i<n.length;i++)r=u.appendChild(t.getDoc().createElement("item")),r.setAttribute("jid",n[i]),r.setAttribute("name",n[i].split("@")[0]),r.setAttribute("subscription","both"),(i+1)%200==0&&(this.JSJACCON.send(t,this.addRosterResult.bind(this)),t=new window.JSJaCIQ,t.setType("set"),t.setID("add_rosters_"+(new Date).getTime()),u=t.setQuery("jabber:iq:roster"));n.length%200!=0&&this.JSJACCON.send(t,this.addRosterResult.bind(this))}},addRostersResult:function(){},removeRoster:function(n){var f=t.ROSTER.getUserByJID(n).fulljid,i=new window.JSJaCIQ,u,r;i.setType("set");u=i.setQuery("jabber:iq:roster");r=u.appendChild(i.getDoc().createElement("item"));r.setAttribute("jid",f);r.setAttribute("subscription","remove");this.JSJACCON.send(i)},createGroup:function(n,i){if(i&&!(i.length<=0)){n=t.cutResource(n);var u=n+"/"+t.ROSTER.currentuser.name,r=new window.JSJaCPresence;r.setTo(u);this.JSJACCON.send(r,this.createGroupResult.bind(this,n,i))}},createGroupResult:function(n,t){this.addGroupMembers(n,t);this.addRoster(n)},addGroupMembers:function(n,i){var r,f,e,u;n=t.cutResource(n);r=new window.JSJaCIQ;r.setType("set");r.setTo(n);r.setID("add_member");f=r.setQuery("http://jabber.org/protocol/muc#admin");for(e in i)u=f.appendChild(r.getDoc().createElement("item")),u.setAttribute("jid",i[e]),u.setAttribute("affiliation","owner");this.JSJACCON.send(r)},removeGroupMember:function(n,i){var r,f,u;n=t.cutResource(n);r=new window.JSJaCIQ;r.setType("set");r.setTo(n);r.setID("remove_member");f=r.setQuery("http://jabber.org/protocol/muc#admin");u=f.appendChild(r.getDoc().createElement("item"));u.setAttribute("jid",i);u.setAttribute("affiliation","none");this.JSJACCON.send(r)},joinGroup:function(n){var i=new window.JSJaCMessage;i.setTo(t.cutResource(n));i.setID("join_group");i.setXMLNS("jabber:client");i.setType(t.CHATTYPE.GROUPCHAT);i.setBody("btalk-join-to-room");this.JSJACCON.send(i)},existGroup:function(n){var i=new window.JSJaCMessage;i.setTo(t.cutResource(n));i.setID("exist_group");i.setXMLNS("jabber:client");i.setType(t.CHATTYPE.GROUPCHAT);i.setBody("btalk-out-of-room");this.JSJACCON.send(i);this.removeGroupMember()},renameGroup:function(n,i){var c=new Date,l=c.getTime().toString(),r=new window.JSJaCIQ,o,u,f,s,e,h;r.setID("rename_group"+l);r.setType("set");r.setTo(t.cutResource(n));o=r.setQuery("http://jabber.org/protocol/muc#owner");u=r.buildNode("x",{xmlns:"jabber:x:data",type:"submit"});o.appendChild(u);f=u.appendChild(r.getDoc().createElement("field"));f.setAttribute("var","FORM_TYPE");s=f.appendChild(r.getDoc().createElement("value"));s.textContent="http://jabber.org/protocol/muc#roomconfig";e=u.appendChild(r.getDoc().createElement("field"));e.setAttribute("var","muc#roomconfig_roomname");h=e.appendChild(r.getDoc().createElement("value"));h.textContent=i;this.JSJACCON.send(r)},changeStatus:function(n,i,r){if(this.savedStates.onlstat=n,i&&(this.savedStates.onlmsg=i),r&&!isNaN(r)&&(this.savedStates.onlprio=r),!this.JSJACCON.connected()&&n!="offline"){this._init();return}var u=new window.JSJaCPresence;switch(n){case"unavailable":n="invisible";u.setType("invisible");break;case"offline":n="unavailable";u.setType("unavailable");this.JSJACCON.send(u);this.JSJACCON.disconnect();return;case"available":n="available";i&&u.setStatus(i);r&&!isNaN(r)?u.setPriority(r):u.setPriority(this.savedStates.onlprio);break;case"chat":r&&!isNaN(r)?u.setPriority(r):u.setPriority(this.savedStates.onlprio);default:i&&u.setStatus(i);u.setType(n);r&&!isNaN(r)?u.setPriority(r):u.setPriority("0");u.setShow(n)}this.JSJACCON.send(u);t.ROSTER&&this.savedStates.onlstat!="invisible"&&this.sendPresence2Groupchats(t.ROSTER.getGroupChats(),this.savedStates.onlstat,this.savedStates.onlmsg)},sendPresence2Groupchats:function(n,t,i){for(var r,u=0;u<n.length;u++)r=new window.JSJaCPresence,r.setTo(n[u]),i&&i!=""&&r.setStatus(i),t!="available"&&r.setShow(t),this.JSJACCON.send(r)},sendCustomPresence:function(n,i,r){var u=new window.JSJaCPresence;u.setTo(n);t.ROSTER.getUserByJID(n).roster&&u.setXMLNS();switch(i){case"offline":u.setType("unavailable");case"unavailable":u.setType("unavailable");i="invisible";default:i!="available"&&u.setShow(i)}typeof r!="undefined"&&r!=""&&u.setStatus(r);this.DEBUG.log(u.xml(),2);this.JSJACCON.send(u)},sendPresenceIDLE:function(n){var t=new window.JSJaCPresence;t.setStatus("available");n?t.setShow("away"):t.setShow("chat");t.setPriority(1);this.JSJACCON.send(t)},handlePresence:function(i){var d=t.cutResource(i.getFrom()),y=i.getType(),e=i.getShow(),a=i.getStatus(),u=t.ROSTER.getUserByJID(d),p,l,w,r,f,b,g,s,nt,o,k,v,h,c;if(u){if(l=i.getChild("x","http://jabber.org/protocol/muc#user"),l){if(w=i.getFrom().substring(i.getFrom().indexOf("/")+1),this.DEBUG.log("jabber.from:"+i.getFrom()+", ofrom:"+w,3),r=u.roster.getUserByJID(i.getFrom()),r||(r=new GroupchatRosterUser(i.getFrom(),w)),f=l.getElementsByTagName("item").item(0),r.affiliation=f.getAttribute("affiliation"),r.role=f.getAttribute("role"),r.nick=f.getAttribute("nick"),r.realjid=f.getAttribute("jid"),f.getElementsByTagName("reason").item(0)&&(r.reason=f.getElementsByTagName("reason").item(0).firstChild.nodeValue),(p=f.getElementsByTagName("actor").item(0))&&(p.getAttribute("jid")!=null?r.actor=p.getAttribute("jid"):f.getElementsByTagName("actor").item(0).firstChild!=null&&(r.actor=f.getElementsByTagName("actor").item(0).firstChild.nodeValue)),r.role!=""&&(r.add2Group(r.role+"s"),r.name==t.htmlEnc(u.roster.nick)&&(u.roster.me=r,u.chatW.updateMe&&u.chatW.updateMe())),this.DEBUG.log("ouser.jid: "+r.jid+", ouser.fulljid:"+r.fulljid+", ouser.name:"+r.name+", user.roster.nick:"+u.roster.nick,3),b=!1,l.getElementsByTagName("status").item(0)){g=l.getElementsByTagName("status").item(0).getAttribute("code");switch(g){case"201":s=new window.JSJaCIQ;s.setType("set");s.setTo(u.jid);nt=s.setQuery("http://jabber.org/protocol/muc#owner");nt.appendChild(s.buildNode("x",{xmlns:NS_XDATA,type:"submit"}));this.JSJACCON.send(s)}}this.DEBUG.log("<"+r.name+"> affiliation:"+r.affiliation+", role:"+r.role,3);u.roster.getUserByJID(i.getFrom())||b?i.getType()!="unavailable"||b||(o=new window.JSJaCMessage,o.setFrom(u.jid),k=""+r.name+" has left",i.getStatus()&&(k+=": "+i.getStatus()),o.setBody(k),v=n.xml2json(o.doc),this._handleEvent("group_member_left",v)):(u.roster.addUser(r),o=new window.JSJaCMessage,o.setFrom(u.jid),o.setBody(""+r.name+" has become available"),v=n.xml2json(o.doc),this._handleEvent("group_member_join",v));u=r}h=undefined;e?(u.get("status")=="unavailable"&&(h=!0),e!=t.CHATTYPE.CHAT&&e!="away"&&e!="xa"&&e!="dnd"&&(e="available"),u.set("status",e)):y?(y=="unsubscribe"?(u.subscription="from",u.set("status","stalker")):u.get("status")!="stalker"&&u.set("status","unavailable"),h=!1):(h=!0,u.set("status","available"));u.statusMsg=a?a:null;(e=="chat"||e=="away")&&a=="available"?(c=n.xml2json(i.doc),this._handleEvent("statusIDLE",c)):h==!0?(c=n.xml2json(i.doc),this._handleEvent("online",c)):h==!1&&(c=n.xml2json(i.doc),this._handleEvent("offline",c));y=="changeStatus"&&this._handleEvent("changeStatus",{from:d,status:a})}},isContentMessage:function(n){return n===t.CHATTYPE.CHAT||n==="file"||n===t.CHATTYPE.GROUPCHAT},bind:function(n,t,i){return function(r){return n.apply(t,[r,i])}},_parseResultToJson:function(t){var i=n.xml2json(t.doc);return n.isArray(i)?i:[i]}})}(window.jQuery,window.btalk),function(n,t){"use strict";t.egov||(t.egov={options:{url:"",userDeptUrl:"",allUsersUrl:"",allDeptUrl:"",allJobTitlesUrl:"",allPositionsUrl:"",users:egov.setting.allUsers,depts:egov.setting.allDeps,userDeptPoses:egov.setting.allUserDeps,jobtitles:egov.setting.allJobtitles,poses:egov.setting.allPositions,acs:[]},init:function(t){this.options=n.extend(!0,{},this.options,t)},getUserDeptTree:function(i){if(this.options.users.length>0&&this.options.depts.length>0&&this.options.userDeptPoses.length>0&&this.options.jobtitles.length>0&&this.options.poses.length>0){typeof this.options.success=="function"&&this.options.success({users:this.options.users,depts:this.options.depts,userDeptPoses:this.options.userDeptPoses,jobtitles:this.options.jobtitles,poses:this.options.poses});return}this.options=n.extend({},this.options,i);this.getAllUsers({success:function(n){this.getAllDept({success:function(i){this.getAllUserDeptPosition({success:function(r){this.getAllJobTitles({success:function(u){this.getAllPositions({success:function(f){for(var o=[],e=0;e<i.length;e++)o.push({id:i[e].value,parentid:i[e].parentid,text:i[e].data.toString(),idext:i[e].idext,icon:"",order:i[e].order,level:i[e].level,label:i[e].label,state:{opened:!1},a_attr:{rel:"dept",idext:i[e].idext,label:i[e].label},li_attr:{id:i[e].value},children:["_"]});typeof this.options.success=="function"&&this.options.success({users:n,depts:o,userDeptPoses:r,jobtitles:u,poses:f});t.ROSTER.sort(t.ROSTER.users)}.bind(this)})}.bind(this)})}.bind(this)})}.bind(this)})}.bind(this)})},getAllUsers:function(i){if(this.options.users.length>0)return this.options.users;if(this.options.allUsersUr=="")return console.log("Chua cau hinh url lay toan bo user egov!"),[];n.ajax({url:this.options.allUsersUrl,type:"GET",success:function(n){t.egov.options.users=n;i&&typeof i.success=="function"&&i.success(n)}})},getAllDept:function(i){if(this.options.depts.length>0)return this.options.depts;n.ajax({url:this.options.allDeptUrl,type:"GET",success:function(n){t.egov.options.depts=n;i&&typeof i.success=="function"&&i.success(n)}})},getAllUserDeptPosition:function(i){if(this.options.userDeptPoses.length>0)return this.options.userDeptPoses;if(this.options.userDeptUrl=="")return console.log("Chua cau hinh url lay danh sach user thuoc phong ban egov!"),[];n.ajax({url:this.options.userDeptUrl,type:"GET",success:function(n){t.egov.options.userDeptPoses=n;i&&typeof i.success=="function"&&i.success(n)}})},getAllJobTitles:function(i){if(this.options.jobtitles.length>0)return this.options.jobtitles;if(this.options.allJobTitlesUrl=="")return console.log("Chua cau hinh url lay toan bo chuc vu egov!"),[];n.ajax({url:this.options.allJobTitlesUrl,type:"GET",success:function(n){t.egov.options.jobtitles=n;i&&typeof i.success=="function"&&i.success(n)}})},getAllPositions:function(i){if(this.options.poses.length>0)return this.options.poses;if(this.options.allPositionsUrl=="")return console.log("Chua cau hinh url lay toan bo chuc danh egov!"),[];n.ajax({url:this.options.allPositionsUrl,type:"GET",success:function(n){t.egov.options.poses=n;i&&typeof i.success=="function"&&i.success(n)}})},getACSInfo:function(i){if(this.options.acs.length>0)return this.options.acs;if(this.options.acsUrl=="")return console.log("Chua cau hinh url lay thong tin nghi phep tu acs!"),[];var r=(new Date).toISOString();return n.ajax({type:"POST",url:this.options.acsUrl,contentType:"application/x-www-form-urlencoded",data:{day:r},dataType:"xml",success:function(r){var u=[];try{u=JSON.parse(n(r.children[0]).text())}catch(f){console.log("btalk.egov.getACSInfo: loi parse thong tin nghi phep!");u=[]}t.egov.options.acs=u;i&&typeof i.success=="function"&&i.success(u)}.bind(this),error:function(){console.log("btalk.egov.getACSInfo: loi service lay thong tin nghi phep!")},async:!1}),t.egov.options.acs}})}(window.jQuery,window.btalk=window.btalk||{},window._),function(n,t){"use strict";t.browser||(t.browser={nVer:navigator.appVersion,nAgt:navigator.userAgent,browserName:navigator.appName,fullVersion:""+parseFloat(navigator.appVersion),majorVersion:parseInt(navigator.appVersion,10),nameOffset:undefined,verOffset:undefined,ix:undefined,OSName:"Unknown OS",init:function(){(this.verOffset=this.nAgt.indexOf("Opera"))!=-1?(this.browserName="Opera",this.fullVersion=this.nAgt.substring(this.verOffset+6),(this.verOffset=this.nAgt.indexOf("Version"))!=-1&&(this.fullVersion=this.nAgt.substring(this.verOffset+8))):(this.verOffset=this.nAgt.indexOf("MSIE"))!=-1?(this.browserName="Microsoft Internet Explorer",this.fullVersion=this.nAgt.substring(this.verOffset+5)):(this.verOffset=this.nAgt.indexOf("Chrome"))!=-1?(this.browserName="Chrome",this.fullVersion=this.nAgt.substring(this.verOffset+7)):(this.verOffset=this.nAgt.indexOf("Safari"))!=-1?(this.browserName="Safari",this.fullVersion=this.nAgt.substring(this.verOffset+7),(this.verOffset=this.nAgt.indexOf("Version"))!=-1&&(this.fullVersion=this.nAgt.substring(this.verOffset+8))):(this.verOffset=this.nAgt.indexOf("Firefox"))!=-1?(this.browserName="Firefox",this.fullVersion=this.nAgt.substring(this.verOffset+8)):(this.nameOffset=this.nAgt.lastIndexOf(" ")+1)<(this.verOffset=this.nAgt.lastIndexOf("/"))&&(this.browserName=this.nAgt.substring(this.nameOffset,this.verOffset),this.fullVersion=this.nAgt.substring(this.verOffset+1),this.browserName.toLowerCase()==this.browserName.toUpperCase()&&(this.browserName=navigator.appName));(this.ix=this.fullVersion.indexOf(";"))!=-1&&(this.fullVersion=this.fullVersion.substring(0,this.ix));(this.ix=this.fullVersion.indexOf(" "))!=-1&&(this.fullVersion=this.fullVersion.substring(0,this.ix));this.majorVersion=parseInt(""+this.fullVersion,10);isNaN(this.majorVersion)&&(this.fullVersion=""+parseFloat(navigator.appVersion),this.majorVersion=parseInt(navigator.appVersion,10));navigator.appVersion.indexOf("Win")!=-1&&(this.OSName="Windows");navigator.appVersion.indexOf("Mac")!=-1&&(this.OSName="MacOS");navigator.appVersion.indexOf("X11")!=-1&&(this.OSName="UNIX");navigator.appVersion.indexOf("Linux")!=-1&&(this.OSName="Linux")}},t.browser.init())}(window.jQuery,window.btalk),function(n,t){"use strict";function i(n,t){typeof Storage!="undefined"&&localStorage.setItem(n,t)}function r(n){var t=null;return typeof Storage!="undefined"&&(t=localStorage.getItem(n)),t}function u(n,t){this.account=n;this.value=t;var i=this;this.canShow=function(){if(i.value=="active"||i.value==null||i.value=="")return!0;if(i.value=="noactive")return!1;var n=parseInt(i.value),t=(new Date).valueOf();return t<n?!1:!0};this.delete=function(){if(i.value=="active"||i.value==null||i.value=="")return!0;var n=parseInt(i.value),t=(new Date).valueOf();return t>n?!0:!1}}function f(n,i){this.chatterId=n;this.viewedCache=JSON.parse(i);(!this.viewedCache||this.viewedCache[0])&&(this.viewedCache={});this.getViewedJidsByMsgId=function(n){for(var r=[],i=Object.keys(this.viewedCache),t=0;t<i.length;t++)this.viewedCache[i[t]].msgId==n&&r.push(i[t]);return r};this.saveToCache=function(n,i,r){var u={msgId:i,secs:r};this.viewedCache[n]=u;t.cache.writeCacheStorage(this.chatterId,JSON.stringify(this.viewedCache))}}function e(){function r(i){var r=t.cache.readCacheStorage(i),u=new t.cache.ViewedCache(i,r);n[i]=u}function i(t){return n[t]||r(t),n[t]}var n={};this.getViewedListByMsgId=function(n,t){var r=i(n);return r.getViewedJidsByMsgId(t)};this.updateAndSaveToCache=function(n,r,u,f){if(!t||!t.auth||typeof t.auth.getJID!="function"||t.auth.getJID()!=r){var e=i(n),o=null;e.viewedCache[r]&&(o=e.viewedCache[r].msgId);e.saveToCache(r,u,f);t.APPVIEW&&t.APPVIEW.CURRENTCHATTER&&typeof t.APPVIEW.CURRENTCHATTER.get=="function"&&t.APPVIEW.CURRENTCHATTER.get("jid")==n&&t.CONVERSATIONDAYS.updateModelsViewed(o,u,r);t.APPVIEW.viewedAllMessage(n)}}}t.cache||(t.cache={ViewedCache:f,CacheManager:e,SettingNotifyWithChatter:u,writeCacheStorage:i,readCacheStorage:r,statusSizeChatter:"default",heightDefaultChatter:40,heightTabHistory:null,Name_OpenChatterInfo:"OpenChatterInfo",Value_OpenChatterInfo:!1,Name_SoundMessage:"soundMessage",Key_SoundMessage:"active",Name_SettingNotification:"SettingNotification",ManagerSettingNotification:[]})}(window.jQuery,window.btalk),function(){"use strict";btalk.emoticon||(btalk.emoticon={HTML:"",EMOTICONS_URL:"/Scripts/btalk/emoticons/",EMOTICONS_COUNT:88,_location:window.location.origin,EMOTICONS_ID:[21,20,6,18,42,48,50,50,51,53,55,56,58,63,67,69,77,34,5,23,60,1,2,3,4,5,7,7,8,8,9,10,10,11,12,13,14,14,15,16,17,19,20,21,22,23,24,25,26,28,28,28,31,30,31,32,33,49,49,49,35,36,37,38,39,40,41,43,44,44,45,46,49,49,50,52,54,57,59,60,61,75,64,65,66,68,70,71,76,78,79,47,72,73,74,75,1,1,2,3,4,8,8,10,10,11,11,13,14,14,15,22,26,27,9,65,62,80,80,81,81,82,82,83,83,84,84,85,85,86,87,87,88,88],EMOTICONS_HEIGHT:[20,20,20,20,18,25,25,20,20,19,19,20,20,18,20,20,20,23,19,18,20,18,20,20,24,20,18,23,22,26,20,20,24,18,20,35,18,25,23,20,20,28,20,24,22,20,28,26,20,48,28,23,26,20,25,18,20,26,28,25,25,20,30,18,20,18,23,25,23,20,25,21,36,18,29,24,18,20,31,18,21,21,18,20,31,24,20,20,20],BACKGROUND_POSITION:[],EMOTICONS:[":-))",":-((","&gt;:D&lt;","#:-S",":-SS","&lt;):)","3:-O","3:-o",":(|)","@};-","**==","(~~)","*-:)","[-O&lt;",":)&gt;-","\\:D/","^:)^","&lt;@:)",";;-)","/:-)","=:-)","(-:",":-(",";-)",":-D",";;)",":-\\",":-/",":-x",":-X",':"&gt;',":-p",":-P",":-*","=((",":-O","x-(","X-(",":-&gt;","B-)",":-S","&gt;:)",":((",":))",":-|","/:)","=))","O:)",":-B","I-|","|-)","I-|","8-|","L-)","8-|",":-$","[-(",":o)",":0)",":O)","8-}","&lt;:P","(:|","=P~",":-?","#-o","=D&gt;","@-)",":^O",":^o",":-w",":-&lt;",":O)",":@)","3:O","~:&gt;","%%-","~O)","8-X","=:)","&gt;-)",":-L","$-)",':-"',"b-(","[-X","&gt;:/",";))",":-@",":-j","(*)","&gt;:P","o-+","o=&gt;","o-&gt;",":-l","(:",":)",":(",";)",":D",":x",":X",":P",":p","=*",":*",":O","x(",")X",":&gt;",":|",":B","=;",":&quot;&gt;",":-&quot;",":-||","\\o/","\\O/","o^^o","O^^O","o^^","O^^","o&gt;:o","O&gt;:O",".|.:d",".|.:D",":(o-o",":(O-O","&gt;:)(:&lt;","*\\o/*","*\\O/*","/o\\","/O\\"],EMOTICONS_REG:[":-\\)\\)",":-\\(\\(","&gt;:D&lt;","#:-S",":-SS","&lt;\\):\\)","3:-O","3:-o",":\\(\\|\\)","@};-","\\*\\*==","\\(~~\\)","\\*-:\\)","\\[-O&lt;",":\\)&gt;-","\\\\:D/","\\^:\\)\\^","&lt;@:\\)",";;-\\)","/:-\\)","=:-\\)","\\(-:",":-\\(",";-\\)",":-D",";;\\)",":-\\\\",":-/",":-x",":-X",':"&gt;',":-p",":-P",":-\\*","=\\(\\(",":-O","x-\\(","X-\\(",":-&gt;","B-\\)",":-S","&gt;:\\)",":\\(\\(",":\\)\\)",":-\\|","/:\\)","=\\)\\)","O:\\)",":-B","I-\\|","\\|-\\)","I-\\|","8-\\|","L-\\)","8-\\|",":-\\$","\\[-\\(",":o\\)",":0\\)",":O\\)","8-}","&lt;:P","\\(:\\|","=P~",":-\\?","#-o","=D&gt;","@-\\)",":\\^O",":\\^o",":-w",":-&lt;",":O\\)",":@\\)","3:O","~:&gt;","%%-","~O\\)","8-X","=:\\)","&gt;-\\)",":-L","\\$-\\)",':-"',"b-\\(","\\[-X","&gt;:/",";\\)\\)",":-@",":-j","\\(\\*\\)","&gt;:P","o-\\+","o=&gt;","o-&gt;",":-l","\\(:",":\\)",":\\(",";\\)",":D",":x",":X",":P",":p","=\\*",":\\*",":O","x\\(","\\)X",":&gt;",":\\|",":B","=;",":&quot;&gt;",":-&quot;",":-\\|\\|","\\\\o/","\\\\O/","o\\^\\^o","O\\^\\^O","o\\^\\^","O\\^\\^","o&gt;:o","O&gt;:O","\\.\\|\\.:d","\\.\\|\\.:D",":\\(o-o",":\\(O-O","&gt;:\\)\\(:&lt;","\\*\\\\o/\\*","\\*\\\\O/\\*","/o\\\\","/O\\\\"],init:function(){for(var t,n=1;n<=this.EMOTICONS_COUNT;n++)t=String.format('<li data-value="{0}" class="emoticon icon{0}" title="{2}"><img src="{1}.gif" alt=""/><\/li>',n,this.EMOTICONS_URL+n,this.getSymbol(n)),this.HTML+=t},getId:function(n){var t=this._getIndexBySymbol(n);return t==this.EMOTICONS.length?"":this.EMOTICONS_ID[t]},getSymbol:function(n){var t=this._getIndexById(n);return t==this.EMOTICONS_ID.length?"":this.EMOTICONS[t]},_getIndexById:function(n){for(var i=-1,t=0;t<this.EMOTICONS_ID.length;t++)if(this.EMOTICONS_ID[t]==n){i=t;break}return i},_getIndexBySymbol:function(n){for(var i=0,t=0;t<this.EMOTICONS.length;t++)if(this.EMOTICONS[t]==n){i=t;break}return i},render:function(){return this.HTML},process:function(n){var e,t,o;if(n){for(e=new Date,t=0;t<this.EMOTICONS_REG.length;t++){for(var i=new RegExp("^"+this.EMOTICONS_REG[t]+" ","gim"),r=new RegExp(" "+this.EMOTICONS_REG[t]+" ","gim"),u=new RegExp("^"+this.EMOTICONS_REG[t]+"$","gim"),f=new RegExp(" "+this.EMOTICONS_REG[t]+"$","gim");i.test(n);)n=n.replace(i,'<img title="'+this.EMOTICONS[t]+'" class="emoticon icon'+this.EMOTICONS_ID[t]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[t]-1]+';" src="'+this.EMOTICONS_URL+this.EMOTICONS_ID[t]+'.gif"/> ');while(r.test(n))n=n.replace(r,' <img title="'+this.EMOTICONS[t]+'" class="emoticon icon'+this.EMOTICONS_ID[t]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[t]-1]+';" src="'+this.EMOTICONS_URL+this.EMOTICONS_ID[t]+'.gif"/> ');while(u.test(n))n=n.replace(u,'<img title="'+this.EMOTICONS[t]+'" class="emoticon icon'+this.EMOTICONS_ID[t]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[t]-1]+';" src="'+this.EMOTICONS_URL+this.EMOTICONS_ID[t]+'.gif"/>');while(f.test(n))n=n.replace(f,' <img title="'+this.EMOTICONS[t]+'" class="emoticon icon'+this.EMOTICONS_ID[t]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[t]-1]+';" src="'+this.EMOTICONS_URL+this.EMOTICONS_ID[t]+'.gif"/>')}return o=new Date,n}},process2:function(n){var v=new Date,t,h,e,i,s,a;if(n){for(t=0;t<this.EMOTICONS.length;t++){if(i=this.EMOTICONS[t],h=i.length,n==i){n='<img title="'+i+'" class="emoticon icon'+this.EMOTICONS_ID[t]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[t]-1]+';" src="./emoticons/'+this.EMOTICONS_ID[t]+'.gif"/>';break}n.startsWith(i+" ")&&(n='<img title="'+i+'" class="emoticon icon'+this.EMOTICONS_ID[t]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[t]-1]+';" src="./emoticons/'+this.EMOTICONS_ID[t]+'.gif"/>'+n.slice(h));n.endsWith(" "+i)&&(n=n.slice(0,n.length-h)+'<img title="'+i+'" class="emoticon icon'+this.EMOTICONS_ID[t]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[t]-1]+';" src="./emoticons/'+this.EMOTICONS_ID[t]+'.gif"/>')}var c="",u=0,l=this.EMOTICONS;do{var r=-1,f=-1,o="";for(e=0;e<l.length;e++)i=l[e],s=n.indexOf(" "+i+" ",u),s==-1||(r==-1||r>s)&&(r=s,f=e,o=i);if(r==-1||f==-1||o=="")break;c+=n.slice(u,r);u=r;c+=' <img title="'+o+'" class="emoticon icon'+this.EMOTICONS_ID[f]+'" style="height: '+this.EMOTICONS_HEIGHT[this.EMOTICONS_ID[f]-1]+';" src="'+this.EMOTICONS_URL+this.EMOTICONS_ID[f]+'.gif"/> ';u=u+o.length+1}while(r>-1);return n=c+n.slice(u),a=new Date,console.log("btalk.emoticon.process2: "+(a.getTime()-v.getTime())),n}}},btalk.emoticon.init())}(),function(){"use strict";if(btalk.autolink)return btalk.autolink;btalk.autolink={process:function(n){if(n){var t=n.autoLink();if(t)return t}}}}(),function(){"use strict";btalk.fm||(btalk.fm={serverURL:window._FILEURL,fileServerType:"egov",options:{keystoneUrl:"",keystoneUrlAdmin:"",tenant:"",debug:!1,defaultRegion:"regionOne"},isReady:!1,containers:[],_init:function(n){this.isReady||(this.isReady=!0,this.options=$.extend(!0,{},this.options,n),JSTACK.Keystone.init(this.options.keystoneUrl,this.options.keystoneUrlAdmin))},log:function(n){this.options.debug&&console.log(JSON.stringify(n,null,4))},login:function(n,t,i){JSTACK.Keystone.authenticate(n,t,undefined,this.options.tenant,i,this.log.bind(this))},reconnect:function(n,t){JSTACK.Keystone.authenticate(undefined,undefined,n,this.options.tenant,t,this.log.bind(this))},logout:function(){},upload:function(n,t,i,r,u){var f=n,o=new FormData,e,s=this.getEgovDate(f.sentDate);o.append("file",f.file);o.append("tenantid",f.tenantid);$.ajax({xhr:function(){var n=new window.XMLHttpRequest;return n.upload.onprogress=function(n){if(n.lengthComputable){var t=Math.round(n.loaded/n.total*100);r({percentage:t,state:t==100?"Finalizing.":"Uploading."})}},n},success:function(n,t,i){if(i.readyState===4)switch(i.status){case 100:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:e=undefined;e=i.responseText!==undefined&&i.responseText!==""&&i.getResponseHeader("Content-Type")=="application/json"?JSON.parse(i.responseText):i.responseText;r(e,i.getAllResponseHeaders());break;case 401:skip_token?u({message:i.status+" Error",body:i.responseText}):checkToken(function(){u({message:i.status+" Error",body:i.responseText})});default:u({message:i.status+" Error",body:i.responseText})}},type:"post",url:this.serverURL+"/FileUploads.ashx?fileName="+f.tenantid+"&date="+s,data:o,processData:!1,contentType:!1,error:function(){u({message:"File gửi lỗi.",body:""})}})},download:function(){},geturl:function(n,t,i,r,u){var f=this.getEgovDate(new Date(u)),e=this.serverURL+"/FileDownload.ashx?fileId="+n+"&fileName="+encodeURI(r)+"&date="+f;return encodeURI(e)},gettenantid:function(){return this.generateFileId()},generateFileId:function(){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<36;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},getEgovDate:function(n){return n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()},is_url_exist:function(n){var t=new XMLHttpRequest;return t.open("HEAD",n,!1),t.send(),t.status=="404"?!1:!0},getFileFromData:function(n){for(var t,o,i,u,f=[],e=[],r=0;r<n.length;r++)if(n[r]&&(t=n[r],o=t.chatterJid,t.attachment))if(t.attachment.length>0)for(i=0;i<t.attachment.length;i++)u=this.getUrlFile(t.attachment[i],o),t.attachment[i].url=u,t.attachment[i].type.indexOf("image")>-1?e.push(t.attachment[i]):f.push(t.attachment[i]);else u=this.getUrlFile(t.attachment,o),t.attachment.url=u,t.attachment.type.indexOf("image")>-1?e.push(t.attachment):f.push(t.attachment);return{file:f,image:e}},getUrlFile:function(n,t){var i,r,u,f,e,o;return i=n.tenantid,r=n.object,u=n.name,f=n.sentDate,e=n.percentage,o=n.type,btalk.fm.geturl(i,t,r,u,f,e)},synsShareFileLocal:function(n,t){var u,i,r,f;if(n&&n!=null)for(i=0;i<t.length;i++){for(u=!0,r=0;r<n.length;r++)if(n[r].id===t[i].id){u=!1;break}u&&n.push(t[i])}else n=t;for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)parseInt(n[i].object)<parseInt(n[r].object)&&(f=n[i],n[i]=n[r],n[r]=f);return n}})}();