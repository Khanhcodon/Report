(function(){function n(){if(this.request=null,window.XMLHttpRequest)this.request=new XMLHttpRequest;else try{this.request=new ActiveXObject("MSXML2.XMLHTTP3.0")}catch(n){return null}this.needAllReload=!1;this._initParams()}n.prototype._initParams=function(){var t=new URL(egov.connections.BmailLink).origin,n,r,u,i;if(t){if(this.vituralHost=t.replace("http://","").replace("https://",""),n=t.split("."),n.length>2&&n[0]=="mail"){for(r="",u=n.length,i=1;i<u-1;i++)r+=n[i]+".";r+=n[u-1]}this.username=egov.usernameEmailDomain;this.url=t+"/service/soap"}else console.log("bmailServer is undefined")};n.prototype.sendRequest=function(t,i,r){var u=this;this.request.onreadystatechange=function(){try{var i=u.request.readyState===4,f=u.request.status==200,e=u.request.status===0;t=="NoOpRequest"?i&&(e?typeof r=="function"&&Util.sendPullRequest(u):f&&n.readyData(this,parent,this.output,this.input,n.needAllReload,r)):i&&f&&n.readyData(this,parent,this.output,this.input,n.needAllReload,r)}catch(o){console.log(o)}};this.request.onerror=function(){$.cookie("serverAddress","",{expires:-1,secure:!0})};this.request.open("POST",this.url,!0,t);this.request.timeout=.5*6e4;this.request.ontimeout=function(){console.log("TimeOut Expired!")};try{this.request.send(i.join(""))}catch(f){console.log(f)}};n.readyData=function(n,t,i,r,u,f){var h=n.readyState===4,a=n.status==200,v=n.status==500,e,c,s,o,l;if(v){e=new SOAPResponse(n.responseText);h&&e.response.Body&&f(e.response.Body.Fault.Reason.Text,"error");return}if(h&&a){e=new SOAPResponse(n.responseText);c=e.getResponseName();switch(c){case"AuthResponse":s=e.response.Body.AuthResponse.authToken[0]._content;bmail.bmailNewAuthenCookie=s;egov.createCookie("bkavAuthen",s);egov.createCookie("newBkavAuthen",s);f(f);break;case"GetMsgResponse":f(e.getMsgData());break;case"GetInfoResponse":f(e.getFolderList(),e.getUserInfo());break;case"SearchResponse":f(e.getDataList());break;case"SendMsgResponse":f(e.getResponseReturnCode());break;case"NoOpResponse":e.response.Header&&e.response.Header.context&&(o=e.response.Header.context,o.refresh&&o.refresh.folder?readFolderInfo(o.refresh.folder[0]):o.notify&&o.notify[0]&&o.notify[0].created&&egov.mobile.notification&&(l=o.notify[0].created,egov.mobile.notification.notifyMail(l.m)));egov.callback(f);bmail.makeRequest.noOption();break;default:f()}}};n.prototype.preAuthen=function(n){n.push("<soap:Envelope xmlns:soap='http://www.w3.org/2003/05/soap-envelope'>");n.push("<soap:Header>");n.push("<context xmlns='urn:zimbra'><session /><notify />");n.push("<format type='js'/>");n.push("<\/context>");n.push("<\/soap:Header>");n.push("<soap:Body>");n.push("<AuthRequest xmlns='urn:zimbraAccount'>");n.push("<virtualHost>");n.push(this.vituralHost);n.push("<\/virtualHost>");n.push("<bkavAuthen>");n.push(bmail.authenCookie);n.push("<\/bkavAuthen>");n.push("<type>simple<\/type>");n.push("<\/AuthRequest>");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeHeader=function(n,t,i){n.push("<soap:Envelope xmlns:soap='http://www.w3.org/2003/05/soap-envelope'>");n.push("<soap:Header>");n.push("<context xmlns='urn:zimbra'>");sessionId==0||i?n.push("<session/>"):(n.push("<session id='"),n.push(sessionId),n.push("'>"),n.push(sessionId),n.push("<\/session>"));n.push("<notify/>");n.push("<format type='");n.push(t);n.push("'/>");n.push("<account by='name'>");n.push(this.username);n.push("<\/account>");bmail.authenCookie==null&&Util.pageLogout();n.push("<authToken>");n.push(bmail.authenCookie);n.push("<\/authToken>");n.push("<virtualHost>");n.push(this.vituralHost);n.push("<\/virtualHost>");n.push("<\/context>");n.push("<\/soap:Header>")};n.prototype.makeSearchBody=function(t,i,r,u,f,e,o,s){isSearch=!1;o&&(isSearch=o);n.needAllReload=u==0?!0:!1;t.push("<soap:Body>");t.push("<");t.push(i);t.push(" xmlns='urn:");t.push(r);t.push("'");t.push(" sortBy='dateDesc' locale='en_US' ");t.push("offset='");t.push(u);t.push("' limit='");t.push(e);s&&t.push("' recip='1");t.push("' types='message'");isSearch?(t.push("  query='"+f+"'"),t.push(">")):(t.push(">"),t.push('<query>in:"'),t.push(f),t.push('"<\/query>'));t.push("<\/");t.push(i);t.push(">");t.push("<\/soap:Body>");t.push("<\/soap:Envelope>")};n.prototype.makeGetInfoBody=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'");n.push(">");n.push("<account by='name'>");n.push(this.username);n.push("<\/account>");n.push("<authToken>");n.push(bmail.authenCookie);n.push("<\/authToken>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeGetMsgBody=function(n,t,i,r){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<m id='");n.push(r);n.push("'");n.push(" html='1' read='1' />");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makePrivateRequestBody=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<\/IMGetPrivateDataRequest>");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeSetPrivateRequestBody=function(n,t,i,r){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<privateData>");n.push(r);n.push("<\/privateData>");n.push("<\/IMSetPrivateDataRequest>");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeFolderStructureBody=function(n,t,i){n.push("<soap:Body>");n.push("<FolderStructureChangeRequest xmlns='urn:");n.push(i);n.push("'>");n.push("<account by='name'>");n.push(this.username);n.push("<\/account><authtoken>");n.push(bmail.authenCookie);n.push("<\/authtoken>");n.push(t);n.push("<\/FolderStructureChangeRequest>");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeRenameFolderBody=function(n,t,i,r,u){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<action ");n.push("op='rename' ");n.push("id='"+r+"' ");n.push("name='"+u+"' ");n.push(" />");n.push("<\/FolderActionRequest>");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeActionFolderBody=function(n,t,i,r,u){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<action ");n.push("op='"+u+"' ");n.push("id='"+r+"' ");n.push("/><type >simple<\/type>");n.push("<\/FolderActionRequest>");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeDeleteFolderBody=function(n,t,i,r){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<action ");n.push("op='delete' ");n.push("id='"+r+"' ");n.push(" />");n.push("<\/FolderActionRequest>");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeMsgActionBody=function(n,t,i,r,u){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<action id='");n.push(r);n.push("'");n.push(" op='");n.push(u);n.push("' tcon='-ts' /><type >simple<\/type>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeGetContactsBody=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeJsonHeader=function(n){var t={context:{_jsns:"urn:zimbra",session:sessionId,userAgent:{name:navigator.userAgent,version:"Bmail 7.0.2"},account:{_content:this.username,by:"name"},authToken:bmail.authenCookie}};n.Header=t};n.prototype.makeAutoCompleteJsonBody=function(n,t){var i={AutoCompleteRequest:{_jsns:"urn:zimbraMail",name:{_content:t}}};n.Body=i};n.prototype.makeSendMsgBody=function(n,t,i,r){var f=[],e,h,o,u,s;if(Util.isUndefined(t.from)||f.push({t:"f",a:t.from,p:t.from_displayName}),!Util.isUndefined(t.to))if(t.to.indexOf(";")!=-1)for(e=t.to.split(";"),u=0;u<e.length;u++)f.push({t:"t",a:e[u]});else f.push({t:"t",a:t.to});if(Util.isUndefined(t.cc)||t.cc==""||f.push({t:"c",a:t.cc}),Util.isUndefined(t.bcc)||t.bcc==""||f.push({t:"b",a:t.bcc}),i&&r){for(h="",o=[],u=0;u<r.length;u++)o.push({mid:i,part:r[u]});s={SendMsgRequest:{_jsns:"urn:zimbraMail",m:{e:f,su:{_content:t.subject},mp:this.makeMPPart(t.mp),attach:{mp:o}}}}}else s={SendMsgRequest:{_jsns:"urn:zimbraMail",m:{e:f,su:{_content:t.subject},mp:this.makeMPPart(t.mp)}}};n.Body=s};n.prototype.makeMPPart=function(n){for(var i=[],t=0;t<n.length;t++)i.push({}),i[t].ct=n[t].ct,Util.isUndefined(n[t].mp)||(i[t].mp=this.makeMPPart(n[t].mp)),Util.isUndefined(n[t].content)||(i[t].content={_content:n[t].content});return i};n.prototype.reqName;n.prototype.requireUpdate;n.prototype.sendJsonRequest=function(t,i,r,u,f,e){this.request.onreadystatechange=function(){n.readyData(this,r,u,f,!1,e)};this.request.open("POST",this.url,!0,t);this.request.send(JSON.stringify(i))};n.prototype.makeIMSendMessageBody=function(n,t,i,r,u){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<message");n.push(" xmlns='' addr='");n.push(r);n.push("'>");u!=""&&(n.push("<body>"),n.push(u),n.push("<\/body>"));n.push("<\/message>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeIMSendTypingBody=function(n,t,i,r){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<message");n.push(" xmlns='' addr='");n.push(r);n.push("'>");n.push("<typing/>");n.push("<\/message>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeIMGetUserOnlineRequest=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<IMGetUserOnlineRequest xmlns='urn:zimbraIM'/>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeIMGatewayListRequest=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<IMGatewayListRequest xmlns='urn:zimbraIM'/>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeIMGetRosterRequest=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<IMGetRosterRequest xmlns='urn:zimbraIM'/>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeIMGetMessageHistoryRequest=function(n,t,i,r,u,f){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<chat startIndex='"+u+"' maxMsg='"+f+"' addr='");n.push(r);n.push("' type='lastChatMessages'/>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeIMCountHistoryRequest=function(n,t,i,r){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<list  addr='");n.push(r);n.push("' type='countChatMessages'/>");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeIMGetListHistoryRequest=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'>");n.push("<list maxMsg ='1' type='lastConversation' />");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};n.prototype.makeNoOpRequest=function(n,t,i){n.push("<soap:Body>");n.push("<");n.push(t);n.push(" xmlns='urn:");n.push(i);n.push("'");n.push(" wait='1'");n.push(" >");n.push("<\/");n.push(t);n.push(">");n.push("<\/soap:Body>");n.push("<\/soap:Envelope>")};window.SOAPRequest=n})();