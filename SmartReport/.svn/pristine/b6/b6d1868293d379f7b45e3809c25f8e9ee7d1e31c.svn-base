define(["jquery","libs/eForm/jquery/jquery.global","libs/eForm/jsutilt","libs/eForm/eForm.Libdata","libs/eForm/eForm.Controls","libs/eForm/eForm.Lib","libs/eForm/eForm.DB","libs/eForm/eForm.Tool","libs/eForm/Resize","libs/eForm/bkav.egate.applet","libs/eForm/bkav.egate","libs/eForm/bkav.egate.compiler"],function(n){var i=Backbone.View.extend({initialize:function(n){this.frame=n.frame;this.doctypeId=n.doctypeId;this.contentId=n.contentId;this.isMain=n.isMain;this.contentName=n.contentName;this.open()},open:function(){var t=this,r=n(".content[data-contentid="+t.contentId+"]",n("#"+this.frame).contents()),i=r.siblings("#Contents").val();i==null||i==""?n.ajax({url:"/Document/GetFormContent",type:"POST",data:{contentId:t.contentId,isCreate:!1,doctypeId:t.doctypeId},success:function(n){var i=JSON.parse(n),r;t.formTmp=n;r={collections:i.JssCatalog,schema:i.JssForm,formid:i.FormId,maxRow:i.MaxRow};t.loadForm(r,!1)}}):n.ajax({url:"/Document/ParseDynamicFormContent",type:"POST",data:{json:i,isFormContent:!1},success:function(n){var i=JSON.parse(n),r;t.formTmp=n;r={collections:i.JssCatalog,schema:i.JssForm,formid:i.FormId,maxRow:i.MaxRow};t.loadForm(r,!1)}})},update:function(){var f,t,e,o;if(!r())return"";if(f=this.formTmp,f!=""){var u=JSON.parse(f),i={},s=eForm.database.JsonSerialize3(u.FormId);return i.FormId=u.FormId,i.GlobalCode=u.GlobalCode,i.Description=u.Description,i.DocFieldJson=JSON.parse(s),t={},t.Content=JSON.stringify(i),t.ContentName=this.contentName,t.FormTypeId=2,t.IsMain=this.isMain,e=parseInt(this.contentId)!=this.contentId?0:this.contentId,t.DocumentContentId=e,o=n(".content[data-contentid="+this.contentId+"]",n("#"+this.frame).contents()),o.siblings("#Contents").val(JSON.stringify(t)),JSON.stringify(t)}return"{}"},rebindForm:function(i){n.ajax({url:"/Document/ParseDynamicFormContent",type:"POST",data:{json:i,isFormContent:!1},success:function(r){var u=JSON.parse(r),e={collections:u.JssCatalog,schema:u.JssForm,formid:u.FormId,maxRow:u.MaxRow},f=n(".content[data-contentid="+JSON.parse(i).DocumentContentId+"]",n("#"+this.frame).contents());n(f).addClass("pnl_root sub_pnl_root").attr("id","div"+u.FormId);t(e,"div"+u.FormId,!0);n(f).parent().find("#Contents").val(r)}})},loadForm:function(i,r){var f,u,e;r==undefined&&(r=!1);f=this;u={};u.height=600;u.width=1e3;u.title=f.contentName;r||(u.buttons=[{text:"Cập nhật",click:function(){var n=f.update();n!==""&&(egov.views.base.dialog.close(),f.rebindForm(n))}},{text:"Đóng",click:function(){n("#div"+i.formid).remove();egov.views.base.dialog.close()}}]);n("#div"+i.formid).remove();e=n("<div><\/div>").attr("id","div"+i.formid);e.addClass("pnl_root sub_pnl_root").appendTo("body");eForm.Lib.Init();t(i,"div"+i.formid,!1);egov.views.base.dialog.openexist(n("#div"+i.formid),u,null,null,!1)}}),t=function(t,i,r){eForm.efTools.init(null,i,t.formid);fformModel.fromCatalog(t.collections);r?eForm.efTools.ViewForm(t.schema,t.maxRow):eForm.efTools.LoadForm(t.schema,t.maxRow);var u=fformModel.fromSchema(eForm.database.GetAll(t.formid),t.formid);n.extend(fformModel,u);ko.applyBindings(fformModel,document.getElementById(i))},r=function(){var t=!0,i=null;return(n(".ffield").each(function(){n(this).blur()}),n(".cssErr").each(function(){n(this).css("display")!="none"&&t&&(i=n(this),t=!1)}),!t)?(n("#"+i.attr("controlValidate")).focus(),!1):!0};return i});
//# sourceMappingURL=editFormDynamic-view.min.js.map
