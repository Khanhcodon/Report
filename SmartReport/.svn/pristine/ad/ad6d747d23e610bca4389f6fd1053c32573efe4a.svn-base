function CssStyle(n){this.nameTag=n}function ComposeModel(n){this.mailId=n.mailId||"";this.rowId=n.rowId||"";this.type=n.composeType;this.folderId=n.folderId||"";this.folderPath=n.folderPath||"";this.loadFromBpr=n.loadFromBpr||!1;this.selectFolder=this.isAttaching=!1;this.message=null;this.imagePart=[];this.imageMailId=[];this.imageName=[];this.imageInline=[];this.currentImg=null;this.updateData=new Event(this);this.insertAttach=new Event(this);this.attachFail=new Event(this);this.startSendMail=new Event(this);this.sendMailFail=new Event(this);this.sendMailComplete=new Event(this);this.insertImageFail=new Event(this);this.insertImageSuccess=new Event(this);this.uploadCompleteEvent=new Event(this)}function ComposeView(n,t){this._model=n;this.table=t||dataTable;this.dontSetActiveTab=!1;this.sendMsg=new Event(this);this.saveDraftBtnClick=new Event(this);this.eSignatureBtnClick=new Event(this);this.ccBtnClick=new Event(this);this.bccBtnClick=new Event(this);this.createAutoComplete=new Event(this)}function ComposeController(n,t){this.sendComposeInQueue();this._view=n;this._model=t;var i=this;this._view.sendMsg.attach(function(n,t){i._model.sendMsg(t)});this._view.saveDraftBtnClick.attach(function(n,t){i._model.saveDraft(t)});this._view.ccBtnClick.attach(function(n,t){t={id:"cc-button"};i._view.handleCcBcc(t)});this._view.bccBtnClick.attach(function(n,t){t={id:"bcc-button"};i._view.handleCcBcc(t)});this._model.updateData.attach(function(n,t){var r=["js/mudim-minorfixed.js"+mailbox.getVersionWeb()];YAHOO.util.Get.script(r,{onFailure:function(){},onSuccess:function(){Mudim.method=mailbox.getInstance().viEnabled?2:0;i._view.updateData(t)}})});this._model.insertAttach.attach(function(n,t){i._view.insertAttach(t)});this._model.attachFail.attach(function(n,t){i._view.handleAttachFail(t)});this._model.startSendMail.attach(function(){i._view.handleStartSendMail()});this._model.sendMailFail.attach(function(){i._view.handleSendMailFail()});this._model.sendMailComplete.attach(function(){i._view.handleSendMailComplete()});this._view.createAutoComplete.attach(function(){i.createAutoComplete()});this._model.insertImageFail.attach(function(){i._view.handleInsertImageFail()});this._model.insertImageSuccess.attach(function(n,t){i._view.handleInsertImageSuccess(t)});this._model.uploadCompleteEvent.attach(function(){i._view.handleUploadComplete()});this.handleWindowClose()}var MXI_DEBUG=!0;(function(n,t){function u(t,i){for(var u,o,e,s=[],f=0;f<t.length;++f){if(!(u=r[t[f]]))n:{for(u=n,o=t[f].split(/[.\/]/),e=0;e<o.length;++e){if(!u[o[e]]){u=void 0;break n}u=u[o[e]]}}if(!u)throw"module definition dependecy not found: "+t[f];s.push(u)}i.apply(null,s)}function i(n,i,f){if("string"!=typeof n)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(f===t)throw"invalid module definition, definition function must be specified";u(i,function(){r[n]=f.apply(null,arguments)})}var r={};i("moxie/core/utils/Basic",[],function(){var n=function(n){return void 0===n?"undefined":null===n?"null":n.nodeType?"node":{}.toString.call(n).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},r=function(u){return t(arguments,function(f,e){0<e&&t(f,function(t,f){void 0!==t&&(n(u[f])===n(t)&&~i(n(t),["array","object"])?r(u[f],t):u[f]=t)})}),u},t=function(t,i){var r,u;if(t)if("number"===n(t.length))for(u=0,r=t.length;u<r&&!1!==i(t[u],u);u++);else if("object"===n(t))for(r in t)if(t.hasOwnProperty(r)&&!1===i(t[r],r))break},i=function(n,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,n);for(var i=0,r=t.length;i<r;i++)if(t[i]===n)return i}return-1};return{guid:function(){var n=0;return function(t){for(var r=(new Date).getTime().toString(32),i=0;5>i;i++)r+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+r+(n++).toString(32)}}(),typeOf:n,extend:r,each:t,isEmptyObj:function(t){var i;if(!t||"object"!==n(t))return!0;for(i in t)return!1;return!0},inSeries:function(t,i){function r(f){"function"===n(t[f])&&t[f](function(n){++f<u&&!n?r(f):i(n)})}var u=t.length;"function"!==n(i)&&(i=function(){});t&&t.length||i();r(0)},inParallel:function(n,i){var u=0,f=n.length,r=Array(f);t(n,function(n,t){n(function(n){if(n)return i(n);var e=[].slice.call(arguments);e.shift();r[t]=e;u++;u===f&&(r.unshift(null),i.apply(this,r))})})},inArray:i,arrayDiff:function(t,r){var u=[],f;"array"!==n(t)&&(t=[t]);"array"!==n(r)&&(r=[r]);for(f in t)-1===i(t[f],r)&&u.push(t[f]);return u.length?u:!1},arrayIntersect:function(n,r){var u=[];return t(n,function(n){-1!==i(n,r)&&u.push(n)}),u.length?u:null},toArray:function(n){for(var i=[],t=0;t<n.length;t++)i[t]=n[t];return i},trim:function(n){return n?String.prototype.trim?String.prototype.trim.call(n):n.toString().replace(/^\s*/,"").replace(/\s*$/,""):n},sprintf:function(t){var i=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=i.shift();return"undefined"!==n(t)?t:""})},parseSizeStr:function(n){if("string"!=typeof n)return n;var i={t:1099511627776,g:1073741824,m:1048576,k:1024},t;return n=/^([0-9\.]+)([tmgk]?)$/.exec(n.toLowerCase().replace(/[^0-9\.tmkg]/g,"")),t=n[2],n=+n[1],i.hasOwnProperty(t)&&(n*=i[t]),Math.floor(n)}}});i("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(n){var r=function(n){var r={has:function(n,t){return-1!==t.toLowerCase().indexOf(n.toLowerCase())},lowerize:function(n){return n.toLowerCase()}},t=function(){for(var r,t,h,u,s,i,e,f=0,o=arguments;f<o.length;f+=2){if(i=o[f],e=o[f+1],"undefined"==typeof r)for(u in r={},e)t=e[u],"object"==typeof t?r[t[0]]=n:r[t]=n;for(t=h=0;t<i.length;t++)if(s=i[t].exec(this.getUA())){for(u=0;u<e.length;u++)i=s[++h],t=e[u],"object"==typeof t&&0<t.length?2==t.length?r[t[0]]="function"==typeof t[1]?t[1].call(this,i):t[1]:3==t.length?r[t[0]]="function"!=typeof t[1]||t[1].exec&&t[1].test?i?i.replace(t[1],t[2]):n:i?t[1].call(this,i,t[2]):n:4==t.length&&(r[t[0]]=i?t[3].call(this,i.replace(t[1],t[2])):n):r[t]=i?i:n;break}if(s)break}return r},i=function(t,i){var u,f;for(u in i)if("object"==typeof i[u]&&0<i[u].length){for(f=0;f<i[u].length;f++)if(r.has(i[u][f],t))return"?"===u?n:u}else if(r.has(i[u],t))return"?"===u?n:u;return t},u={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",RT:"ARM"},f=[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],["name","version"],[/\s(opr)\/([\w\.]+)/i],[["name","Opera"],"version"],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],["name","version"],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[["name","IE"],"version"],[/(edge)\/((\d+)?[\w\.]+)/i],["name","version"],[/(yabrowser)\/([\w\.]+)/i],[["name","Yandex"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],["name","version"],[/(dolfin)\/([\w\.]+)/i],[["name","Dolphin"],"version"],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[["name","Chrome"],"version"],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],["version",["name","Android Browser"]],[/FBAV\/([\w\.]+);/i],["version",["name","Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",i,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name","Netscape"],"version"],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],e=[[/windows.+\sedge\/([\w\.]+)/i],["version",["name","EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv\:([\w\.]+).*(gecko)/i],["version","name"]],o=[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],["name",["version",i,u]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",i,u]],[/\((bb)(10);/i],[["name","BlackBerry"],"version"],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],["name","version"],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[["name","Symbian"],"version"],[/\((series40);/i],["name"],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"],"version"],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],["name","version"],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(sunos)\s?([\w\.]+\d)*/i],[["name","Solaris"],"version"],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],["name","version"],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[["name","iOS"],["version",/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[["name","Mac OS"],["version",/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],["name","version"]];return function(n){var i=n||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return t.apply(this,f)};this.getEngine=function(){return t.apply(this,e)};this.getOS=function(){return t.apply(this,o)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return i};this.setUA=function(n){return i=n,this};this.setUA(i)}}(),u=function(){var i={define_property:!1,create_canvas:function(){var n=document.createElement("canvas");return!(!n.getContext||!n.getContext("2d"))}(),return_response_type:function(t){try{if(-1!==n.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var i=new XMLHttpRequest;if(i.open("get","/"),"responseType"in i)return i.responseType=t,i.responseType!==t?!1:!0}}catch(r){}return!1},use_data_uri:function(){var n=new Image;return n.onload=function(){i.use_data_uri=1===n.width&&1===n.height},setTimeout(function(){n.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return i.use_data_uri&&("IE"!==t.browser||9<=t.version)},use_data_uri_of:function(n){return i.use_data_uri&&33e3>n||i.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var n=document.createElement("input");return n.setAttribute("type","file"),!n.disabled}};return function(t){var r=[].slice.call(arguments);return r.shift(),"function"===n.typeOf(i[t])?i[t].apply(this,r):!!i[t]}}(),i=(new r).getResult(),t={can:u,uaParser:r,browser:i.browser.name,version:i.browser.version,os:i.os.name,osVersion:i.os.version,verComp:function(n,t,i){var r=0,f=0,u=0,o={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},r=function(n){return n=(""+n).replace(/[_\-+]/g,"."),n=n.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),n.length?n.split("."):[-8]},e=function(n){return n?isNaN(n)?o[n]||-7:parseInt(n,10):0};for(n=r(n),t=r(t),f=Math.max(n.length,t.length),r=0;r<f;r++)if(n[r]!=t[r])if(n[r]=e(n[r]),t[r]=e(t[r]),n[r]<t[r]){u=-1;break}else if(n[r]>t[r]){u=1;break}if(!i)return u;switch(i){case">":case"gt":return 0<u;case">=":case"ge":return 0<=u;case"<=":case"le":return 0>=u;case"==":case"=":case"eq":return 0===u;case"<>":case"!=":case"ne":return 0!==u;case"":case"<":case"lt":return 0>u;default:return null}},swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return t.OS=t.os,MXI_DEBUG&&(t.debug={runtime:!0,events:!1},t.log=function(){var i=arguments[0],t;"string"===n.typeOf(i)&&(i=n.sprintf.apply(this,arguments));window&&window.console&&window.console.log?window.console.log(i):document&&(t=document.getElementById("moxie-console"),t||(t=document.createElement("pre"),t.id="moxie-console",document.body.appendChild(t)),n.inArray(n.typeOf(i),["object","array"]),t.appendChild(document.createTextNode(i+"\n")))}),t});i("moxie/core/I18n",["moxie/core/utils/Basic"],function(n){var t={};return{addI18n:function(i){return n.extend(t,i)},translate:function(n){return t[n]||n},_:function(n){return this.translate(n)},sprintf:function(t){var i=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=i.shift();return"undefined"!==n.typeOf(t)?t:""})}}});i("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(n,t){var i={mimes:{},extensions:{},addMimeType:function(n){n=n.split(/,/);for(var i,r,t=0;t<n.length;t+=2){for(r=n[t+1].split(/ /),i=0;i<r.length;i++)this.mimes[r[i]]=n[t];this.extensions[n[t]]=r}},extList2mimes:function(t,i){for(var u,r,e,o=[],f=0;f<t.length;f++)for(u=t[f].extensions.split(/\s*,\s*/),r=0;r<u.length;r++){if("*"===u[r])return[];if((e=this.mimes[u[r]])&&-1===n.inArray(e,o)&&o.push(e),i&&/^\w+$/.test(u[r]))o.push("."+u[r]);else if(!e)return[]}return o},mimes2exts:function(t){var i=this,r=[];return n.each(t,function(t){if("*"===t)return r=[],!1;var u=t.match(/^(\w+)\/(\*|\w+)$/);u&&("*"===u[2]?n.each(i.extensions,function(n,t){new RegExp("^"+u[1]+"/").test(t)&&[].push.apply(r,i.extensions[t])}):i.extensions[t]&&[].push.apply(r,i.extensions[t]))}),r},mimes2extList:function(i){var r=[],u=[];return"string"===n.typeOf(i)&&(i=n.trim(i).split(/\s*,\s*/)),u=this.mimes2exts(i),r.push({title:t.translate("Files"),extensions:u.length?u.join(","):"*"}),r.mimes=i,r},getFileExtension:function(n){return(n=n&&n.match(/\.([^.]+)$/))?n[1].toLowerCase():""},getFileMime:function(n){return this.mimes[this.getFileExtension(n)]||""}};return i.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),i});i("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(n){var t=function(n,t){return n.className?new RegExp("(^|\\s+)"+t+"(\\s+|$)").test(n.className):!1};return{get:function(n){return"string"!=typeof n?n:document.getElementById(n)},hasClass:t,addClass:function(n,i){t(n,i)||(n.className=n.className?n.className.replace(/\s+$/,"")+" "+i:i)},removeClass:function(n,t){n.className&&(n.className=n.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)"),function(n,t,i){return" "===t&&" "===i?" ":""}))},getStyle:function(n,t){return n.currentStyle?n.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(n,null)[t]:void 0},getPos:function(t,i){function o(n){var t,i=0;return t=0,n&&(t=n.getBoundingClientRect(),n="CSS1Compat"===e.compatMode?e.documentElement:e.body,i=t.left+n.scrollLeft,t=t.top+n.scrollTop),{x:i,y:t}}var u=0,f=0,r,e=document;if(i=i||e.body,t&&t.getBoundingClientRect&&"IE"===n.browser&&(!e.documentMode||8>e.documentMode))return u=o(t),f=o(i),{x:u.x-f.x,y:u.y-f.y};for(r=t;r&&r!=i&&r.nodeType;)u+=r.offsetLeft||0,f+=r.offsetTop||0,r=r.offsetParent;for(r=t.parentNode;r&&r!=i&&r.nodeType;)u-=r.scrollLeft||0,f-=r.scrollTop||0,r=r.parentNode;return{x:u,y:f}},getSize:function(n){return{w:n.offsetWidth||n.clientWidth,h:n.offsetHeight||n.clientHeight}}}});i("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(n){function t(n,t){for(var i in n)if(n[i]===t)return i;return null}return{RuntimeError:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": RuntimeError "+this.code}var r={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return n.extend(i,r),i.prototype=Error.prototype,i}(),OperationNotAllowedException:function(){function t(n){this.code=n;this.name="OperationNotAllowedException"}return n.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": ImageError "+this.code}var r={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};return n.extend(i,r),i.prototype=Error.prototype,i}(),FileException:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": FileException "+this.code}var r={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return n.extend(i,r),i.prototype=Error.prototype,i}(),DOMException:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": DOMException "+this.code}var r={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return n.extend(i,r),i.prototype=Error.prototype,i}(),EventException:function(){function t(n){this.code=n;this.name="EventException"}return n.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}});i("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(n,t,i){function r(){var r={};i.extend(this,{uid:null,init:function(){this.uid||(this.uid=i.guid("uid_"))},addEventListener:function(n,t,u,f){var o=this,e;this.hasOwnProperty("uid")||(this.uid=i.guid("uid_"));n=i.trim(n);/\s/.test(n)?i.each(n.split(/\s+/),function(n){o.addEventListener(n,t,u,f)}):(n=n.toLowerCase(),u=parseInt(u,10)||0,e=r[this.uid]&&r[this.uid][n]||[],e.push({fn:t,priority:u,scope:f||this}),r[this.uid]||(r[this.uid]={}),r[this.uid][n]=e)},hasEventListener:function(n){return(n=n?r[this.uid]&&r[this.uid][n]:r[this.uid])?n:!1},removeEventListener:function(n,t){n=n.toLowerCase();var u=r[this.uid]&&r[this.uid][n],f;if(u){if(t){for(f=u.length-1;0<=f;f--)if(u[f].fn===t){u.splice(f,1);break}}else u=[];u.length||(delete r[this.uid][n],i.isEmptyObj(r[this.uid])&&delete r[this.uid])}},removeAllEventListeners:function(){r[this.uid]&&delete r[this.uid]},dispatchEvent:function(u){var s,f,o,e={},c=!0,h;if("string"!==i.typeOf(u))if(f=u,"string"===i.typeOf(f.type))u=f.type,void 0!==f.total&&void 0!==f.loaded&&(e.total=f.total,e.loaded=f.loaded),e.async=f.async||!1;else throw new t.EventException(t.EventException.UNSPECIFIED_EVENT_TYPE_ERR);return-1!==u.indexOf("::")?function(n){s=n[0];u=n[1]}(u.split("::")):s=this.uid,u=u.toLowerCase(),(f=r[s]&&r[s][u])&&(f.sort(function(n,t){return t.priority-n.priority}),o=[].slice.call(arguments),o.shift(),e.type=u,o.unshift(e),MXI_DEBUG&&n.debug.events&&n.log("Event '%s' fired on %u",e.type,s),h=[],i.each(f,function(n){o[0].target=n.scope;e.async?h.push(function(t){setTimeout(function(){t(!1===n.fn.apply(n.scope,o))},1)}):h.push(function(t){t(!1===n.fn.apply(n.scope,o))})}),h.length&&i.inSeries(h,function(n){c=!n})),c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(n){var t=this;this.bind(n.join(" "),function(n){var t="on"+n.type.toLowerCase();"function"===i.typeOf(this[t])&&this[t].apply(this,arguments)});i.each(n,function(n){n="on"+n.toLowerCase(n);"undefined"===i.typeOf(t[n])&&(t[n]=null)})}})}return r.instance=new r,r});i("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(n,t,i,r){function u(r,e,o,s,h){var c=this,l,a=t.guid(e+"_");h=h||"browser";r=r||{};f[a]=this;o=t.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},o);r.preferred_caps&&(h=u.getMode(s,r.preferred_caps,h));MXI_DEBUG&&n.debug.runtime&&n.log("\tdefault mode: %s",h);l=function(){var n={};return{exec:function(t,i,r,u){if(l[i]&&(n[t]||(n[t]={context:this,instance:new l[i]}),n[t].instance[r]))return n[t].instance[r].apply(this,u)},removeInstance:function(t){delete n[t]},removeAllInstances:function(){var i=this;t.each(n,function(n,r){"function"===t.typeOf(n.instance.destroy)&&n.instance.destroy.call(n.context);i.removeInstance(r)})}}}();t.extend(this,{initialized:!1,uid:a,type:e,mode:u.getMode(s,r.required_caps,h),shimid:a+"_container",clients:0,options:r,can:function(n,i,r){if(r=r||o,"string"===t.typeOf(n)&&"undefined"===t.typeOf(i)&&(n=u.parseCaps(n)),"object"===t.typeOf(n)){for(var f in n)if(!this.can(f,n[f],r))return!1;return!0}return"function"===t.typeOf(r[n])?r[n].call(this,i):i===r[n]},getShimContainer:function(){var r,n=i.get(this.shimid);return n||(r=this.options.container?i.get(this.options.container):document.body,n=document.createElement("div"),n.id=this.shimid,n.className="moxie-shim moxie-shim-"+this.type,t.extend(n.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),r.appendChild(n)),n},getShim:function(){return l},shimExec:function(n,t){var i=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,n,t,i)},exec:function(n,t){var i=[].slice.call(arguments,2);return c[n]&&c[n][t]?c[n][t].apply(this,i):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var n=i.get(this.shimid);n&&n.parentNode.removeChild(n);l&&l.removeAllInstances();this.unbindAll();delete f[this.uid];a=c=l=this.uid=null}}});this.mode&&r.required_caps&&!this.can(r.required_caps)&&(this.mode=!1)}var e={},f={};return u.order="html5,flash,silverlight,html4",u.getRuntime=function(n){return f[n]?f[n]:!1},u.addConstructor=function(n,t){t.prototype=r.instance;e[n]=t},u.getConstructor=function(n){return e[n]||null},u.getInfo=function(n){var t=u.getRuntime(n);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}:null},u.parseCaps=function(n){var i={};return"string"!==t.typeOf(n)?n||{}:(t.each(n.split(","),function(n){i[n]=!0}),i)},u.can=function(n,t){var i,r;return i=u.getConstructor(n),i?(i=new i({required_caps:t}),r=i.mode,i.destroy(),!!r):!1},u.thatCan=function(n,t){var i=(t||u.order).split(/\s*,\s*/);for(var r in i)if(u.can(i[r],n))return i[r];return null},u.getMode=function(i,r,u){var f=null;if("undefined"===t.typeOf(u)&&(u="browser"),r&&!t.isEmptyObj(i)){if(t.each(r,function(r,u){if(i.hasOwnProperty(u)){var e=i[u](r);if("string"==typeof e&&(e=[e]),f){if(!(f=t.arrayIntersect(f,e)))return MXI_DEBUG&&n.debug.runtime&&n.log("\t\t%c: %v (conflicting mode requested: %s)",u,r,e),f=!1}else f=e}MXI_DEBUG&&n.debug.runtime&&n.log("\t\t%c: %v (compatible modes: %s)",u,r,f)}),f)return-1!==t.inArray(u,f)?u:f[0];if(!1===f)return!1}return u},u.capTrue=function(){return!0},u.capFalse=function(){return!1},u.capTest=function(n){return function(){return!!n}},u});i("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(n,t,i,r){return function(){var u;i.extend(this,{connectRuntime:function(f){function o(i){var e,h;i.length?(e=i.shift().toLowerCase(),(h=r.getConstructor(e))?(MXI_DEBUG&&n.debug.runtime&&(n.log("Trying runtime: %s",e),n.log(f)),u=new h(f),u.bind("Init",function(){u.initialized=!0;MXI_DEBUG&&n.debug.runtime&&n.log("Runtime '%s' initialized",u.type);setTimeout(function(){u.clients++;s.trigger("RuntimeInit",u)},1)}),u.bind("Error",function(){MXI_DEBUG&&n.debug.runtime&&n.log("Runtime '%s' failed to initialize",u.type);u.destroy();o(i)}),MXI_DEBUG&&n.debug.runtime&&n.log("\tselected mode: %s",u.mode),u.mode?u.init():u.trigger("Error")):o(i)):(s.trigger("RuntimeError",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)),u=null)}var s=this,e;if("string"===i.typeOf(f)?e=f:"string"===i.typeOf(f.ruid)&&(e=f.ruid),e){if(u=r.getRuntime(e))return u.clients++,u;throw new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR);}o((f.runtime_order||r.order).split(/\s*,\s*/))},disconnectRuntime:function(){u&&0>=--u.clients&&u.destroy();u=null},getRuntime:function(){return u&&u.uid?u:u=null},exec:function(){return u?u.exec.apply(this,arguments):null}})}});i("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Env moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),function(n,t,i,r,u,f,e,o,s){function h(f){MXI_DEBUG&&t.log("Instantiating FileInput...");var l=this,h;if(-1!==n.inArray(n.typeOf(f),["string","node"])&&(f={browse_button:f}),h=r.get(f.browse_button),!h)throw new u.DOMException(u.DOMException.NOT_FOUND_ERR);h={accept:[{title:e.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:h.parentNode||document.body};f=n.extend({},h,f);"string"==typeof f.required_caps&&(f.required_caps=o.parseCaps(f.required_caps));"string"==typeof f.accept&&(f.accept=i.mimes2extList(f.accept));h=r.get(f.container);h||(h=document.body);"static"===r.getStyle(h,"position")&&(h.style.position="relative");h=h=null;s.call(l);n.extend(l,{uid:n.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){l.bind("RuntimeInit",function(t,i){l.ruid=i.uid;l.shimid=i.shimid;l.bind("Ready",function(){l.trigger("Refresh")},999);l.bind("Refresh",function(){var u,t,e;t=r.get(f.browse_button);e=r.get(i.shimid);t&&(u=r.getPos(t,r.get(f.container)),t=r.getSize(t),e&&n.extend(e.style,{top:u.y+"px",left:u.x+"px",width:t.w+"px",height:t.h+"px"}))});i.exec.call(l,"FileInput","init",f)});l.connectRuntime(n.extend({},f,{required_caps:{select_file:!0}}))},disable:function(t){var i=this.getRuntime();i&&i.exec.call(this,"FileInput","disable","undefined"===n.typeOf(t)?!0:t)},refresh:function(){l.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===n.typeOf(this.files)&&n.each(this.files,function(n){n.destroy()});this.files=null;this.unbindAll()}});this.handleEventProps(c)}var c="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");return h.prototype=f.instance,h});i("moxie/core/utils/Encode",[],function(){var t=function(n){return unescape(encodeURIComponent(n))},n=function(n){return decodeURIComponent(escape(n))};return{utf8_encode:t,utf8_decode:n,atob:function(t,i){var u,e,o,r,s,f,c,h;if("function"==typeof atob)return i?n(window.atob(t)):window.atob(t);if(f=0,c=0,r="",h=[],!t)return t;t+="";do u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(f++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(f++)),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(f++)),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(f++)),o=u<<18|e<<12|r<<6|s,u=o>>16&255,e=o>>8&255,o&=255,h[c++]=64==r?String.fromCharCode(u):64==s?String.fromCharCode(u,e):String.fromCharCode(u,e,o);while(f<t.length);return r=h.join(""),i?n(r):r},btoa:function(n,i){if(i&&(n=t(n)),"function"==typeof btoa)return window.btoa(n);var e,o,s,u,r=0,h=0,f="",f=[];if(!n)return n;do e=n.charCodeAt(r++),o=n.charCodeAt(r++),s=n.charCodeAt(r++),u=e<<16|o<<8|s,e=u>>18&63,o=u>>12&63,s=u>>6&63,u&=63,f[h++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(o)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(s)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(u);while(r<n.length);return f=f.join(""),r=n.length%3,(r?f.slice(0,r-3):f)+"===".slice(r||3)}}});i("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(n,t,i){function u(f,e){function o(t,i,f){var e=r[this.uid];return"string"!==n.typeOf(e)||!e.length?null:(i=new u(null,{type:f,size:i-t}),i.detach(e.substr(t,i.size)),i)}i.call(this);f&&this.connectRuntime(f);e?"string"===n.typeOf(e)&&(e={data:e}):e={};n.extend(this,{uid:e.uid||n.guid("uid_"),ruid:f,size:e.size||0,type:e.type||"",slice:function(n,t,i){return this.isDetached()?o.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),n,t,i)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(n){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),n=n||"","data:"==n.substr(0,5)){var i=n.indexOf(";base64,");this.type=n.substring(5,i);n=t.atob(n.substring(i+8))}this.size=n.length;r[this.uid]=n},isDetached:function(){return!this.ruid&&"string"===n.typeOf(r[this.uid])},destroy:function(){this.detach();delete r[this.uid]}});e.data?this.detach(e.data):r[this.uid]=e}var r={};return u});i("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(n,t,i){function r(r,u){u||(u={});i.apply(this,arguments);this.type||(this.type=t.getFileMime(u.name));var f;u.name?(f=u.name.replace(/\\/g,"/"),f=f.substr(f.lastIndexOf("/")+1)):this.type&&(f=this.type.split("/")[0],f=n.guid((""!==f?f:"file")+"_"),t.extensions[this.type]&&(f+="."+t.extensions[this.type][0]));n.extend(this,{name:f||n.guid("file_"),relativePath:"",lastModifiedDate:u.lastModifiedDate||(new Date).toLocaleString()})}return r.prototype=i.prototype,r});i("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/core/utils/Env moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),function(n,t,i,r,u,f,e,o,s){function h(i){var u=this,f;"string"==typeof i&&(i={drop_zone:i});f={accept:[{title:n.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};i="object"==typeof i?r.extend({},f,i):f;i.container=t.get(i.drop_zone)||document.body;"static"===t.getStyle(i.container,"position")&&(i.container.style.position="relative");"string"==typeof i.accept&&(i.accept=s.mimes2extList(i.accept));e.call(u);r.extend(u,{uid:r.guid("uid_"),ruid:null,files:null,init:function(){u.bind("RuntimeInit",function(n,t){u.ruid=t.uid;t.exec.call(u,"FileDrop","init",i);u.dispatchEvent("ready")});u.connectRuntime(i)},destroy:function(){var n=this.getRuntime();n&&(n.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null;this.unbindAll()}});this.handleEventProps(c)}var c=["ready","dragenter","dragleave","drop","error"];return h.prototype=o.instance,h});i("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/runtime/RuntimeClient".split(" "),function(n,t,i,r,u,f){function e(){function r(n,r){if(this.trigger("loadstart"),this.readyState===e.LOADING)this.trigger("error",new i.DOMException(i.DOMException.INVALID_STATE_ERR)),this.trigger("loadend");else if(r instanceof u)if(this.result=null,this.readyState=e.LOADING,r.isDetached()){var f=r.getSource();switch(n){case"readAsText":case"readAsBinaryString":this.result=f;break;case"readAsDataURL":this.result="data:"+r.type+";base64,"+t.btoa(f)}this.readyState=e.DONE;this.trigger("load");this.trigger("loadend")}else this.connectRuntime(r.ruid),this.exec("FileReader","read",n,r);else this.trigger("error",new i.DOMException(i.DOMException.NOT_FOUND_ERR)),this.trigger("loadend")}f.call(this);n.extend(this,{uid:n.guid("uid_"),readyState:e.EMPTY,result:null,error:null,readAsBinaryString:function(n){r.call(this,"readAsBinaryString",n)},readAsDataURL:function(n){r.call(this,"readAsDataURL",n)},readAsText:function(n){r.call(this,"readAsText",n)},abort:function(){this.result=null;-1===n.inArray(this.readyState,[e.EMPTY,e.DONE])&&(this.readyState===e.LOADING&&(this.readyState=e.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();this.exec("FileReader","destroy");this.disconnectRuntime();this.unbindAll()}});this.handleEventProps(o);this.bind("Error",function(n,t){this.readyState=e.DONE;this.error=t},999);this.bind("Load",function(){this.readyState=e.DONE},999)}var o="loadstart progress load abort error loadend".split(" ");return e.EMPTY=0,e.LOADING=1,e.DONE=2,e.prototype=r.instance,e});i("moxie/core/utils/Url",[],function(){var n=function(t,i){for(var u="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),f=u.length,r={},e=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(t||"");f--;)e[f]&&(r[u[f]]=e[f]);return r.scheme||(i&&"string"!=typeof i||(i=n(i||document.location.href)),r.scheme=i.scheme,r.host=i.host,r.port=i.port,u="",/^[^\/]/.test(r.path)&&(u=i.path,u=/\/[^\/]*\.[^\/]*$/.test(u)?u.replace(/\/[^\/]+$/,"/"):u.replace(/\/?$/,"/")),r.path=u+(r.path||"")),r.port||(r.port={http:80,https:443}[r.scheme]||80),r.port=parseInt(r.port,10),r.path||(r.path="/"),delete r.source,r};return{parseUrl:n,resolveUrl:function(t){return t="object"==typeof t?t:n(t),t.scheme+"://"+t.host+(t.port!=={http:80,https:443}[t.scheme]?":"+t.port:"")+t.path+(t.query?t.query:"")},hasSameOrigin:function(t){function i(n){return[n.scheme,n.host,n.port].join("/")}return"string"==typeof t&&(t=n(t)),i(n())===i(t)}}});i("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(n,t,i){function r(){this.uid=n.guid("uid_");t.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}return r.prototype=i.instance,r});i("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(n,t,i){return function(){function r(n,t){var r;if(t.isDetached()){r=t.getSource();switch(n){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+i.btoa(r);case"readAsText":for(var f="",u=0,e=r.length;u<e;u++)f+=String.fromCharCode(r[u]);return f}}else return r=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",n,t),this.disconnectRuntime(),r}t.call(this);n.extend(this,{uid:n.guid("uid_"),readAsBinaryString:function(n){return r.call(this,"readAsBinaryString",n)},readAsDataURL:function(n){return r.call(this,"readAsDataURL",n)},readAsText:function(n){return r.call(this,"readAsText",n)}})}});i("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(n,t,i){return function(){var n,r=[];t.extend(this,{append:function(u,f){var o=this,e=t.typeOf(f);f instanceof i?n={name:u,value:f}:"array"===e?(u+="[]",t.each(f,function(n){o.append(u,n)})):"object"===e?t.each(f,function(n,t){o.append(u+"["+t+"]",n)}):"null"===e||"undefined"===e||"number"===e&&isNaN(f)?o.append(u,"false"):r.push({name:u,value:f.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return n&&n.value||null},getBlobName:function(){return n&&n.name||null},each:function(i){t.each(r,function(n){i(n.value,n.name)});n&&i(n.value,n.name)},destroy:function(){n=null;r=[]}})}});i("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){function y(){this.uid=n.guid("uid_")}function a(){function i(n,t){if(tt.hasOwnProperty(n)){if(1===arguments.length)return c.can("define_property")?tt[n]:ht[n];c.can("define_property")?tt[n]=t:ht[n]=t}}function yt(t){function u(){s&&(s.destroy(),s=null);r.dispatchEvent("loadend");r=null}function o(f){s.bind("LoadStart",function(n){i("readyState",a.LOADING);r.dispatchEvent("readystatechange");r.dispatchEvent(n);ft&&r.upload.dispatchEvent(n)});s.bind("Progress",function(n){i("readyState")!==a.LOADING&&(i("readyState",a.LOADING),r.dispatchEvent("readystatechange"));r.dispatchEvent(n)});s.bind("UploadProgress",function(n){ft&&r.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:n.total,loaded:n.loaded})});s.bind("Load",function(t){i("readyState",a.DONE);i("status",Number(f.exec.call(s,"XMLHttpRequest","getStatus")||0));i("statusText",p[i("status")]||"");i("response",f.exec.call(s,"XMLHttpRequest","getResponse",i("responseType")));~n.inArray(i("responseType"),["text",""])?i("responseText",i("response")):"document"===i("responseType")&&i("responseXML",i("response"));nt=f.exec.call(s,"XMLHttpRequest","getAllResponseHeaders");r.dispatchEvent("readystatechange");0<i("status")?(ft&&r.upload.dispatchEvent(t),r.dispatchEvent(t)):(g=!0,r.dispatchEvent("error"));u()});s.bind("Abort",function(n){r.dispatchEvent(n);u()});s.bind("Error",function(n){g=!0;i("readyState",a.DONE);r.dispatchEvent("readystatechange");et=!0;r.dispatchEvent(n);u()});f.exec.call(s,"XMLHttpRequest","send",{url:ct,method:st,async:it,user:lt,password:at,headers:b,mimeType:rt,encoding:vt,responseType:r.responseType,withCredentials:r.withCredentials,options:w},t)}var r=this;(new Date).getTime();s=new e;"string"==typeof w.required_caps&&(w.required_caps=f.parseCaps(w.required_caps));w.required_caps=n.extend({},w.required_caps,{return_response_type:r.responseType});t instanceof h&&(w.required_caps.send_multipart=!0);n.isEmptyObj(b)||(w.required_caps.send_custom_headers=!0);ot||(w.required_caps.do_cors=!0);w.ruid?o(s.connectRuntime(w)):(s.bind("RuntimeInit",function(n,t){o(t)}),s.bind("RuntimeError",function(n,t){r.dispatchEvent("RuntimeError",t)}),s.connectRuntime(w))}var ht=this,tt={timeout:0,readyState:a.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},it=!0,ct,st,b={},lt,at,vt=null,rt=null,ut=!1,d=!1,ft=!1,et=!1,g=!1,ot=!1,w={},s,nt="",k;n.extend(this,tt,{uid:n.guid("uid_"),upload:new y,open:function(f,e,o,s,h){if(!f||!e)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(f)||r.utf8_encode(f)!==f)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~n.inArray(f.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&(st=f.toUpperCase()),~n.inArray(st,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(e=r.utf8_encode(e),f=u.parseUrl(e),ot=u.hasSameOrigin(f),ct=u.resolveUrl(e),(s||h)&&!ot)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(lt=s||f.user,at=h||f.pass,it=o||!0,!1===it&&(i("timeout")||i("withCredentials")||""!==i("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);ut=!it;d=!1;b={};i("responseText","");i("responseXML",null);i("response",null);i("status",0);i("statusText","");i("readyState",a.OPENED);this.dispatchEvent("readystatechange")},setRequestHeader:function(u,f){if(i("readyState")!==a.OPENED||d)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(u)||r.utf8_encode(u)!==u)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return(u=n.trim(u).toLowerCase(),~n.inArray(u,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||/^(proxy\-|sec\-)/.test(u))?!1:(b[u]=b[u]?b[u]+(", "+f):f,!0)},getAllResponseHeaders:function(){return nt||""},getResponseHeader:function(t){return t=t.toLowerCase(),g||~n.inArray(t,["set-cookie","set-cookie2"])?null:nt&&""!==nt&&(k||(k={},n.each(nt.split(/\r\n/),function(t){t=t.split(/:\s+/);2===t.length&&(t[0]=n.trim(t[0]),k[t[0].toLowerCase()]={header:t[0],value:n.trim(t[1])})})),k.hasOwnProperty(t))?k[t].header+": "+k[t].value:null},overrideMimeType:function(r){var u;if(~n.inArray(i("readyState"),[a.LOADING,a.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(r=n.trim(r.toLowerCase()),/;/.test(r)&&(u=r.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(r=u[1]),!l.mimes[r])throw new t.DOMException(t.DOMException.SYNTAX_ERR);},send:function(i,u){if(w="string"===n.typeOf(u)?{ruid:u}:u?u:{},this.readyState!==a.OPENED||d)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(i instanceof o)w.ruid=i.ruid,rt=i.type||"application/octet-stream";else if(i instanceof h){if(i.hasBlob()){var f=i.getBlob();w.ruid=f.ruid;rt=f.type||"application/octet-stream"}}else"string"==typeof i&&(vt="UTF-8",rt="text/plain;charset=UTF-8",i=r.utf8_encode(i));this.withCredentials||(this.withCredentials=w.required_caps&&w.required_caps.send_browser_cookies&&!ot);ft=!ut&&this.upload.hasEventListener();g=!1;et=!i;ut||(d=!0);yt.call(this,i)},abort:function(){if(g=!0,ut=!1,~n.inArray(i("readyState"),[a.UNSENT,a.OPENED,a.DONE]))i("readyState",a.UNSENT);else{if(i("readyState",a.DONE),d=!1,s)s.getRuntime().exec.call(s,"XMLHttpRequest","abort",et);else throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);et=!0}},destroy:function(){s&&("function"===n.typeOf(s.destroy)&&s.destroy(),s=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}});this.handleEventProps(v.concat(["readystatechange"]));this.upload.handleEventProps(v)}var p={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"},v;return y.prototype=i.instance,v="loadstart progress abort error load timeout loadend".split(" "),a.UNSENT=0,a.OPENED=1,a.HEADERS_RECEIVED=2,a.LOADING=3,a.DONE=4,a.prototype=i.instance,a});i("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(n,t,i,r){function u(){function h(t,i){var s=this;e=i;s.bind("TransportingProgress",function(t){f=t.loaded;f<r&&-1===n.inArray(s.state,[u.IDLE,u.DONE])&&c.call(s)},999);s.bind("TransportingComplete",function(){f=r;s.state=u.DONE;o=null;s.result=e.exec.call(s,"Transporter","getAsBlob",t||"")},999);s.state=u.BUSY;s.trigger("TransportingStarted");c.call(s)}function c(){var n;n=r-f;s>n&&(s=n);n=t.btoa(o.substr(f,s));e.exec.call(this,"Transporter","receive",n,r)}var l,e,o,r,f,s;i.call(this);n.extend(this,{uid:n.guid("uid_"),state:u.IDLE,result:null,transport:function(t,i,u){var e=this,c;u=n.extend({chunk_size:204798},u);(l=u.chunk_size%3)&&(u.chunk_size+=3-l);s=u.chunk_size;r=f=0;o=this.result=null;o=t;r=t.length;"string"===n.typeOf(u)||u.ruid?h.call(e,i,this.connectRuntime(u)):(c=function(n,t){e.unbind("RuntimeInit",c);h.call(e,i,t)},this.bind("RuntimeInit",c),this.connectRuntime(u))},abort:function(){this.state=u.IDLE;e&&(e.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted"));r=f=0;o=this.result=null},destroy:function(){this.unbindAll();e=null;this.disconnectRuntime();r=f=0;o=this.result=null}})}return u.IDLE=0,u.BUSY=1,u.DONE=2,u.prototype=r.instance,u});i("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){function r(t){var u=n.typeOf(t);try{if(t instanceof v){if(!t.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);p.apply(this,arguments)}else if(t instanceof c){if(!~n.inArray(t.type,["image/jpeg","image/png"]))throw new i.ImageError(i.ImageError.WRONG_FORMAT);h.apply(this,arguments)}else if(-1!==n.inArray(u,["blob","file"]))r.call(this,new l(null,t),arguments[1]);else if("string"===u)"data:"===t.substr(0,5)?r.call(this,new c(null,{data:t}),arguments[1]):w.apply(this,arguments);else if("node"===u&&"img"===t.nodeName.toLowerCase())r.call(this,t.src,arguments[1]);else throw new i.DOMException(i.DOMException.TYPE_MISMATCH_ERR);}catch(f){this.trigger("error",f.code)}}function p(t,i){var r=this.connectRuntime(t.ruid);this.ruid=r.uid;r.exec.call(this,"Image","loadFromImage",t,"undefined"===n.typeOf(i)?!0:i)}function h(t,i){function u(n){r.ruid=n.uid;n.exec.call(r,"Image","loadFromBlob",t)}var r=this;r.name=t.name||"";t.isDetached()?(this.bind("RuntimeInit",function(n,t){u(t)}),i&&"string"==typeof i.required_caps&&(i.required_caps=f.parseCaps(i.required_caps)),this.connectRuntime(n.extend({required_caps:{access_image_binary:!0,resize_image:!0}},i))):u(this.connectRuntime(t.ruid))}function w(n,t){var r=this,i;i=new u;i.open("get",n);i.responseType="blob";i.onprogress=function(n){r.trigger(n)};i.onload=function(){h.call(r,i.response,!0)};i.onerror=function(n){r.trigger(n)};i.onloadend=function(){i.destroy()};i.bind("RuntimeError",function(n,t){r.trigger("RuntimeError",t)});i.send(null,t)}e.call(this);n.extend(this,{uid:n.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){r.apply(this,arguments)},downsize:function(t,r,u,f){var e={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:!1};t="object"==typeof t?n.extend(e,t):n.extend(e,{width:t,height:r,crop:u,preserveHeaders:f});try{if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(this.width>v.MAX_RESIZE_WIDTH||this.height>v.MAX_RESIZE_HEIGHT)throw new i.ImageError(i.ImageError.MAX_RESOLUTION_ERR);this.exec("Image","downsize",t.width,t.height,t.crop,t.preserveHeaders)}catch(o){this.trigger("error",o.code)}},crop:function(n,t,i){this.downsize(n,t,!0,i)},getAsCanvas:function(){if(!s.can("create_canvas"))throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(n,t){if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsBlob",n||"image/jpeg",t||90)},getAsDataURL:function(n,t){if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",n||"image/jpeg",t||90)},getAsBinaryString:function(n,t){var i=this.getAsDataURL(n,t);return a.atob(i.substring(i.indexOf("base64,")+7))},embed:function(r,u){function c(t,u){var c=this,f,l;if(s.can("create_canvas")&&(f=c.getAsCanvas(),f)){r.appendChild(f);f=null;c.destroy();e.trigger("embedded");return}if(f=c.getAsDataURL(t,u),!f)throw new i.ImageError(i.ImageError.WRONG_FORMAT);s.can("use_data_uri_of",f.length)?(r.innerHTML='<img src="'+f+'" width="'+c.width+'" height="'+c.height+'" />',c.destroy(),e.trigger("embedded")):(l=new o,l.bind("TransportingComplete",function(){h=e.connectRuntime(this.result.ruid);e.bind("Embedded",function(){n.extend(h.getShimContainer().style,{top:"0px",left:"0px",width:c.width+"px",height:c.height+"px"});h=null},999);h.exec.call(e,"ImageView","display",this.result.uid,width,height);c.destroy()}),l.transport(a.atob(f.substring(f.indexOf("base64,")+7)),t,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:r}))}var e=this,h,f;u=n.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},u||{});try{if(!(r=t.get(r)))throw new i.DOMException(i.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);return f=new v,f.bind("Resize",function(){c.call(this,u.type,u.quality)}),f.bind("Load",function(){f.downsize(u)}),this.meta.thumb&&this.meta.thumb.width>=u.width&&this.meta.thumb.height>=u.height?f.load(this.meta.thumb.data):f.clone(this,!1),f}catch(l){this.trigger("error",l.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}});this.handleEventProps(y);this.bind("Load Resize",function(){var n=void 0,n=this.exec("Image","getInfo");this.size=n.size;this.width=n.width;this.height=n.height;this.type=n.type;this.meta=n.meta;""===this.name&&(this.name=n.name)},999)}var y=["progress","load","error","resize","embedded"];return v.MAX_RESIZE_WIDTH=8192,v.MAX_RESIZE_HEIGHT=8192,v.prototype=h.instance,v});i("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(n,t,i,r){var u={};return i.addConstructor("html5",function(t,f,e){var o=this,s=i.capTest,h=i.capTrue;e=n.extend({access_binary:s(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return o.can("access_binary")&&!!u.Image},display_media:s(r.can("create_canvas")||r.can("use_data_uri_over32kb")),do_cors:s(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:s(function(){var n=document.createElement("div");return("draggable"in n||"ondragstart"in n&&"ondrop"in n)&&("IE"!==r.browser||r.verComp(r.version,9,">"))}()),filter_by_extension:s("Chrome"===r.browser&&r.verComp(r.version,28,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||"Safari"===r.browser&&r.verComp(r.version,7,">=")),return_response_headers:h,return_response_type:function(n){return"json"===n&&window.JSON?!0:r.can("return_response_type",n)},return_status_code:h,report_upload_progress:s(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return o.can("access_binary")&&r.can("create_canvas")},select_file:function(){return r.can("use_fileinput")&&window.File},select_folder:function(){return o.can("select_file")&&"Chrome"===r.browser&&r.verComp(r.version,21,">=")},select_multiple:function(){return o.can("select_file")&&!("Safari"===r.browser&&"Windows"===r.os)&&!("iOS"===r.os&&r.verComp(r.osVersion,"7.0.0",">")&&r.verComp(r.osVersion,"8.0.0","<"))},send_binary_string:s(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:s(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||o.can("send_binary_string")},slice_blob:s(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return o.can("slice_blob")&&o.can("send_multipart")},summon_file_dialog:function(){return o.can("select_file")&&("Firefox"===r.browser&&r.verComp(r.version,4,">=")||"Opera"===r.browser&&r.verComp(r.version,12,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||!!~n.inArray(r.browser,["Chrome","Safari"]))},upload_filesize:h},e);i.call(this,t,f||"html5",e);n.extend(this,{init:function(){this.trigger("Init")},destroy:function(n){return function(){n.call(o);n=o=null}}(this.destroy)});n.extend(this.getShim(),u)}),u});i("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(n){function u(){this.returnValue=!1}function f(){this.cancelBubble=!0}var i={},t="moxie_"+n.guid(),r=function(r,u,f){var e,o;if(u=u.toLowerCase(),r[t]&&i[r[t]]&&i[r[t]][u]){for(e=i[r[t]][u],o=e.length-1;0<=o;o--)if((e[o].orig===f||e[o].key===f)&&(r.removeEventListener?r.removeEventListener(u,e[o].func,!1):r.detachEvent&&r.detachEvent("on"+u,e[o].func),e[o].orig=null,e[o].func=null,e.splice(o,1),void 0!==f))break;if(e.length||delete i[r[t]][u],n.isEmptyObj(i[r[t]])){delete i[r[t]];try{delete r[t]}catch(s){r[t]=void 0}}}};return{addEvent:function(r,e,o,s){var h;e=e.toLowerCase();r.addEventListener?(h=o,r.addEventListener(e,h,!1)):r.attachEvent&&(h=function(){var n=window.event;n.target||(n.target=n.srcElement);n.preventDefault=u;n.stopPropagation=f;o(n)},r.attachEvent("on"+e,h));r[t]||(r[t]=n.guid());i.hasOwnProperty(r[t])||(i[r[t]]={});r=i[r[t]];r.hasOwnProperty(e)||(r[e]=[]);r[e].push({func:h,orig:o,key:s})},removeEvent:r,removeAllEvents:function(u,f){u&&u[t]&&n.each(i[u[t]],function(n,t){r(u,t,f)})}}});i("moxie/runtime/html5/file/FileInput","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(n,t,i,r,u,f,e){return n.FileInput=function(){var n;i.extend(this,{init:function(o){var s=this,h=s.getRuntime(),c,l,a;n=o;o=n.accept.mimes||f.extList2mimes(n.accept,h.can("filter_by_extension"));c=h.getShimContainer();c.innerHTML='<input id="'+h.uid+'" type="file" style="font-size:999px;opacity:0;"'+(n.multiple&&h.can("select_multiple")?"multiple":"")+(n.directory&&h.can("select_folder")?"webkitdirectory directory":"")+(o?' accept="'+o.join(",")+'"':"")+" />";o=r.get(h.uid);i.extend(o.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});l=r.get(n.browse_button);h.can("summon_file_dialog")&&("static"===r.getStyle(l,"position")&&(l.style.position="relative"),a=parseInt(r.getStyle(l,"z-index"),10)||1,l.style.zIndex=a,c.style.zIndex=a-1,u.addEvent(l,"click",function(n){var t=r.get(h.uid);t&&!t.disabled&&t.click();n.preventDefault()},s.uid));c=h.can("summon_file_dialog")?l:c;u.addEvent(c,"mouseover",function(){s.trigger("mouseenter")},s.uid);u.addEvent(c,"mouseout",function(){s.trigger("mouseleave")},s.uid);u.addEvent(c,"mousedown",function(){s.trigger("mousedown")},s.uid);u.addEvent(r.get(n.container),"mouseup",function(){s.trigger("mouseup")},s.uid);o.onchange=function v(r){s.files=[];i.each(this.files,function(i){var r="";if(n.directory&&"."==i.name)return!0;i.webkitRelativePath&&(r="/"+i.webkitRelativePath.replace(/^\//,""));i=new t(h.uid,i);i.relativePath=r;s.files.push(i)});"IE"!==e.browser&&"IEMobile"!==e.browser?this.value="":(r=this.cloneNode(!0),this.parentNode.replaceChild(r,this),r.onchange=v);s.files.length&&s.trigger("change")};s.trigger({type:"ready",async:!0});c=null},disable:function(n){var t=this.getRuntime();(t=r.get(t.uid))&&(t.disabled=!!n)},destroy:function(){var t=this.getRuntime(),i=t.getShim(),t=t.getShimContainer();u.removeAllEvents(t,this.uid);u.removeAllEvents(n&&r.get(n.container),this.uid);u.removeAllEvents(n&&r.get(n.browse_button),this.uid);t&&(t.innerHTML="");i.removeInstance(this.uid);n=null}})}});i("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(n,t){return n.Blob=function(){function n(n,t,i){var r;if(window.File.prototype.slice)try{return n.slice(),n.slice(t,i)}catch(u){return n.slice(t,i-t)}else return(r=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?r.call(n,t,i):null}this.slice=function(){return new t(this.getRuntime().uid,n.apply(this,arguments))}}});i("moxie/runtime/html5/file/FileDrop","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime".split(" "),function(n,t,i,r,u,f){return n.FileDrop=function(){function o(n){return!n.dataTransfer||!n.dataTransfer.types?!1:(n=i.toArray(n.dataTransfer.types||[]),-1!==i.inArray("Files",n)||-1!==i.inArray("public.file-url",n)||-1!==i.inArray("application/x-moz-file",n))}function s(r,u){var e;h.length?(e=f.getFileExtension(r.name),e=!e||-1!==i.inArray(e,h)):e=!0;e&&(e=new t(c,r),e.relativePath=u||"",n.push(e))}function v(n){for(var t=[],r=0;r<n.length;r++)[].push.apply(t,n[r].extensions.split(/\s*,\s*/));return-1===i.inArray("*",t)?t:[]}function l(n,t){var r=[];i.each(n,function(n){var t=n.webkitGetAsEntry();t&&(t.isFile?s(n.getAsFile(),t.fullPath):r.push(t))});r.length?a(r,t):t()}function a(n,t){var r=[];i.each(n,function(n){r.push(function(t){y(n,t)})});i.inSeries(r,function(){t()})}function y(n,t){n.isFile?n.file(function(i){s(i,n.fullPath);t()},function(){t()}):n.isDirectory?p(n,t):t()}function p(n,t){function i(n){u.readEntries(function(t){t.length?([].push.apply(r,t),i(n)):n()},n)}var r=[],u=n.createReader();i(function(){a(r,t)})}var n=[],h=[],e,c;i.extend(this,{init:function(t){var r=this;e=t;c=r.ruid;h=v(e.accept);e.inIframe&&(t=document.getElementById(e.editor_id).contentWindow.document,u.addEvent(t,"dragover",function(n){o(n)&&(n.preventDefault(),n.dataTransfer.dropEffect="copy")},r.uid),u.addEvent(t,"drop",function(t){o(t)&&(t.preventDefault(),n=[],t.dataTransfer.items&&t.dataTransfer.items[0].webkitGetAsEntry?l(t.dataTransfer.items,function(){r.files=n;r.trigger("drop")}):(i.each(t.dataTransfer.files,function(n){s(n)}),r.files=n,r.trigger("drop")))},r.uid),u.addEvent(t,"dragenter",function(){r.trigger("dragenter")},r.uid),u.addEvent(t,"dragleave",function(){r.trigger("dragleave")},r.uid));t=e.container;u.addEvent(t,"dragover",function(n){o(n)&&(n.preventDefault(),n.dataTransfer.dropEffect="copy")},r.uid);u.addEvent(t,"drop",function(t){o(t)&&(t.preventDefault(),n=[],t.dataTransfer.items&&t.dataTransfer.items[0].webkitGetAsEntry?l(t.dataTransfer.items,function(){r.files=n;r.trigger("drop")}):(i.each(t.dataTransfer.files,function(n){s(n)}),r.files=n,r.trigger("drop")))},r.uid);u.addEvent(t,"dragenter",function(){r.trigger("dragenter")},r.uid);u.addEvent(t,"dragleave",function(){r.trigger("dragleave")},r.uid)},destroy:function(){u.removeAllEvents(e&&r.get(e.container),this.uid);c=n=h=e=null}})}});i("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(n,t,i){return n.FileReader=function(){var n,r=!1;i.extend(this,{read:function(u,f){var e=this;e.result="";n=new window.FileReader;n.addEventListener("progress",function(n){e.trigger(n)});n.addEventListener("load",function(i){var u;r?(u=n.result,u=t.atob(u.substring(u.indexOf("base64,")+7))):u=n.result;e.result=u;e.trigger(i)});n.addEventListener("error",function(t){e.trigger(t,n.error)});n.addEventListener("loadend",function(t){n=null;e.trigger(t)});"function"===i.typeOf(n[u])?(r=!1,n[u](f.getSource())):"readAsBinaryString"===u&&(r=!0,n.readAsDataURL(f.getSource()))},abort:function(){n&&n.abort()},destroy:function(){n=null}})}});i("moxie/runtime/html5/xhr/XMLHttpRequest","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env".split(" "),function(n,t,i,r,u,f,e,o,s){return n.XMLHttpRequest=function(){function l(n,t){var u=this,r,i;r=t.getBlob().getSource();i=new window.FileReader;i.onload=function(){t.append(t.getBlobName(),new f(null,{type:r.type,data:i.result}));c.send.call(u,n,t)};i.readAsBinaryString(r)}function a(){var t,i,n;if(!window.XMLHttpRequest||"IE"===s.browser&&s.verComp(s.version,8,"<")){n:{for(i=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],n=0;n<i.length;n++)try{t=new ActiveXObject(i[n]);break n}catch(r){}t=void 0}return t}return new window.XMLHttpRequest}function v(t){var i="----moxieboundary"+(new Date).getTime(),r="";if(!this.getRuntime().can("send_binary_string"))throw new o.RuntimeError(o.RuntimeError.NOT_SUPPORTED_ERR);return n.setRequestHeader("Content-Type","multipart/form-data; boundary="+i),t.each(function(n,t){r=n instanceof f?r+("--"+i+'\r\nContent-Disposition: form-data; name="'+t+'"; filename="'+unescape(encodeURIComponent(n.name||"blob"))+'"\r\nContent-Type: '+(n.type||"application/octet-stream")+"\r\n\r\n"+n.getSource()+"\r\n"):r+("--"+i+'\r\nContent-Disposition: form-data; name="'+t+'"\r\n\r\n'+unescape(encodeURIComponent(n))+"\r\n")}),r+="--"+i+"--\r\n"}var c=this,n,h;t.extend(this,{send:function(i,u){var o=this,p="Mozilla"===s.browser&&s.verComp(s.version,4,">=")&&s.verComp(s.version,7,"<"),w="Android Browser"===s.browser,y=!1,c;if(h=i.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),n=a(),n.open(i.method,i.url,i.async,i.user,i.password),u instanceof f)u.isDetached()&&(y=!0),u=u.getSource();else if(u instanceof e){if(u.hasBlob())if(u.getBlob().isDetached())u=v.call(o,u),y=!0;else if((p||w)&&"blob"===t.typeOf(u.getBlob().getSource())&&window.FileReader){l.call(o,i,u);return}u instanceof e&&(c=new window.FormData,u.each(function(n,t){n instanceof f?c.append(t,n.getSource()):c.append(t,n)}),u=c)}n.upload?(i.withCredentials&&(n.withCredentials=!0),n.addEventListener("load",function(n){o.trigger(n)}),n.addEventListener("error",function(n){o.trigger(n)}),n.addEventListener("progress",function(n){o.trigger(n)}),n.upload.addEventListener("progress",function(n){o.trigger({type:"UploadProgress",loaded:n.loaded,total:n.total})})):n.onreadystatechange=function(){switch(n.readyState){case 3:var t,u;try{r.hasSameOrigin(i.url)&&(t=n.getResponseHeader("Content-Length")||0);n.responseText&&(u=n.responseText.length)}catch(f){t=u=0}o.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:u});break;case 4:n.onreadystatechange=function(){};0===n.status?o.trigger("error"):o.trigger("load")}};t.isEmptyObj(i.headers)||t.each(i.headers,function(t,i){n.setRequestHeader(i,t)});""!==i.responseType&&"responseType"in n&&(n.responseType="json"!==i.responseType||s.can("return_response_type","json")?i.responseType:"text");y?n.sendAsBinary?n.sendAsBinary(u):function(){for(var i=new Uint8Array(u.length),t=0;t<u.length;t++)i[t]=u.charCodeAt(t)&255;n.send(i.buffer)}():n.send(u);o.trigger("loadstart")},getStatus:function(){try{if(n)return n.status}catch(t){}return 0},getResponse:function(t){var l=this.getRuntime(),f,e,o,r,c;try{switch(t){case"blob":return f=new u(l.uid,n.response),e=n.getResponseHeader("Content-Disposition"),e&&(o=e.match(/filename=([\'\"'])([^\1]+)\1/),o&&(h=o[2])),f.name=h,f.type||(f.type=i.getFileMime(h)),f;case"json":return s.can("return_response_type","json")?n.response:200===n.status&&window.JSON?JSON.parse(n.responseText):null;case"document":return r=n.responseXML,c=n.responseText,"IE"===s.browser&&c&&r&&!r.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(n.getResponseHeader("Content-Type"))&&(r=new window.ActiveXObject("Microsoft.XMLDOM"),r.async=!1,r.validateOnParse=!1,r.loadXML(c)),r&&("IE"===s.browser&&0!==r.parseError||!r.documentElement||"parsererror"===r.documentElement.tagName)?null:r;default:return""!==n.responseText?n.responseText:null}}catch(a){return null}},getAllResponseHeaders:function(){try{return n.getAllResponseHeaders()}catch(t){}return""},abort:function(){n&&n.abort()},destroy:function(){c=h=null}})}});i("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(n){function t(n){n instanceof ArrayBuffer?i.apply(this,arguments):r.apply(this,arguments)}function i(t){var i=new DataView(t);n.extend(this,{readByteAt:function(n){return i.getUint8(n)},writeByteAt:function(n,t){i.setUint8(n,t)},SEGMENT:function(n,r,u){switch(arguments.length){case 2:return t.slice(n,n+r);case 1:return t.slice(n);case 3:if(null===u&&(u=new ArrayBuffer),u instanceof ArrayBuffer){var f=new Uint8Array(this.length()-r+u.byteLength);0<n&&f.set(new Uint8Array(t.slice(0,n)),0);f.set(new Uint8Array(u),n);f.set(new Uint8Array(t.slice(n+r)),n+u.byteLength);this.clear();t=f.buffer;i=new DataView(t);break}default:return t}},length:function(){return t?t.byteLength:0},clear:function(){i=t=null}})}function r(t){function i(n,i,r){r=3===arguments.length?r:t.length-i-1;t=t.substr(0,i)+n+t.substr(r+i)}n.extend(this,{readByteAt:function(n){return t.charCodeAt(n)},writeByteAt:function(n,t){i(String.fromCharCode(t),n,1)},SEGMENT:function(n,r,u){switch(arguments.length){case 1:return t.substr(n);case 2:return t.substr(n,r);case 3:i(null!==u?u:"",n,r);break;default:return t}},length:function(){return t?t.length:0},clear:function(){t=null}})}return n.extend(t.prototype,{littleEndian:!1,read:function(n,t){var r,u,i;if(n+t>this.length())throw Error("You are trying to read outside the source boundaries.");for(u=this.littleEndian?0:-8*(t-1),r=i=0;i<t;i++)r|=this.readByteAt(n+i)<<Math.abs(u+8*i);return r},write:function(n,t,i){var u,r;if(n>this.length())throw Error("You are trying to write outside the source boundaries.");for(u=this.littleEndian?0:-8*(i-1),r=0;r<i;r++)this.writeByteAt(n+r,t>>Math.abs(u+8*r)&255)},BYTE:function(n){return this.read(n,1)},SHORT:function(n){return this.read(n,2)},LONG:function(n){return this.read(n,4)},SLONG:function(n){return n=this.read(n,4),2147483647<n?n-4294967296:n},CHAR:function(n){return String.fromCharCode(this.read(n,1))},STRING:function(n,t){return this.asArray("CHAR",n,t).join("")},asArray:function(n,t,i){for(var u=[],r=0;r<i;r++)u[r]=this[n](t+r);return u}}),t});i("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(n,t){return function i(r){var u=[],f,e,o=0;if(r=new n(r),65496!==r.SHORT(0))throw r.clear(),new t.ImageError(t.ImageError.WRONG_FORMAT);for(f=2;f<=r.length();)if(e=r.SHORT(f),65488<=e&&65495>=e)f+=2;else{if(65498===e||65497===e)break;o=r.SHORT(f+2)+2;65505<=e&&65519>=e&&u.push({hex:e,name:"APP"+(e&15),start:f,length:o,segment:r.SEGMENT(f,o)});f+=o}return r.clear(),{headers:u,restore:function(t){var r,i;for(i=new n(t),f=65504==i.SHORT(2)?4+i.SHORT(4):2,r=0,t=u.length;r<t;r++)i.SEGMENT(f,0,u[r].segment),f+=u[r].length;return t=i.SEGMENT(),i.clear(),t},strip:function(t){var r,u;for(r=new i(t),u=r.headers,r.purge(),r=new n(t),t=u.length;t--;)r.SEGMENT(u[t].start,u[t].length,"");return t=r.SEGMENT(),r.clear(),t},get:function(n){for(var i=[],t=0,r=u.length;t<r;t++)u[t].name===n.toUpperCase()&&i.push(u[t].segment);return i},set:function(n,t){var r=[],i,f,e;for("string"==typeof t?r.push(t):r=t,i=f=0,e=u.length;i<e&&!(u[i].name===n.toUpperCase()&&(u[i].segment=r[f],u[i].length=r[f].length,f++),f>=r.length);i++);},purge:function(){this.headers=u=[]}}}});i("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(n,i,r){function u(f){function c(i,u){var y,c,h,s,f,a,o;s=[];var v={},p={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},w={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(y=this.SHORT(i),c=0;c<y;c++)if(o=i+2+12*c,h=u[this.SHORT(o)],h!==t){if(s=p[this.SHORT(o+=2)],f=this.LONG(o+=2),a=w[s],!a)throw new r.ImageError(r.ImageError.INVALID_META_ERR);if(o+=4,4<a*f&&(o=this.LONG(o)+e.tiffHeader),o+a*f>=this.length())throw new r.ImageError(r.ImageError.INVALID_META_ERR);"ASCII"===s?v[h]=n.trim(this.STRING(o,f).replace(/\0$/,"")):(s=this.asArray(s,o,f),f=1==f?s[0]:s,v[h]=l.hasOwnProperty(h)&&"object"!=typeof f?l[h][f]:f)}return v}var a,s,l,e,h,o;if(i.call(this,f),s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},e={tiffHeader:10},h=e.tiffHeader,a={clear:this.clear},n.extend(this,{read:function(){try{return u.prototype.read.apply(this,arguments)}catch(n){throw new r.ImageError(r.ImageError.INVALID_META_ERR);}},write:function(){try{return u.prototype.write.apply(this,arguments)}catch(n){throw new r.ImageError(r.ImageError.INVALID_META_ERR);}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(n){return this.LONG(n)/this.LONG(n+4)},SRATIONAL:function(n){return this.SLONG(n)/this.SLONG(n+4)},ASCII:function(n){return this.CHAR(n)},TIFF:function(){return o||null},EXIF:function(){var t=null,i,r;if(e.exifIFD){try{t=c.call(this,e.exifIFD,s.exif)}catch(u){return null}if(t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(i=0,r="";i<t.ExifVersion.length;i++)r+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=r}}return t},GPS:function(){var t=null;if(e.gpsIFD){try{t=c.call(this,e.gpsIFD,s.gps)}catch(i){return null}t.GPSVersionID&&"array"===n.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join("."))}return t},thumb:function(){if(e.IFD1)try{var n=c.call(this,e.IFD1,s.thumb);if("JPEGInterchangeFormat"in n)return this.SEGMENT(e.tiffHeader+n.JPEGInterchangeFormat,n.JPEGInterchangeFormatLength)}catch(t){}return null},setExif:function(n,t){var i,r,u,h,f,o;if("PixelXDimension"!==n&&"PixelYDimension"!==n)return!1;n:{if(i=n,f=0,"string"==typeof i)for(u in r=s.exif,r)if(r[u]===i){i=u;break}for(r=e.exifIFD,u=this.SHORT(r),o=0;o<u;o++)if(h=r+12*o+2,this.SHORT(h)==i){f=h+8;break}if(f){try{this.write(f,t,4)}catch(c){i=!1;break n}i=!0}else i=!1}return i},clear:function(){a.clear();f=s=l=o=e=a=null}}),65505!==this.SHORT(0)||"EXIF\x00"!==this.STRING(4,5).toUpperCase())throw new r.ImageError(r.ImageError.INVALID_META_ERR);if(this.littleEndian=18761==this.SHORT(h),42!==this.SHORT(h+=2))throw new r.ImageError(r.ImageError.INVALID_META_ERR);e.IFD0=e.tiffHeader+this.LONG(h+=2);o=c.call(this,e.IFD0,s.tiff);"ExifIFDPointer"in o&&(e.exifIFD=e.tiffHeader+o.ExifIFDPointer,delete o.ExifIFDPointer);"GPSInfoIFDPointer"in o&&(e.gpsIFD=e.tiffHeader+o.GPSInfoIFDPointer,delete o.GPSInfoIFDPointer);n.isEmptyObj(o)&&(o=null);(h=this.LONG(e.IFD0+12*this.SHORT(e.IFD0)+2))&&(e.IFD1=e.tiffHeader+h)}return u.prototype=i.prototype,u});i("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(n,t,i,r,u){return function(f){function c(n){var t=0,i;for(n||(n=s);t<=n.length();){if(i=n.SHORT(t+=2),65472<=i&&65475>=i)return t+=5,{height:n.SHORT(t),width:n.SHORT(t+2)};i=n.SHORT(t+=2);t+=i-2}return null}function l(){var t=e.thumb(),i,n;return t&&(i=new r(t),n=c(i),i.clear(),n)?(n.data=t,n):null}var s,o,e,h;if(s=new r(f),65496!==s.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);o=new i(f);try{e=new u(o.get("app1")[0])}catch(a){}h=c.call(this);n.extend(this,{type:"image/jpeg",size:s.length(),width:h&&h.width||0,height:h&&h.height||0,setExif:function(t,i){if(!e)return!1;"object"===n.typeOf(t)?n.each(t,function(n,t){e.setExif(t,n)}):e.setExif(t,i);o.set("app1",e.SEGMENT())},writeHeaders:function(){return arguments.length?o.restore(arguments[0]):o.restore(f)},stripHeaders:function(n){return o.strip(n)},purge:function(){e&&o&&s&&(e.clear(),o.purge(),s.clear(),h=o=e=s=null)}});e&&(this.meta={tiff:e.TIFF(),exif:e.EXIF(),gps:e.GPS(),thumb:l()})}});i("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(n,t,i){return function(r){function e(){u&&(u.clear(),r=f=u=null)}var u,f;u=new i(r),function(){for(var i=0,t=0,r=[35152,20039,3338,6666],t=0;t<r.length;t++,i+=2)if(r[t]!=u.SHORT(i))throw new n.ImageError(n.ImageError.WRONG_FORMAT);}();f=function(){var n=8,i,r,t;return i=u.LONG(n),r=u.STRING(n+=4,4),t=n+=4,u.LONG(n+i),"IHDR"==r?{width:u.LONG(t),height:u.LONG(t+4)}:null}.call(this);t.extend(this,{type:"image/png",size:u.length(),width:f.width,height:f.height,purge:function(){e.call(this)}});e.call(this)}});i("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(n,t,i,r){return function(u){var e=[i,r],f;f=function(){for(var n=0;n<e.length;n++)try{return new e[n](u)}catch(i){}throw new t.ImageError(t.ImageError.WRONG_FORMAT);}();n.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(n){return n},stripHeaders:function(n){return n},purge:function(){u=null}});n.extend(this,f);this.purge=function(){f.purge();f=null}}});i("moxie/runtime/html5/image/MegaPixel",[],function(){function n(n){var i=n.naturalWidth,t;return 1048576<i*n.naturalHeight?(t=document.createElement("canvas"),t.width=t.height=1,t=t.getContext("2d"),t.drawImage(n,-i+1,0),0===t.getImageData(0,0,1,1).data[3]):!1}return{isSubsampled:n,renderTo:function(t,i,r){var h=t.naturalWidth,s=t.naturalHeight,v=r.width,y=r.height,p=r.x||0,l,a,f,u;r=r.y||0;i=i.getContext("2d");n(t)&&(h/=2,s/=2);l=document.createElement("canvas");l.width=l.height=1024;a=l.getContext("2d");f=s;u=document.createElement("canvas");u.width=1;u.height=f;u=u.getContext("2d");u.drawImage(t,0,0);for(var u=u.getImageData(0,0,1,f).data,c=0,e=f,o=f;o>c;)0===u[4*(o-1)+3]?e=o:c=o,o=e+c>>1;for(f=o/f,f=0===f?1:f,u=0;u<s;){for(c=u+1024>s?s-u:1024,e=0;e<h;)o=e+1024>h?h-e:1024,a.clearRect(0,0,1024,1024),a.drawImage(t,-e,-u),i.drawImage(l,0,0,o,c,e*v/h+p<<0,u*y/s/f+r<<0,Math.ceil(o*v/h),Math.ceil(c*y/s/f)),e+=1024;u+=1024}}}});i("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/MegaPixel moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n.Image=function(){function b(){if(!n&&!v)throw new i.ImageError(i.DOMException.INVALID_STATE_ERR);return n||v}function p(n){return r.atob(n.substring(n.indexOf("base64,")+7))}function k(n){var t=this;v=new Image;v.onerror=function(){nt.call(this);t.trigger("error",i.ImageError.WRONG_FORMAT)};v.onload=function(){t.trigger("load")};v.src="data:"==n.substr(0,5)?n:"data:"+(a.type||"")+";base64,"+r.btoa(n)}function tt(n,t){var u=this,r;if(window.FileReader)r=new FileReader,r.onload=function(){t(this.result)},r.onerror=function(){u.trigger("error",i.ImageError.WRONG_FORMAT)},r.readAsDataURL(n);else return t(n.getAsDataURL())}function g(i,r,u,f){var s,l=0,a=0,e,c;if(d=f,c=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(c,[5,6,7,8])&&(e=i,i=r,r=e),e=b(),u?(i=Math.min(i,e.width),r=Math.min(r,e.height),s=Math.max(i/e.width,r/e.height)):s=Math.min(i/e.width,r/e.height),!(1<s&&!u&&f)){if(n||(n=document.createElement("canvas")),f=Math.round(e.width*s),s=Math.round(e.height*s),u?(n.width=i,n.height=r,f>i&&(l=Math.round((f-i)/2)),s>r&&(a=Math.round((s-r)/2))):(n.width=f,n.height=s),!d){i=n.width;r=n.height;switch(c){case 5:case 6:case 7:case 8:n.width=r;n.height=i;break;default:n.width=i;n.height=r}u=n.getContext("2d");switch(c){case 2:u.translate(i,0);u.scale(-1,1);break;case 3:u.translate(i,r);u.rotate(Math.PI);break;case 4:u.translate(0,r);u.scale(1,-1);break;case 5:u.rotate(.5*Math.PI);u.scale(1,-1);break;case 6:u.rotate(.5*Math.PI);u.translate(0,-r);break;case 7:u.rotate(.5*Math.PI);u.translate(i,-r);u.scale(-1,1);break;case 8:u.rotate(-.5*Math.PI);u.translate(-i,0)}}c=n;l=-l;a=-a;"iOS"===h.OS?o.renderTo(e,c,{width:f,height:s,x:l,y:a}):c.getContext("2d").drawImage(e,l,a,f,s);this.width=n.width;this.height=n.height;y=!0}this.trigger("Resize")}function nt(){l&&(l.purge(),l=null);c=v=n=a=null;y=!1}var w=this,v,l,n,c,a,y=!1,d=!0;t.extend(this,{loadFromBlob:function(n){var t=this,r=t.getRuntime(),u=1<arguments.length?arguments[1]:!0;if(!r.can("access_binary"))throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR);a=n;n.isDetached()?(c=n.getSource(),k.call(this,c)):tt.call(this,n.getSource(),function(n){u&&(c=p(n));k.call(t,n)})},loadFromImage:function(n,t){this.meta=n.meta;a=new f(null,{name:n.name,size:n.size,type:n.type});k.call(this,t?c=n.getAsBinaryString():n.getAsDataURL())},getInfo:function(){var n=this.getRuntime();return!l&&c&&n.can("access_image_binary")&&(l=new e(c)),n={width:b().width||0,height:b().height||0,type:a.type||s.getFileMime(a.name),size:c&&c.length||a.size||0,name:a.name||"",meta:l&&l.meta||this.meta||{}},!n.meta||!n.meta.thumb||n.meta.thumb.data instanceof u||(n.meta.thumb.data=new u(null,{type:"image/jpeg",data:n.meta.thumb.data})),n},downsize:function(){g.apply(this,arguments)},getAsCanvas:function(){return n&&(n.id=this.uid+"_canvas"),n},getAsBlob:function(n,t){return n!==this.type&&g.call(this,this.width,this.height,!1),new f(null,{name:a.name||"",type:n,data:w.getAsBinaryString.call(this,n,t)})},getAsDataURL:function(t,i){var r=i||90;if(!y)return v.src;if("image/jpeg"!==t)return n.toDataURL("image/png");try{return n.toDataURL("image/jpeg",r/100)}catch(u){return n.toDataURL("image/jpeg")}},getAsBinaryString:function(t,i){if(!y)return c||(c=p(w.getAsDataURL(t,i))),c;if("image/jpeg"!==t)c=p(w.getAsDataURL(t,i));else{var r;i||(i=90);try{r=n.toDataURL("image/jpeg",i/100)}catch(u){r=n.toDataURL("image/jpeg")}c=p(r);l&&(c=l.stripHeaders(c),d&&(l.meta&&l.meta.exif&&l.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),c=l.writeHeaders(c)),l.purge(),l=null)}return y=!1,c},destroy:function(){w=null;nt.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});i("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(n,t,i,r,u){function e(){var n;try{n=navigator.plugins["Shockwave Flash"];n=n.description}catch(t){try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){n="0.0"}}return n=n.match(/\d+/g),parseFloat(n[0]+"."+n[1])}function o(n){var r=i.get(n);r&&"OBJECT"==r.nodeName&&("IE"===t.browser?(r.style.display="none",function u(){var t,f;if(4==r.readyState){if(t=i.get(n),t){for(f in t)"function"==typeof t[f]&&(t[f]=null);t.parentNode.removeChild(t)}}else setTimeout(u,10)}()):r.parentNode.removeChild(r))}var f={};return u.addConstructor("flash",function(s){var h=this,c;s=n.extend({swf_url:t.swf_url},s);u.call(this,s,"flash",{access_binary:function(n){return n&&"browser"===h.mode},access_image_binary:function(n){return n&&"browser"===h.mode},display_media:u.capTrue,do_cors:u.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===h.mode},resize_image:u.capTrue,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!n.arrayDiff(t,["","text","document"])||"browser"===h.mode},return_status_code:function(t){return"browser"===h.mode||!n.arrayDiff(t,[200,404])},select_file:u.capTrue,select_multiple:u.capTrue,send_binary_string:function(n){return n&&"browser"===h.mode},send_browser_cookies:function(n){return n&&"browser"===h.mode},send_custom_headers:function(n){return n&&"browser"===h.mode},send_multipart:u.capTrue,slice_blob:function(n){return n&&"browser"===h.mode},stream_upload:function(n){return n&&"browser"===h.mode},summon_file_dialog:!1,upload_filesize:function(t){return 2097152>=n.parseSizeStr(t)||"client"===h.mode},use_http_method:function(t){return!n.arrayDiff(t,["GET","POST"])}},{access_binary:function(n){return n?"browser":"client"},access_image_binary:function(n){return n?"browser":"client"},report_upload_progress:function(n){return n?"browser":"client"},return_response_type:function(t){return n.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return n.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(n){return n?"browser":"client"},send_browser_cookies:function(n){return n?"browser":"client"},send_custom_headers:function(n){return n?"browser":"client"},stream_upload:function(n){return n?"client":"browser"},upload_filesize:function(t){return 2097152<=n.parseSizeStr(t)?"client":"browser"}},"client");10>e()&&(MXI_DEBUG&&t.debug.runtime&&t.log("\tFlash didn't meet minimal version requirement (10)."),this.mode=!1);n.extend(this,{getShim:function(){return i.get(this.uid)},shimExec:function(n,t){var i=[].slice.call(arguments,2);return h.getShim().exec(this.uid,n,t,i)},init:function(){var i,f,u;u=this.getShimContainer();n.extend(u.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});i='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+s.swf_url+'" ';"IE"===t.browser&&(i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');i+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+s.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /><\/object>';"IE"===t.browser?(f=document.createElement("div"),u.appendChild(f),f.outerHTML=i,f=u=null):u.innerHTML=i;c=setTimeout(function(){h&&!h.initialized&&(h.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&t.debug.runtime&&t.log("\tFlash failed to initialize within a specified period of time (typically 5s)."))},5e3)},destroy:function(n){return function(){o(h.uid);n.call(h);clearTimeout(c);s=c=n=h=null}}(this.destroy)},f)}),f});i("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(n,t,i){return n.FileInput={init:function(n){var r=this,u=this.getRuntime();this.bind("Change",function(){var n=u.shimExec.call(r,"FileInput","getFiles");r.files=[];i.each(n,function(n){r.files.push(new t(u.uid,n))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",{name:n.name,accept:n.accept,multiple:n.multiple});this.trigger("ready")}}});i("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(n,t){return n.Blob={slice:function(n,i,r,u){var f=this.getRuntime();return 0>i?i=Math.max(n.size+i,0):0<i&&(i=Math.min(i,n.size)),0>r?r=Math.max(n.size+r,0):0<r&&(r=Math.min(r,n.size)),(n=f.shimExec.call(this,"Blob","slice",i,r,u||""))&&(n=new t(f.uid,n)),n}}});i("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(n,t){function i(n,i){switch(i){case"readAsText":return t.atob(n,"utf8");case"readAsBinaryString":return t.atob(n);case"readAsDataURL":return n}return null}return n.FileReader={read:function(n,t){var r=this;return r.result="","readAsDataURL"===n&&(r.result="data:"+(t.type||"")+";base64,"),r.bind("Progress",function(t,u){u&&(r.result+=i(u,n))},999),r.getRuntime().shimExec.call(this,"FileReader","readAsBase64",t.uid)}}});i("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(n,t){function i(n,i){switch(i){case"readAsText":return t.atob(n,"utf8");case"readAsBinaryString":return t.atob(n);case"readAsDataURL":return n}return null}return n.FileReaderSync={read:function(n,t){var r;return(r=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",t.uid),!r)?null:("readAsDataURL"===n&&(r="data:"+(t.type||"")+";base64,"+r),i(r,n,t.type))}}});i("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter".split(" "),function(n,t,i,r,u,f,e){return n.XMLHttpRequest={send:function(n,r){function o(){n.transport=u.mode;u.shimExec.call(s,"XMLHttpRequest","send",n,r)}function l(n,t){u.shimExec.call(s,"XMLHttpRequest","appendBlob",n,t.uid);r=null;o()}function a(n,t){var i=new e;i.bind("TransportingComplete",function(){t(this.result)});i.transport(n.getSource(),n.type,{ruid:u.uid})}var s=this,u=s.getRuntime(),c,h;t.isEmptyObj(n.headers)||t.each(n.headers,function(n,t){u.shimExec.call(s,"XMLHttpRequest","setRequestHeader",t,n.toString())});r instanceof f?(r.each(function(n,t){n instanceof i?c=t:u.shimExec.call(s,"XMLHttpRequest","append",t,n)}),r.hasBlob()?(h=r.getBlob(),h.isDetached()?a(h,function(n){h.destroy();l(c,n)}):l(c,h)):(r=null,o())):r instanceof i?r.isDetached()?a(r,function(n){r.destroy();r=n.uid;o()}):(r=r.uid,o()):o()},getResponse:function(n){var f,i,e=this.getRuntime();if(i=e.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(i=new r(e.uid,i),"blob"===n)return i;try{if(f=new u,~t.inArray(n,["","text"]))return f.readAsText(i);if("json"===n&&window.JSON)return JSON.parse(f.readAsText(i))}finally{i.destroy()}}return null},abort:function(){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});i("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(n,t){return n.Transporter={getAsBlob:function(n){var i=this.getRuntime();return(n=i.shimExec.call(this,"Transporter","getAsBlob",n))?new t(i.uid,n):null}}});i("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(n,t,i,r,u){return n.Image={loadFromBlob:function(n){function f(n){u.shimExec.call(r,"Image","loadFromBlob",n.uid);r=u=null}var r=this,u=r.getRuntime(),t;n.isDetached()?(t=new i,t.bind("TransportingComplete",function(){f(t.result.getSource())}),t.transport(n.getSource(),n.type,{ruid:u.uid})):f(n.getSource())},loadFromImage:function(n){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",n.uid)},getInfo:function(){var t=this.getRuntime(),n=t.shimExec.call(this,"Image","getInfo");return!n.meta||!n.meta.thumb||n.meta.thumb.data instanceof r||(n.meta.thumb.data=new r(t.uid,n.meta.thumb.data)),n},getAsBlob:function(n,t){var i=this.getRuntime(),u=i.shimExec.call(this,"Image","getAsBlob",n,t);return u?new r(i.uid,u):null},getAsDataURL:function(){var n=this.getRuntime().Image.getAsBlob.apply(this,arguments);return n?(new u).readAsDataURL(n):null}}});i("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(n,t,i,r,u){function e(n){var r=!1,h=null,u,t,i,f,o,e=0,s;try{try{h=new ActiveXObject("AgControl.AgControl");h.IsVersionSupported(n)&&(r=!0)}catch(c){if(s=navigator.plugins["Silverlight Plug-In"],s){for(u=s.description,"1.0.30226.2"===u&&(u="2.0.30226.2"),t=u.split(".");3<t.length;)t.pop();for(;4>t.length;)t.push(0);for(i=n.split(".");4<i.length;)i.pop();do f=parseInt(i[e],10),o=parseInt(t[e],10),e++;while(e<i.length&&f===o);f<=o&&!isNaN(f)&&(r=!0)}}}catch(c){r=!1}return r}var f={};return u.addConstructor("silverlight",function(o){var s=this,h;o=n.extend({xap_url:t.xap_url},o);u.call(this,o,"silverlight",{access_binary:u.capTrue,access_image_binary:u.capTrue,display_media:u.capTrue,do_cors:u.capTrue,drag_and_drop:!1,report_upload_progress:u.capTrue,resize_image:u.capTrue,return_response_headers:function(n){return n&&"client"===s.mode},return_response_type:function(n){return"json"!==n?!0:!!window.JSON},return_status_code:function(t){return"client"===s.mode||!n.arrayDiff(t,[200,404])},select_file:u.capTrue,select_multiple:u.capTrue,send_binary_string:u.capTrue,send_browser_cookies:function(n){return n&&"browser"===s.mode},send_custom_headers:function(n){return n&&"client"===s.mode},send_multipart:u.capTrue,slice_blob:u.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:u.capTrue,use_http_method:function(t){return"client"===s.mode||!n.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(n){return n?"client":"browser"},return_status_code:function(t){return n.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(n){return n?"browser":"client"},send_custom_headers:function(n){return n?"client":"browser"},use_http_method:function(t){return n.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}});e("2.0.31005.0")&&"Opera"!==t.browser||(MXI_DEBUG&&t.debug.runtime&&t.log("\tSilverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely)."),this.mode=!1);n.extend(this,{getShim:function(){return i.get(this.uid).content.Moxie},shimExec:function(n,t){var i=[].slice.call(arguments,2);return s.getShim().exec(this.uid,n,t,i)},init:function(){this.getShimContainer().innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+o.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/><\/object>';h=setTimeout(function(){s&&!s.initialized&&(s.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&t.debug.runtime&&t.log("Silverlight failed to initialize within a specified period of time (5-10s)."))},"Windows"!==t.OS?1e4:5e3)},destroy:function(n){return function(){n.call(s);clearTimeout(h);o=h=n=s=null}}(this.destroy)},f)}),f});i("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(n,t,i){return n.FileInput={init:function(n){var r=this,u=this.getRuntime();this.bind("Change",function(){var n=u.shimExec.call(r,"FileInput","getFiles");r.files=[];i.each(n,function(n){r.files.push(new t(u.uid,n))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",function(n){for(var i="",t=0;t<n.length;t++)i+=(""!==i?"|":"")+n[t].title+" | *."+n[t].extensions.replace(/,/g,";*.");return i}(n.accept),n.name,n.multiple);this.trigger("ready")}}});i("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(n,t,i){return n.Blob=t.extend({},i)});i("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(n,t,i){return n.FileDrop={init:function(){var n=this.getRuntime(),r;return r=n.getShimContainer(),i.addEvent(r,"dragover",function(n){n.preventDefault();n.stopPropagation();n.dataTransfer.dropEffect="copy"},this.uid),i.addEvent(r,"dragenter",function(i){i.preventDefault();t.get(n.uid).dragEnter(i)&&i.stopPropagation()},this.uid),i.addEvent(r,"drop",function(i){i.preventDefault();t.get(n.uid).dragDrop(i)&&i.stopPropagation()},this.uid),n.shimExec.call(this,"FileDrop","init")}}});i("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(n,t,i){return n.FileReader=t.extend({},i)});i("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(n,t,i){return n.FileReaderSync=t.extend({},i)});i("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(n,t,i){return n.XMLHttpRequest=t.extend({},i)});i("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(n,t,i){return n.Transporter=t.extend({},i)});i("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(n,t,i,r){return n.Image=t.extend({},r,{getInfo:function(){var u=this.getRuntime(),n={meta:{}},r=u.shimExec.call(this,"Image","getInfo");return r.meta&&(t.each(["tiff","exif","gps","thumb"],function(t){var u=r.meta[t],e,f,o,i;if(u&&u.keys)for(n.meta[t]={},f=0,o=u.keys.length;f<o;f++)(e=u.keys[f],i=u[e])&&(/^(\d|[1-9]\d+) $/.test(i)?i=parseInt(i,10):/^\d*\.\d+$/.test(i)&&(i=parseFloat(i)),n.meta[t][e]=i)}),!n.meta||!n.meta.thumb||n.meta.thumb.data instanceof i||(n.meta.thumb.data=new i(u.uid,n.meta.thumb.data))),n.width=parseInt(r.width,10),n.height=parseInt(r.height,10),n.size=parseInt(r.size,10),n.type=r.type,n.name=r.name,n}})});i("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(n,t,i,r){var u={};return i.addConstructor("html4",function(t){var f=this,e=i.capTest,o=i.capTrue;i.call(this,t,"html4",{access_binary:e(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:e(u.Image&&(r.can("create_canvas")||r.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:e("Chrome"===r.browser&&r.verComp(r.version,28,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||"Safari"===r.browser&&r.verComp(r.version,7,">=")),resize_image:function(){return u.Image&&f.can("access_binary")&&r.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!!~n.inArray(t,["text","document",""])},return_status_code:function(t){return!n.arrayDiff(t,[200,404])},select_file:function(){return r.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return f.can("select_file")},summon_file_dialog:function(){return f.can("select_file")&&("Firefox"===r.browser&&r.verComp(r.version,4,">=")||"Opera"===r.browser&&r.verComp(r.version,12,">=")||"IE"===r.browser&&r.verComp(r.version,10,">=")||!!~n.inArray(r.browser,["Chrome","Safari"]))},upload_filesize:o,use_http_method:function(t){return!n.arrayDiff(t,["GET","POST"])}});n.extend(this,{init:function(){this.trigger("Init")},destroy:function(n){return function(){n.call(f);n=f=null}}(this.destroy)});n.extend(this.getShim(),u)}),u});i("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(n,t,i,r,u,f,e){return n.FileInput=function(){function h(){var a=this,y=a.getRuntime(),l,p,c,f,v;v=i.guid("uid_");l=y.getShimContainer();o&&(p=r.get(o+"_form"))&&i.extend(p.style,{top:"100%"});c=document.createElement("form");c.setAttribute("id",v+"_form");c.setAttribute("method","post");c.setAttribute("enctype","multipart/form-data");c.setAttribute("encoding","multipart/form-data");i.extend(c.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});f=document.createElement("input");f.setAttribute("id",v);f.setAttribute("type","file");f.setAttribute("name",n.name||"Filedata");f.setAttribute("accept",s.join(","));i.extend(f.style,{fontSize:"999px",opacity:0});c.appendChild(f);l.appendChild(c);i.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===e.browser&&e.verComp(e.version,10,"<")&&i.extend(f.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});f.onchange=function(){var n;if(this.value){if(this.files){if(n=this.files[0],0===n.size){c.parentNode.removeChild(c);return}}else n={name:this.value};n=new t(y.uid,n);this.onchange=function(){};h.call(a);a.files=[n];f.setAttribute("id",n.uid);c.setAttribute("id",n.uid+"_form");a.trigger("change");f=c=null}};y.can("summon_file_dialog")&&(l=r.get(n.browse_button),u.removeEvent(l,"click",a.uid),u.addEvent(l,"click",function(n){f&&!f.disabled&&f.click();n.preventDefault()},a.uid));o=v;l=p=l=null}var o,s=[],n;i.extend(this,{init:function(t){var i=this,e=i.getRuntime(),o;n=t;s=t.accept.mimes||f.extList2mimes(t.accept,e.can("filter_by_extension"));o=e.getShimContainer(),function(){var n,f;n=r.get(t.browse_button);e.can("summon_file_dialog")&&("static"===r.getStyle(n,"position")&&(n.style.position="relative"),f=parseInt(r.getStyle(n,"z-index"),10)||1,n.style.zIndex=f,o.style.zIndex=f-1);n=e.can("summon_file_dialog")?n:o;u.addEvent(n,"mouseover",function(){i.trigger("mouseenter")},i.uid);u.addEvent(n,"mouseout",function(){i.trigger("mouseleave")},i.uid);u.addEvent(n,"mousedown",function(){i.trigger("mousedown")},i.uid);u.addEvent(r.get(t.container),"mouseup",function(){i.trigger("mouseup")},i.uid);n=null}();h.call(this);o=null;i.trigger({type:"ready",async:!0})},disable:function(n){var t;(t=r.get(o))&&(t.disabled=!!n)},destroy:function(){var t=this.getRuntime(),i=t.getShim(),t=t.getShimContainer();u.removeAllEvents(t,this.uid);u.removeAllEvents(n&&r.get(n.container),this.uid);u.removeAllEvents(n&&r.get(n.browse_button),this.uid);t&&(t.innerHTML="");i.removeInstance(this.uid);o=s=n=null}})}});i("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(n,t){return n.FileReader=t});i("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData".split(" "),function(n,t,i,r,u,f,e,o){return n.XMLHttpRequest=function(){function c(t){var o=this,r,u,e,s=!1;if(n){if(r=n.id.replace(/_iframe$/,""),r=i.get(r+"_form")){for(u=r.getElementsByTagName("input"),e=u.length;e--;)switch(u[e].getAttribute("type")){case"hidden":u[e].parentNode.removeChild(u[e]);break;case"file":s=!0}u=[];s||r.parentNode.removeChild(r);r=null}setTimeout(function(){f.removeEvent(n,"load",o.uid);n.parentNode&&n.parentNode.removeChild(n);var i=o.getRuntime().getShimContainer();i.children.length||i.parentNode.removeChild(i);n=null;t()},1)}}var h,s,n;t.extend(this,{send:function(l,a){var y=this,k=y.getRuntime(),p,v,w,b;if(h=s=null,a instanceof o&&a.hasBlob()){if(b=a.getBlob(),p=b.uid,w=i.get(p),v=i.get(p+"_form"),!v)throw new u.DOMException(u.DOMException.NOT_FOUND_ERR);}else p=t.guid("uid_"),v=document.createElement("form"),v.setAttribute("id",p+"_form"),v.setAttribute("method",l.method),v.setAttribute("enctype","multipart/form-data"),v.setAttribute("encoding","multipart/form-data"),k.getShimContainer().appendChild(v);v.setAttribute("target",p+"_iframe");a instanceof o&&a.each(function(n,i){if(n instanceof e)w&&w.setAttribute("name",i);else{var r=document.createElement("input");t.extend(r,{type:"hidden",name:i,value:n});w?v.insertBefore(r,w):v.appendChild(r)}});v.setAttribute("action",l.url),function(){var u=k.getShimContainer()||document.body,i=document.createElement("div");i.innerHTML='<iframe id="'+p+'_iframe" name="'+p+'_iframe" src="javascript:&quot;&quot;" style="display:none"><\/iframe>';n=i.firstChild;u.appendChild(n);f.addEvent(n,"load",function(){var i;try{i=n.contentWindow.document||n.contentDocument||window.frames[n.id].document;/^4(0[0-9]|1[0-7]|2[2346])\s/.test(i.title)?h=i.title.replace(/^(\d+).*$/,"$1"):(h=200,s=t.trim(i.body.innerHTML),y.trigger({type:"progress",loaded:s.length,total:s.length}),b&&y.trigger({type:"uploadprogress",loaded:b.size||1025,total:b.size||1025}))}catch(u){if(r.hasSameOrigin(l.url))h=404;else{c.call(y,function(){y.trigger("error")});return}}c.call(y,function(){y.trigger("load")})},y.uid)}();v.submit();y.trigger("loadstart")},getStatus:function(){return h},getResponse:function(n){if("json"===n&&"string"===t.typeOf(s)&&window.JSON)try{return JSON.parse(s.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(i){return null}return s},abort:function(){var t=this;n&&n.contentWindow&&(n.contentWindow.stop?n.contentWindow.stop():n.contentWindow.document.execCommand?n.contentWindow.document.execCommand("Stop"):n.src="about:blank");c.call(this,function(){t.dispatchEvent("abort")})}})}});i("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(n,t){return n.Image=t}),function(i){for(var o=0;o<i.length;o++){for(var f=n,s=i[o],u=s.split(/[.\/]/),e=0;e<u.length-1;++e)f[u[e]]===t&&(f[u[e]]={}),f=f[u[e]];f[u[u.length-1]]=r[s]}}("moxie/core/utils/Basic moxie/core/utils/Env moxie/core/I18n moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/FileInput moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/file/FileDrop moxie/file/FileReader moxie/core/utils/Url moxie/runtime/RuntimeTarget moxie/file/FileReaderSync moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/runtime/Transporter moxie/image/Image moxie/core/utils/Events".split(" "))})(this),function(n){var t={},i=n.moxie.core.utils.Basic.inArray;return function r(n){var u,f;for(u in n)f=typeof n[u],"object"!==f||~i(u,["Exceptions","Env","Mime"])?"function"===f&&(t[u]=n[u]):r(n[u])}(n.moxie),t.Env=n.moxie.core.utils.Env,t.Mime=n.moxie.core.utils.Mime,t.Exceptions=n.moxie.core.Exceptions,n.mOxie=t,n.o||(n.o=t),t}(this);CssStyle.prototype.nameTag;CssStyle.prototype.closeTag=function(){return"<\/"+this.nameTag+">"};CssStyle.prototype.setTag=function(n){this.nameTag=n};CssStyle.prototype.makeStyle=function(n,t){return"undefined"==typeof this.nameTag&&(this.nameTag="div"),"<"+this.nameTag+" style='"+n+"'>"+t};CssStyle.prototype.makeStyleWithIdOrClass=function(n,t,i,r){return"undefined"==typeof this.nameTag&&(this.nameTag="div"),"id"==n?"<"+this.nameTag+" id='"+t+"' style='"+i+"'>"+r:"<"+this.nameTag+" class='"+t+"' style='"+i+"'>"+r};CssStyle.prototype.makeStyleWithIdAndClass=function(n,t,i,r){return"undefined"==typeof this.nameTag&&(this.nameTag="div"),"<"+this.nameTag+" class='"+n+"' id='"+t+"' style='"+i+"'>"+r};CssStyle.prototype.insertSpaceChar=function(n){for(output="",i=0;i<n;i++)output+="&nbsp;";return output},function(n,t,i){function e(n){function u(n,t,r){var u={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};u[n]?i[u[n]]=t:r||(i[n]=t)}var t=n.required_features,i={};return"string"==typeof t?r.each(t.split(/\s*,\s*/),function(n){u(n,!0)}):"object"==typeof t?r.each(t,function(n,t){u(t,n)}):!0===t&&(0<n.chunk_size&&(i.slice_blob=!0),(n.resize.enabled||!n.multipart)&&(i.send_binary_string=!0),r.each(n,function(n,t){u(t,!!n,!0)})),i}var u=n.setTimeout,f={},r={VERSION:"2.1.8",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,get:function(n){var i=[],u,r;for("array"!==t.typeOf(n)&&(n=[n]),r=n.length;r--;)(u=t.get(n[r]))&&i.push(u);return i.length?i:null},each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(n){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return n?(""+n).replace(/[<>&\"\']/g,function(n){return t[n]?"&"+t[n]+";":n}):n},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(n){for(var i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<i.length;t+=2)n=n.replace(i[t],i[t+1]);return n=n.replace(/\s+/g,"_"),n.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(n,t){var i="";return r.each(t,function(n,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(n)}),i&&(n+=(0<n.indexOf("?")?"&":"?")+i),n},formatSize:function(n){function u(n,t){return Math.round(n*Math.pow(10,t))/Math.pow(10,t)}if(n===i||/\D/.test(n))return r.translate("N/A");var t=Math.pow(1024,4);return n>t?u(n/t,1)+" "+r.translate("tb"):n>(t/=1024)?u(n/t,1)+" "+r.translate("gb"):n>(t/=1024)?u(n/t,1)+" "+r.translate("mb"):1024<n?Math.round(n/1024)+" "+r.translate("kb"):n+" "+r.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(n,i){var u,f;return u=new r.Uploader(n),f=t.Runtime.thatCan(u.getOption().required_features,i||n.runtimes),u.destroy(),f},addFileFilter:function(n,t){f[n]=t}};r.addFileFilter("mime_types",function(n,t,i){n.length&&!n.regexp.test(t.name)?(this.trigger("Error",{code:r.FILE_EXTENSION_ERROR,message:r.translate("File extension error."),file:t}),i(!1)):i(!0)});r.addFileFilter("max_file_size",function(n,t,i){n=r.parseSize(n);void 0!==t.size&&n&&t.size>n?(this.trigger("Error",{code:r.FILE_SIZE_ERROR,message:r.translate("File size error."),file:t}),i(!1)):i(!0)});r.addFileFilter("prevent_duplicates",function(n,t,i){if(n)for(n=this.files.length;n--;)if(t.name===this.files[n].name&&t.size===this.files[n].size){this.trigger("Error",{code:r.FILE_DUPLICATE_ERROR,message:r.translate("Duplicate file error."),file:t});i(!1);return}i(!0)});r.Uploader=function(n){function w(){var n,i=0,t;if(this.state==r.STARTED){for(t=0;t<h.length;t++)n||h[t].status!=r.QUEUED?i++:(n=h[t],this.trigger("BeforeUpload",n)&&(n.status=r.UPLOADING,this.trigger("UploadFile",n)));i==h.length&&(this.state!==r.STOPPED&&(this.state=r.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",h))}}function d(n){n.percent=0<n.size?Math.ceil(n.loaded/n.size*100):100;p()}function p(){var t,n;for(c.reset(),t=0;t<h.length;t++)n=h[t],n.size!==i?(c.size+=n.origSize,c.loaded+=n.loaded*n.origSize/n.size):c.size=i,n.status==r.DONE?c.uploaded++:n.status==r.FAILED?c.failed++:c.queued++;c.size===i?c.percent=0<h.length?Math.ceil(c.uploaded/h.length*100):0:(c.bytesPerSec=Math.ceil(c.loaded/((+new Date-k||1)/1e3)),c.percent=0<c.size?Math.ceil(c.loaded/c.size*100):0)}function b(){var n=l[0]||v[0];return n?n.getRuntime().uid:!1}function it(n,i){if(n.ruid){var r=t.Runtime.getInfo(n.ruid);if(r)return r.can(i)}return!1}function rt(){this.bind("FilesAdded FilesRemoved",function(n){n.trigger("QueueChanged");n.refresh()});this.bind("CancelUpload",ht);this.bind("BeforeUpload",ft);this.bind("UploadFile",et);this.bind("UploadProgress",ot);this.bind("StateChanged",st);this.bind("QueueChanged",p);this.bind("Error",lt);this.bind("FileUploaded",ct);this.bind("Destroy",at)}function g(n,i){var u=this,f=0,e=[],o={runtime_order:n.runtimes,required_caps:n.required_features,preferred_caps:a,swf_url:n.flash_swf_url,xap_url:n.silverlight_xap_url};r.each(n.runtimes.split(/\s*,\s*/),function(t){n[t]&&(o[t]=n[t])});n.browse_button&&r.each(n.browse_button,function(i){e.push(function(e){var s=new t.FileInput(r.extend({},o,{accept:n.filters.mime_types,name:n.file_data_name,multiple:n.multi_selection,container:n.container,browse_button:i}));s.onready=function(){var n=t.Runtime.getInfo(this.ruid);t.extend(u.features,{chunks:n.can("slice_blob"),multipart:n.can("send_multipart"),multi_selection:n.can("select_multiple")});f++;l.push(this);e()};s.onchange=function(){u.addFile(this.files)};s.bind("mouseenter mouseleave mousedown mouseup",function(r){y||(n.browse_button_hover&&("mouseenter"===r.type?t.addClass(i,n.browse_button_hover):"mouseleave"===r.type&&t.removeClass(i,n.browse_button_hover)),n.browse_button_active&&("mousedown"===r.type?t.addClass(i,n.browse_button_active):"mouseup"===r.type&&t.removeClass(i,n.browse_button_active)))});s.bind("mousedown",function(){u.trigger("Browse")});s.bind("error runtimeerror",function(){s=null;e()});s.init()})});n.drop_element&&r.each(n.drop_element,function(n){e.push(function(i){var e=new t.FileDrop(r.extend({},o,{drop_zone:n,inIframe:vt,editor_id:yt}));e.onready=function(){var n=t.Runtime.getInfo(this.ruid);u.features.dragdrop=n.can("drag_and_drop");f++;v.push(this);i()};e.ondrop=function(){u.addFile(this.files)};e.bind("error runtimeerror",function(){e=null;i()});e.init()})});t.inSeries(e,function(){"function"==typeof i&&i(f)})}function ut(n,r,u){var f=new t.Image;try{f.onload=function(){if(r.width>this.width&&r.height>this.height&&r.quality===i&&r.preserve_headers&&!r.crop)return this.destroy(),u(n);f.downsize(r.width,r.height,r.crop,r.preserve_headers)};f.onresize=function(){u(this.getAsBlob(n.type,r.quality));this.destroy()};f.onerror=function(){u(n)};f.load(n)}catch(e){u(n)}}function nt(n,i,u){function s(n,t,i){var u=o[n];switch(n){case"max_file_size":"max_file_size"===n&&(o.max_file_size=o.filters.max_file_size=t);break;case"chunk_size":(t=r.parseSize(t))&&(o[n]=t,o.send_file_name=!0);break;case"multipart":o[n]=t;t||(o.send_file_name=!0);break;case"unique_names":(o[n]=t)&&(o.send_file_name=!0);break;case"filters":"array"===r.typeOf(t)&&(t={mime_types:t});i?r.extend(o.filters,t):o.filters=t;t.mime_types&&(o.filters.mime_types.regexp=function(n){var t=[];return r.each(n,function(n){r.each(n.extensions.split(/,/),function(n){/^\s*\*\s*$/.test(n)?t.push("\\.*"):t.push("\\."+n.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(o.filters.mime_types));break;case"resize":i?r.extend(o.resize,t,{enabled:!0}):o.resize=t;break;case"prevent_duplicates":o.prevent_duplicates=o.filters.prevent_duplicates=!!t;break;case"browse_button":case"drop_element":t=r.get(t);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":o[n]=t;i||(h=!0);break;default:o[n]=t}i||f.trigger("OptionChanged",n,t,u)}var f=this,h=!1;"object"==typeof n?r.each(n,function(n,t){s(t,n,u)}):s(n,i,u);u?(o.required_features=e(r.extend({},o)),a=e(r.extend({},o,{required_features:!0}))):h&&(f.trigger("Destroy"),g.call(f,o,function(n){n?(f.runtime=t.Runtime.getInfo(b()).type,f.trigger("Init",{runtime:f.runtime}),f.trigger("PostInit")):f.trigger("Error",{code:r.INIT_ERROR,message:r.translate("Init error.")})}))}function ft(n,t){if(n.settings.unique_names){var i=t.name.match(/\.([^.]+)$/),r="part";i&&(r=i[1]);t.target_name=t.id+"."+r}}function et(n,i){function v(){0<y--?u(h,1e3):(i.loaded=e,n.trigger("Error",{code:r.HTTP_ERROR,message:r.translate("HTTP Error."),file:i,response:s.responseText,status:s.status,responseHeaders:s.getAllResponseHeaders()}))}function h(){var w,b,p={},k;i.status===r.UPLOADING&&n.state!==r.STOPPED&&(n.settings.send_file_name&&(p.name=i.target_name||i.name),o&&l.chunks&&f.size>o?(k=Math.min(o,f.size-e),w=f.slice(e,e+k)):(k=f.size,w=f),o&&l.chunks&&(n.settings.send_chunk_number?(p.chunk=Math.ceil(e/o),p.chunks=Math.ceil(f.size/o)):(p.offset=e,p.total=f.size)),s=new t.XMLHttpRequest,s.upload&&(s.upload.onprogress=function(t){i.loaded=Math.min(i.size,e+t.loaded);n.trigger("UploadProgress",i)}),s.onload=function(){400<=s.status?v():(y=n.settings.max_retries,k<f.size?(w.destroy(),e+=k,i.loaded=Math.min(e,f.size),n.trigger("ChunkUploaded",i,{offset:i.loaded,total:f.size,response:s.responseText,status:s.status,responseHeaders:s.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&n.trigger("UploadProgress",i)):i.loaded=i.size,w=b=null,!e||e>=f.size?(i.size!=i.origSize&&(f.destroy(),f=null),n.trigger("UploadProgress",i),i.status=r.DONE,n.trigger("FileUploaded",i,{response:s.responseText,status:s.status,responseHeaders:s.getAllResponseHeaders()})):u(h,1))},s.onerror=function(){v()},s.onloadend=function(){this.destroy();s=null},n.settings.multipart&&l.multipart?(s.open("post",c,!0),r.each(n.settings.headers,function(n,t){s.setRequestHeader(t,n)}),b=new t.FormData,r.each(r.extend(p,n.settings.multipart_params),function(n,t){b.append(t,n)}),b.append(n.settings.file_data_name,w),s.send(b,{runtime_order:n.settings.runtimes,required_caps:n.settings.required_features,preferred_caps:a,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url})):(c=r.buildUrl(n.settings.url,r.extend(p,n.settings.multipart_params)),s.open("post",c,!0),s.setRequestHeader("Content-Type","application/octet-stream"),r.each(n.settings.headers,function(n,t){s.setRequestHeader(t,n)}),s.send(w,{runtime_order:n.settings.runtimes,required_caps:n.settings.required_features,preferred_caps:a,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url})))}var c=n.settings.url,o=n.settings.chunk_size,y=n.settings.max_retries,l=n.features,e=0,f;i.loaded&&(e=i.loaded=o?o*Math.floor(i.loaded/o):0);f=i.getSource();n.settings.resize.enabled&&it(f,"send_binary_string")&&~t.inArray(f.type,["image/jpeg","image/png"])?ut.call(this,f,n.settings.resize,function(n){f=n;i.size=n.size;h()}):h()}function ot(n,t){d(t)}function st(n){if(n.state==r.STARTED)k=+new Date;else if(n.state==r.STOPPED)for(var t=n.files.length-1;0<=t;t--)n.files[t].status==r.UPLOADING&&(n.files[t].status=r.QUEUED,p())}function ht(){s&&s.abort()}function ct(n){p();u(function(){w.call(n)},1)}function lt(n,t){t.code===r.INIT_ERROR?n.destroy():t.code===r.HTTP_ERROR&&(t.file.status=r.FAILED,d(t.file),n.state==r.STARTED&&(n.trigger("CancelUpload"),u(function(){w.call(n)},1)))}function at(n){n.stop();r.each(h,function(n){n.destroy()});h=[];l.length&&(r.each(l,function(n){n.destroy()}),l=[]);v.length&&(r.each(v,function(n){n.destroy()}),v=[]);a={};y=!1;k=s=null;c.reset()}var vt=n.inIframe||!1,yt=n.editor_id||"",tt=r.guid(),o,h=[],a={},l=[],v=[],k,c,y=!1,s;o={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,editor_id:"",inIframe:!1,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0};nt.call(this,n,null,!0);c=new r.QueueProgress;r.extend(this,{id:tt,uid:tt,state:r.STOPPED,features:{},runtime:null,files:h,settings:o,total:c,init:function(){var n=this;"function"==typeof o.preinit?o.preinit(n):r.each(o.preinit,function(t,i){n.bind(i,t)});rt.call(this);o.browse_button&&o.url?g.call(this,o,function(i){"function"==typeof o.init?o.init(n):r.each(o.init,function(t,i){n.bind(i,t)});i?(n.runtime=t.Runtime.getInfo(b()).type,n.trigger("Init",{runtime:n.runtime}),n.trigger("PostInit")):n.trigger("Error",{code:r.INIT_ERROR,message:r.translate("Init error.")})}):this.trigger("Error",{code:r.INIT_ERROR,message:r.translate("Init error.")})},setOption:function(n,t){nt.call(this,n,t,!this.runtime)},getOption:function(n){return n?o[n]:o},refresh:function(){l.length&&r.each(l,function(n){n.trigger("Refresh")});this.trigger("Refresh")},start:function(){this.state!=r.STARTED&&(this.state=r.STARTED,this.trigger("StateChanged"),w.call(this))},stop:function(){this.state!=r.STOPPED&&(this.state=r.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(n){y=n!==i?n:!0;l.length&&r.each(l,function(n){n.disable(y)});this.trigger("DisableBrowse",y)},getFile:function(n){for(var t=h.length-1;0<=t;t--)if(h[t].id===n)return h[t]},addFile:function(n,i){function a(n,i){var r=[];t.each(o.settings.filters,function(t,i){f[i]&&r.push(function(r){f[i].call(o,t,n,function(n){r(!n)})})});t.inSeries(r,i)}function e(n){var f=t.typeOf(n);if(n instanceof t.File){if(!n.ruid&&!n.isDetached()){if(!s)return!1;n.ruid=s;n.connectRuntime(s)}e(new r.File(n))}else n instanceof t.Blob?(e(n.getSource()),n.destroy()):n instanceof r.File?(i&&(n.name=i),c.push(function(t){a(n,function(i){i||(h.push(n),l.push(n),o.trigger("FileFiltered",n));u(t,1)})})):-1!==t.inArray(f,["file","blob"])?e(new t.File(null,n)):"node"===f&&"filelist"===t.typeOf(n.files)?t.each(n.files,e):"array"===f&&(i=null,t.each(n,e))}var o=this,c=[],l=[],s;s=b();e(n);c.length&&t.inSeries(c,function(){l.length&&o.trigger("FilesAdded",l)})},removeFile:function(n){n="string"==typeof n?n:n.id;for(var t=h.length-1;0<=t;t--)if(h[t].id===n)return this.splice(t,1)[0]},splice:function(n,t){var u=h.splice(n===i?0:n,t===i?h.length:t),f=!1;return this.state==r.STARTED&&(r.each(u,function(n){if(n.status===r.UPLOADING)return f=!0,!1}),f&&this.stop()),this.trigger("FilesRemoved",u),r.each(u,function(n){n.destroy()}),f&&this.start(),u},dispatchEvent:function(n){var t,r,i;if(n=n.toLowerCase(),t=this.hasEventListener(n))for(t.sort(function(n,t){return t.priority-n.priority}),r=[].slice.call(arguments),r.shift(),r.unshift(this),i=0;i<t.length;i++)if(!1===t[i].fn.apply(t[i].scope,r))return!1;return!0},bind:function(n,t,i,u){r.Uploader.prototype.bind.call(this,n,t,u,i)},destroy:function(){this.trigger("Destroy");o=c=null;this.unbindAll()}})};r.Uploader.prototype=t.EventTarget.instance;r.File=function(){var n={};return function(i){r.extend(this,{id:r.guid(),name:i.name||i.fileName,type:i.type||"",size:i.size||i.fileSize,origSize:i.size||i.fileSize,loaded:0,percent:0,status:r.QUEUED,lastModifiedDate:i.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var n=this.getSource().getSource();return-1!==t.inArray(t.typeOf(n),["blob","file"])?n:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete n[this.id])}});n[this.id]=i}}();r.QueueProgress=function(){var n=this;n.size=0;n.loaded=0;n.uploaded=0;n.failed=0;n.queued=0;n.percent=0;n.bytesPerSec=0;n.reset=function(){n.size=n.loaded=n.uploaded=n.failed=n.queued=n.percent=n.bytesPerSec=0}};n.plupload=r}(window,mOxie);AttachmentBox=function(n,t,i,r,u,f){this._compose=n;AttachmentBox.ID++;this._id="attachElement"+share.INDEX+AttachmentBox.ID;$("<span id='"+this._id+"'><\/span>").appendTo($(t));$("#"+this._id).addClass("attachItem").css("font-size","12px").css("padding","2px 4px 2px 7px").css("padding-left","4").css("display","inline-block");this._icon=i;this._filename=r;this._readonly=u;this._isFwd=f||!1};AttachmentBox.ID=0;AttachmentBox.prototype.setPart=function(n){this._part=n};AttachmentBox.prototype.getPart=function(){return this._part};AttachmentBox.prototype.getFileName=function(){return this._filename};AttachmentBox.prototype.render=function(){var n=this,i="a"+share.INDEX+AttachmentBox.ID,t=$('<a  href="" style="right:1px;position:absolute; top:1px;"><\/a>'),r;$(t).append(""+(this._readonly?"":'<span style="background-image:url(icon1/icon_close.png); height:16px; width:16px; text-indent: -9999px; overflow:hidden;display:block;margin-top:-1px">close<\/span>'));r=$('<a href="#" id="'+i+'">'+this._filename+"<\/a>");$("#"+this._id).addClass("attachmentbox").append(60<this._filename.length?this._filename.substring(0,57)+"...":this._readonly?r:this._filename).append(t);this._readonly?($(t).css("display","block").click(function(){n._compose.downloadFile(n._part,n._filename)}),$("#"+i).attr("href","https://"+window.location.host+"/service/home/~/"+this._filename+"?auth=co&loc=en_US&id="+this._compose._mid+"&part="+this._part+"&disp=a")):$(t).css("display","block").click(function(t){t.preventDefault();console.log("_this._isFwd :"+n._isFwd);n._compose.removeAttachFile(n._part,n._isFwd);$("#"+n._id).remove();n._compose.updateHeight()})};jQuery.fn.selectSendOther=function(n,t,i){var u="ulsendother_"+t,f=this,r=$('<ul class="ulsendother" id="'+u+'"><\/ul>');$("body").prepend(r);$(r).hide();jQuery.each(n,function(n,t){var e=$("#selectAccountAddress"+i).val(),f="",u;t.accountAddress==Session.getInstance().getUser()?(u="<img src='giaodien/BmailChat.png' style='width:16px;height:16px;float:left;margin-top:2px;margin-right:5px;' /> Gửi bằng tài khoản chính",""==e&&(f="selected")):-1!=t.accountAddress.toLowerCase().indexOf("@yahoo")?u="<img src='giaodien/yahoo.png' style='width:16px;height:16px;float:left;margin-top:2px;margin-right:5px;'  /> Gửi bằng tài khoản Yahoo":-1!=t.accountAddress.toLowerCase().indexOf("@gmail")&&(u="<img src='giaodien/gtalk.png' style='width:16px;height:16px;float:left;margin-top:2px;margin-right:5px;'  /> Gửi bằng tài khoản Gmail");$(r).append('<li><a href="#"  title = "< '+t.accountAddress+' >" class="'+f+'" val="'+t.accountAddress+'" name="'+t.accountAddress+'">'+u+"<\/a><\/li>")});$(f).bind("click",function(n){return n.preventDefault(),"none"!=$(r).css("display")?$(r).css("display","none"):$(r).show(),$(r).css({top:$(f).offset().top+$(f).height()+4,left:$(f).offset().left-80}),$(this).blur(),!1});$(r).find("a").click(function(){var n=$(this).attr("val");return $("#selectAccountAddress"+i).val(n),$("#selectAccountName"+i).val(n),$("#tb_composeMail"+i).click(),$(r).hide(),!1});$(document).bind("click",function(n){$("#"+u)&&"none"!=$("#"+u).css("display")&&$(n.target).attr("id")!=t&&$("#"+u).css("display","none")})};ComposeModel.prototype.idMailDraft="";ComposeModel.prototype.dontNeedHandleFaultResponse=!1;ComposeModel.prototype.idMailFwd="";ComposeModel.prototype.partMailFwd=[];ComposeModel.prototype.idnt="";ComposeModel.prototype.irt="";ComposeModel.prototype.midPart=[];ComposeModel.prototype.aidArray=[];ComposeModel.prototype.fileList=[];ComposeModel.prototype.toApplet="";ComposeModel.prototype.ccApplet="";ComposeModel.prototype.bccApplet="";ComposeModel.prototype.beginPartAttach="";ComposeModel.prototype.attachNameApplet="";ComposeModel.prototype.subjectApplet="";ComposeModel.prototype.contentApplet="";ComposeModel.prototype.cidApplet="";ComposeModel.prototype.formatApplet="text/html";ComposeModel.prototype.oldContent="";ComposeModel.prototype.xhr=null;ComposeModel.prototype.getTabName=function(){var n=newTabSoanTxt;return"reply"==this.type?n=replyButtonMsg:"replyall"==this.type||"postandreplyall"==this.type?n=replyAllTabMsg:"forward"==this.type?n=forwardButtonMsg:"readmail"==this.type&&(n=readMailMsg),n};ComposeModel.prototype.getTabId=function(){var n="composeMail";return"reply"==this.type?n="replyTab":"replyall"==this.type?n="replyAllTab":"forward"==this.type?n="forwardTab":"readmail"==this.type&&(n="readMailTab"),n};ComposeModel.prototype.getMailId=function(){var n=this.mailId||"";return n||(n=dataTable.getRecordSet().getRecord(this.rowId).getData().id),n};ComposeModel.prototype.getMail=function(){var t,r;if(""!=this.mailId){var t=MailCache.getInstance().getMessageByRowId(this.rowId),n=this,i=function(t){var i=dataTable.getRecordSet().getRecord(n.rowId),r,f;i&&Util.markRead(i,!0);dataTable.setCacheReplyMail(t);n.message=new Message(t);n.folderId=n.message.getFolderId();t=TreeController.getInstance().getNodeByProperty("labelElId",n.folderId);t||(t=mailbox.getInstance().getShareFolderId(n.folderId),n.folderId=t,t=TreeController.getInstance().getNodeByProperty("labelElId",n.folderId));n.folderPath=getLocation(t);r=getTo();f=getCc();t=getSubject();var o=getFullName(),i=getContent(),s=getSendTime(),e=getFrom();if("reply"==n.type){-1==t.indexOf("Re: ")&&(t="Re: "+t);f&&(r+=f);var i=n.getContentReply(i),i=n.getStringReply(e,o,s,r,t)+"<\/div><br>"+i,i=n.insertSignature(i),u={to:e,subject:t,content:i}}else if("replyall"==n.type){if(-1==t.indexOf("Re: ")&&(t="Re: "+t),f&&(r+=f),i=n.getContentReply(i),i=n.getStringReply(e,o,s,r,t)+"<\/div><br>"+i,i=n.insertSignature(i),u=r.split(";"),1<u.length){for(f=!1,r=0;r<u.length;r++)u[r]==e&&(f=!0),u[r].toUpperCase()==Session.getInstance().getUser().toUpperCase()&&u.splice(r,1);f||u.unshift(e);r=u.join(";")}u={to:r,subject:t,content:i}}else if("forward"==n.type){if(-1==t.indexOf("Fwd: ")&&(t="Fwd: "+t),f=getPart(),i=n.getContentReply(i),i=n.getStringReply(e,o,s,r,t)+"<\/div><br>"+i,i=n.insertSignature(i),0<f.length)for(n.idMailFwd=getId(),console.log(n.idMailFwd),e=getFileName(),r=0;r<f.length;r++)n.partMailFwd.push(f[r]),u={part:f[r],index:r,fileName:e[r],isFwd:!0},n.insertAttach.notify(u);u={subject:t,content:i}}else"editasnew"==n.type?u={subject:t,content:i}:"readmail"==n.type?(f=getPart(),i=n.getContentReply(i),u={subject:t,content:i,to:r,fullName:o,from:e,part:f}):("postfolder"==n.type||"postandreplyall"==n.type)&&(-1==t.indexOf("Re: ")&&(t="Re: "+t),i=n.getContentReply(i),i=n.getStringReply(e,o,s,r,t)+"<\/div><br>"+i,i=n.insertSignature(i),u={subject:t,folderPath:n.folderPath,content:i});n.updateData.notify(u)};t?(t=t.get("Data"),i(t)):(t=new XMLElement("GetMsgRequest"),r=t.addElement("m"),r.addAttribute("id",this.mailId),r.addAttribute("html","1"),t=new Soap(Session.getInstance().getUser(),t,"urn:zimbraMail",!0,sessionId,seqNotify),t.isNeedAbort(!1),t.sendRequestCallback(i))}else("postfolder"==this.type||"postandreplyall"==this.type)&&(i=TreeController.getInstance().getHighlightedNode(),this.folderId=i.labelElId,this.folderPath=getLocation(i)),this.getDataMail()};ComposeModel.prototype.getSignature=function(){var n="";return"FALSE"!=currentUser.bmailUseSignature?n=currentUser.signatureContent:null==currentUser.signatureContent&&(n="<a href='mailto:"+Session.getInstance().getUser()+"' >"+Session.getInstance().getUser()+"<\/a>"),n};ComposeModel.prototype.getStringReply=function(n,t,i,r,u){var e=sendFromHeaderMsg,o=sentAtHeaderMsg,s=sentToHeaderMsg,h=subjectHeaderMsg,f="<div style='font-size: 14px'><br><span style='color: rgb(139, 0, 0);'><i> ----- "+oldContentMsg+" : -----<\/i><\/span>",f=f+(t?e+(t+"<\/u>["+n+"]<\/span>"):e+(n+"<\/u>["+n+"]<\/span>")),f=f+(o+i),f=f+(s+r);return f+(h+u)};ComposeModel.prototype.insertSignature=function(n){var t="";return"FALSE"!=currentUser.bmailUseSignature?"TRUE"==currentUser.addSignatureReply&&(t="top"==currentUser.signatureStyle?"<br><div>"+currentUser.signatureContent+"<\/div>"+n:n+"<br><div>"+currentUser.signatureContent+"<\/div>"):null==currentUser.signatureContent&&(t="<a href='mailto:"+Session.getInstance().getUser()+"' >"+Session.getInstance().getUser()+"<\/a>",t=n+"<br><div>"+t+"<\/div>"),t||(t=n),t};ComposeModel.prototype.getContentReply=function(n){var t,i,u,r;if(-1!=n.indexOf("dfsrc")&&(n=n.replace(/dfsrc/gi,"src")),t=[],this.message&&(t=this.message.getAttachInline()),0<t.length)for(i=0;i<t.length;i++)u=t[i].path,r=t[i].ci,-1!=n.indexOf(r)&&(n=n.replace(new RegExp(r,"g"),u));return n};ComposeModel.prototype.getDataMail=function(){var n=this.getSignature(),n="<br><div>"+n+"<\/div>";""!=n&&this.updateData.notify({content:n,folderPath:this.folderPath})};ComposeModel.prototype.saveDraft=function(b){var c=!1,t,n,u,r,i;b.notify&&(c=!0);t=[];b&&b.attachId&&(t=b.attachId);var e=b.isInsertImage||!1,o=b.multipart,f=b.emailTo,s=b.subject;if(0!=currentUser.timeoutSession&&window.clearTimeout(mailbox.getInstance().timeout),r="",t)if(n=t.length,1==n)u=t[0].length,r=r+t[0].substring(1,u-1);else for(i=0;i<n;i++)u=t[i].length,0==i&&(t[i]=t[i].substring(1,u)),i==n-1&&(t[i]=t[i].substring(0,u-1)),t[i]+=",",r+=t[i];if(t=Session.getInstance().getIpServer(),u=Session.getInstance().getUser(),i=Session.getInstance().getAuthen(),t=location.protocol+"//"+t+"/service/soap",n="<soap:Envelope xmlns:soap='http://www.w3.org/2003/05/soap-envelope'><soap:Header><context xmlns='urn:zimbra'>",n+="<format type='js'/>",n+="<account by='name'>"+u+"<\/account>",n+="<authToken>"+i+"<\/authToken>",n+="<\/context>",n+="<\/soap:Header>",n+="<soap:Body>",n+="<SaveDraftRequest xmlns='urn:zimbraMail'>",n=this.idMailDraft&&""!=this.idMailDraft?n+("<m id='"+this.idMailDraft+"' idnt='"+this.idnt+"'>"):n+"<m>",f&&(n+=f),n+="<su>"+s+"<\/su>",o&&(n+=o),this.midPart&&0<this.midPart.length){if(n=r?n+("<attach aid='"+r+"'>"):n+"<attach>",o=this.midPart.length,this.idMailDraft)for(f=0;f<o;f++)n+="<mp mid='"+this.idMailDraft+"' part='"+this.midPart[f]+"' />";n+="<\/attach>"}else r&&(n+="<attach aid='"+r+"'><\/attach>");this.irt&&(n+="<irt>"+this.irt+"<\/irt>");var n=n+"<\/m>",n=n+"<\/SaveDraftRequest>",n=n+"<\/soap:Body>",n=n+"<\/soap:Envelope>",m=getRequest(),w=this;m.onreadystatechange=function(){if(4==m.readyState&&200==m.status){var a=eval("("+m.responseText+")");e?w.handleInsertImage(w,a):w.handleSaveDraft(w,a,c)}else 4==m.readyState&&200!=m.status&&(e?new MessageBox("Thông báo","Hiện tại không đính kèm ảnh được. Bạn vui lòng thử lại"):b&&b.attachId?($("#wprocess"+w.orderTab).css("display","none"),new MessageBox("Thông báo","Hiện tại không đính kèm được. Bạn vui lòng thử lại")):new MessageBox("Thông báo","Hiện tại không lưu nháp được. Bạn vui lòng thử lại"))};m.open("POST",t,!0,"SaveDraftRequest");m.send(n)};ComposeModel.prototype.handleInsertImage=function(n,t){var f,i,r,u;if(t.Body.SaveDraftResponse&&t.Body.SaveDraftResponse.m&&t.Body.SaveDraftResponse.m[0]){if(this.imageMailId.push(t.Body.SaveDraftResponse.m[0].id),t.Body.SaveDraftResponse.m[0].mp[0].mp){for(f=t.Body.SaveDraftResponse.m[0].mp[0].mp.length,i=0;i<f;i++)t.Body.SaveDraftResponse.m[0].mp[0].mp[i].cd&&"attachment"==t.Body.SaveDraftResponse.m[0].mp[0].mp[i].cd&&(r=t.Body.SaveDraftResponse.m[0].mp[0].mp[i].part,this.imagePart.push(r),u=t.Body.SaveDraftResponse.m[0].mp[0].mp[i].filename,this.imageName.push(u));this.insertImageSuccess.notify({part:r,fileName:u,mailId:t.Body.SaveDraftResponse.m[0].id})}}else this.insertImageFail.notify()};ComposeModel.prototype.handleSaveDraft=function(n,t,i){var f,u,e;if(n._attachBoxes=[],f=[],f.push(""),t.Body.SaveDraftResponse&&t.Body.SaveDraftResponse.m&&t.Body.SaveDraftResponse.m[0]){if(this.uploadCompleteEvent.notify(),n.midPart=[],n.idMailDraft=t.Body.SaveDraftResponse.m[0].id,t.Body.SaveDraftResponse.m[0].idnt&&(n.idnt=t.Body.SaveDraftResponse.m[0].idnt),t.Body.SaveDraftResponse.m[0].mid&&(n.irt=t.Body.SaveDraftResponse.m[0].mid),""!=n.irt&&(n.irt=n.irt.substring(1,n.irt.length-1)),n._cidApplet=t.Body.SaveDraftResponse.m[0].id,t.Body.SaveDraftResponse.m[0].mp[0].mp)for(var o=t.Body.SaveDraftResponse.m[0].mp[0].mp.length,s=0,r=0;r<o;r++)t.Body.SaveDraftResponse.m[0].mp[0].mp[r].cd&&"attachment"==t.Body.SaveDraftResponse.m[0].mp[0].mp[r].cd&&(u=t.Body.SaveDraftResponse.m[0].mp[0].mp[r].part,0==s&&(n._beginPartAttach=t.Body.SaveDraftResponse.m[0].mp[0].mp[r].part),f.push(u),e=t.Body.SaveDraftResponse.m[0].mp[0].mp[r].filename,n._attachNameApplet+=e,0<r&&r<o-1&&(n._attachNameApplet+="/"),n.midPart.push(u),u={part:u,index:r,fileName:e},n.insertAttach.notify(u),s++,n.isAttaching=!1);i&&(n=new ActionDoneMsg("resources/common/saveDraftMsg.png"),n.init(),n.show())}else this.uploadCompleteEvent.notify(),i||(u={response:t},n.isAttaching=!1,n.attachFail.notify(u))};ComposeModel.prototype.updateContactCache=function(n,t){var f=n.length,u="",r,i;if(0<f)for(r=0;r<f;r++)console.log("1: "+n[r]),i=n[r].replace(/^\s*/,"").replace(/\s*$/,""),""!=i&&" "!=i&&(console.log("2: "+n[r]),i=String(i).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),-1==i.indexOf("@")&&(i=i+"@"+share.domain),u+='{"t":"'+t+'","a":"'+i+'"}',u+=",",currentUser.updateContact(n[r]));return u};ComposeModel.prototype.createAttachTag=function(n){var t="",i,r;if(this.idMailDraft&&0<n.length)for(t='"attach":{"mp":[',i=0;i<n.length;i++)r='{"mid":"'+this.idMailDraft+'","part":"'+n[i]+'"}',t=t+r,i<n.length-1&&(t+=",");if(""!=this.idMailFwd&&0<this.partMailFwd.length)for(t=""==t?'"attach":{"mp":[':t+",",i=0;i<this.partMailFwd.length;i++)r='{"mid":"'+this.idMailFwd+'","part":"'+this.partMailFwd[i]+'"}',t+=r,i<this.partMailFwd.length-1&&(t+=",");return""!=t&&(t+="]}"),t};ComposeModel.prototype.createAttachInlineTag=function(){var i="",r=[];if(this.message&&(r=this.message.getAttachInline()),0<r.length)for(var i=",",u=r.length,n=0;n<u;n++){var t="",t=r[n].fullCid,f=r[n].id,e=r[n].part,t='{"ci":"'+t+'","attach":{"mp":[',t=t+('{"mid":"'+f+'","part":"'+e+'"}'),t=t+"]}}",i=i+t;n<u-1&&(i+=",")}if(0<this.imageInline.length)for(i+=",",u=this.imageInline.length,n=0;n<u;n++)t=this.imageInline[n].cId,f=this.imageInline[n].mailId,e=this.imageInline[n].part,t='{"ci":"'+t+'","attach":{"mp":[',t+='{"mid":"'+f+'","part":"'+e+'"}',t+="]}}",i+=t,n<u-1&&(i+=",");return i};ComposeModel.prototype.sendInviteMsg=function(){};ComposeModel.prototype.replaceImageInline=function(n){var f;if(0<this.imagePart.length)for(var e=Session.getInstance().getAuthen(),o=Session.getInstance().getIpServer(),s=this.imagePart.length,t=0;t<s;t++){var i=this.imageMailId[t],r=this.imagePart[t],u=location.protocol+"//"+o+"/service/home/~/"+this.imageName[t]+"?authToken="+e+"&id="+i+"&part="+r,u=u.replace(/&/g,"&amp;");-1!=n.indexOf(u)&&(f=i+r,n=n.replace(u,"cid:"+f),this.imageInline.push({cId:f,part:r,mailId:i}))}return n};ComposeModel.prototype.sendMsg=function(t){var i=t.content,h=t.part,r=t.subject,r=String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),w=t.noCheckComposeType||!1,o,s,l,v,p,n;if(this.startSendMail.notify(),o=[],this.message&&(o=this.message.getAttachInline()),0<o.length)for(s=0;s<o.length;s++){var c=o[s].path,u=o[s].ci,c=c.replace(/&/g,"&amp;");-1!=i.indexOf(c)&&(i=i.replaceAll(c,u))}i=this.removeBreaks(i);i=this.replaceImageInline(i);-1!=i.indexOf('"')&&(i=i.replace(/"/gi,'\\"'));-1!=i.indexOf("\\")&&(i=i.replace(/\\/gi,"\\"));o="https://"+Session.getInstance().getIpServer()+"/service/soap";s=Session.getInstance().getUser();c=Session.getInstance().getAuthen();"postfolder"!=this.type&&"postandreplyall"!=this.type||w?u=this.updateContactCache(t.toArr,"t"):(u=s.split("@")[1],u=this.locdau(this.folderPath)+"@"+u,u='{"t":"t","a":"..'+u+'"},');var f=t.ccArr,b=this.updateContactCache(f,"c"),e=t.bccArr,k=this.updateContactCache(e,"b");("postfolder"==this.type||"postandreplyall"==this.type)&&(""!=b||""!=k)&&(l=e,0==f.length&&(f=e,l=[]),this.sendMsg({emailTo:t.emailTo,toArr:f,ccArr:[],bccArr:l,content:t.content,frDisplayName:t.fromDisplayName,frAddress:t.fromAddress,part:t.part,subject:t.subject,textPlain:t.textPlain,noCheckComposeType:!0}));var e="",f=this.createAttachTag(h),l=this.createAttachInlineTag(),y=Session.getInstance().getUser(),a=currentUser.displayName;t.frDisplayName&&(a=t.frDisplayName);t.frAddress&&(y=t.frAddress);a||(a=y);t=t.textPlain;-1!=t.indexOf('"')&&(t=t.replace(/"/gi,'\\"'));-1!=t.indexOf("\\")&&(t=t.replace(/\\/gi,"\\"));t=t.replace(/\n/gi,"\\r\\n");t=this.removeBreaks(t);-1!=r.indexOf('"')&&(r=r.replace(/"/gi,'\\"'));-1!=r.indexOf("\\")&&(r=r.replace(/\\/gi,"\\"));v="SendMsgRequest";"postfolder"!=this.type&&"postandreplyall"!=this.type||w||(v="SendMailHereRequest");p="";"postfolder"!=this.type&&"postandreplyall"!=this.type||w||(p='},"l":{"_content":"'+this.folderId+'"');""!=f&&(f=","+f);e+='{"Header":{"context":{"_jsns":"urn:zimbra","account":{"_content":"'+s+'","by":"name"},"authToken":"'+c+'"}},';e=this.idMailDraft&&0<h.length?e+('"Body":{"'+v+'":{"_jsns":"urn:zimbraMail","m":{"id":"'+this.idMailDraft+'","e":['+u+b+k+'{"t":"f","a":"'+y+'","p":"'+a+'"}],"su":{"_content":"'+r+'"}'+f+',"mp":[{"ct":"multipart/alternative","mp":[{"ct":"text/plain","content":{"_content":"'+t+'"}},{"ct":"multipart/related","mp":[{"ct":"text/html","content":{"_content":"'+i+'"}}'+l+"]}]}]"+p+"}}}}"):e+('"Body":{"'+v+'":{"_jsns":"urn:zimbraMail","m":{"e":['+u+b+k+'{"t":"f","a":"'+y+'","p":"'+a+'"}],"su":{"_content":"'+r+'"}'+f+',"mp":[{"ct":"multipart/alternative","mp":[{"ct":"text/plain","content":{"_content":"'+t+'"}},{"ct":"multipart/related","mp":[{"ct":"text/html","content":{"_content":"'+i+'"}}'+l+"]}]}]"+p+"}}}}");this.xhr=getRequest();n=this;this.xhr.onreadystatechange=function(){var a,b;if(4==n.xhr.readyState&&200==n.xhr.status)if(a=eval("("+n.xhr.responseText+")"),-1!=n.xhr.responseText.indexOf("service.AUTH_EXPIRED")&&share.logout(),b=!1,"postfolder"==n.type||"postandreplyall"==n.type?a.Body&&a.Body.SendMailHereResponse&&(b=!0):a.Body&&a.Body.SendMsgResponse&&a.Body.SendMsgResponse.m&&(b=!0),b){if(n.sendMailComplete.notify(),0<h.length&&""!=n.idMailDraft&&n.deleteM(n.idMailDraft),0<n.imageMailId.length)for(a=0;a<n.imageMailId.length;a++)n.deleteM(n.imageMailId[a])}else-1!=n.xhr.responseText.indexOf("mail.SEND_ABORTED_ADDRESS_FAILURE")?new MessageBox(errorDlgMsg,errorInvalidReciever):new MessageBox(errorDlgMsg,sendErrMsg),n.sendMailFail.notify();else 4!=n.xhr.readyState||200==n.xhr.status||n.dontNeedHandleFaultResponse||(-1!=n.xhr.responseText.indexOf("mail.SEND_ABORTED_ADDRESS_FAILURE")?new MessageBox(errorDlgMsg,errorInvalidReciever):new MessageBox(errorDlgMsg,sendErrMsg),n.sendMailFail.notify())};console.log(e);this.xhr.open("POST",o,!0,v);this.xhr.send(e)};ComposeModel.prototype.deleteM=function(n){var r=Session.getInstance().getUser(),u=Session.getInstance().getAuthen(),i=Session.getInstance().getIpServer(),i=location.protocol+"//"+i+"/service/soap",t;t="<soap:Envelope xmlns:soap='http://www.w3.org/2003/05/soap-envelope'><soap:Header><context xmlns='urn:zimbra'>";t+="<format type='js'/>";t+="<account by='name'>"+r+"<\/account>";t+="<authToken >"+u+"<\/authToken>";t+="<\/context>";t+="<\/soap:Header>";t+="<soap:Body>";t+="<MsgActionRequest xmlns='urn:zimbraMail'>";t+="<action id='"+n+"' op='delete' />";t+="<\/MsgActionRequest>";t+="<\/soap:Body>";t+="<\/soap:Envelope>";n=getRequest();n.onreadystatechange=function(){};n.open("POST",i,!0,"MsgActionRequest");n.send(t)};ComposeModel.prototype.locdau=function(n){return n=n.replace(/\u00e0|\u00e1|\u1ea1|\u1ea3|\u00e3|\u00e2|\u1ea7|\u1ea5|\u1ead|\u1ea9|\u1eab|\u0103|\u1eb1|\u1eaf|\u1eb7|\u1eb3|\u1eb5/gi,"a"),n=n.replace(/\u00e8|\u00e9|\u1eb9|\u1ebb|\u1ebd|\u00ea|\u1ec1|\u1ebf|\u1ec7|\u1ec3|\u1ec5/gi,"e"),n=n.replace(/\u00ec|\u00ed|\u1ecb|\u1ec9|\u0129/gi,"i"),n=n.replace(/\u00f2|\u00f3|\u1ecd|\u1ecf|\u00f5|\u00f4|\u1ed3|\u1ed1|\u1ed9|\u1ed5|\u1ed7|\u01a1|\u1edd|\u1edb|\u1ee3|\u1edf|\u1ee1/gi,"o"),n=n.replace(/\u00f9|\u00fa|\u1ee5|\u1ee7|\u0169|\u01b0|\u1eeb|\u1ee9|\u1ef1|\u1eed|\u1eef/gi,"u"),n=n.replace(/\u1ef3|\u00fd|\u1ef5|\u1ef7|\u1ef9/gi,"y"),n=n.replace(/\u0111/gi,"d"),n=n.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g," "),n=n.replace(/ + /g,""),n=n.replace(/^\ +|\ +$/g,""),n.replace(/ /g,"")};ComposeModel.prototype.removeBreaks=function(n){return n=n.replace(/(\r\n|\n|\r)/gm,"<1br />"),n=n.replace(/<1br \/><1br \/>/gi," "),n=n.replace(/\<1br \/>/gi," "),n=n.replace(/\s+/g," "),n.replace(/<2br \/>/gi,"\n\n")};ComposeView.prototype.widthCompose=0;ComposeView.prototype.heightCompose=0;ComposeView.prototype.counter=1;ComposeView.prototype.orderTab=0;ComposeView.prototype.layout=null;ComposeView.prototype.style=null;ComposeView.prototype.attachFail=!1;ComposeView.prototype.tab=null;ComposeView.prototype.toolbar=null;ComposeView.prototype.sending=!1;ComposeView.prototype.tblSelectAddress=null;ComposeView.prototype.tblAddress=null;ComposeView.prototype.layoutId="";ComposeView.prototype.toolbarId="";ComposeView.prototype.init=function(){this.orderTab=++share.INDEX;this.style=new CssStyle("div");this.layoutId="layoutComposeMail"+this.orderTab;this.toolbarId="inboxToolbarComposeMail"+this.orderTab;this.widthCompose=YAHOO.util.Dom.getClientWidth()-200;this.heightCompose=YAHOO.util.Dom.getClientHeight()-24;this.createTab(this._model.getTabId())};ComposeView.prototype.createTab=function(n){var i=this._model.getTabName(),r,t;this.removeComposeTab();"readmail"==this._model.type?i='<div class="hoverTab"><\/div><div id="composeLabel'+this.orderTab+'"><span id="composeImage" style=""><\/span><span style="margin-top:5px;"><span style="position:absolute;left:35px;margin-top:6px;color: #6FAEEE;" class="labelSoan" id="labelSoan'+this.orderTab+'" >'+i+'<\/span><div id="closeTab'+this.orderTab+'" class="closeTab" name="'+this._model.getMailId()+'"><img id="closesubtab'+this.orderTab+'" class="closeSubTab" name="Soạn" src="icon1/Closeinactive.png"><\/div><\/span><\/div>':(r="color:#6FAEEE",mailbox.getInstance().isEgov&&(r="color:black !important"),i='<div class="hoverTab"><\/div><div class="sendingDiv" id="sendingTab'+this.orderTab+'" style="margin-top:7px;display:none;'+r+'">'+sendingTabMsg+'<div id="closeSendingTab'+this.orderTab+'" class="closeTab"><img id="closeSendingImg'+this.orderTab+'" class="closeSubTab" name="Soạn" src="icon1/Closeinactive.png"><\/div><\/div><div id="composeLabel'+this.orderTab+'"><span id="composeImage" style=""><\/span><span style="margin-top:5px;"><span style="position:absolute;left:35px;margin-top:6px;color: #6FAEEE;" class="labelSoan" id="labelSoan'+this.orderTab+'" >'+i+'<\/span><div id="closeTab'+this.orderTab+'" class="closeTab"><img id="closesubtab'+this.orderTab+'" class="closeSubTab" name="Soạn" src="icon1/Closeinactive.png"><\/div><\/span><\/div>',NaN+this.orderTab+'" class="closeSubTab" name="Soạn" src="icon1/Closeinactive.png"><\/div><\/span><\/div>');this.tab=new Tab(n,i,'<div class = "layoutComposeMail" id = "layoutComposeMail'+this.orderTab+'"><\/div>',!0);this.tab.init();tabView.addTab(this.tab.tab);this.addComposeTab();"readmail"==this._model.type?this.createLayoutReadMail():this.createLayout();t=this;YAHOO.util.Event.on("closeTab"+this.orderTab,"click",function(){var u,i,r,n;if("readmail"==t._model.type){if(u=t._model.mailId,i=share.tabReadMail.length,0<i){for(r=[],n=0;n<i;n++)share.tabReadMail[n].mailId!=u&&r.push({mailId:share.tabReadMail[n].mailId,tab:share.tabReadMail[n].tab});share.tabReadMail=r}tabView.removeTab(t.tab.tab);tabView.set("activeIndex",0)}else t._model.oldContent!=t._editor.getContent()&&""!=t._editor.getContent()&&"<br><div><br><br><\/div>"!=t._editor.getContent()&&"<br>"!=t._editor.getContent().toLowerCase()?t.handleCfmSaveDraft():(tabView.removeTab(t.tab.tab),tabView.set("activeIndex",0))})};ComposeView.prototype.createLayout=function(){var t=this,n;this.style.setTag("div");n=this.style.makeStyleWithIdAndClass("headerCompose","headerCompose"+this.orderTab,"height:100px;","")+this.style.makeStyleWithIdOrClass("class","tooBarCompose","eateLayouttransparent;height:25px;margin-left:1px;margin-top: -10px;","")+this.style.makeStyleWithIdOrClass("id","inboxToolbarComposeMail"+this.orderTab,"background: transparent;","")+'<div id="tb_sendother'+this.orderTab+'" class="sendother"><\/div><\/div><\/div><form name="composeForm" class="composeForm" id="composeForm'+this.orderTab+'" style="background: transparent;border:0px;margin-top:5px;"><div class="toFrom"><div class="buttonListDiv"><input align="center"  class="buttonListInput" value ="'+toInputMsg+'" name="'+this.orderTab+'" type="button" style="margin-top:0px;margin-left:6px; color: #565656" /><\/div><div class="spaceVer"><\/div><div class="textToFromDiv">';"postfolder"==this._model.type||"postandreplyall"==this._model.type?n+='<input  class="textToFromInput" readonly="readonly" name="textToFromInput" id="textToFromInput'+this.orderTab+'" type="text" />':(n+='<input  class="textToFromInput" name="textToFromInput" id="textToFromInput'+this.orderTab+'" type="text"/>',n+='<div  id="autoComTo'+this.orderTab+'" class="yui-ac-container"><\/div>');n+='<\/div><div style="right:5px;position:absolute;"><input type="button" value="CC" class="displayCC" id="cc-button'+this.orderTab+'" /><input type="button" value="BCC" class="displayBCC" id="bcc-button'+this.orderTab+'"/><\/div><\/div><div class="spaceHor2"><\/div><div class="fromCc" style="display:none" id="fromCc'+this.orderTab+'"><div class="buttonListDiv"><input align="center"  class="buttonListInput" name="'+this.orderTab+'"  type="button" value="'+ccInputMsg+'" style="margin-top:-2px;margin-left:5px; color: #565656"/><\/div><div class="spaceVer"><\/div><div class="textFromCcDiv"><input class="textFromCcInput"  name ="textFromCcInput"  id="textFromCcInput'+this.orderTab+'" type="text"/><div class="yui-ac-container" id="autoComCc'+this.orderTab+'"><\/div><\/div><\/div><div class="spaceHor3" id= "spaceHor3'+this.orderTab+'"><\/div><div class="fromBcc" id="fromBcc'+this.orderTab+'"><div class="buttonListDiv" ><input class="buttonListInput" name="'+this.orderTab+'"  type="button" value="BCC"  style="margin-top:-2px;margin-left:6px"/><\/div><div class="spaceVer"><\/div><div class="textFromBccDiv"><input   type="text"  name ="textFromBccInput" class="textFromBccInput" id="textFromBccInput'+this.orderTab+'"/><div id="autoComBcc'+this.orderTab+'" class="yui-ac-container"><\/div><\/div><\/div><div class="spaceHor4"><\/div><div class="fromSub"><div class="buttonListDiv" ><div align="right" class="sub" style="margin-top:8px;margin-left:14px; color: #565656">'+subjectInputMsg+'<\/div><\/div><div class="spaceVer"><\/div><div class="textFromSubDiv"><input type="text"  name = "textFromSubInput" class="textFromSubInput" id ="textFromSubInput'+this.orderTab+'"/>&nbsp;&nbsp;<input type="hidden" id ="selectAccountAddress'+this.orderTab+'" value=""/><input type="hidden" id ="selectAccountName'+this.orderTab+'" value=""/><\/div><\/div><div style="margin-left:63px;margin-top:9px;margin-bottom:5px;" id="progressAttach'+this.orderTab+'"><\/div><div class="yui-pb yui-pb-ltr" id="wprocess'+this.orderTab+'"  style="border-radius: 3px;display: none;width: 100px; height: 13px;border:1px solid #808080;margin-left:63px"><div class="yui-pb-bar yui-pb-anim" id="processUpload'+this.orderTab+'" style="width:0;"><\/div><\/div><div class="fileAttachDiv" id="fileAttachDiv'+this.orderTab+'"><div id="fileAttach'+this.orderTab+'" class="fileAttachCompose" style="padding-left:20px;margin-left: 45px; max-width: 859px; max-height: 55px; overflow-y: auto;overflow-x:hidden;background:url(/mail/css/giaodien/separator.png) no-repeat scroll 18px 0 transparent;margin-top:2px;"><\/div><\/div><div class="spaceHor6"><\/div><\/form><\/div><div class="bodyCompose" ><form name="bodyContent" ><div  id="contentHtml'+this.orderTab+'" name="contentHtml"        class="rte-editor"><\/div><div id="descriptionContainer"><\/div><\/form><\/div><\/div>';this.layout=new YAHOO.widget.Layout(this.layoutId,{width:YAHOO.util.Dom.getClientWidth()-240,height:YAHOO.util.Dom.getClientHeight()-50,units:[{position:"center",body:n,gutter:"0 0px px 0"}]});this.layout.on("render",function(){t.initInterface();t.initEditor();t.createToolbar();t.initAttach()});this.layout.render();this.createAutoComplete.notify()};ComposeView.prototype.updateTabLabel=function(n){$("#labelSoan"+this.orderTab).html(n)};ComposeView.prototype.createLayoutReadMail=function(){var t='<div  align="center"  style="float:right;margin-top:9px;background:transparent;margin-right:20px;" class="Rcompose"><img src="giaodien/previous.png" height="14px" id="previousRead'+this.orderTab+'"/>'+this.style.insertSpaceChar(2)+'<img src="giaodien/separate.png" style="margin-right:7px;height:16px"><img src="giaodien/next.png" height="14px" id="nextRead'+this.orderTab+'"/><\/div><div class="headerCompose"  id="headerCompose'+this.orderTab+'"><div class="tooBarComposeReadMail readMailLayout" style="background: transparent;margin-left:1px;height:26px;"><div id="inboxToolbarComposeMail'+this.orderTab+'"  style="background: transparent;"><\/div><\/div><div id="hReadMail'+this.orderTab+"\" style=\"\" class=\"hReadMail\"><div class='divHeaderReadMail' style='padding-top : 5px'><span class='fromLabelReadMail'>"+senderTableMsg+": <\/span><span id='fromLabelReadMailText"+this.orderTab+"' class='fromLabelReadMailText'><\/span><span class='toLabelReadMail'>"+toInputMsg+": <\/span><a id='toMore"+this.orderTab+"' class='toMoreReadMail'><\/a><div id='frShowMore"+this.orderTab+"' class='frShowMoreReadMail'><div id='showMore"+this.orderTab+"' class='showMoreReadMail'><\/div><a id='closeMore"+this.orderTab+"' class='closeMoreReadMail'>&nbsp;<\/a><\/div><span id='toLabelReadMailText"+this.orderTab+"' class='toLabelReadMailText'><\/span><\/div><div class='hrHeaderReadMail'><\/div><div class='divHeaderReadMail1'><span class='subjectLabelReadMail'>"+subjectInputMsg+": <\/span><span id='subjectLabelReadMailText"+this.orderTab+"' class='subjectLabelReadMailText'><\/span><\/div><div class=\"attach-div-readmail\" id=\"attach-div-readmail"+this.orderTab+'"><div class="attachFileReadMailLabel" id="attachFileReadMailLabel'+this.orderTab+'">'+fileAttachMsg+'<\/div><div class="attachFileReadMailIcon" id="attachFileReadMailIcon'+this.orderTab+'" ><img src="giaodien/paperclip1.png" /><\/div><div class="attachFileReadMailPanel" id="attachFileReadMailPanel'+this.orderTab+'"><\/div><\/div><\/div><iframe id="contentHtml'+this.orderTab+'"  frameborder="0" style="overflow:auto;width:100%;border-top:0px;border-left:1px;border-style:solid;border-color:rgb(175,173,174);background-color:#fff" class="divContentReadMail"><\/iframe><\/div>',t=t+("<div id='loadingTabReadMail"+this.orderTab+"' style='position:absolute;top:150px;width:100%'><p align='center' ><img src='images/progress1.gif'><\/div>"),t=new YAHOO.widget.Layout(this.layoutId,{width:YAHOO.util.Dom.getClientWidth()-240,height:YAHOO.util.Dom.getClientHeight()-26,units:[{position:"center",body:t,gutter:"0 5px 0px 0"}]}),n=this,i,u;t.on("render",function(){n.createToolbarReadMail();$("#contentHtml"+n.orderTab).height(YAHOO.util.Dom.getClientHeight()-140)});t.render();$("#attach-div-readmail"+this.orderTab).click(function(t){t.stopPropagation();n.createAttachReadMailDialog()});i=this._model.rowId;t=this.table.getRecordSet().getRecord(i).getData().id;share.tabReadMail.push({mailId:t,tab:this.tab.tab});var t=this.table.getTrEl(i),r=i,f=this.table.getPreviousTrEl(t);f||(document.getElementById("previousRead"+this.orderTab).style.opacity="0.4");u=this.table.getNextTrEl(t);u||(document.getElementById("nextRead"+this.orderTab).style.opacity="0.4");YAHOO.util.Event.on("previousRead"+this.orderTab,"click",function(){var o,u,e,t;if(f){if(r&&(o=n.table.getRecordSet().getRecord(r).getData().id,u=share.tabReadMail.length,0<u)){for(e=[],t=0;t<u;t++)share.tabReadMail[t].mailId!=o&&e.push({mailId:share.tabReadMail[t].mailId,tab:share.tabReadMail[t].tab});share.tabReadMail=e}i=f.id;$("#closeTab"+n.orderTab).click();n.table==dataTable?n.table.handleRowDbClick(i):n.table.rowDblclickEvent.fire()}});YAHOO.util.Event.on("nextRead"+this.orderTab,"click",function(){var o,f,e,t;if(u){if(r&&(o=n.table.getRecordSet().getRecord(r).getData().id,f=share.tabReadMail.length,0<f)){for(e=[],t=0;t<f;t++)share.tabReadMail[t].mailId!=o&&e.push({mailId:share.tabReadMail[t].mailId,tab:share.tabReadMail[t].tab});share.tabReadMail=e}i=u.id;$("#closeTab"+n.orderTab).click();n.table==dataTable?n.table.handleRowDbClick(i):n.table.rowDblclickEvent.fire()}});$(".buttonListInput").attr("tabIndex",-1)};ComposeView.prototype.resetInterface=function(){$("#fromLabelReadMailText"+this.orderTab).html("");$("#subjectLabelReadMailText"+this.orderTab).html("");$("#toLabelReadMailText"+this.orderTab).html("")};ComposeView.prototype.createAttachReadMailDialog=function(n,t){var r=new YAHOO.widget.Panel("attachPanelReadMail"+this.orderTab,{visible:!1,draggable:!1,close:!1,zIndex:1e3}),e,u,i,o,f;for(n=this._model.message.getDownloadAll(),n="<a href='"+n+"'><img src ='"+getImgFromFileName(".all")+"' style ='margin-bottom: -3px; margin-right: 3px;'/>"+dowloadAllMsg+"<\/a>",t=this._model.message.getFileArray(),r.setHeader(""),e=document.createElement("div"),i=document.createElement("div"),i.innerHTML=n,YAHOO.util.Dom.setStyle(i,"padding","2px"),$(i).hover(function(){$(this).css({"background-color":"#EDF5FF"});$(this).children().css("color","black")},function(){$(this).css("background-color","#FFFFFF")}),$(i).click(function(){$(this).children()}),u=this,$("#attachPanelReadMail"+this.orderTab+"_c").find("a").bind("click",function(){$("#attachPanelReadMail"+u.orderTab+"_c").remove()}),e.appendChild(i),i=t.split("<\/div>"),o=0;o<i.length-1;o++)f=document.createElement("div"),f.innerHTML=i[o]+"<\/div>",$(f).css("padding","2px").css("margin-top","2px"),$(f).hover(function(){$(this).css({"background-color":"#EDF5FF"});$(this).find("a").css("color","black")},function(){$(this).css("background-color","#FFFFFF")}),e.appendChild(f);r.setBody(e);r.setFooter("");r.render("attachFileReadMailPanel"+this.orderTab);r.cfg.setProperty("minWidth","160px");r.show();mailbox.getInstance().disableOutline();u=this;YAHOO.util.Event.on(document,"click",function(n){if(r){n=YAHOO.util.Event.getTarget(n);var t=document.getElementById("attachFileReadMailIcon"+u.orderTab),i=document.getElementById("attachFileReadMailLabel"+u.orderTab),f=r.element;n==f||YAHOO.util.Dom.isAncestor(f,n)||n==t||YAHOO.util.Dom.isAncestor(t,n)||n==i||YAHOO.util.Dom.isAncestor(i,n)||$("#attachPanelReadMail"+u.orderTab+"_c").remove()}})};ComposeView.prototype.initEditor=function(){$(".bodyCompose").width(this.widthCompose-40);this._editor=new BmailEditor("#contentHtml"+this.orderTab,null,this);this._editor.render();this._editor.setHeight(this.heightCompose-173)};ComposeView.prototype.handleInsertImageSuccess=function(n){var t=n.fileName,i=n.mailId,r=n.part,u=Session.getInstance().getAuthen(),f=Session.getInstance().getIpServer();n=this._editor._editorId;t=location.protocol+"//"+f+"/service/home/~/"+t+"?authToken="+u+"&id="+i+"&part="+r;$("#"+n).contents().find("#uploadingImage").attr("src",t);$("#"+n).contents().find("#uploadingImage").removeAttr("id");"Microsoft Internet Explorer"==navigator.appName&&$("#"+n).contents().find("#uploadingImage").css({width:"64px",height:"64px"})};ComposeView.prototype.handleInsertImageFail=function(){$("#"+this._editor._editorId).contents().find("#uploadingImage").remove()};ComposeView.prototype.createToolbarReadMail=function(){this.toolbar=new YAHOO.widget.Toolbar(this.toolbarId,{buttons:[{group:"",label:null,buttons:[{id:"compose_tb_reply",type:"push",label:replyButtonMsg,value:"reply"},{id:"compose_tb_replyall",type:"push",label:replyAllButtonMsg,value:"replyall"},{id:"compose_tb_forward",type:"push",label:forwardButtonMsg,value:"forward"}]}]});var n=this;this.toolbar.on("buttonClick",function(t){if("reply"==t.button.value){t={composeType:"reply",rowId:n._model.rowId,mailId:n._model.mailId};t=new ComposeModel(t);var i=new ComposeView(t);t=new ComposeController(i,t);t.init()}else"replyall"==t.button.value?(t=!1,0==n._model.folderPath.indexOf("inbox")&&(t=!0),t="2"==n._model.folderId||"3"==n._model.folderId||"4"==n._model.folderId||"5"==n._model.folderId||"6"==n._model.folderId||t?{composeType:"replyall",rowId:n._model.rowId,mailId:n._model.mailId}:{composeType:"postandreplyall",rowId:n._model.rowId,mailId:n._model.mailId},t=new ComposeModel(t),i=new ComposeView(t),t=new ComposeController(i,t),t.init()):"forward"==t.button.value&&(t={composeType:"forward",rowId:n._model.rowId,mailId:n._model.mailId},t=new ComposeModel(t),i=new ComposeView(t),t=new ComposeController(i,t),t.init())})};ComposeView.prototype.createToolbar=function(){var n=this;this.toolbar="TRUE"==currentUser.useESignature?new YAHOO.widget.Toolbar(this.toolbarId,{buttons:[{group:"",label:null,buttons:[{id:"tb_composeMail"+n.orderTab,type:"push",label:sendButtonMsg,value:"compose"},{type:"separator"},{id:"tb_saveDraft"+n.orderTab,type:"push",label:saveButtonMsg,value:"draft"},{id:"tb_encode",type:"push",label:"Mã hóa",value:"encode"},{id:"tb_ca",type:"push",label:"Ký điện tử",value:"ca"}]}]}):new YAHOO.widget.Toolbar(this.toolbarId,{buttons:[{group:"",label:null,buttons:[{id:"tb_composeMail"+n.orderTab,type:"push",label:sendButtonMsg,value:"compose"},{type:"separator"},{id:"tb_saveDraft"+n.orderTab,type:"push",label:saveButtonMsg,value:"draft"}]}]});1<accountArray.length&&($("#tb_sendother"+this.orderTab).selectSendOther(accountArray,"tb_sendother"+this.orderTab,this.orderTab),$("#tb_sendother"+this.orderTab).css("display","block"));$("#tb_composeMail"+this.orderTab).click(function(){var t,i,r;n.toolbar.getButtonById("tb_composeMail"+n.orderTab).get("disabled")||(t=n.getEmailTo(),""==t?(new MessageBox("Lỗi",noReceiverErrMsg),$("#textToFromInput"+n.orderTab).focus()):(i=function(){var i=function(n){var e=n._editor.getContent(),o=n._editor.getPlainTextContent(),s=document.getElementById("textFromSubInput"+n.orderTab).value,h=n.getTo(),c=n.getCc(),l=n.getBcc(),r="",u="",i,f;1<accountArray.length&&(i=document.getElementById("selectAccountAddress"+n.orderTab).value,f=document.getElementById("selectAccountName"+n.orderTab).value,i!=u&&r!=f&&(r=f,u=i));-1==t.indexOf("@")&&(t=t+"@"+share.domain);i=n.getPartList();n.sendMsg.notify({emailTo:t,toArr:h,ccArr:c,bccArr:l,content:e,frDisplayName:r,frAddress:u,part:i,subject:s,textPlain:o})};0==mailbox.getInstance().timeToRetrieveMailSent?i(n):n.handleRetrieveMailSent(i)},""==document.getElementById("textFromSubInput"+n.orderTab).value?new ConfirmBox("Thông báo",sendNoSubjectErrMsg,i):(r=n._editor.getContent(),"<br>"==r||""==r?new ConfirmBox("Thông báo",sendNoContentErrMsg,i):i())))});$("#tb_saveDraft"+this.orderTab).click(function(){n.handleSaveDraft()});$("#tb_ca").click(function(){n.eSignatureBtnClick.notify()})};ComposeView.prototype.initEventAbortSendMail=function(){var n=this;console.log("initEventAbortSendMail: ");YAHOO.util.Event.on("closeSendingTab"+this.orderTab,"click",function(){n.cfmCloseSedingTab()})};ComposeView.prototype.cfmCloseSedingTab=function(){var n=this;new ConfirmBox(messageBoxMsg,cfmCloseTabWhenSendingMsg,function(){tabView.removeTab(n.tab.tab);tabView.set("activeIndex",0)},function(){},chooseButtonMsg,cancelButtonMsg)};ComposeView.prototype.createDropToAttach=function(){};ComposeView.prototype.handleSaveDraft=function(){var i=this.getEmailTo(),n=this._editor.getContent(),n=n.replace(/</gi,"&lt;"),n=n.replace(/>/gi,"&gt;"),t;-1!=n.indexOf("&nbsp")&&(n=n.replace(/&nbsp;/gi,"&#160;"));n="<mp ct='text/html'><content>"+n+"<\/content><\/mp>";t=document.getElementById("textFromSubInput"+this.orderTab).value;this.saveDraftBtnClick.notify({multipart:n,subject:t,emailTo:i,notify:!0})};ComposeView.prototype.handleCfmSaveDraft=function(){var n=this;new ConfirmBox(messageBoxMsg,cfmSaveDraftMsg,function(){n.handleSaveDraft();tabView.removeTab(n.tab.tab);tabView.set("activeIndex",0)},function(){tabView.removeTab(n.tab.tab);tabView.set("activeIndex",0)},chooseButtonMsg,cancelButtonMsg)};ComposeView.prototype.handleRetrieveMailSent=function(n){var t,i;$("#tab .yui-nav").children("li[class='selected']").css("display","none");tabView.selectTab(0);mailbox.getInstance().composeArr.push({composeView:this,callback:n});t=this;document.getElementById("retrieveMailSent")||($("body").prepend('<div id = "retrieveMailSent"><\/div>'),$("#retrieveMailSent").css("display","none"));"none"==$("#retrieveMailSent").css("display")&&($("#retrieveMailSent").css("display","block"),i=$("#layoutMain").width()/2,$("#retrieveMailSent").css("left",i+"px"),$("#retrieveMailSent").html('<span id ="retrieveMailSentBtn" style="color: red">Lấy lại <\/span>thư trong <span id ="timeRetrieveMailSent">'+mailbox.getInstance().timeToRetrieveMailSent+"<\/span> giây."),mailbox.getInstance().timeOutRetrieveMailSent=window.setTimeout(function(){n(mailbox.getInstance().composeArr[0].composeView);mailbox.getInstance().composeArr=[]},1e3*mailbox.getInstance().timeToRetrieveMailSent),$("#retrieveMailSentBtn").click(function(){t.retrieveMailSent()}),this.countdown("timeRetrieveMailSent"))};ComposeView.prototype.retrieveMailSent=function(){var n,t,i;for(clearTimeout(mailbox.getInstance().timeOutRetrieveMailSent),mailbox.getInstance().timeOutRetrieveMailSent=null,mailbox.getInstance().composeArr=[],$("#retrieveMailSent").css("display","none"),n="composeLabel"+this.orderTab,$("#"+n).parents("li[id='"+this._model.getTabId()+"']").css("display","inline"),$("#tab .yui-nav").children("li[class='selected']").removeClass("selected"),$("#"+n).parents("li[id='"+this._model.getTabId()+"']").addClass("selected"),n=$("#tab .yui-nav").children(),t=0;t<n.length;t++)if(i=n[t],$(i).attr("class")&&"selected"==$(i).attr("class")){tabView.selectTab(t);break}};ComposeView.prototype.countdownInterval=function(n){var t=parseInt($("#"+n).html()),t=t-1;0>t&&(t=0);$("#"+n).html(t);0>=t&&$("#"+n).parent().css("display","none")};ComposeView.prototype.countdown=function(n){this.countdownTimeout&&(clearInterval(this.countdownTimeout),this.countdownTimeout=null);var t=this;this.countdownTimeout=window.setInterval(function(){t.countdownInterval(n)},1e3)};ComposeView.prototype.initInterface=function(){var t=this.widthCompose-206,n;document.getElementById("btnBcc")&&(document.getElementById("btnBcc").value=displayBccMsg);document.getElementById("btnTo")&&(document.getElementById("btnTo").value=sendToMsg);document.getElementById("sub")&&(document.getElementById("sub").innerHTML=subjectMsg);$(".composeMail").width(this.widthCompose);$(".spaceHor1").width(this.widthCompose);$(".toFrom").width(this.widthCompose);$(".tooBarCompose").width(this.widthCompose);$(".textToFromInput").width(t);$(".textToFromInput").css("padding-left","5px");$(".spaceHor2").width(this.widthCompose);$(".fromCc").width(this.widthCompose);$(".textFromCcDiv").width(t);$(".textFromCcInput").width(t);$(".textFromCcInput").css("padding-left","5px");$(".spaceHor3").width(this.widthCompose);$(".fromBcc").width(this.widthCompose);$(".textFromBccDiv").width(t);$(".textFromBccInput").width(t);$(".textFromBccInput").css("padding-left","5px");$(".fromSub").width(this.widthCompose);$(".spaceHor4").width(this.widthCompose);$(".textFromSubDiv").width(t);1>=accountArray.length?($(".textFromSubInput").width(t),$(".sub").css("margin-top","2px")):($(".textFromSubInput").width(t),$(".sub").css("margin-top","4px"));$(".textFromSubInput").css("padding-left","5px");$(".spaceHor5").width(this.widthCompose);$(".spaceHor6").width(this.widthCompose);$(".fileAttachCompose").width(t-28);n=this;$(".buttonListInput").click(function(){$(this).attr("value")!=sendToMsg||"forward"!=n._model.type&&!n._model.selectFolder?n.createDialogSelectAddress(n.orderTab):n.createDialogSelectFolder()});$("#cc-button"+this.orderTab).click(function(){n.ccBtnClick.notify()});$("#bcc-button"+this.orderTab).click(function(){n.bccBtnClick.notify()});this.handleTabKey();document.getElementById("selectAccountAddress"+this.orderTab).value=Session.getInstance().getUser();document.getElementById("selectAccountName"+this.orderTab).value=currentUser.displayName;$("#textFromSubInput"+this.orderTab).keyup(function(){var t=$(this).val();""!=t?(8<t.length&&(t=t.substring(0,8),t+="..."),$("#labelSoan"+n.orderTab).html(t)):$("#labelSoan"+n.orderTab).html(newTabSoanTxt)})};ComposeView.prototype.handleTabKey=function(){$(".buttonListInput").attr("tabIndex",-1);$(".displayBCC").attr("tabIndex",-1);$(".displayCC").attr("tabIndex",-1);$(".moxie-shim").attr("tabIndex",-1)};ComposeView.prototype.updateData=function(n){var t=this,u,r;if("readmail"!=this._model.type)this._model.loadFromBpr?(bkav_template.getInstance().getCookie(),$("#textToFromInput"+this.orderTab).attr("readonly","readonly"),$("#textToFromInput"+this.orderTab).val(bkav_template.toTemplate()),$("#textFromSubInput"+this.orderTab).val(bkav_template.subjectTemplate()),this._editor.setContent(bkav_template.getInstance().contentTemplate()),mailbox.getInstance().isSupport&&(mailbox.getInstance().isSupport=!1)):(this._editor.setNoFocusContent(!0),this._editor.setContent(n.content),u=n.subject||"",$("#textFromSubInput"+this.orderTab).val(u),"postfolder"==this._model.type||"postandreplyall"==this._model.type?$("#textToFromInput"+this.orderTab).val(n.folderPath):(r=n.to||"",$("#textToFromInput"+this.orderTab).val(r))),window.setTimeout(function(){var n=document.activeElement;console.log("curElement: "+n);n||($(document).click(),t._editor.focus())},400),window.setTimeout(function(){t._model.oldContent=t._editor.getContent()},500);else{var u=n.subject||"",f=n.fullName||"",e=n.from||"",r=n.to||"",s=n.content||"",i=u;8<u.length&&(i=u.substring(0,8)+"...");this.updateTabLabel(i);var r=r.replace(/;$/,""),i=r.split(";"),o="";2<i.length&&(o=r,r=i[0]+";"+i[1]);2<i.length?(document.getElementById("toLabelReadMailText"+this.orderTab).innerHTML=i[0]+","+i[1],Util.renderMoreAddress("closeMore"+this.orderTab,"frShowMore"+this.orderTab,"toMore"+this.orderTab,o)):(2==i.length&&$("#toLabelReadMailText"+this.orderTab).html(i[0]+","+i[1]),1==i.length&&$("#toLabelReadMailText"+this.orderTab).html(i[0]));f?$("#fromLabelReadMailText"+this.orderTab).html(f+"&lt;"+e+"&gt;"):$("#fromLabelReadMailText"+this.orderTab).html(e);$("#subjectLabelReadMailText"+this.orderTab).html(u);$("#toLabelReadMailText"+this.orderTab).html(r);0<(n.part||[]).length&&($("#attachFileReadMailLabel"+this.orderTab).css("display","block"),$("#attachFileReadMailIcon"+this.orderTab).css("display","block"));window.setTimeout(function(){$("#contentHtml"+t.orderTab).contents().find("body").html("<div id='contentReadMail_"+t.orderTab+"'>"+s+"<\/div>");$("#loadingTabReadMail"+t.orderTab).remove();$("#contentHtml"+t.orderTab).contents().find("body").css({height:"97%",overflow:"auto",padding:"0",margin:"0","padding-top":"10px"});$("#contentHtml"+t.orderTab).contents().find("html").css({height:"100%",overflow:"auto",padding:"0",margin:"0","padding-left":"12px"});$("#contentHtml"+t.orderTab).contents().find(".volumeInfo").css({color:"#6c8594","font-size":"12px","margin-top":"20px","font-family":"Tahoma"});$("#contentHtml"+t.orderTab).contents().find("table").css({"margin-left":"0"});var n=$("#contentHtml"+t.orderTab).contents().get(0);$(n).click(function(){0<$("#frShowMore"+t.orderTab).length&&$("#frShowMore"+t.orderTab).css("display","none");0<$("#attachPanelReadMail"+t.orderTab+"_c").length&&$("#attachPanelReadMail"+t.orderTab+"_c").remove()})},100);Util.createContextMenu("contentHtml"+t.orderTab);window.setTimeout(function(){Util.decodeImageSrc("contentHtml"+t.orderTab)},500)}};ComposeView.prototype.removeComposeTab=function(){var n=getindexNewTab(txtSoan);tabView.removeTab(tabView.getTab(n))};ComposeView.prototype.handleStartSendMail=function(){0!=currentUser.timeoutSession&&window.clearTimeout(mailbox.getInstance().timeout);YAHOO.util.Dom.setStyle("sendingTab"+this.orderTab,"display","block");YAHOO.util.Dom.setStyle("composeLabel"+this.orderTab,"display","none");this.toolbar.getButtonById("tb_composeMail"+this.orderTab).set("disabled",!0);this.toolbar.getButtonById("tb_saveDraft"+this.orderTab).set("disabled",!0);this.initEventAbortSendMail()};ComposeView.prototype.handleSendMailFail=function(){0<mailbox.getInstance().timeToRetrieveMailSent&&this.retrieveMailSent();YAHOO.util.Dom.setStyle("sendingTab"+this.orderTab,"display","none");YAHOO.util.Dom.setStyle("composeLabel"+this.orderTab,"display","block");this.isSendingStatus=this.sending=!1;this.toolbar.getButtonById("tb_composeMail"+this.orderTab).set("disabled",!1);this.toolbar.getButtonById("tb_saveDraft"+this.orderTab).set("disabled",!1);document.getElementById("tb_attach"+this.orderTab).disabled=!1;mailbox.getInstance().loggingOut&&new ConfirmBox(messageBoxMsg,"Gửi mail lỗi. Bạn có muốn tiếp tục thoát không?",function(){mailbox.getInstance().handleLogout()},function(){},chooseButtonMsg,cancelButtonMsg)};ComposeView.prototype.removeTab=function(){tabView.removeTab(this.tab.tab);this.dontSetActiveTab||tabView.set("activeIndex",0)};ComposeView.prototype.handleSendMailComplete=function(){this.sending=!1;this.removeTab();var n=new ActionDoneMsg("resources/common/sentMailMsg.png");n.init();n.show();mailbox.getInstance().loggingOut&&mailbox.getInstance().handleLogout()};ComposeView.prototype.addComposeTab=function(){var n=new YAHOO.widget.Tab({label:txtSoan,id:"composeMailTab"});tabView.addTab(n);YAHOO.util.Event.on("composeMailTab","click",function(){var n=new ComposeModel({composeType:"compose"}),t=new ComposeView(n);new ComposeController(t,n).init()})};ComposeView.prototype.handleCcBcc=function(n){"bcc-button"==n.id?(this._headerHeight||(this._headerHeight=$("#headerCompose"+this.orderTab).height()-($(".fileAttachDiv").height()||0)),"none"==YAHOO.util.Dom.getStyle("fromBcc"+this.orderTab,"display")?(YAHOO.util.Dom.setStyle("fromBcc"+this.orderTab,"display","block"),this._headerHeight+=28,this._editor.setHeight(this.heightCompose-186)):(YAHOO.util.Dom.setStyle("fromBcc"+this.orderTab,"display","none"),this._headerHeight-=28,this._editor.setHeight(this.heightCompose-161))):(this._headerHeight||(this._headerHeight=$("#headerCompose"+this.orderTab).height()-($(".fileAttachDiv").height()||0)),"none"==YAHOO.util.Dom.getStyle("fromCc"+this.orderTab,"display")?(YAHOO.util.Dom.setStyle("fromCc"+this.orderTab,"display","block"),this._headerHeight+=28,this._editor.setHeight(this.heightCompose-186)):(YAHOO.util.Dom.setStyle("fromCc"+this.orderTab,"display","none"),this._headerHeight-=28,this._editor.setHeight(this.heightCompose-161)));$("#headerCompose"+this.orderTab).height(this._headerHeight+$(".fileAttachDiv").height()||0)};ComposeView.prototype.handleUploadComplete=function(){$("#wprocess"+this.orderTab).css("display","none")};ComposeView.prototype.initAttach=function(){window.addEventListener("dragover",function(n){n=n||event;n.preventDefault()},!1);window.addEventListener("drop",function(n){n=n||event;n.preventDefault()},!1);var n=this,r=Session.getInstance().getIpServer(),t="200,'null','",i=new plupload.Uploader({runtimes:"html5,flash",browse_button:"tb_attach"+n.orderTab,drop_element:"descriptionContainer",inIframe:!0,editor_id:n._editor._editorId,multi_selection:!0,url:location.protocol+"//"+r+"/service/upload?fmt=raw",flash_swf_url:"lib/plupload/Moxie.swf",dragdrop:!0,init:{PostInit:function(){},FilesAdded:function(t,r){var s;n.attachFail=!1;for(var e=!0,o="",f=!1,u=0;u<r.length;u++)s=r[u].name.split(".").pop(),-1!=currentUser.extension.indexOf(s)?(e=!1,o+=r[u].name+"<br>",t.removeFile(r[u])):f=!0;e?t.total.size>currentUser.maxFileSize&&(f=!1,this.trigger("Error",{code:"-600",message:"Tổng dung lượng tệp đính kèm không được vượt quá "+plupload.formatSize(currentUser.maxFileSize),file:r[u]})):this.trigger("Error",{code:"-601",message:o+errorTypeAttachment,file:r[u]});f&&(n._headerHeight||(n._headerHeight=$("#headerCompose"+n.orderTab).height()-($("#fileAttach"+n.orderTab).height()||0)),$("#headerCompose"+n.orderTab).height($("#headerCompose"+n.orderTab).height()+15),n._model.isAttaching=!0,i.start())},UploadComplete:function(){},UploadProgress:function(){$("#wprocess"+n.orderTab).css("display","block");$("#processUpload"+n.orderTab).width(i.total.percent);$("#processUpload"+n.orderTab).html('<span style="height: 8px;font-size: 12; margin-left: 105px;">'+i.total.percent+"%<\/span>")},FileUploaded:function(r,u,f){var e,o;if(n.attachFail=!1,u=f.response.split(","),2<u.length&&(u=u[2].split("'"),t="200,'null','"==t?t+u[1]:t+(","+u[1])),r.total.uploaded==i.files.length){if(t+="'",t.split(","),"<pre><\/pre>"==t)pb1&&pb1.set("value",2e3),new MessageBox("Lỗi",attachErrMsg),$(".yui-editor-editable-container").height($(".yui-editor-editable-container").height()+25),n.attachFail=!0,n._isSendingStatus=!1;else{if(r=[],u=t.split(","),f=u.length,2<f)for(e=2;e<f;e++)r.push(u[e]);n._model._attachBoxes=[];u=n.getEmailTo();f=n._editor.getContent();f=f.replace(/</gi,"&lt;");f=f.replace(/>/gi,"&gt;");-1!=f.indexOf("&nbsp")&&(f=f.replace(/&nbsp;/gi,"&#160;"));f="<mp ct='text/html'><content>"+f+"<\/content><\/mp>";document.getElementById("textFromSubInput")+n.orderTab&&(o=document.getElementById("textFromSubInput"+n.orderTab).value);n.saveDraftBtnClick.notify({attachId:r,multipart:f,subject:o,emailTo:u})}t="200,'null','"}},Error:function(t,i){n._model.isAttaching=!1;"-600"!=i.code&&"-601"!=i.code||new MessageBox(errorDlgMsg,i.message)}}});i.init({editor_id:n._editor._editorId});$(document).live()};ComposeView.prototype.handleAttachFail=function(n){n=n.response;n.Body&&n.Body.Fault&&n.Body.Fault.Detail&&n.Body.Fault.Detail.Error&&"mail.MESSAGE_TOO_BIG"==n.Body.Fault.Detail.Error.Code?(this.attachFail=!0,$(".yui-editor-editable-container").height($(".yui-editor-editable-container").height()+25),new MessageBox("Lỗi",attachSizeToBigErrMsg)):(this.attachFail=!0,$(".yui-editor-editable-container").height($(".yui-editor-editable-container").height()+25),-1!=response_data.indexOf("413,'null'")?new MessageBox(errorDlgMsg,attachSizeToBigErrMsg):new MessageBox(errorDlgMsg,attachErrMsg));this.attachFail?$("#headerCompose"+this.orderTab).height($("#headerCompose"+this.orderTab).height()-15):($("#fileAttach"+this.orderTab).css("display","block"),$("#headerCompose"+this.orderTab).height(this._headerHeight+$("#fileAttach"+this.orderTab).height()+3))};ComposeView.prototype.updateHeight=function(){var n=$("#headerCompose"+this.orderTab).height();$("#headerCompose"+this.orderTab).height(this._headerHeight+$("#fileAttach"+this.orderTab).height());n=$("#headerCompose"+this.orderTab).height()-n;console.log("added : "+n);$(".yui-editor-editable-container").css("height",$(".yui-editor-editable-container").height()-n+"px !important")};ComposeView.prototype.removeAttachFile=function(n,t){for(var r=-1,i=0;i<this._model._attachBoxes.length;i++)this._model._attachBoxes[i].getPart()==n&&(r=i);for(0<=r&&this._model._attachBoxes.splice(r,1),r=-1,i=0;i<this._model.midPart.length;i++)this._model.midPart[i]==n&&(r=i);if(0<=r&&this._model.midPart.splice(r,1),r=-1,console.log("isFwd : "+t),t&&0<this._model.partMailFwd.length)for(i=0;i<this._model.partMailFwd.length;i++)this._model.partMailFwd[i]==n&&(r=i);0<=r&&this._model.partMailFwd.splice(r,1);console.log(r);console.log("this._model.partMailFwd.length: "+this._model.partMailFwd.length)};ComposeView.prototype.hasAttach=function(){return this._model._attachBoxes&&0<this._model._attachBoxes.length};ComposeView.prototype.getPartList=function(){var t=[],n;if(this._model._attachBoxes)for(n=0;n<this._model._attachBoxes.length;n++)t.push(this._model._attachBoxes[n].getPart());return t};ComposeView.prototype.getAttachFileNames=function(){var t=[],n;if(this._model._attachBoxes)for(n=0;n<this._model._attachBoxes.length;n++)t.push(this._model._attachBoxes[n].getFileName());return t};ComposeView.prototype.insertAttach=function(n){var r,t,i,u;this._model._attachBoxes&&0==this._model._attachBoxes.length&&$("#fileAttachDiv"+this.orderTab+" span[id^='attachElement']").remove();r=n.part;t=n.fileName;this.counter++;$("#fileAttachDiv"+this.orderTab).css("display","block");$("#headerCompose"+this.orderTab).css("height","140px");i=!1;n.isFwd&&(i=n.isFwd);""!=t&&(document.getElementById("fileAttach"+this.orderTab)&&(u=document.getElementById("fileAttach"+this.orderTab)),n=new AttachmentBox(this,u,getImgFromFileName(t),t,!1,i),n.setPart(r),n.render(),this._model._attachBoxes||(this._model._attachBoxes=[]),this._model._attachBoxes.push(n));3<this._model._attachBoxes.length?($("#headerCompose"+this.orderTab).height("160px"),this._editor.setHeight(this.heightCompose-233)):0<this._model._attachBoxes.length?(this._editor.setHeight(this.heightCompose-213),$("#headerCompose"+this.orderTab).height("140px")):this._editor.setHeight(this.heightCompose-173)};ComposeView.prototype.getTo=function(){var r=document.getElementById("textToFromInput"+this.orderTab).value,u=0,n=[];if(""==r)u=0;else if(-1!=r.indexOf(";")){for(var n=r.split(";"),u=n.length,i=0;i<u;i++)if(-1!=n[i].indexOf(","))for(var t=n[i].split(","),u=u-1+t.length,n=removeItem(n,i),e=t.length,f=0;f<e;f++)n.push(t[f])}else-1!=r.indexOf(",")?(n=r.split(","),u=n.length):u=1;if(t=[],0!=u){if(0<n.length?t.push(n[0]):t.push(r),1<u)for(i=1;i<u;i++)0<n.length?t.push(n[i]):t.push(r)}else t.push(r);return t};ComposeView.prototype.getCc=function(){var u=[],i=document.getElementById("textFromCcInput"+this.orderTab).value,r=0,n=[];if(""==i)r=0;else if(-1!=i.indexOf(";")){for(var n=i.split(";"),r=n.length,t=0;t<r;t++)if(-1!=n[t].indexOf(","))for(var f=n[t].split(","),r=r-1+f.length,n=removeItem(n,t),o=f.length,e=0;e<o;e++)n.push(f[e])}else-1!=i.indexOf(",")?(n=i.split(","),r=n.length):r=1;if(0!=r){if(0<n.length?u.push(n[0]):u.push(i),1<r)for(t=1;t<r;t++)0<n.length?u.push(n[t]):u.push(i)}else u.push(i);return u};ComposeView.prototype.getBcc=function(){var u=[],r=document.getElementById("textFromBccInput"+this.orderTab).value,n=[],t=0;if("none"==document.getElementById("fromBcc"+this.orderTab).style.display)t=0;else if(""==r)t=0;else if(-1!=r.indexOf(";")){for(var n=r.split(";"),t=n.length,i=0;i<t;i++)if(-1!=n[i].indexOf(","))for(var f=n[i].split(","),t=t-1+f.length,n=removeItem(n,i),o=f.length,e=0;e<o;e++)n.push(f[e])}else-1!=r.indexOf(",")?(n=r.split(","),t=n.length):t=1;if(0!=t){if(0<n.length?u.push(n[0]):u.push(r),1<t)for(i=1;i<t;i++)0<n.length?u.push(n[i]):u.push(r)}else u.push(r);return u};ComposeView.prototype.getEmailTo=function(){var i=this.getTo(),r=this.getCc(),u=this.getBcc(),f=i.length,t,n;if(0!=f){for(t="<e t='f' a='"+Session.getInstance().getUser()+"' p='"+currentUser.displayName+"' />",n=0;n<f;n++)""!=i[n]&&-1!=i[n].indexOf("@")&&(t+="<e t='t' a='"+i[n]+"'/>");if(0<r.length)for(n=0;n<r.length;n++)""!=r[n]&&(t+="<e t='c' a='"+r[n]+"'/>");if(0<u.length)for(n=0;n<u.length;n++)""!=u[n]&&(t+="<e t='b' a='"+u[n]+"'/>");return t}return""};ComposeView.prototype.createDialogSelectFolder=function(){function f(){if(""!=document.getElementById("foldertoMove").value){u._model.type="postfolder";u._model.selectFolder=!0;var n=document.getElementById("idSubFolder").value;u._model.folderId=n;n=TreeController.getInstance().getNodeByProperty("labelElId",n);u._model.folderPath=getLocation(n);$("#textToFromInput"+u.orderTab).val(u._model.folderPath);$("#textToFromInput"+u.orderTab).attr("disabled","disabled");this.cancel()}else""==n&&($("#foldertoMove").focus(),new MessageBox(errorDlgMsg,noChoiceFolderToMoveMsg))}var i=document.body.appendChild(document.createElement("div")),r,n,t,u;i.setAttribute("id","moveDialog");r=i.appendChild(document.createElement("div"));r.className="hd";r.appendChild(document.createTextNode(""));r=i.appendChild(document.createElement("div"));r.className="bd";n=document.createElement("div");n.setAttribute("id","divFolder");t=document.createElement("label");t.innerHTML=folderMsg+": ";n.appendChild(t);t=document.createElement("input");t.setAttribute("type","text");t.setAttribute("size","30");t.setAttribute("id","foldertoMove");t.setAttribute("disabled","disabled");n.appendChild(t);t=document.createElement("input");t.setAttribute("type","hidden");t.setAttribute("id","idSubFolder");n.appendChild(t);r.appendChild(n);n=r.appendChild(document.createElement("div"));n.setAttribute("id","bodyMoveDialog");n.style.overflow="auto";n.style.background="none repeat scroll 0 0 #FFFFFF";n.style.height="300px";n.style.width="400px";n.style.border="1px solid #c0c0c0";n.style.marginTop="5px";n.style.bgcolor="#fdfcfa";r=document.createElement("div");r.id=TreeController.subTreeId+TreeView.INDEX;n.appendChild(r);TreeView.INDEX++;n=new TreeModel(TreeController.getInstance().getBmailFolderStructure());n=new TreeView(n);n.createTree({treeId:r.id,isSubTree:!0});TreeController.getInstance().changeExpandRootNode(n);n.tree.subscribe("labelClick",function(n){var t=getSubfolderLabel(n.label);document.getElementById("foldertoMove").value=t;document.getElementById("idSubFolder").value=n.labelElId});i.appendChild(document.createElement("div")).className="ft";i=new YAHOO.widget.SimpleDialog(i,{fixedcenter:!0,modal:!0,constraintoviewport:!0,close:!1,width:"430px",visible:!1});u=this;i.cfg.queueProperty("buttons",[{text:chooseButtonMsg,handler:f},{text:closeButtonMsg,handler:function(){this.cancel()}}]);i.setHeader("<div class = 'rhd'><\/div><div class = 'rft'><\/div>"+headerDialogMoveMailMsg);i.render(document.body);i.bringToTop();i.show();$("#foldertoMove").focus();$("#divFolder").css("margin-left","3px");i.focusEnter(f);mailbox.getInstance().disableOutline()};ComposeView.prototype.createDialogSelectAddress=function(){var n=this,i=new YAHOO.widget.SimpleDialog("CreateNewContactGroupDialog",{fixedcenter:!0,modal:!0,constraintoviewport:!0,draggable:!0,close:!1,visible:!1,height:"525px",width:"820px"}),r=[{text:chooseButtonMsg,handler:function(){var t=n._tblAddress.getRecordSet().getLength();if(0<t){for(var f=[],e=[],o=[],u=0;u<t;u++){var i=n._tblAddress.getRecordSet().getRecord(u),r=i.getData().type,i=i.getData().email;"To"==r?f.push(i):"Cc"==r?e.push(i):"Bcc"==r&&o.push(i)}if(0<f.length){for(t=$("#textToFromInput"+n.orderTab).val(),u=t.substr(t.length-1),r="",i=0;i<f.length;i++)r+=f[i]+";";t=""==t||";"==u||","==u?t+r:t+";"+r;$("#textToFromInput"+n.orderTab).val(t)}if(0<e.length&&("block"!=document.getElementById("fromCc"+n.orderTab).style.display&&$("#cc-button"+n.orderTab).click(),"block"==document.getElementById("fromCc"+n.orderTab).style.display)){for(t=$("#textFromCcInput"+n.orderTab).val(),u=t.substr(t.length-1),r="",i=0;i<e.length;i++)r+=e[i]+";";t=""==t||";"==u||","==u?t+r:t+";"+r;$("#textFromCcInput"+n.orderTab).val(t)}if(0<o.length&&("block"!=document.getElementById("fromBcc"+n.orderTab).style.display&&$("#bcc-button"+n.orderTab).click(),"block"==document.getElementById("fromBcc"+n.orderTab).style.display)){for(t=$("#textFromBccInput"+n.orderTab).val(),u=t.substr(t.length-1),r="",i=0;i<o.length;i++)r+=o[i]+";";t=""==t||";"==u||","==u?t+r:t+";"+r;$("#textFromBccInput"+n.orderTab).val(t)}}this.cancel()}},{text:cancelButtonMsg,handler:function(){this.cancel()}}],t;for(t="<div>"+("<input type='text' id='searchAddressInput' /> <input type='button' value='"+searchButtonMsg+"' id='searchAddressBtn' />"),t+="<div  id='autoSearch' class='yui-ac-container'><\/div><\/div>",t+="<div>",t+="<table>",t+="<tr>",t+="<td>",t+="<div id='tblSelectAddress' />",t+="<\/td>",t+="<td>",t+="<div><input type='button' value='"+sendToMsg+"' id='toBtnSelectAddress' /><\/div>",t+="<div><input type='button' value='"+ccInputMsg+"' id='ccBtnSelectAddress' /><\/div>",t+="<div><input type='button' value='"+bccInputMsg+"' id='bccBtnSelectAddress' /><\/div>",t+="<div><input type='button' value='"+removeButtonMsg+"' id='removeBtnSelectAddress' /><\/div>",t+="<\/td>",t+="<td>",t+="<div id='tblAddress' />",t+="<\/td>",t+="<\/tr>",t+="<\/table>",t+="<\/div>",i.cfg.queueProperty("buttons",r),i.setBody(t),i.setHeader(' <div class = "rhd"><\/div><div class = "rft"><\/div> '+selectContactMsg),i.render(document.body),i.show(),this.createTblSelectAddress(),this.createTblAddress(),n=this,i=[],r=0;r<currentUser.contact.length;r++)/^([\w-\.]+) @((\[[0-9]{1, 3}\.[0-9]{1, 3}\.[0-9]{1, 3}\.) |(([\w-]+\.) +)) ([a-zA-Z]{2, 4}|[0-9]{1, 3}) (\]?) $/.test(currentUser.contact[r].email)&&i.push({email:currentUser.contact[r].email,name:currentUser.contact[r].fullname});i=new YAHOO.util.LocalDataSource(i);i.responseSchema={fields:["email","name"]};i=new YAHOO.widget.AutoComplete("searchAddressInput","autoSearch",i);i.prehighlightClassName="yui-ac-prehighlight";i.queryDelay=0;i.doBeforeExpandContainer=function(t,i,r,u){for(t=[],i=0;i<u.length;i++){r=u[i].name;var f=u[i].email;""==r&&(r=f);t.push({email:f,name:r})}return u=n._tblSelectAddress.getRecordSet(),0<u.getLength()&&(n._tblSelectAddress.set("MSG_EMPTY",""),u=u.getLength(),n._tblSelectAddress.deleteRows(0,u)),n._tblSelectAddress.addRows(t,0),!1};YAHOO.util.Event.on("searchAddressInput","keyup",function(){""==document.getElementById("searchAddressInput").value&&n.createTblSelectAddress()});YAHOO.util.Event.on("searchAddressInput","keydown",function(t){if(13==t.keyCode){t=$("#searchAddressInput").val();var i=new XMLElement("SearchGalRequest");i.addAttribute("type","account");i.addAttribute("limit","500");i.addAttribute("name",t);t=new Soap(readCookie("user"),i,"urn:zimbraAccount",!0);t.setSimple(!0);t.isNeedAbort(!1);t.sendRequestCallback(function(t){var u=[],f,i,e,r;if(t.Body&&t.Body.SearchGalResponse&&t.Body.SearchGalResponse.cn)for(f=t.Body.SearchGalResponse.cn.length,i=0;i<f;i++)e=t.Body.SearchGalResponse.cn[i]._attrs.email,r="",t.Body.SearchGalResponse.cn[i]._attrs.fullName&&(r=t.Body.SearchGalResponse.cn[i]._attrs.fullName),""!=r&&u.push({name:r,email:e});n.createTblSelectAddress(u)})}});YAHOO.util.Event.on("searchAddressBtn","click",function(){var t=$("#searchAddressInput").val(),i=new XMLElement("SearchGalRequest");i.addAttribute("type","account");i.addAttribute("limit","500");i.addAttribute("name",t);t=new Soap(readCookie("user"),i,"urn:zimbraAccount",!0);t.setSimple(!0);t.isNeedAbort(!1);t.sendRequestCallback(function(t){var u=[],f,i,e,r;if(t.Body&&t.Body.SearchGalResponse&&t.Body.SearchGalResponse.cn)for(f=t.Body.SearchGalResponse.cn.length,i=0;i<f;i++)e=t.Body.SearchGalResponse.cn[i]._attrs.email,r="",t.Body.SearchGalResponse.cn[i]._attrs.fullName&&(r=t.Body.SearchGalResponse.cn[i]._attrs.fullName),""!=r&&u.push({name:r,email:e});n.createTblSelectAddress(u)})});YAHOO.util.Event.on("toBtnSelectAddress","click",function(){var e=n._tblSelectAddress.getSelectedRows(),o=e.length,i,f,s;if(0<o)for(i=0;i<o;i++){for(var r=e[i],h=n._tblSelectAddress.getRecordSet().getRecord(r).getData().name,r=n._tblSelectAddress.getRecordSet().getRecord(r).getData().email,t=0,c=n._tblAddress.getRecordSet().getLength(),u=0;u<c;u++)if(f=n._tblAddress.getRecordSet().getRecord(u),s=f.getData().type,f.getData().email==r&&"To"==s){t=1;break}0==t&&(t=[],t.push({type:"To",email:r,name:h}),n._tblAddress.addRow(t[0]))}});YAHOO.util.Event.on("ccBtnSelectAddress","click",function(){var e=n._tblSelectAddress.getSelectedRows(),o=e.length,i,f,s;if(0<o)for(i=0;i<o;i++){for(var r=e[i],h=n._tblSelectAddress.getRecordSet().getRecord(r).getData().name,r=n._tblSelectAddress.getRecordSet().getRecord(r).getData().email,t=0,c=n._tblAddress.getRecordSet().getLength(),u=0;u<c;u++)if(f=n._tblAddress.getRecordSet().getRecord(u),s=f.getData().type,f.getData().email==r&&"Cc"==s){t=1;break}0==t&&(t=[],t.push({type:"Cc",email:r,name:h}),n._tblAddress.addRow(t[0]))}});YAHOO.util.Event.on("bccBtnSelectAddress","click",function(){var e=n._tblSelectAddress.getSelectedRows(),o=e.length,i,f,s;if(0<o)for(i=0;i<o;i++){for(var r=e[i],h=n._tblSelectAddress.getRecordSet().getRecord(r).getData().name,r=n._tblSelectAddress.getRecordSet().getRecord(r).getData().email,t=0,c=n._tblAddress.getRecordSet().getLength(),u=0;u<c;u++)if(f=n._tblAddress.getRecordSet().getRecord(u),s=f.getData().type,f.getData().email==r&&"Bcc"==s){t=1;break}0==t&&(t=[],t.push({type:"Bcc",email:r,name:h}),n._tblAddress.addRow(t[0]))}});YAHOO.util.Event.on("removeBtnSelectAddress","click",function(t){var i,r;if(t=n._tblAddress.getSelectedRows().length,0<t)for(i=0;i<t;i++)r=n._tblAddress.getSelectedRows()[i],n._tblAddress.deleteRow(r)})};ComposeView.prototype.createTblSelectAddress=function(n){var t=this;YAHOO.util.Event.onDOMReady(function(){var i,r,u,f;if(n)i=new YAHOO.util.DataSource(n);else{for(i=[],r=0;r<currentUser.contact.length;r++)u=currentUser.contact[r].email,f=currentUser.contact[r].fullname,/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(u)&&(""==f&&(f=u),i.push({name:f,email:u}));i=new YAHOO.util.DataSource(i)}t._tblSelectAddress=new YAHOO.widget.DataTable("tblSelectAddress",[{key:"name",label:"<div style='margin-top:2px'>Tên",resizeable:!0,width:100},{key:"email",label:"<div style='margin-top:2px'>Email",resizeable:!1,width:150}],i,{scrollable:!0,width:"350px",height:"350px",MSG_EMPTY:""});t._tblSelectAddress.subscribe("rowClickEvent",t._tblSelectAddress.onEventSelectRow);t._tblSelectAddress.subscribe("rowDblclickEvent",function(n){var r=n.target.id,f,e;n=this.getRecordSet().getRecord(r).getData().name;for(var r=this.getRecordSet().getRecord(r).getData().email,i=0,o=t._tblAddress.getRecordSet().getLength(),u=0;u<o;u++)if(f=t._tblAddress.getRecordSet().getRecord(u),e=f.getData().type,f.getData().email==r&&"To"==e){i=1;break}0==i&&(i=[],i.push({type:"To",email:r,name:n}),t._tblAddress.addRow(i[0]))})})};ComposeView.prototype.createTblAddress=function(){var n=this;YAHOO.util.Event.onDOMReady(function(){var t=[{key:"type",label:"<div style='margin-top:2px'>"+typeMsg,resizeable:!0,width:30},{key:"name",label:"<div style='margin-top:2px'>"+nameMsg,resizeable:!0,width:100},{key:"email",label:"<div style='margin-top:2px'>"+emailMsg,resizeable:!1,width:150}],i=new YAHOO.util.DataSource;n._tblAddress=new YAHOO.widget.DataTable("tblAddress",t,i,{scrollable:!0,width:"350px",height:"350px",MSG_EMPTY:""});n._tblAddress.subscribe("rowClickEvent",n._tblAddress.onEventSelectRow);n._tblAddress.subscribe("rowDblclickEvent",function(t){n._tblAddress.deleteRow(t.target.id)})})};ComposeController.dontSetActiveTab=!1;ComposeController.prototype.abortSending=!1;ComposeController.prototype.useKyDienTu=!1;ComposeController.prototype.countdownTimeout=null;ComposeController.prototype.init=function(){this._view.init();this._model.getMail()};ComposeController.prototype.createAutoComplete=function(){var r=this._view.orderTab,n,i,t;for($(".textToFromInput").keypress(function(n){if(32==n.which||37==n.which||38==n.which||39==n.which||40==n.which)return!1}),n=[],i=0;i<currentUser.contact.length;i++)t=currentUser.contact[i].email,t&&(t=t.toLowerCase(),-1==n.indexOf(t)&&n.push(t));i=new YAHOO.util.LocalDataSource(n);i.responseSchema={fields:["contact"]};i=new YAHOO.widget.AutoComplete("textToFromInput"+r,"autoComTo"+r,i);i.prehighlightClassName="yui-ac-prehighlight";i.delimChar=";";i.maxResultsDisplayed=20;t=new YAHOO.util.LocalDataSource(n);t.responseSchema={fields:["contact"]};t=new YAHOO.widget.AutoComplete("textFromCcInput"+r,"autoComCc"+r,t);t.prehighlightClassName="yui-ac-prehighlight";t.delimChar=";";t.maxResultsDisplayed=20;n=new YAHOO.util.LocalDataSource(n);n.responseSchema={fields:["contact"]};n=new YAHOO.widget.AutoComplete("textFromBccInput"+r,"autoComBcc"+r,n);n.prehighlightClassName="yui-ac-prehighlight";n.delimChar=";";n.maxResultsDisplayed=20;i.doBeforeExpandContainer=function(n,t,i){return n=document.getElementById("textToFromInput"+r),i=YAHOO.util.Dom.getX(n),i=i+11*n.value.length/2-2,YAHOO.util.Dom.setX(t,i),!0};t.doBeforeExpandContainer=function(n,t,i){return n=document.getElementById("textFromCcInput"+r),i=YAHOO.util.Dom.getX(n),i=i+11*n.value.length/2-2,YAHOO.util.Dom.setX(t,i),!0};n.doBeforeExpandContainer=function(n,t,i){return n=document.getElementById("textFromBccInput"+r),i=YAHOO.util.Dom.getX(n),i=i+11*n.value.length/2-2,YAHOO.util.Dom.setX(t,i),!0}};ComposeController.prototype.sendComposeInQueue=function(){var i,n,t,r;if(0<mailbox.getInstance().composeArr.length)for(clearTimeout(mailbox.getInstance().timeOutRetrieveMailSent),mailbox.getInstance().timeOutRetrieveMailSent=null,$("#retrieveMailSent").css("display","none"),i=mailbox.getInstance().composeArr.length,n=0;n<i;n++)t=mailbox.getInstance().composeArr[n].composeView,r=mailbox.getInstance().composeArr[n].callback,t.dontSetActiveTab=!0,r(t),mailbox.getInstance().composeArr.pop()};ComposeController.prototype.handleWindowClose=function(){var n=this;window.onbeforeunload=function(){n.sendComposeInQueue()}};
//# sourceMappingURL=compose.min.js.map
