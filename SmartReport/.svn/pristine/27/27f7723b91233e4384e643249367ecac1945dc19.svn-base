var pb1;var numberComposeTab=0;function compose(){this.widthCompose=YAHOO.util.Dom.getClientWidth()-200;this.heightCompose=YAHOO.util.Dom.getClientHeight();this.hien=false;this.counter=1;this.autoId="";this.temp1="";this.temp2="";this.temp3="";this.temp4="";this.orderTab=0;this.aidArray=[];self=this}compose.prototype.createToolbar=function(e,c,a){this.toolbarComposeMail=new YAHOO.widget.Toolbar(e,{buttons:[{group:"",label:null,buttons:[{id:"tb_composeMail",type:"push",label:"",value:"compose"},{id:"tb_saveDraft",type:"push",label:"",value:"draft"},{id:"tb_attach",type:"push",label:"",value:"attach"}]}]});YAHOO.util.Event.on("tb_composeMail","mousedown",function(g){var f=YAHOO.util.Dom.getChildren("tb_composeMail")[1];YAHOO.util.Dom.addClass(f,"compose_newMailBtnPressed")});YAHOO.util.Event.on("tb_composeMail","mouseout",function(g){var f=YAHOO.util.Dom.getChildren("tb_composeMail")[1];YAHOO.util.Dom.removeClass(f,"compose_newMailBtnPressed")});YAHOO.util.Event.on("tb_composeMail","mouseup",function(g){var f=YAHOO.util.Dom.getChildren("tb_composeMail")[1];YAHOO.util.Dom.removeClass(f,"compose_newMailBtnPressed")});YAHOO.util.Event.on("tb_saveDraft","mousedown",function(g){var f=YAHOO.util.Dom.getChildren("tb_saveDraft")[1];YAHOO.util.Dom.addClass(f,"compose_draftBtnPressed")});YAHOO.util.Event.on("tb_saveDraft","mouseout",function(g){var f=YAHOO.util.Dom.getChildren("tb_saveDraft")[1];YAHOO.util.Dom.removeClass(f,"compose_draftBtnPressed")});YAHOO.util.Event.on("tb_saveDraft","mouseup",function(g){var f=YAHOO.util.Dom.getChildren("tb_saveDraft")[1];YAHOO.util.Dom.removeClass(f,"compose_draftBtnPressed")});YAHOO.util.Event.on("tb_attach","mousedown",function(g){var f=YAHOO.util.Dom.getChildren("tb_attach")[1];YAHOO.util.Dom.addClass(f,"compose_attachBtnPressed")});YAHOO.util.Event.on("tb_attach","mouseout",function(g){var f=YAHOO.util.Dom.getChildren("tb_attach")[1];YAHOO.util.Dom.removeClass(f,"compose_attachBtnPressed")});YAHOO.util.Event.on("tb_attach","mouseup",function(g){var f=YAHOO.util.Dom.getChildren("tb_attach")[1];YAHOO.util.Dom.removeClass(f,"compose_attachBtnPressed")});var d=this.getOrderTab();var b=this.toolbarComposeMail.getButtonById("tb_composeMail");this.toolbarComposeMail.on("buttonClick",function(f){if(f.button.value=="compose"){if(c){self.sendMessenger(d,c,a)}else{self.sendMessenger(d)}}else{if(f.button.value=="attach"){if(c){self.attachFile(d,c)}else{self.attachFile(d)}}}});YAHOO.util.Event.on("tb_saveDraft","click",function(){var i=readCookie("user");var f=readCookie("authen");var k=self.getEmailTo(d);var l=tinyMCE.get("contentHtml"+numberComposeTab).getContent();l=l.replace(/</gi,"&lt;");l=l.replace(/>/gi,"&gt;");if(l.indexOf("&nbsp")!=-1){l=l.replace(/&nbsp;/gi,"&#160;")}var h="<mp ct='text/html'><content>"+l+"</content></mp>";if(document.getElementById("textFromSubInput")+numberComposeTab){var j=document.getElementById("textFromSubInput"+numberComposeTab).value}if(k){var g=saveDraft(i,f,k,j,h)}else{var g=saveDraft(i,f,null,j,h)}})};compose.prototype.createToolbarReadMail=function(a){this.toolbarComposeMail=new YAHOO.widget.Toolbar(a,{buttons:[{group:"",label:null,buttons:[{id:"compose_tb_reply",type:"push",label:"",value:"reply"},{id:"compose_tb_replyall",type:"push",label:"",value:"replyall"},{id:"compose_tb_forward",type:"push",label:"",value:"forward"}]}]});this.toolbarComposeMail.on("buttonClick",function(c){if(c.button.value=="reply"){var b=new compose();b.addTabComposeMail("Trả lời","replyTab");b.createLayout("layoutComposeMail"+numberComposeTab);YAHOO.util.Event.onContentReady("inboxToolbarComposeMail"+numberComposeTab,function(){b.createToolbar("inboxToolbarComposeMail"+numberComposeTab)});b.initLabelRep(getTo(),getCc(),getSubject(),getFullName(),getContent(),getSendTime(),getFrom());document.title="Bmail: Reply"}else{if(c.button.value=="replyall"){var b=new compose();b.addTabComposeMail("Trả lời tất cả","replyAllTab");b.createLayout("layoutComposeMail"+numberComposeTab);YAHOO.util.Event.onContentReady("inboxToolbarComposeMail"+numberComposeTab,function(){b.createToolbar("inboxToolbarComposeMail"+numberComposeTab)});b.initLabelReplyAll(getTo(),getCc(),getSubject(),getFullName(),getContent(),getSendTime(),getFrom());document.title="Bmail: ReplyAll"}else{if(c.button.value=="forward"){var b=new compose();b.addTabComposeMail("Gửi tiếp","forwardTab");b.createLayout("layoutComposeMail"+numberComposeTab);YAHOO.util.Event.onContentReady("inboxToolbarComposeMail"+numberComposeTab,function(){b.createToolbar("inboxToolbarComposeMail"+numberComposeTab)});b.initLabelFwd(getTo(),getCc(),getSubject(),getFullName(),getContent(),getSendTime(),getFrom());document.title="Bmail: Forward"}}}})};compose.prototype.addTabComposeMail=function(c,e){var b=getindexTabByLabel("Mới");tabView.removeTab(tabView.getTab(b));var a=new YAHOO.widget.Tab({label:"<b>"+c+"</b><img src='icon1/Closeinactive.png' style='position:absolute;right:4px;\n		 bottom:6px;' id='closesubtab"+numberComposeTab+"' name='Soạn' onmouseover='mouseOverCloseTabSearch(this)' onmouseout='mouseOutCloseTabSearch(this)'>",content:'<div id = "layoutComposeMail'+numberComposeTab+'"></div>',active:true,id:e});tabView.addTab(a);YAHOO.util.Event.on("closesubtab"+numberComposeTab,"click",function(){tabView.removeTab(a);tabView.set("activeIndex",0)});var d=new YAHOO.widget.Tab({label:"<b>Mới</b>",id:"composeMailTab"});tabView.addTab(d);YAHOO.util.Event.on("composeMailTab","click",function(){if(navigator.appName=="Microsoft Internet Explorer"){var f=new composeMailForIE();f.addTabComposeMail("Soạn","composeMail");f.createLayout("layoutComposeMail"+numberComposeTab);f.createToolbar("inboxToolbarComposeMail"+numberComposeTab);f.initLabel();document.title="Bmail: Compose"}else{var f=new compose();f.addTabComposeMail("Soạn","composeMail");f.createLayout("layoutComposeMail"+numberComposeTab);f.createToolbar("inboxToolbarComposeMail"+numberComposeTab);f.initLabel();document.title="Bmail: Compose"}})};compose.prototype.createLayout=function(a,b){numberComposeTab++;this.orderTab=numberComposeTab;var c='<form name="composeForm" style="background: transparent;background-color:#F0F0F0;border:0px;border-left:1px;border-style:solid;border-color:#B9B4AA;"><div class="tooBarCompose" style="background: transparent;background-color:#F0F0F0;"><div id="inboxToolbarComposeMail'+numberComposeTab+'"  style="background: transparent;background-color:#F0F0F0;"></div></div><div class="spaceHor1"></div><div class="toFrom"><div class="buttonListDiv"><input align="center"  class="buttonListInput" value ="Gửi tới" type="button" style="margin-top:-2px;margin-left:20px"/></div><div class="spaceVer"></div><div class="textToFromDiv">';if(b){c+='<input  class="textToFromInput" readonly="readonly" name="textToFromInput" id="textToFromInput'+numberComposeTab+'"type="text" />'}else{c+='<input  class="textToFromInput" name="textToFromInput" id="textToFromInput'+numberComposeTab+'"type="text"/>';c+='<div  id="autoComTo'+numberComposeTab+'" class="yui-ac-container"></div>'}c+='</div></div><div class="spaceHor2"></div><div class="fromCc"><div class="buttonListDiv"><input align="center"  class="buttonListInput"  type="button" value="Đồng gửi" style="margin-top:-2px;margin-left:20px"/></div><div class="spaceVer"></div><div class="textFromCcDiv"><input class="textFromCcInput"  name ="textFromCcInput" id="textFromCcInput'+numberComposeTab+'" type="text"  /><div id="autoComCc'+numberComposeTab+'" class="yui-ac-container"></div></div><div class="spaceVer"></div></div><div class="spaceHor3" id= "spaceHor3'+numberComposeTab+'"></div><div class="fromBcc" id="fromBcc'+numberComposeTab+'"><div class="buttonListDiv" ><input class="buttonListInput"  type="button" value="Bcc"  style="margin-top:-2px;margin-left:20px"/></div><div class="spaceVer"></div><div class="textFromBccDiv"><input   type="text"  name ="textFromBccInput" class="textFromBccInput" id="textFromBccInput'+numberComposeTab+'"/><div id="autoComBcc'+numberComposeTab+'" class="yui-ac-container"></div></div></div><div class="spaceHor4"></div><div class="fromSub"><div class="buttonListDiv" ><div align="right" class="sub" style="margin-top:2px;margin-left:23px">Chủ đề :</div></div><div class="spaceVer"></div><div class="textFromSubDiv"><input type="text"  name = "textFromSubInput" class="textFromSubInput" id ="textFromSubInput'+numberComposeTab+'"/></div></div><div class="spaceHor5"></div><div style="margin-left:10px;" id="progressAttach"></div><div style="margin-left:10px;" id="fileAttach'+numberComposeTab+'"></div><div class="spaceHor6"></div><textarea  id="contentHtml'+numberComposeTab+'"></textarea></form>';var d=new YAHOO.widget.Layout(a,{width:YAHOO.util.Dom.getClientWidth()-200,height:YAHOO.util.Dom.getClientHeight()-30,units:[{position:"center",body:c}]});d.render();var j=new YAHOO.util.LocalDataSource(contact);j.responseSchema={fields:["contact"]};var e=new YAHOO.widget.AutoComplete("textToFromInput"+numberComposeTab,"autoComTo"+numberComposeTab,j);e.prehighlightClassName="yui-ac-prehighlight";e.delimChar=";";var i=new YAHOO.util.LocalDataSource(contact);i.responseSchema={fields:["contact"]};var g=new YAHOO.widget.AutoComplete("textFromCcInput"+numberComposeTab,"autoComCc"+numberComposeTab,i);g.prehighlightClassName="yui-ac-prehighlight";g.delimChar=";";var h=new YAHOO.util.LocalDataSource(contact);h.responseSchema={fields:["contact"]};var f=new YAHOO.widget.AutoComplete("textFromBccInput"+numberComposeTab,"autoComBcc"+numberComposeTab,h);f.prehighlightClassName="yui-ac-prehighlight";f.delimChar=";"};compose.prototype.createLayoutReadMail=function(c){numberComposeTab++;this.orderTab=numberComposeTab;var b='<form name="composeForm" style="background: transparent;background-color:#F0F0F0;border:0px;border-left:1px;border-style:solid;border-color:#B9B4AA;"><div class="tooBarCompose" style="background: transparent;background-color:#F0F0F0;"><div id="inboxToolbarComposeMail'+numberComposeTab+'"  style="background: transparent;background-color:#F0F0F0;"></div></div><div class="spaceHor1"></div><div class="toFrom"><div class="buttonListDiv"><input align="center"  class="buttonListInput" value ="Gửi từ" type="button" /></div><div class="spaceVer"></div><input  class="textToFromInput" readonly="readonly" name="textToFromInput" id="textToInput'+numberComposeTab+'"type="text" /></div><div class="toFrom"><div class="buttonListDiv"><input align="center"  class="buttonListInput" value ="Gửi tới" type="button" /></div><div class="spaceVer"></div><div class="textToFromDiv">';b+='<input  class="textToFromInput" readonly="readonly" name="textToFromInput" id="textToFromInput'+numberComposeTab+'"type="text" />';b+='<div class="autoComTo" id="autoComTo'+numberComposeTab+'" ></div></div></div><div class="spaceHor2"></div><div class="fromCc"><div class="buttonListDiv"><input align="center"  class="buttonListInput"  type="button" value="Đồng gửi" /></div><div class="spaceVer"></div><div class="textFromCcDiv"><input class="textFromCcInput"  name ="textFromCcInput" readonly="readonly" id="textFromCcInput'+numberComposeTab+'" type="text"   /><div class="autoComCc"></div></div><div class="spaceVer"></div></div><div class="spaceHor3" id= "spaceHor3'+numberComposeTab+'"></div><div class="fromBcc" id="fromBcc'+numberComposeTab+'"><div class="buttonListDiv" ><input class="buttonListInput"  type="button" value="Bcc"  /></div><div class="spaceVer"></div><div class="textFromBccDiv"><input   type="text"  name ="textFromBccInput" readonly="readonly" class="textFromBccInput" id="textFromBccInput'+numberComposeTab+'" /><div class="autoComBcc"></div></div></div><div class="spaceHor4"></div><div class="fromSub"><div class="buttonListDiv" ><div align="right" class="sub" >Chủ đề :</div></div><div class="spaceVer"></div><div class="textFromSubDiv"><input type="text"  readonly="readonly" name = "textFromSubInput" class="textFromSubInput" id ="textFromSubInput'+numberComposeTab+'"/></div></div><div class="spaceHor5"></div><div class="fileAttach" id="progressAttach"></div><div class="fileAttach" id="fileAttach'+numberComposeTab+'"></div><div class="spaceHor6"></div><textarea  id="contentHtml'+numberComposeTab+'"></textarea></form>';var a=new YAHOO.widget.Layout(c,{width:YAHOO.util.Dom.getClientWidth()-200,height:YAHOO.util.Dom.getClientHeight()-30,units:[{position:"center",body:b}]});a.render()};compose.prototype.initLabelReadMail=function(g,k,b,q,l,e,d,p,c,a){var n=this.widthCompose-82;var m=this.widthCompose-162;var j=this.heightCompose-180;if(document.getElementById("btnBcc")){document.getElementById("btnBcc").value="Hiển thị Bcc"}if(document.getElementById("btnTo")){document.getElementById("btnTo").value="Gửi tới"}if(document.getElementById("sub")){document.getElementById("sub").innerHTML="Chủ đề :"}YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"height",this.heightCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor1"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("toFrom"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("tooBarCompose"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromDiv"),"width",n+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromInput"),"width",n+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromCc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcDiv"),"width",m+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcInput"),"width",n+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor3"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromBcc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccDiv"),"width",n+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccInput"),"width",n+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromSub"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor4"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubDiv"),"width",n+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubInput"),"width",n+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor5"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor6"),"width",this.widthCompose+"px");var o="";if(g){o+=g}if(k){o+=k}var h=l;document.getElementById("textToInput"+numberComposeTab).value=q+" <"+d+">";document.getElementById("textFromSubInput"+numberComposeTab).value=b;document.getElementById("textToFromInput"+numberComposeTab).value=o;tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-178,this.widthCompose,true);tinyMCE.execCommand("mceAddControl",true,"contentHtml"+numberComposeTab);document.getElementById("contentHtml"+numberComposeTab).value=h;if(c){for(var f=0;f<c.length;f++){self.insertfileAttach("",p,c[f],f+1,"",numberComposeTab,a[f],true)}}YAHOO.util.Dom.setStyle("yui-gen1","position","fixed");document.getElementById("contentHtml"+numberComposeTab+"_ifr").focus()};compose.prototype.initLabel=function(e){var h=readCookie("user");var b=readCookie("authen");var c=getSignature(h,b);var a="";if(c.Body&&c.Body.GetSignaturesResponse&&c.Body.GetSignaturesResponse.signature&&c.Body.GetSignaturesResponse.signature[0].name){if(c.Body.GetSignaturesResponse.signature[0].content&&c.Body.GetSignaturesResponse.signature[0].content[0]._content){a=c.Body.GetSignaturesResponse.signature[0].content[0]._content;a="<br/><br/>"+a}}var g=this.widthCompose-82;var d=this.widthCompose-162;var f=this.heightCompose-153;if(document.getElementById("btnBcc")){document.getElementById("btnBcc").value="Hiển thị Bcc"}if(document.getElementById("btnTo")){document.getElementById("btnTo").value="Gửi tới"}if(document.getElementById("sub")){document.getElementById("sub").innerHTML="Chủ đề :"}YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"height",this.heightCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor1"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("toFrom"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("tooBarCompose"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromDiv"),"width",g+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromInput"),"width",g+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromCc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcDiv"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcInput"),"width",g+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor3"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromBcc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccDiv"),"width",g+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccInput"),"width",g+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromSub"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor4"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubDiv"),"width",g+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubInput"),"width",g+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor5"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor6"),"width",this.widthCompose+"px");document.getElementById("textToFromInput"+numberComposeTab).focus();if(e){document.getElementById("textToFromInput"+numberComposeTab).value=e}tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-160,this.widthCompose);tinyMCE.execCommand("mceAddControl",true,"contentHtml"+numberComposeTab);document.getElementById("contentHtml"+numberComposeTab).value=a;YAHOO.util.Dom.setStyle("yui-gen1","position","fixed");document.getElementById("contentHtml"+numberComposeTab+"_ifr").focus()};compose.prototype.initLabelRep=function(l,m,i,a,b,o,d,n){var f=readCookie("user");var u=readCookie("authen");var p=getSignature(f,u);var k="";if(p.Body&&p.Body.GetSignaturesResponse&&p.Body.GetSignaturesResponse.signature&&p.Body.GetSignaturesResponse.signature[0].name){if(p.Body.GetSignaturesResponse.signature[0].content&&p.Body.GetSignaturesResponse.signature[0].content[0]._content){k=p.Body.GetSignaturesResponse.signature[0].content[0]._content;k="<br/><br/>"+k}}var c=this.widthCompose-82;var t=this.widthCompose-162;var v=this.heightCompose-180;if(document.getElementById("btnBcc")){document.getElementById("btnBcc").value="Hiển thị Bcc"}if(document.getElementById("btnTo")){document.getElementById("btnTo").value="Gửi tới"}if(document.getElementById("sub")){document.getElementById("sub").innerHTML="Chủ đề :"}YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"height",this.heightCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor1"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("toFrom"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("tooBarCompose"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromDiv"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromCc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcDiv"),"width",t+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor3"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromBcc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccDiv"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromSub"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor4"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubDiv"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor5"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor6"),"width",this.widthCompose+"px");var e="";if(l){e+=l}if(m){e+=m}var w="<br><b>Gửi từ  :</b>  <span style='color: blue;'><u>";w+=a+"</u>["+d+"]</span>";var q="<br><b>Gửi lúc :</b>  ";q+=o;var g="<br><b>Gửi tới :</b>  ";g+=e;var h="<br><b>Chủ đề  :</b>  ";h+=i;var r=b;if(i.indexOf("Re :")){document.getElementById("textFromSubInput"+numberComposeTab).value="Re :"+i}else{document.getElementById("textFromSubInput"+numberComposeTab).value=i}document.getElementById("textToFromInput"+numberComposeTab).value=d;var s="<br><span style='color: rgb(139, 0, 0);'><i> ----- Thông điệp gốc : -----</i></span>";s+=w;s+=q;s+=g;s+=h;var j=s+"<br>"+r;j=k+j;if(n){tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-160,this.widthCompose,n)}else{tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-160,this.widthCompose)}tinyMCE.execCommand("mceAddControl",true,"contentHtml"+numberComposeTab);document.getElementById("contentHtml"+numberComposeTab).value=j;YAHOO.util.Dom.setStyle("yui-gen1","position","fixed");document.getElementById("contentHtml"+numberComposeTab+"_ifr").focus()};compose.prototype.initLabelFwd=function(m,n,j,a,b,o,d,z,r,t){var f=readCookie("user");var x=readCookie("authen");var p=getSignature(f,x);var l="";if(p.Body&&p.Body.GetSignaturesResponse&&p.Body.GetSignaturesResponse.signature&&p.Body.GetSignaturesResponse.signature[0].name){if(p.Body.GetSignaturesResponse.signature[0].content&&p.Body.GetSignaturesResponse.signature[0].content[0]._content){l=p.Body.GetSignaturesResponse.signature[0].content[0]._content;l="<br/><br/>"+l}}var c=this.widthCompose-82;var v=this.widthCompose-162;var y=this.heightCompose-153;if(document.getElementById("btnBcc")){document.getElementById("btnBcc").value="Hiển thị Bcc"}if(document.getElementById("btnTo")){document.getElementById("btnTo").value="Gửi tới"}if(document.getElementById("sub")){document.getElementById("sub").innerHTML="Chủ đề :"}YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"height",this.heightCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor1"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("toFrom"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("tooBarCompose"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromDiv"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromCc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcDiv"),"width",v+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor3"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromBcc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccDiv"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromSub"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor4"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubDiv"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubInput"),"width",c+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor5"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor6"),"width",this.widthCompose+"px");var e="";if(m){e+=m}if(n){e+=n}var A="<br><b>Gửi từ  :</b>  <span style='color: blue;'><u>";A+=a+"</u>["+d+"]</span>";var q="<br><b>Gửi lúc :</b>  ";q+=o;var g="<br><b>Gửi tới :</b>  ";g+=e;var h="<br><b>Chủ đề  :</b>  ";h+=j;var s=b;if(j.indexOf("Fwd :")){document.getElementById("textFromSubInput"+numberComposeTab).value="Fwd :"+j}else{document.getElementById("textFromSubInput"+numberComposeTab).value=j}var u="<br><span style='color: rgb(139, 0, 0);'><i> ----- Thông điệp gốc : -----</i></span>";u+=A;u+=q;u+=g;u+=h;var k=u+"<br>"+s;tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-160,this.widthCompose);tinyMCE.execCommand("mceAddControl",true,"contentHtml"+numberComposeTab);k=l+k;document.getElementById("contentHtml"+numberComposeTab).value=k;if(r){for(var w=0;w<r.length;w++){self.insertfileAttach("",z,r[w],w+1,"",numberComposeTab,t[w])}self.counter=r.length}YAHOO.util.Dom.setStyle("yui-gen1","position","fixed");document.getElementById("textToFromInput"+numberComposeTab).focus()};compose.prototype.initLabelEditAsNew=function(k,n,c,s,o,g,e,r,d,b){var j=readCookie("user");var a=readCookie("authen");var q=this.widthCompose-82;var p=this.widthCompose-162;var l=this.heightCompose-153;if(document.getElementById("btnBcc")){document.getElementById("btnBcc").value="Hiển thị Bcc"}if(document.getElementById("btnTo")){document.getElementById("btnTo").value="Gửi tới"}if(document.getElementById("sub")){document.getElementById("sub").innerHTML="Chủ đề :"}YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"height",this.heightCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor1"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("toFrom"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("tooBarCompose"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromDiv"),"width",q+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromInput"),"width",q+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromCc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcDiv"),"width",p+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcInput"),"width",q+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor3"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromBcc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccDiv"),"width",q+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccInput"),"width",q+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromSub"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor4"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubDiv"),"width",q+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubInput"),"width",q+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor5"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor6"),"width",this.widthCompose+"px");document.getElementById("textFromSubInput"+numberComposeTab).value=c;if(d){var f=(d.length)*20;tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-160-f,this.widthCompose)}else{tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-160,this.widthCompose)}tinyMCE.execCommand("mceAddControl",true,"contentHtml"+numberComposeTab);document.getElementById("contentHtml"+numberComposeTab).value=o;if(d){for(var h=0;h<d.length;h++){self.insertfileAttach("",r,d[h],h+1,"",numberComposeTab,b[h])}self.counter=d.length+1}YAHOO.util.Dom.setStyle("yui-gen1","position","fixed");document.getElementById("textToFromInput"+numberComposeTab).focus()};compose.prototype.initLabelReplyAll=function(m,n,j,a,c,o,e){var g=readCookie("user");var t=readCookie("authen");var p=getSignature(g,t);var l="";if(p.Body&&p.Body.GetSignaturesResponse&&p.Body.GetSignaturesResponse.signature&&p.Body.GetSignaturesResponse.signature[0].name){if(p.Body.GetSignaturesResponse.signature[0].content&&p.Body.GetSignaturesResponse.signature[0].content[0]._content){l=p.Body.GetSignaturesResponse.signature[0].content[0]._content;l="<br/><br/>"+l}}var d=this.widthCompose-82;var s=this.widthCompose-162;var u=this.heightCompose-153;if(document.getElementById("btnTo")){document.getElementById("btnTo").value="Gửi tới"}if(document.getElementById("sub")){document.getElementById("sub").innerHTML="Chủ đề :"}YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("composeMail"),"height",this.heightCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor1"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("toFrom"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("tooBarCompose"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromDiv"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textToFromInput"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor2"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromCc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcDiv"),"width",s+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromCcInput"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor3"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromBcc"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccDiv"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromBccInput"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("fromSub"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor4"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubDiv"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("textFromSubInput"),"width",d+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor5"),"width",this.widthCompose+"px");YAHOO.util.Dom.setStyle(YAHOO.util.Dom.getElementsByClassName("spaceHor6"),"width",this.widthCompose+"px");var f="";if(m){f+=m}if(n){f+=n}if(!m.indexOf("@")){f+=e}var v="<br><b>Gửi từ  :</b>  <span style='color: blue;'><u>";v+=a+"</u>["+e+"]</span>";var q="<br><b>Gửi lúc :</b>  ";q+=o;var h="<br><b>Gửi tới :</b>  ";h+=f;var i="<br><b>Chủ đề  :</b>  ";i+=j;var r=c;if(j.indexOf("Re :")){document.getElementById("textFromSubInput"+numberComposeTab).value="Re :"+j}else{document.getElementById("textFromSubInput"+numberComposeTab).value=j}document.getElementById("textToFromInput"+numberComposeTab).value=f;var b="<br><span style='color: rgb(139, 0, 0);'><i> ----- Thông điệp gốc : -----</i></span>";b+=v;b+=q;b+=h;b+=i;var k=b+"<br>"+r;tinyMCE.settings=this.tinyMCEsetting(this.heightCompose-160,this.widthCompose);tinyMCE.execCommand("mceAddControl",true,"contentHtml"+numberComposeTab);k=l+k;document.getElementById("contentHtml"+numberComposeTab).value=k;YAHOO.util.Dom.setStyle("yui-gen1","position","fixed");document.getElementById("contentHtml"+numberComposeTab+"_ifr").focus()};compose.prototype.closeTab=function(a){tabView.removeTab(a);tabView.set("activeIndex",0);document.title="Bmail:Inbox"};compose.prototype.insertAttachment=function(f,a,d,b){var h=new YAHOO.widget.Dialog(a,{width:"500px",fixedcenter:true,constraintoviewport:true,modal:true,draggable:true,visible:false,callback:{success:g,failure:c}});var g=function(n){alert("success")};var c=function(n){alert("failure")};var e;var k;function j(){this.cancel()}function l(){var o=new Date();e=o.getTime();pb1=new YAHOO.widget.ProgressBar();pb1.set("value",0);pb1.set("direction","lr");pb1.set("maxValue",1500);pb1.set("width",100);pb1.set("height",13);pb1.set("anim",true);var n=pb1.get("anim");n.duration=30;n.method=YAHOO.util.Easing.easeNone;pb1.render("progressAttach");pb1.set("value",1400);pb1.on("complete",function(p){pb1.destroy();pb1=null});this.submit()}var m=function(x){if(b){if(x.responseText=="<pre></pre>"){new MessageBox("Lỗi","Không attach được")}else{var n=[];var v=x.responseText.split(",");if(v.length>=3){var D=v[2].split("-end of file-");var t=D.length;for(var E=0;E<t-1;E++){self.aidArray.push(D[E])}for(var E=1;E<=t-1;E++){self.insertfileAttach(self.aidArray[E-1],"",0,E,self.aidArray[E-1],d)}}}}else{if(x.responseText=="<pre></pre>"){new MessageBox("Lỗi","Không attach được")}else{var n=[];var D=x.responseText.split(",");var t=D.length;if(t>2){for(var E=2;E<t;E++){n.push(D[E])}}var K=readCookie("user");var I=readCookie("authen");var q=self.getEmailTo(d);var C=tinyMCE.get("contentHtml"+d).getContent();C=C.replace(/</gi,"&lt;");C=C.replace(/>/gi,"&gt;");if(C.indexOf("&nbsp")!=-1){C=C.replace(/&nbsp;/gi,"&#160;")}var w="<mp ct='text/html'><content>"+C+"</content></mp>";if(document.getElementById("textFromSubInput")+d){var r=document.getElementById("textFromSubInput"+d).value}var p=saveDraft(K,I,q,r,w,n);var z=[];z.push("");if(p.Body.SaveDraftResponse&&p.Body.SaveDraftResponse.m&&p.Body.SaveDraftResponse.m[0].mp[0].mp){var J=p.Body.SaveDraftResponse.m[0].id;var u=p.Body.SaveDraftResponse.m[0].cid;var A=p.Body.SaveDraftResponse.m[0].mp[0].mp.length;for(var E=0;E<A;E++){if(p.Body.SaveDraftResponse.m[0].mp[0].mp[E].cd&&p.Body.SaveDraftResponse.m[0].mp[0].mp[E].cd=="attachment"){var G=p.Body.SaveDraftResponse.m[0].mp[0].mp[E].part;z.push(G)}}var F=self.getCounter();for(var E=1;E<=z.length-1;E++){self.insertfileAttach(n[E-1],J,z[E],E,u,d)}}else{if(p.Body&&p.Body.Fault&&p.Body.Fault.Detail&&p.Body.Fault.Detail.Error&&p.Body.Fault.Detail.Error.Code=="mail.MESSAGE_TOO_BIG"){new MessageBox("Lỗi","Attach file không thành công vì kích thước quá lớn")}else{new MessageBox("Lỗi","Attach file không thành công!")}}var H=new Date();k=H.getTime();var s=(k-e)/1000;var B=pb1.get("anim");B.duration=s;B.method=YAHOO.util.Easing.easeNone;var y=pb1.get("maxValue");pb1.set("value",y)}}};h.callback.upload=m;var i=[{text:"Đính kèm",handler:l,isDefault:true},{text:"Đóng lại",handler:j}];h.cfg.queueProperty("buttons",i);h.setBody(f);h.setHeader("Attach file");h.render(document.body);h.show()};compose.prototype.autoComplete=function(h){this.autoId=h;if(this.autoId=="autoComTo"){var f=document.getElementById("textToFromInput"+numberComposeTab).value;this.temp4=this.temp1}else{if(this.autoId=="autoComCc"){var f=document.getElementById("textFromCcInput"+numberComposeTab).value;this.temp4=this.temp2}else{var f=document.getElementById("textFromBccInput"+numberComposeTab).value;this.temp4=this.temp3}}var c=self.processString(f);var g=readCookie("user");var a=readCookie("authen");if(c==""){if(document.getElementById(this.autoId)){document.getElementById(this.autoId).style.display="none"}}else{var e=autoCompleteRe(g,a,c);if(!e.Body.AutoCompleteResponse.match){if(document.getElementById(this.autoId)){document.getElementById(this.autoId).style.display="none"}}else{for(var d=0;d<this.temp4;d++){self.removeAutoComplete("autoDiv_"+this.autoId+d)}if(this.autoId=="autoComTo"){this.temp1=e.Body.AutoCompleteResponse.match.length}else{if(this.autoId=="autoComCc"){this.temp2=e.Body.AutoCompleteResponse.match.length}else{this.temp3=e.Body.AutoCompleteResponse.match.length}}for(var d=0;d<e.Body.AutoCompleteResponse.match.length;d++){var b=e.Body.AutoCompleteResponse.match[d].email;self.addAutoComplete(b,d)}}}};compose.prototype.addAutoComplete=function(b,c){var a=document.getElementById(this.autoId+this.orderTab);var e=document.createElement("div");e.setAttribute("id","autoDiv_"+this.autoId+c);e.setAttribute("class","autoDiv");e.setAttribute("onclick","self.returnFrom("+c+");");var d=document.createTextNode(b);e.appendChild(d);a.appendChild(e);document.getElementById(this.autoId+this.orderTab).style.display="block"};compose.prototype.removeAutoComplete=function(b){var a=document.getElementById(this.autoId);a.removeChild(document.getElementById(b))};compose.prototype.setOrderTab=function(){this.orderTab=numberComposeTab};compose.prototype.getOrderTab=function(){return this.orderTab};compose.prototype.getCounter=function(){return this.counter};compose.prototype.returnFrom=function(g){var b=0;var f="";var e=self.processStringFrom(document.getElementById("autoDiv_"+this.autoId+g).innerHTML);if(this.autoId=="autoComTo"){var d=document.getElementById("textToFromInput"+numberComposeTab).value}else{if(this.autoId=="autoComCc"){var d=document.getElementById("textFromCcInput"+numberComposeTab).value}else{var d=document.getElementById("textFromBccInput"+numberComposeTab).value}}for(var c=0;c<d.length;c++){if(d[c]==";"){b++}}var a=d.split(";");for(var c=0;c<b;c++){f+=a[c];f+=";"}if(this.autoId=="autoComTo"){document.getElementById("textToFromInput"+numberComposeTab).value=f+e}else{if(this.autoId=="autoComCc"){document.getElementById("textFromCcInput"+numberComposeTab).value=f+e}else{document.getElementById("textFromBccInput"+numberComposeTab).value=f+e}}document.getElementById(this.autoId+numberComposeTab).style.display="none"};compose.prototype.processStringFrom=function(c){var b=c.split(";");var a=b[1].split("&");return(a[0]+";")};compose.prototype.processString=function(d){var a=0;for(var c=0;c<d.length;c++){if(d[c]==";"){a++}}var b=d.split(";");return(b[a])};compose.prototype.addAttachmentElement=function(h){var a=document.getElementById("insertAttach");var d=document.getElementById("AttachTab_"+h).value;this.counter++;d++;document.getElementById("AttachTab_"+h).value=d;document.getElementById("insertAttach").value=d;var c=document.createElement("div");c.setAttribute("id","attachment_"+d);c.setAttribute("class","attachment");var g=document.createElement("label");g.innerHTML="Attach : ";c.appendChild(g);var f=document.createElement("input");f.setAttribute("type","file");f.setAttribute("size","30");f.setAttribute("id","file_"+d+"_"+h);f.setAttribute("name","file_"+d+"_"+h);c.appendChild(f);var b=document.createElement("a");b.setAttribute("href","");b.setAttribute("onclick","self.removeAttachmentElement("+d+");return false;");var e=document.createElement("img");e.setAttribute("id","RemoveButton_"+d);e.setAttribute("src","resources/attach/minusButton.png");e.setAttribute("alt","Remove");b.appendChild(e);c.appendChild(b);a.appendChild(c)};compose.prototype.removeAttachmentElement=function(b){this.counter--;var a=document.getElementById("insertAttach");a.removeChild(document.getElementById("attachment_"+b))};compose.prototype.getEmailTo=function(f){var m=document.getElementById("textToFromInput"+f).value;var d=document.getElementById("textFromCcInput"+f).value;var h=document.getElementById("textFromBccInput"+f).value;var a=0;var g=0;var l=0;if(m==""){a=0}else{if(m.indexOf(";")!=-1){var j=m.split(";");a=j.length}else{a=1}}if(d==""){g=0}else{if(d.indexOf(";")!=-1){var b=d.split(";");g=b.length}else{g=1}}if(document.getElementById("fromBcc"+f).style.display=="none"){l=0}else{if(h==""){l=0}else{if(h.indexOf(";")!=-1){var k=h.split(";");l=k.length}else{l=1}}}if(a!=0){var c=readCookie("user");var n="<e t='f' a='"+c+"' p='"+displayName+"' />";if(m.indexOf(";")!=-1){n+="<e t='t' a='"+j[0]+"'/>"}else{n+="<e t='t' a='"+m+"'/>"}if(a>1){for(var e=1;e<a;e++){if(m.indexOf(";")!=-1){n+="<e t='t' a='"+j[e]+"'/>"}else{n+="<e t='t' a='"+m+"'/>"}}}if(d.indexOf(";")!=-1){for(var e=0;e<g;e++){n+="<e t='c' a='"+b[e]+"'/>"}}else{if(g!=0){n+="<e t='c' a='"+d+"'/>"}}if(h.indexOf(";")!=-1){for(var e=0;e<l;e++){n+="<e t='b' a='"+k[e]+"'/>"}}else{if(l!=0){n+="<e t='b' a='"+h+"'/>"}}return n}else{return""}};var getImgFromFileName=function(d){var b=d.lastIndexOf(".");var c=d.substr(b+1);c=c.toLowerCase();var a="";switch(c){case"exe":a="exe";break;case"xls":a="excel";break;case"doc","odt","docx":a="word";break;case"dll":a="dll";break;case"ini":a="ini";break;case"pdf":a="pdf";break;case"cut","bmp","dds","g3","gif","hdr","ico","iff","lbm","j2k","j2c","jng","jp2","jpg","jif","jpeg","jpe","pic":a="img";break;case"psd":a="psd";break;case"zip","rar","7z":a="zip";break;case"htm","html":a="htm";break;case"bat":a="bat";break;default:a="default"}return"resources/mail/"+a+".png"};compose.prototype.insertfileAttach=function(f,v,n,q,h,r,o,p){if(o){x=o}else{if(navigator.appName=="Microsoft Internet Explorer"){var t=document.getElementById("file_"+q+"_"+r);var x=t.value}else{var x=document.getElementById("file_"+q+"_"+r).files[0].fileName}}if(x!=""){if(navigator.appName=="Netscape"){document.getElementById("contentHtml"+r+"_tbl").style.height=(YAHOO.util.Dom.getRegion("contentHtml"+r+"_tbl").height-20)+"px";document.getElementById("contentHtml"+r+"_ifr").style.height=(YAHOO.util.Dom.getRegion("contentHtml"+r+"_ifr").height-20)+"px"}if(document.getElementById("fileAttach"+r)){var k=document.getElementById("fileAttach"+r)}var c=document.createElement("div");c.setAttribute("id","imageAttach_"+q);c.setAttribute("style","padding-left:2px;");var l=document.createElement("img");var e=getImgFromFileName(x);alert(e);l.setAttribute("src","resources/mail/attach.gif");c.appendChild(l);var s=document.createElement("input");s.setAttribute("type","checkbox");s.setAttribute("id","checkBox_"+q+"_"+r);s.setAttribute("checked","true");if(p){s.setAttribute("readonly","readonly")}c.appendChild(s);var w=document.createElement("a");var d=document.createTextNode(x);w.appendChild(d);c.appendChild(w);var j=document.createElement("input");j.setAttribute("type","hidden");j.setAttribute("id","attach_"+q);j.setAttribute("value",f);c.appendChild(j);var u=document.createElement("input");u.setAttribute("type","hidden");u.setAttribute("id","filename_"+q);u.setAttribute("value",x);c.appendChild(u);var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("id","mid_"+q+"_"+r);b.setAttribute("value",v);c.appendChild(b);var m=document.createElement("input");m.setAttribute("type","hidden");m.setAttribute("id","cid_"+q+"_"+r);m.setAttribute("value",h);c.appendChild(m);var g=document.createElement("input");g.setAttribute("type","hidden");g.setAttribute("id","part_"+q+"_"+r);g.setAttribute("value",n);c.appendChild(g);k.appendChild(c)}};compose.prototype.attachFile=function(f,c){var e=readCookie("ipServer");var b="http://"+e+"/service/upload?fmt=raw";var d="http://"+e+"/service/upload?fmt=base64";var a='<form id = "uploadForm" name ="uploadForm" method="POST" ENCTYPE="multipart/form-data" action="">';a+='<div id="insertAttach"><input type="hidden" value="1" id="attachment_counter" />';a+='<div id="attachment_1" class="attachment" ><label>Attach : </label><input type="file" size="30" id="file_1_'+f+'" name="file_1" /></a></div></div>';a+='<p href="" id="Add_'+f+'"><img id="AddButton_1" src="resources/attach/plusButton.png";" alt="Add" style="float:left" /></p><input type="hidden" value="'+1+'" id="AttachTab_'+f+'" />';a+='<input type="hidden" name="requestId" value="my_first_attachment" />\n			</form>';YAHOO.util.Event.on("Add_"+f,"click",function(){self.addAttachmentElement(f);return false});self.insertAttachment(a,"attach",f,c);if(c){document.getElementById("uploadForm").action=d}else{document.getElementById("uploadForm").action=b}};compose.prototype.getSubject=function(b){var a="";if(document.getElementById("textFromSubInput"+b)){a=document.getElementById("textFromSubInput"+b).value}return a};compose.prototype.sendMessenger=function(D,G,u){var A=readCookie("user");var x=readCookie("authen");var w=self.getSubject(D);var N=self.getEmailTo(D);var m=tinyMCE.get("contentHtml"+D).getContent();var s="<mp ct='text/html'><content>"+m+"</content></mp>";var g=self.getSubject(D);var M=document.getElementById("textToFromInput"+D).value;if(M==""){new MessageBox("Lỗi","Bạn phải nhập địa chỉ người nhận")}else{var r=[];if(document.getElementById("mid_1_"+D)){var f=document.getElementById("mid_1_"+D)}if(f){var b=f.value;var l=document.getElementById("cid_1_"+D).value;if(b){for(var J=1;J<=this.counter;J++){if(document.getElementById("checkBox_"+J+"_"+D)){var d=document.getElementById("checkBox_"+J+"_"+D);if(d.checked==true){var e=document.getElementById("part_"+J+"_"+D).value;r.push(e)}}}}}if(!m){var O=confirm("Bạn vẫn muốn gửi thư không có nội dung!");if(O==true){if(g==""){var p=confirm("Bạn vẫn muốn gửi thư không có tiêu đề");if(p==true){var q="<mp ct='multipart/alternative'><mp ct='text/plain'><content></content></mp><mp ct='text/html'><content></content></mp></mp>";if(b&&r){if(G){var o=addMessage(A,x,N,g,q,b,r,G)}else{var o=getCompose(A,x,N,g,q,b,r)}deleteM(A,x,l)}else{if(G){var o=addMessage(A,x,N,g,q,G)}else{var o=getCompose(A,x,N,g,q)}if(o.Body&&o.Body.SendMsgResponse&&o.Body.SendMsgResponse.m){self.removeTab()}else{new MessageBox("Lỗi","Gửi thất bại")}}}else{var q="<mp ct='multipart/alternative'><mp ct='text/plain'><content></content></mp><mp ct='text/html'><content></content></mp></mp>";if(b&&r){if(G){var o=addMessage(A,x,N,g,q,G,b,r)}else{var o=getCompose(A,x,N,g,q,b,r)}if(o.Body&&o.Body.SendMsgResponse&&o.Body.SendMsgResponse.m){self.removeTab();deleteM(A,x,l)}}else{if(G){var o=addMessage(A,x,N,g,q,G)}else{var o=getCompose(A,x,N,g,q)}}if(o.Body&&o.Body.SendMsgResponse&&o.Body.SendMsgResponse.m){self.removeTab()}else{new MessageBox("Lỗi","Gửi thất bại")}}}else{var q="<mp ct='multipart/alternative'><mp ct='text/plain'><content></content></mp><mp ct='text/html'><content></content></mp></mp>";if(b&&r){if(G){var o=addMessage(A,x,N,g,q,G,b,r)}else{var o=getCompose(A,x,N,g,q,b,r)}if(o.Body&&o.Body.SendMsgResponse&&o.Body.SendMsgResponse.m){self.removeTab();deleteM(A,x,l)}}else{if(G){var o=addMessage(A,x,N,g,q,G)}else{var o=getCompose(A,x,N,g,q)}}if(o.Body&&o.Body.SendMsgResponse&&o.Body.SendMsgResponse.m){self.removeTab()}else{new MessageBox("Lỗi","Gửi thất bại")}}}}else{var K="<html><head></head><body><div>"+m+"</div></body></html>";if(arrayInline.length!=0){var B=readCookie("ipServer");if(K.indexOf("%7E")!=-1){K=K.replace(/%7E/gi,"~")}if(K.indexOf("&amp;")!=-1){K=K.replace(/&amp;/gi,"&")}var n=arrayInline.length;for(var H=0;H<n;H++){var y=arrayInline[H].path;var a=arrayInline[H].ci;if(K.indexOf(y)!=-1){K=K.replace(y,a)}}}if(g==""){var p=confirm("Bạn vẫn muốn gửi thư không có tiêu đề");if(p==true){var C=K.replace(/</gi,"&lt;");var z=C.replace(/>/gi,"&gt;");var q="<mp ct='multipart/alternative'><mp ct='text/plain'><content></content></mp><mp ct='multipart/related'><mp ct='text/html'><content>"+z+"</content></mp>";q=q+"</mp></mp>";if(G){if(self.aidArray.length>0){var L=document.getElementById("cid_1").value;var F=L.replace("<pre>","");var E=F.replace("</pre>","");for(var J=1;J<=self.counter;J++){var d=document.getElementById("checkBox_"+J);if(d.checked==true){var v=document.getElementById("filename_"+J).value}}var I=addMessage(A,x,A,g,m,z,G,u,v,E);if(I.Body&&I.Body.AddMsgResponse&&I.Body.AddMsgResponse.m){self.removeTab()}else{if(I.Body&&I.Body.Fault&&I.Body.Fault.Detail&&I.Body.Fault.Detail.Error&&I.Body.Fault.Detail.Error.Code=="service.PERM_DENIED"){new MessageBox("Lỗi","Bạn không có quyền gửi thư lên folder này")}else{new MessageBox("Lỗi","Gửi thất bại")}}}else{var I=addMessage(A,x,A,g,m,z,G,u);if(I.Body&&I.Body.AddMsgResponse&&I.Body.AddMsgResponse.m){self.removeTab()}else{if(I.Body&&I.Body.Fault&&I.Body.Fault.Detail&&I.Body.Fault.Detail.Error&&I.Body.Fault.Detail.Error.Code=="service.PERM_DENIED"){new MessageBox("Lỗi","Bạn không có quyền gửi thư lên folder này")}else{new MessageBox("Lỗi","Gửi thất bại")}}}}else{if(b&&r){var I=getCompose(A,x,N,g,s,b,r);if(I.Body&&I.Body.SendMsgResponse&&I.Body.SendMsgResponse.m){self.removeTab();deleteM(A,x,l)}else{new MessageBox("Lỗi","Gửi thất bại")}}else{var I=getCompose(A,x,N,g,q,false);if(I.Body&&I.Body.SendMsgResponse&&I.Body.SendMsgResponse.m){self.removeTab()}else{new MessageBox("Lỗi","Gửi thất bại")}}}}}else{var C=K.replace(/</gi,"&lt;");var z=C.replace(/>/gi,"&gt;");if(z.indexOf("&nbsp")!=-1){z=z.replace(/&nbsp;/gi,"&#160;")}var q="<mp ct='multipart/alternative'><mp ct='text/plain'><content></content></mp><mp ct='multipart/related'><mp ct='text/html'><content>"+z+"</content></mp>";if(arrayInline.length==0){q=q+"</mp></mp>"}else{var n=arrayInline.length;for(var k=0;k<n;k++){var a=arrayInline[k].ci;a=a.substring(4,a.length);var t=arrayInline[k].id;var c=arrayInline[k].part;var h="<mp ci='"+a+"'><attach>";h=h+"<mp mid='"+t+"' part='"+c+"' /></attach></mp>";q+=h}q=q+"</mp></mp>"}if(G){if(self.aidArray.length>0){var L=document.getElementById("cid_1_"+D).value;var F=L.replace("<pre>","");var E=F.replace("</pre>","");var v=[];for(var J=1;J<=this.counter;J++){if(document.getElementById("checkBox_"+J+"_"+D)){var d=document.getElementById("checkBox_"+J+"_"+D);if(d.checked==true){v.push(document.getElementById("filename_"+J).value)}}}var I=addMessage(A,x,A,g,m,z,G,u,v,self.aidArray);if(I.Body&&I.Body.AddMsgResponse&&I.Body.AddMsgResponse.m){self.removeTab()}else{if(I.Body&&I.Body.Fault&&I.Body.Fault.Detail&&I.Body.Fault.Detail.Error&&I.Body.Fault.Detail.Error.Code=="service.PERM_DENIED"){new MessageBox("Lỗi","Bạn không có quyền gửi thư lên folder này")}else{new MessageBox("Lỗi","Gửi thất bại")}}}else{var I=addMessage(A,x,A,g,m,z,G,u);if(I.Body&&I.Body.AddMsgResponse&&I.Body.AddMsgResponse.m){self.removeTab()}else{if(I.Body&&I.Body.Fault&&I.Body.Fault.Detail&&I.Body.Fault.Detail.Error&&I.Body.Fault.Detail.Error.Code=="service.PERM_DENIED"){new MessageBox("Lỗi","Bạn không có quyền gửi thư lên folder này")}else{new MessageBox("Lỗi","Gửi thất bại")}}}}else{if(b&&r){var I=getCompose(A,x,N,g,q,b,r);if(I.Body&&I.Body.SendMsgResponse&&I.Body.SendMsgResponse.m){self.removeTab();deleteM(A,x,l)}else{new MessageBox("Lỗi","Gửi thất bại")}}else{var I=getCompose(A,x,N,g,q,false);if(I.Body&&I.Body.SendMsgResponse&&I.Body.SendMsgResponse.m){self.removeTab()}else{new MessageBox("Lỗi","Gửi thất bại")}}}}}}};compose.prototype.mouseOverCloseTab=function(a){a.style.height="11px"};compose.prototype.mouseOutCloseTab=function(a){a.style.height="10px"};compose.prototype.removeTab=function(){tabView.removeTab(tabView.get("activeTab"));tabView.set("activeIndex",0);document.title="Bmail:Inbox"};compose.prototype.generateBoundary=function(){return""+(new Date).getTime()};compose.prototype.tinyMCEsetting=function(b,c,a){readOnly=false;if(a){readOnly=a}var d={theme:"advanced",mode:"none",language:"en",skin:"o2k7",skin_variant:"silver",plugins:"table, print, emotions, inlinepopups",dialog_type:"modal",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_layout_manager:"SimpleLayout",theme_advanced_buttons1:"fontselect,fontsizeselect,separator,bold,italic,underline,strikethrough,separator, forecolor,backcolor,numlist, bullist, separator,outdent,indent,justifyleft,justifycenter,justifyright,justifyfull, print,image,link, emotions,table, row_props,cell_props, delete_col, delete_row, delete_table, col_after, col_before, row_after, row_before, split_cells, merge_cells",theme_advanced_buttons2:"",theme_advanced_buttons3:"",height:b,width:c,entity_encoding:"raw",force_br_newlines:true,force_p_newlines:false,forced_root_block:"",readonly:readOnly};return d};