function Util(){}function partition(n,t,i,r){var e=recentlyAddress[r].count,u,f;for(n.swap(r,i-1),u=t,f=t;f<i-1;++f)n[f].count<=e&&(n.swap(u,f),++u);return n.swap(i-1,u),u}function qsort(n,t,i){if(i-1>t){var r=t+Math.floor(Math.random()*(i-t));r=partition(n,t,i,r);qsort(n,t,r);qsort(n,r+1,i)}}function insertImage(n){var i=document.selection,t;i?(t=i.createRange(),document.execCommand("insertImage",!1,n),t.collapse(!1),t.select()):document.execCommand("insertImage",!1,n)}function insertLink(n){var i=document.selection,t;i?(t=i.createRange(),document.execCommand("createLink",!1,n),t.collapse(!1),t.select()):document.execCommand("createLink",!1,n)}function insertHtml(n){var i=document.selection,t;i?(t=i.createRange(),document.execCommand("insertHTML",!1,n),t.collapse(!1),t.select()):document.execCommand("insertHTML",!1,n)}function configMessage(n){var t,i,r,u;return n.indexOf("http://www.youtube.com/watch")!=-1&&(i=n.substring(n.indexOf("http://www.youtube.com/watch")),t=i.indexOf(" ")!=-1?i.substring(0,i.indexOf(" ")):i,r=t.indexOf("&")!=-1?t.substring(t.indexOf("=")+1,t.indexOf("&")):t.substring(t.indexOf("=")+1),r.length>6&&r.length<15&&(u="http://www.youtube.com/embed/"+r,n=n.replace(t,u))),n=n.replaceAll("<br>","<br/>"),n.lastIndexOf("<br>")!=-1&&n.lastIndexOf("<br>")==n.length-4&&(n=n.substring(0,n.length-4)),n.lastIndexOf("<br/>")!=-1&&n.lastIndexOf("<br/>")==n.length-5&&(n=n.substring(0,n.length-5)),n.lastIndexOf("<br>")!=-1&&n.lastIndexOf("<br>")==n.length-4&&(n=n.substring(0,n.length-4)),n.lastIndexOf("<br/>")!=-1&&n.lastIndexOf("<br/>")==n.length-5&&(n=n.substring(0,n.length-5)),n.lastIndexOf("<br>")!=-1&&n.lastIndexOf("<br>")==n.length-4&&(n=n.substring(0,n.length-4)),n.lastIndexOf("<br/>")!=-1&&n.lastIndexOf("<br/>")==n.length-5&&(n=n.substring(0,n.length-5)),n}function reVertImg(n){var e=getIcon(),o=getIconImg(),t,u,f,n,r;if(n=n.replaceAll("<IMG","<img"),t=n.split("<img"),t.length>1){for(u="",i=0;i<t.length;i++){if(t[i].indexOf("jsmobile/emoticon/")!=-1&&(f=t[i].indexOf(">"),f!=-1))for(n=t[i].substr(0,f+1),j=e.length-1;j>=0;j--)if(t[i].indexOf(o[j])!=-1){r=e[j].replaceAll("<","&lt;");r=r.replaceAll(">","&gt;");t[i]=t[i].replace(n,r);break}u+=t[i]}n=u}return n}function convertImg(n){var i,r,t;for(typeof n!="string"&&Object.prototype.toString.call(n)==="[object Array]"&&(n=n.join("")),i=getIcon(),r=getIconImg(),t=0;t<i.length;t++)n=n.replaceAll("&gt;",">"),n=n.replaceAll("&lt;","<"),n=n.replaceAll(i[t],"<img src='https://"+readCookie("ipServer")+"/mail/jsmobile/emoticon/"+r[t]+"' />");return n}function getIconImg(){return["11.gif","12.gif","13.gif","14.gif","21.gif","22.gif","23.gif","24.gif","31.gif","32.gif","33.gif","34.gif","41.gif","42.gif","43.gif","44.gif"]}function getIcon(){return[":-*","=((",":-O","X(",":))","#:-S",":-S",":((","/:)",":(",":P","=))",":)",":|",":>","B-)"]}function removeTag(n){for(var u,t=n.split("<"),r=t[0],i=1;i<t.length;i++)u=t[i].substring(t[i].lastIndexOf(">")),r+=u;return r.replaceAll(">","")}function regMess(n){var s,r,u,e,o,f,t;if(n=convertImg(n),n=="")return"";if(typeof n!="string")return n;for(n=n.replace("http://youtu.be/","http://www.youtube.com/embed/"),n.indexOf("http://www.youtube.com/watch")!=-1?(u=n.substring(n.indexOf("http://www.youtube.com/watch")),r=u.indexOf(" ")!=-1?u.substring(0,u.indexOf(" ")):u,f=r.indexOf("&")!=-1?r.substring(r.indexOf("=")+1,r.indexOf("&")):r.substring(r.indexOf("=")+1),f.length>6&&f.length<15&&(s="http://www.youtube.com/embed/"+f,n=n.replace(r,'<iframe width="420" height="315" src="'+s+'" frameborder="0" allowfullscreen><\/iframe>'))):n.indexOf("http://www.youtube.com/embed")!=-1&&(u=n.substring(n.indexOf("http://www.youtube.com/")),r=u.indexOf(" ")!=-1?u.substring(0,u.indexOf(" ")):u,f=r.substring(r.indexOf("ed/")+3),f.length>6&&f.length<15&&(n=n.replace(r,'<iframe width="420" height="315" src="'+r+'" frameborder="0" allowfullscreen><\/iframe>'))),arr=n.split("http"),e=!1,i=1;i<arr.length;i++)arr[i]="http"+arr[i],o=!0,arr[i-1].lastIndexOf("<a ")!=-1&&arr[i-1].lastIndexOf("<a ")>arr[i-1].lastIndexOf("<\/a")&&(e=!0),arr[i-1].length>5&&(f=arr[i-1].substring(arr[i-1].length-5),f.indexOf("=")!=-1&&(o=!1)),o&&(t=arr[i].indexOf(" ")!=-1?arr[i].substring(0,arr[i].indexOf(" ")):arr[i],t.lastIndexOf(".")==t.length&&(t=t.substring(0,t.length)),t.indexOf(".")>0&&t.indexOf("://")!=-1&&(t.lastIndexOf("<")!=-1&&(t=t.substring(0,t.lastIndexOf("<"))),e||(arr[i]=arr[i].replace(t,'<a target="_blank" href="'+t+'">'+t+"<\/a>")))),arr[i].indexOf("<\/a")!=-1&&(e=!1);for(n=arr[0],i=1;i<arr.length;i++)n+=arr[i];return n}function setCaret(n,t){var i=document.getElementById(n),r=document.createRange(),f=window.getSelection(),o,e,u;if(i.childNodes[0]){if(o=t[0].caretPos,e=t[0].anchorNode,e&&e.id==n)r.setStart(i,o),r.collapse(!0),f.removeAllRanges(),f.addRange(r),i.focus();else for(u=0;u<i.childNodes.length;u++)i.childNodes[u]==e&&(r.setStart(i.childNodes[u],o),r.collapse(!0),f.removeAllRanges(),f.addRange(r),i.focus());return!0}return!1}function getCaretPosition(n){var i=0,r,t,e=null,o=[],f,u;return window.getSelection?(r=window.getSelection(),r.rangeCount&&(t=r.getRangeAt(0),e=r.anchorNode,t.commonAncestorContainer.parentNode.id=="mailBody"?i=t.endOffset:t.commonAncestorContainer.parentNode.id=="MailContent"?i=t.endOffset:t.commonAncestorContainer.parentNode==n&&(i=t.endOffset))):document.selection&&document.selection.createRange&&(t=document.selection.createRange(),t.parentElement()==n&&(f=document.createElement("span"),n.insertBefore(f,n.firstChild),u=t.duplicate(),u.moveToElementText(f),u.setEndPoint("EndToEnd",t),i=u.text.length)),o.push({caretPos:i,anchorNode:e}),o}function showReconnect(n){var t=!1;n.readyState==4&&n.status==0&&(t=!0);t}var noDuplicateNumber=0,displayAddress="addr_",autoComplete="auto_";Util.getRequest=function(){var n=null;if(window.XMLHttpRequest)n=new XMLHttpRequest;else try{n=new ActiveXObject("MSXML2.XMLHTTP3.0")}catch(t){return null}return n};Util.makeJsonHeader=function(n){var t={context:{_jsns:"urn:zimbra",session:sessionId,userAgent:{name:navigator.userAgent,version:"Bmail 7.0.2"},account:{_content:Util.readCookie("user"),by:"name"},authToken:Util.readCookie("authen")}};n.Header=t};Date.prototype.getVNDay=function(){switch(this.getDay()){case 1:return getResource("egov.resources.time.mon");case 2:return getResource("egov.resources.time.tue");case 3:return getResource("egov.resources.time.wed");case 4:return getResource("egov.resources.time.thi");case 5:return getResource("egov.resources.time.fri");case 6:return getResource("egov.resources.time.sat");default:return getResource("egov.resources.time.sun")}};Util.prettyDate=function(n){var t,i;n=new Date(n);t=n.getHours();i=n.getMinutes();t<10&&(t="0"+t);i<10&&(i="0"+i);var u=new Date,r=(u.getTime()-n.getTime())/1e3,f=Math.floor(r/86400);return f===0&&n.getDate()===u.getDate()?r<120?"1"+egov.resources.time.minbefore:r<3600?Math.floor(r/60)+egov.resources.time.minbefore:t+":"+i:n.getDate()+"/"+n.getMonth()};Util.convertTime=function(n,t){var i=new Date(n),o=new Date,e=i.getHours(),r,u,f;return(e<10&&(e="0"+e),r=i.getMinutes(),r<10&&(r="0"+r),u=i.getMonth()+1,u<10&&(u="0"+u),f=i.getDate(),f<10&&(f="0"+f),!t&&o.getFullYear()==i.getFullYear()&&o.getMonth()==i.getMonth()&&o.getDate()-i.getDate()==0)?e+":"+r:f+"/"+u+"/"+i.getFullYear()};Util.convertDetailTime=function(n){var r=new Date(n),i=r.getHours(),t;return i<10&&(i="0"+i),t=r.getMinutes(),t<10&&(t="0"+t),i+":"+t+" "+Util.convertTime(n,!0)};Util.getDate=function(n){var t=new Date(n);return t.getDate()};Util.getMonth=function(n){var t=new Date(n);return t.getMonth()+1};Util.getFullYear=function(n){var t=new Date(n);return t.getFullYear()};Util.getHours=function(n){var t=new Date(n);return t.getHours()};Util.getMinutes=function(n){var t=new Date(n);return t.getMinutes()};Util.getTime=function(n){return typeof n=="number",new Date};Util.isUndefined=function(n){return typeof n=="undefined"?!0:!1};Util.getAddress=function(n){var t=[];return $(n).children("#displayAddress").each(function(){t.push($(this).text())}),t.join(";")};Util.getAddressToSend=function(){};Util.displayBubbleAddress=function(n){for(var t=[],i=0;i<n.length;i++)noDuplicateNumber++,t.push("<div id='displayAddress'"),t.push(" class='"),t.push(displayAddress+noDuplicateNumber),t.push("'>"),n[i].indexOf("gmail",0)!=-1?t.push("<img src='/mail/cssmobile/images/google.png' id='logo-service'/>"):n[i].indexOf("yahoo",0)!=-1&&t.push("<img src='/mail/cssmobile/images/yahoo.png' id='logo-service'/>"),t.push(n[i]),t.push("<\/div>");return t.join("")};Util.searchContact=function(n,t,i){var u,f,r;for(console.log(i),u=0,f=[],r=0;r<n.length;r++)if((n[r].name.indexOf(i,0)!=-1||n[r].email.indexOf(i,0)!=-1)&&(f.push({id:n[r].id,name:n[r].name==""?n[r].email:n[r].name,email:n[r].email}),u++),u==t)break;return f};Util.checkNewChatArr=function(n){var i,t,r;if(newChatAddress&&newChatAddress.length==0)return-1;for(i=-1,t=0;t<newChatAddress.length;t++)if(r=newChatAddress[t].from,r==n){i=t;break}return i};Util.updateNoti=function(){var n=newChatAddress.length;n!=0?($(".chatNoti").css({display:"block"}),$(".chatNoti").length>0&&$(".chatNoti").html(n)):$(".chatNoti").css({display:"none"})};Util.updateFriendStatus=function(n,t){var i,r;if(friendListChat.length>0)for(i=0;i<friendListChat.lenght;i++)if(r=friendListChat[i].address,r==n){friendListChat[i].show=t;break}};Util.updateAvatar=function(n,t){var i,r;if(friendListChat.length>0)for(i=0;i<friendListChat.lenght;i++)if(r=friendListChat[i].address,r==n){friendListChat[i].avatarHash=t;break}};Util.sortRecentlyArray=function(){recentlyAddress.length>1&&qsort(recentlyAddress,0,recentlyAddress.length)};Array.prototype.swap=function(n,t){var i=this[n];this[n]=this[t];this[t]=i};Util.checkExistItem=function(n,t){var r,i;if(n.length==0)return-1;for(r=-1,i=0;i<n.length;i++)if(n[i]==t){r=i;break}return r};Util.updateNewChatArr=function(n,t){if(newChatAddress&&newChatAddress.length>0){var i=Util.checkNewChatArr(n);i!=-1&&(newChatAddress[i].message=t)}};Util.removeNewChatItem=function(n){var r,i,t,u;if(newChatAddress&&newChatAddress.length>0){if(r=Util.checkNewChatArr(n),r!=-1)for(i=[],t=0;t<newChatAddress.length;t++)u=newChatAddress[t].from,u!=n&&i.push(newChatAddress[t]);newChatAddress=i}};Util.getCookie=function(n){var t="";return n.AuthResponse&&n.AuthResponse.authToken&&(t=n.AuthResponse.authToken[0]._content),t};Util.readCookie=function(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return null};Util.createCookie=function(n,t,i){var u,r;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="";document.cookie=n+"="+t+u+"; path=/"};Util.removeCookie=function(n,t){Util.createCookie(n,"",-1,t)};Util.isValidEmail=function(n){var i,r,t;if(n=="")return!0;for(i=n.split(";"),r=new RegExp(/^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i),t=0;t<i.length;t++)if(i[t]=="")i.splice(t,1);else if(!r.test(i[t]))return alert(n[t]+": not an valid email"),!1;return!0};Util.needToSendAutoComplete=function(n,t,i){var u=[],r;if(n!=186||n!=13){if(i!=";"||i!=","||i!="["||i!="]"){if(t.length>0&&n!=8){if(Util.isUndefined(autoCompleteResult))return console.log("6"),!1;for(r=0;r<autoCompleteResult.length;r++)(autoCompleteResult[r].email.indexOf(t,0)!=-1||autoCompleteResult[r].name.indexOf(t,0)!=-1)&&u.push({email:autoCompleteResult[r].email,name:autoCompleteResult[r].name,ranking:autoCompleteResult[r].ranking});return u.length!=0?(stillNeedToAutoComplete=!1,autoCompleteResult.length=0,autoCompleteResult=u,!1):!0}return!0}return console.log("4"),!0}return!0};Util.getFolderById=function(n,t){var r=null,u=n.length,i,f;if(u>0)for(i=0;i<u;i++)if(f=n[i].id,f==t){r=n[i];break}return r};Util.updateFolderList=function(n,t,i,r){var o=n.length,u,f,s,e;if(o>0)for(u=0;u<o;u++)if(f=n[u],s=f.id,s==t){for(e in f)e==i&&(f[e]=r);break}};Util.pageLogout=function(){var n=window.location.host;Util.createCookie("authen","",-1)};Util.getUrl=function(){return window.location.protocol+"//"+window.location.host+"/mail/"};Util.getUrlParam=function(n){var t=new RegExp(n+"=([^&]*)","i").exec(window.location.search);return t&&t[1]||""};Util.sendPullRequest=function(n){var t=new SOAPRequest,i=[];t.makeHeader(i,"js");t.makeNoOpRequest(i,"NoOpRequest","zimbraMail");t.sendRequest("NoOpRequest",i,n)};Util.makeClassForLi=function(n){return n=n.replace(/\@/g,""),n=n.replace(/\./g,""),n.replace(/\%/g,"")};Util.makeAvatar=function(n,t,i,r,u){var e="",f;if(r=="bmail"){for(f=0;f<bads.length;f++)if(i==bads[f].addr){e=bads[f].link;break}}else if(r=="yahoo"){for(f=0;f<yads.length;f++)if(i==yads[f].addr){e=yads[f].link;break}}else if(r=="facebook"){for(f=0;f<fads.length;f++)if(i==fads[f].addr){e=fads[f].link;break}}else if(r=="gtalk")for(f=0;f<gads.length;f++)if(i==gads[f].addr){e=gads[f].link;break}u!=""?(n.push("<img class='"),n.push(u),n.push("' "),n.push("src='")):n.push("<img src='");e==""?n.push("/mail/cssmobile/images/unknow.png"):n.push("https://"+window.location.host+"/mail/"+e);n.push("' width='");n.push(t);n.push("' />")};Util.improveClickEvent=function(){var n=$.hasData(document)&&$._data(document).events.click,t;n=$.extend(!0,{},n);$(document).off("click");for(t in n){console.log(n[t]);$(document).on("vclick",n[t].handler)}};Util.makeUrlParameters=function(n){for(var r="",i=Object.keys(n),t=0;t<i.length;t++)r+="&"+i[t]+"="+n[i[t]];window.history.pushState("ducla","Hop thu","/mail/Tablet/index.html?"+r)};Util.updateDataForPage=function(n,t){var o=$("#bmailChat > li").map(function(){return this.id}).get(),r,u,f,i,e,s;if(t=="msg")for(r=0;r<o.length;r++)u="#"+o[r],i=$("#bmailChat").children(u).html(),f=$("#bmailChat").children(u).attr("name"),Util.isUndefined(n[f])&&(n[f]=""),e=i.indexOf("<\/h5>")+5,s=i.substring(0,e)+"<p style='white-space:nowrap'>"+n[f]+"<\/p>"+i.substring(e,i.length),$("#bmailChat").children(u).html(s);else t=="avatar"};Util.getPartList=function(){return[]};Util.saveDraft=function(user,authen,emailTo,subject,multipart,attachId,idMailDraft,idnt,irt,midPart,isAttaching){var aid="",l,i,len,url,soapCompose,_l,t,http,responseJson;if(attachId)if(l=attachId.length,l==1)len=attachId[0].length,aid+=attachId[0].substring(1,len-1);else for(i=0;i<l;i++)len=attachId[i].length,i==0&&(attachId[i]=attachId[i].substring(1,len)),i==l-1&&(attachId[i]=attachId[i].substring(0,len-1)),attachId[i]+=",",aid+=attachId[i];if(url=egov.connections.BmailLink+"/service/soap",soapCompose="<soap:Envelope xmlns:soap='http://www.w3.org/2003/05/soap-envelope'>",soapCompose+="<soap:Header>",soapCompose+="<context xmlns='urn:zimbra'>",soapCompose+="<format type='js'/>",soapCompose+="<account by='name'>"+user+"<\/account>",soapCompose+="<authToken>"+authen+"<\/authToken>",soapCompose+="<\/context>",soapCompose+="<\/soap:Header>",soapCompose+="<soap:Body>",soapCompose+="<SaveDraftRequest xmlns='urn:zimbraMail'>",soapCompose+=idMailDraft&&idMailDraft!=""?idnt?"<m id='"+idMailDraft+"' idnt='"+idnt+"'>":"<m id='"+idMailDraft+"' >":"<m>",emailTo&&(soapCompose+=emailTo),soapCompose+="<su>"+subject+"<\/su>",multipart&&(soapCompose+=multipart),midPart&&midPart.length>0){if(soapCompose+=aid||isAttaching?"<attach aid='"+aid+"'>":"<attach>",_l=midPart.length,idMailDraft)for(t=0;t<_l;t++)soapCompose+="<mp mid='"+idMailDraft+"' part='"+midPart[t]+"' />";soapCompose+="<\/attach>"}else aid&&(soapCompose+="<attach aid='"+aid+"'><\/attach>");return irt&&(soapCompose+="<irt>"+irt+"<\/irt>"),soapCompose+="<\/m>",soapCompose+="<\/SaveDraftRequest>",soapCompose+="<\/soap:Body>",soapCompose+="<\/soap:Envelope>",http=Util.getRequest(),http.open("POST",url,!1,"SaveDraftRequest"),http.send(soapCompose),responseJson="error",eval("("+http.responseText+")")};Util.getRequest=function(){var n;if(window.ActiveXObject)try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}else window.XMLHttpRequest&&(n=new XMLHttpRequest,n.overrideMimeType&&n.overrideMimeType("text/xml"));return n};Util.toJson=function(text){var n;try{n=JSON.parse(text);console.log("la json")}catch(t){console.log("ko phai la json");n=eval("("+text+")")}return n};Util.getSubject=function(n){return n&&n.length>0?n:getResource("bmail.resources.detail.nosubject")};String.prototype.replaceAll=function(n,t){for(var i=this,r=i.indexOf(n);r!=-1;)i=i.replace(n,t),r=i.indexOf(n);return i};