define(["jquery"],function(n){"use strict";if(typeof n!="function")throw"Trang chưa có Jquery";var a={init:function(n){this.doc=n;this.bindShortKey()},bindShortKey:function(){var t=this;n(t.doc.$el).on("keydown",function(n){if(n.ctrlKey)if(n.shiftKey)switch(n.keyCode){case 80:n.preventDefault();y(t.doc)}else switch(n.keyCode){case 83:n.preventDefault();v(t.doc);break;case 80:n.preventDefault();p(t.doc);break;case 72:n.preventDefault();w(t.doc);break;case 82:n.preventDefault();b(t.doc);break;case 69:n.preventDefault();e(t.doc)}else if(n.altKey)switch(n.keyCode){case 89:n.preventDefault();k(t.doc);break;case 84:n.preventDefault();e(t.doc)}else switch(n.keyCode){case 9:f(n);n.preventDefault();break;case 13:f(n);break;case 37:tt(n);break;case 38:g(n);break;case 39:f(n);break;case 40:nt(n);break;case 32:it(n)}})}},v=function(n){if(n.isHsmc){n.transfer({id:"TiepNhanHoSoVaTiepTuc",isSpecial:!0,name:"Tiếp nhận và tiếp tục (Ctrl+S)"});return}return n.saveDocument(function(t){egov.pubsub.publish(egov.events.status.success,egov.resources.document.saveSuccess);var i=_.find(egov.waitingPacket,function(t){return t.attachment.get("Id")==n.attachmentIdInWaitingPacket});if(i){n.tab.close(!0);i.saved=!0;i.documentCopyId=t.documentCopyId;i.title=n.model.get("Compendium");egov.waitingPacket.remove(i);egov.waitingPacket.push(i);return}n.model.get("CategoryBusinessId")===egov.enum.categoryBusiness.vbden&&(n.tab.close(!0),egov.views.home.tab.addDocument(n.model.get("DocTypeId"),n.model.get("DocTypeName")))}),!1},y=function(n){n.printReceiptShortKey(!0)},p=function(n){n.printReceiptShortKey()},w=function(n){n.toolbar.$(".btnTransfer").click()},b=function(n){n.toolbar.$(".btnInsertRelation").click()},k=function(n){n.$("#openDialogCommon").click()},e=function(n){n.toolbar.$(".fileinput-button .fileupload").click()},o=function(n){var t=n.parent().children().index(n),i=n.parent().parent().children().index(n.parent());return{row:i,col:t}},d=function(n){return n.siblings("td").length+1},t=function(t,i){var r,f=i?n(t.find(u).get().reverse()):t.find(u);return f.each(function(){return n(this).attr("disabled")?!0:(r=n(this),!1)}),r},i=function(n,i){var u,r=n.parent(),e,f;if(i)for(e=n.index();r.next().length>0;){if(r=r.next(),f=r.children("td:eq("+e+")"),f.length>0&&(u=t(f),u))break;if(u=t(r),u)break}else while(r.next().length>0)if(r=r.next(),u=t(r),u)break;return u},r=function(n,i){var u,r=n.parent(),e,f;if(i)for(e=n.index();r.prev().length>0;){if(r=r.prev(),f=r.children("td:eq("+e+")"),f.length>0&&(u=t(f),u))break;if(u=t(r),u)break}else while(r.prev().length>0)if(r=r.prev(),u=t(r,!0),u)break;return u},s=function(n){for(var t,u=n.attr("class").split(" ")[0],r=n.closest("li");r.next().length>0;)if(r=r.next(),t=r.find("input."+u),t.length>0&&!t.attr("disabled"))return t;return i(n.closest("td"),!0)},h=function(n){for(var t,u=n.attr("class").split(" ")[0],i=n.closest("li");i.prev().length>0;)if(i=i.prev(),t=i.find("input."+u),t.length>0&&!t.attr("disabled"))return t;return r(n.closest("td"),!0)},c=function(n){var r,f=o(n),e=d(n),u;if(f.col<e-1){for(u=n;u.next().length>0;)if(u=u.next(),r=t(u),r)return r;r=i(n)}else r=i(n);return r},l=function(n){var i,f=o(n),u;if(f.col>0){for(u=n;u.prev().length>0;)if(u=u.prev(),i=t(u),i)return i;i=r(n)}else i=r(n);return i},u="input[type=text],input[type=checkbox],.ui-multiselect,textarea,select:visible",f=function(t){var i=n(document.activeElement),e=i.parents(".document-info"),r,f;if(i.is(e.find("input[type=text],input[type=checkbox],select,textarea").last()))return!0;if(i.parents("#tableLayout").length===0)if(i.parents(".ui-multiselect-checkboxes").length>0){if(n("#"+i.attr("name").replace("multiselect_","")).parents("#tableLayout").length===0)return!0}else return!0;if(r=function(t){var e;t&&t.length>0&&(i=t);var r,o=i.closest("td"),f=o.find(u),h=n.inArray(i[0],f),s;if(h<f.length-1){for(e=h+1;e<f.length;e++)if(s=n(f[e]),!s.attr("disabled")){r=s;r.focus();return}r=c(o)}else r=c(o);if(r.is(".hasDatepicker")){r.focusAndSelectRange();return}r&&r.focus()},i.is('input[type="text"]')){if(i.val().length===0||i.getCursorPosition()===i.val().length||t.keyCode===13||t.keyCode===9)return r(),!1}else if(i.is("textarea"))if(i.val().length==0||i.getCursorPosition()==i.val().length){if(t.keyCode===39||t.keyCode===9)return r(),!1}else return t.keyCode===9?(r(),!1):!0;else if(i.is('input[type="checkbox"]')&&i.parents(".ui-multiselect-checkboxes").length>0){if(t.keyCode===9&&(f=i.attr("name"),f.indexOf("multiselect_")>-1))return r(n("#"+f.replace("multiselect_","")).siblings("button")),!1}else return i.is("select")?t.keyCode===13?i.data("events").mousedown?!1:!0:(r(),!1):(r(),!1);return!0},g=function(t){var u,i=n(document.activeElement);if(i.parents("#tableLayout").length===0)return!0;if(i.is('input[type="text"]')||i.is(".ui-multiselect")){if(i.hasClass("fee-name")||i.hasClass("fee-price")||i.hasClass("fee-id")||i.hasClass("paper-name")||i.hasClass("paper-amount")||i.hasClass("paper-id"))u=h(i);else{if(i.hasClass("ui-autocomplete-input")&&n(".ui-autocomplete:visible").length>0)return!0;u=r(i.closest("td"),!0)}return u&&u.focus(),!1}if(i.is("textarea")){if(i.val().length===0||i.getCursorPosition()===0)return t.preventDefault(),u=r(i.closest("td"),!0),u&&u.focus(),!1}else{if(i.is('input[type="checkbox"]')&&i.parents(".ui-multiselect-checkboxes").length===0)return u=i.hasClass("fee-id")||i.hasClass("paper-id")?h(i):r(i.closest("td"),!0),u&&u.focus(),!1;if(i.is("select")&&i.val()===i.find("option:first").val())return u=r(i.closest("td"),!0),u&&u.focus(),!1}return!0},nt=function(t){var u,r=n(document.activeElement);if(r.parents("#tableLayout").length===0)return!0;if(r.is('input[type="text"]')){if(r.hasClass("fee-name")||r.hasClass("fee-price")||r.hasClass("paper-name")||r.hasClass("paper-amount"))u=s(r);else{if(r.hasClass("ui-autocomplete-input")&&n(".ui-autocomplete:visible").length>0)return!0;u=i(r.closest("td"),!0)}return u&&u.focus(),!1}if(r.is("textarea")){if(r.val().length===0||r.getCursorPosition()===r.val().length)return u=i(r.closest("td"),!0),u&&u.focus(),!1}else{if(r.is('input[type="checkbox"]')&&r.parents(".ui-multiselect-checkboxes").length===0)return u=r.hasClass("fee-id")||r.hasClass("paper-id")?s(r):i(r.closest("td"),!0),u&&u.focus(),!1;if(r.is("select")){if(r.val()===r.find("option:last").val())return u=i(r.closest("td"),!0),t.preventDefault(),u&&u.focus(),!1}else r.is(".ui-multiselect")&&r.simulate("click")}return!0},tt=function(){var t=n(document.activeElement),i;if(t.parents("#tableLayout").length===0)return!0;if(i=function(){var i,f=t.closest("td"),o=f.find(u),s=n.inArray(document.activeElement,o),e,r;if(s>0){for(r=s-1;r>=0;r--)if(e=n(o[r]),!e.attr("disabled")){i=e;i.focus();return}i=l(f)}else i=l(f);i&&i.focus()},t.is('input[type="text"]')||t.is("textarea")){if(t.val().length===0||t.getCursorPosition()===0)return i(),!1}else return t.is('input[type="checkbox"]')?t.parents(".ui-multiselect-checkboxes").length===0?(i(),!1):!0:(i(),!1);return!0},rt=function(){return this.moveNext()},it=function(){var t=n(document.activeElement);t.is('input[type="checkbox"]')&&t.simulate("click")};return a});