(function(n,t,i){"use strict";var u={indexedDb:"indexedDb",storage:"storage",fileApi:"fileApi"},r=function(){return this._cacheManager=new n.CacheManager(u.indexedDb),(n.isMobile||this._cacheManager==i||!this._cacheManager.hasSupport)&&(this._cacheManager=new n.CacheManager(u.storage)),this._dataBase={},this._hasCache=this._cacheManager!==i&&this._cacheManager.hasSupport,this._expriedDay=10,this};r.prototype.get=function(r){var u,e=this,f,s=n.getKeyName(r),o;if(r==i){n.log("DataAccess.get: Entity is null.");return}if(f=r.option.success,!r.hasSessionCache){e._sendRequestToServer(r);return}r.option.success=function(h){if(r.option.success=f,h){e._sendRequestToServer(r);return}if(s=n.getKeyName(r),u=e._dataBase[s],u)if(r.isInsertToCurrentCache){if(o=JSON.stringify(r.option.data),u=u.filter(function(n){return n.key==o}),u.length>0){n.callback(f,u[0].value);return}}else{n.callback(f,u);return}e._getFromCache(r,function(h){if(h)if(u=h.value,r.isInsertToCurrentCache){if(o=JSON.stringify(r.option.data),u=u.filter(function(n){return n.key==o}),u.length>0){n.callback(f,u[0].value);return}}else{e._dataBase[s]=u;n.callback(f,u);return}t.isFunction(r.request)?e._sendRequestToServer(r):n.callback(f,i)})};this.resetOutofDate(r)};r.prototype.getCache=function(t){var r,o=this,u,f,e;if(t==i){n.log("DataAccess.get: Entity is null.");return}f=n.getKeyName(t);u=t.option.success;this._cacheManager.get(f,function(s){if(s)if(r=s.value,t.isInsertToCurrentCache){if(e=JSON.stringify(t.option.data),r=r.filter(function(n){return n.key==e}),r.length>0){n.callback(u,r[0].value);return}}else{o._dataBase[f]=r;n.callback(u,r);return}n.callback(u,i)})};r.prototype.resetOutofDate=function(t){var i,r,u;i=this;r=n.getKeyName(t);u=t.option.success;t.option.success=function(t){if(t&&Date.now()-t>i._expriedDay*864e5){i._dataBase[r]=null;i.delete(r,function(){n.callback(u,!0)});return}n.callback(u,t?!1:!0)};this.getLastUpdate(t)};r.prototype.getLastUpdate=function(t){var r;if(t==i){n.log("DataAccess.getLastUpdate: Entity is null.");return}(r=t.option.success,t.hasSessionCache)&&this._getFromCache(t,function(t){n.callback(r,t?t.dateModified:i)})};r.prototype.insert=function(t,i){var u,f,r;r=this;u=n.getKeyName(t);f=t.option.success;r._dataBase[u]=i;t.hasCache&&r._hasCache?r._cacheManager.insert(u,i,f):n.callback(f,i)};r.prototype.update=function(t,r,u){var h,e,f,o,s,c;if(f=this,e=n.getKeyName(t),u=u||!1,c="id",s=t.option.success,h=f._dataBase[e]||[],!u&&(r===i||r.length===0)){n.callback(s,h);return}o=u?r:n.mergeArraysByProperty(h,r,c);f._dataBase[e]=o;t.hasCache&&f._hasCache?f._cacheManager.update(e,o,s):n.callback(s,o)};r.prototype.delete=function(t,r){var u,f=this;if(u=n.entities[t],u===i){n.log("DataAccess.delete: entity not found");return}t=n.getKeyName(u);this._dataBase[t]=null;u.hasCache&&f._hasCache?this._cacheManager.delete(t,r):n.callback(r,t)};r.prototype.reset=function(t){this._dataBase={};this._hasCache?this._cacheManager.reset(t):n.callback(t)};r.prototype._saveToCache=function(n,t){this._cacheManager.insert(n,t)};r.prototype._getFromCache=function(t,r){this._hasCache&&t.hasCache?this._cacheManager.get(n.getKeyName(t),r):n.callback(r,i)};r.prototype._sendRequestToServer=function(t){var u,r=this,f,i,e,o,s=t.option.success;f=n.getKeyName(t);u=$.extend({cache:!0},t.option);u.success=function(u){t.isInsertToCurrentCache?r._getFromCache(t,function(n){n&&(i=n.value,o=!0);e=JSON.stringify(t.option.data);i?i.push({key:e,value:u}):i=[{key:e,value:u}];r._dataBase[f]=i;t.hasCache&&(t.option.success=function(){s(u)},o?r.update(t,i,!0):r.insert(t,i));return}):(r._dataBase[f]=u,t.option.success=function(){n.callback(s,u)},t.hasCache?r.insert(t,u):n.callback(t.option.success))};u.error=function(n){n.getResponseHeader("IsAuthenticated")==="false"&&parent.logout()};t.request(u)};r.prototype._checkBrowsersNotSupport=function(){this._cacheManager.isNotSupportIndexedDb&&(this._hasCache=!1)};r.prototype.version=function(){};r.prototype.setVersion=function(){};n.DataAccess=new r})(this.egov=this.egov||{},_,undefined);