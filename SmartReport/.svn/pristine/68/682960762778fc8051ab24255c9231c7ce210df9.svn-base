define([egov.tempate.transfer.plan],function(n){"use strict";egov.models.action=Backbone.Model.extend({defaults:{currentNodeId:0,id:"",isAllow:!0,isAllowSign:!1,isSpecial:!1,name:"",nextNodeId:0,priority:0,userIdNext:0,workflowId:0}});var t=Backbone.View.extend({template:n,checkmouseDown:!1,a:[],b:[],events:{"mousedown #dropdownAction":"dropdownAction","change #dropdownAction":"changedropdownAction","change #dropdownUserTransfer":"dropdownUserTransfer","change #dropdownActionPlan":"dropdownActionPlan"},initialize:function(n){this.documentCopyId=n.documentCopyId||0;this.doctypeId=n.doctypeId;this.isCreatingDocument=n.documentCopyId<=0;this.destination=null;this._open();this.$el.html(this.template);this.$el.bindResources()},_open:function(){var n=this,t={},r,i;t.width=810;t.title="eGovCloud - Dự kiến bàn giao hồ sơ, văn bản";t.buttons=[{text:"Đồng ý",click:function(){var t,i;$("#dropdownAction").val()!==""&&$("#dropdownUserTransfer").val()!==""&&$("#dropdownActionPlan").val()!==""?(t=egov.cshtml.transfer.getDestination(),t&&(i=_.find(n.actions,function(n){return n.id===$("#dropdownAction").val()}),n.$el.dialog("destroy"))):egov.message.show("Bạn phải chọn hướng chuyển dự kiến")}},{text:"Bỏ qua",click:function(){n.$el.dialog("destroy")}}];r=$("<div><\/div>").append($("#transferPlanTemplate").tmpl()).appendTo($("body"));$("#dialogTransferPlan #divTransfer").append($("#transferTemplate").tmpl());i=new dialogAdapter;i.openexist(n.$el,t,function(){egov.cshtml.transfer.initLayout();$(".dialog-center").css({border:"none"});$(".dialog-south").css({border:"none"});$(".dialog-center-south").css({border:"none"})},function(){egov.cshtml.transfer.dialogLayout&&(egov.cshtml.transfer.dialogLayout=null)})},dropdownAction:function(){var t=[];if(!this.checkmouseDown){var n=this,i=n.isCreatingDocument?{documentTypeId:n.doctypeId,isPhanloai:!1}:{documentCopyId:n.documentCopyId},r=n.isCreatingDocument?"/Transfer/GetActionsCreate":"/Transfer/GetActionsEdit";$.get(r,i,function(n){if(n)if(n.error)egov.message.notification(n.error,egov.message.messageTypes.error);else{var i=_.filter(n,function(n){return!n.isspecial});i.length>0&&(t=i,$.each(i,function(n,t){$("#dropdownAction").append('<option value="'+t.id+'">'+t.name+"<\/option>")}),$("#dropdownAction").unbind("mousedown"))}})}t.length>0&&(this.a=t);this.checkmouseDown=!0},changedropdownAction:function(){var i=this,n=$("#dropdownAction").val(),t;n?(t=_.find(i.a,function(t){return t.id===n}),t&&$.ajax({url:"/Transfer/GetUserByAction",type:"Get",datatype:"json",data:{actionId:n,workflowId:t.workflowId,documentCopyId:i.documentCopyId},success:function(n){$("#dropdownUserTransfer").html($("#dropdownUserTransfer option:first"));$.each(n,function(n,t){$("#dropdownUserTransfer").append('<option value="'+t.value+'">'+t.label+"<\/option>")})},error:function(){egov.message.show("Bạn không có quyền xử lý văn bản!")}})):($("#dropdownUserTransfer").html($("#dropdownUserTransfer option:first")),$("#dropdownActionPlan").html($("#dropdownActionPlan option:first")))},dropdownUserTransfer:function(){var i=$("#dropdownUserTransfer").val(),t=[],r=this,n;i?(n=_.find(r.a,function(n){return n.id===$("#dropdownAction").val()}),n&&$.get("/Transfer/GetActionsTransferPlan",{workflowId:n.workflowId,userId:i,currentNodeId:n.nextNodeId},function(n){n?(t=n,this.b=n,$("#dropdownActionPlan").html($("#dropdownActionPlan option:first")),$.each(n,function(n,t){$("#dropdownActionPlan").append('<option value="'+t.id+'">'+t.name+"<\/option>")})):egov.message.show("Bạn không có quyền xử lý văn bản!")})):$("#dropdownActionPlan").html($("#dropdownActionPlan option:first"));t.length>0&&(this.b=t)},dropdownActionPlan:function(){var t=$("#dropdownActionPlan").val(),r=this,n;t&&(n=_.find(r.b,function(n){return n.id===t}),n&&$.get("/Transfer/GetUserByAction",{actionId:t,workflowId:n.workflowid,documentCopyId:0,userId:$("#dropdownUserTransfer").val()},function(r){r?(i(r,n.nextnodeid,n.workflowid,n.currentnodeid,t),$(".dialog-center").css({border:"none"}),$(".dialog-south").css({border:"none"}),$(".dialog-center-south").css({border:"none"})):egov.message.show("Bạn không có quyền xử lý văn bản!")}))}}),i=function(n,t,i,r,u,f){egov.cshtml.transfer.nextNodeId=t;egov.cshtml.transfer.workflowId=i;egov.cshtml.transfer.currentNodeId=r;egov.cshtml.transfer.actionId=u;$("#divViewXulychinh, #divViewDongxuly, #divViewThongbao, #tblUsersTransfer tbody").html("");$("#tblUsersTransfer tbody").append($("#userTransferTemplate").tmpl(n));egov.cshtml.transfer.bindSearceUser(n);egov.utilities.checkbox.checkAndUnCheckAll($("#dongxulyAll"),$(".dongxulyItem"));egov.cshtml.transfer.bindDxlAllClick();egov.cshtml.transfer.bindChooseReceiveItems();$("#closeDonggui").click(function(){$(".dialog-south").hide();$("#openDonggui").show();$("#closeDonggui").hide()});f&&typeof f=="number"&&$("#tblUsersTransfer tbody tr[id="+f+"] .xulychinhItem").simulate("click")};return t});