function Base(){}function ChromeNativeApp(){Base.call(this)}function PluginFactory(){}(function(n,t,i,r){var f=["áàảãạăắằẳẵặâấầẩẫậ","ÁÀẢÃẠĂẮẰẲẴẶÂẤẦẨẪẬ","đ","Đ","éèẻẽẹêếềểễệ","ÉÈẺẼẸÊẾỀỂỄỆ","íìỉĩị","ÍÌỈĨỊ","óòỏõọơớờởỡợôốồổỗộ","ÓÒỎÕỌƠỚỜỞỠỢÔỐỒỔỖỘ","ưứừửữựúùủũụ","ƯỨỪỬỮỰÚÙỦŨỤ","ýỳỷỹỵ","ÝỲỶỸỴ"],e=["a","A","d","D","e","E","i","I","o","O","u","U","y","Y"],o='<li id="${value}" label="${attr.label}" rel="${attr.rel}" idext="${attr.idext}" class="jstree-${state}"><ins class="jstree-icon">&nbsp;<\/ins><a href="#" class=""><ins class="jstree-icon">&nbsp;<\/ins>${data}<\/a><\/li>';var s='<li id="${value}" rel="${attr.rel}" idext="${attr.idext}" class="jstree-${state}"><ins class="jstree-icon">&nbsp;<\/ins><a href="#" class=""><ins class="jstree-checkbox">&nbsp;<\/ins><ins class="jstree-icon">&nbsp;<\/ins>${data}<\/a><\/li>',h='<li id="${value}" rel="${attr.rel}" idext="${attr.idext}" class="jstree-${state} jstree-unchecked"><ins class="jstree-icon">&nbsp;<\/ins><a href="#" class=""><ins class="jstree-checkbox">&nbsp;<\/ins><ins class="jstree-icon">&nbsp;<\/ins>${data}<\/a><\/li>',u=["themes","json_data","ui","crrm"];n.utilities={};n.utilities.checkbox={};n.utilities.checkbox.checkAndUnCheckAll=function(n,i,r){var u=i.length;n.bind("click",function(){for(var f=this.checked,n=0;n<u;n++)i[n].checked=f,t(i[n]).trigger("change");r&&typeof r=="function"&&r()});i.bind("click",function(){var t=0,u=0,f;i.each(function(){t++;this.checked==!0&&u++});f=t==u?!0:!1;n.prop("checked",f);r&&typeof r=="function"&&r()})};n.utilities.jstree={};n.utilities.jstree.getChildrens=function(t,r,u,f,e){var o=i.filter(u,function(n){return n.parentid==t}),h=i.filter(e,function(n){return n.departmentid===t}),c,l,s,a;if(o.length>0)for(c=0;c<o.length;c++)(n.utilities.jstree.getChildrens(o[c].value,!1,u,[],[]).length>0||r&&h.length>0)&&(o[c].state="closed");if(r&&h.length>0)for(l=0;l<h.length;l++)s=i.find(f,function(n){return n.value===h[l].userid}),s&&(a={value:"user_"+s.value,data:s.fullname,parentid:t,state:"leaf",metadata:{id:"user_"+s.value},attr:{id:"user_"+s.value,rel:"people",idext:h[l].idext}},o.push(a));return o};n.utilities.jstree.bindJsTree=function(r,f,e,o,s,h,c,l,a,v,y){var p=i.find(s,function(n){return n.parentid===0});e&&u.push("checkbox");o&&u.push("dnd");p&&r.jstree({json_data:{data:[{data:p.data.toString(),metadata:{id:p.value},state:"closed",attr:{id:p.value,rel:"dept",idext:p.idext,label:p.label},children:n.utilities.jstree.getChildrens(p.value,f,s,h,c)}]},crrm:o==!1?{}:{move:{check_move:function(n){var r=i.find(s,function(t){return t.value===parseInt(n.o.attr("id"))}),t;return r?r.level!=1?!1:(t=this._get_parent(n.o),!t)?!1:(t=t==-1?this.get_container():t,t===n.np)?!0:t[0]&&n.np[0]&&t[0]===n.np[0]?!0:!1:!1}}},dnd:o==!1?{}:{drop_target:!1,drag_target:!1},plugins:u}).bind("loaded.jstree",function(i,u){var o=1;u.inst.get_container().find("li").each(function(){u.inst.get_path(t(this)).length<=o&&u.inst.open_node(t(this))});r.bind("open_node.jstree",function(t,i){i.inst._get_children(i.rslt.obj).length==0&&n.utilities.jstree.appendChild(i.rslt.obj,parseInt(i.rslt.obj.attr("id")),f,e,s,h,c,v,y)});typeof l=="function"&&l(a)})};n.utilities.jstree.appendChild=function(i,u,f,e,c,l,a,v,y){var w,p,b;typeof v==r&&(v=!0);typeof y==r&&(y=!0);w=n.utilities.jstree.getChildrens(u,f,c,l,a);w.length>0&&(p=t("<ul><\/ul>"),p.appendTo(i),e?(b=y?s:h,t.template("checkboxTemplate",b),t.tmpl("checkboxTemplate",w).appendTo(p),v&&t(i).find("li").each(function(n,r){t(r).addClass(i.hasClass("jstree-checked")?"jstree-checked":"jstree-unchecked")})):(t.template("itemTreeviewTemplate",o),t.tmpl("itemTreeviewTemplate",w).appendTo(p)),p.children("li:last").addClass("jstree-last"))};n.utilities.string={};n.utilities.string.stripVietnameseChars=function(n){for(var i,r,t=[],u=0;u<n.length;u++)t.push(n.charAt(u));for(i=0;i<t.length;i++)for(r=0;r<f.length;r++)f[r].indexOf(t[i])>-1&&(t[i]=e[r]);return t.join("")};n.utilities.url={};n.utilities.url.getQueryStringValue=function(n,t){t||(t=location.search);n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+n+"=([^&#]*)"),i=r.exec(t);return i==null?"":decodeURIComponent(i[1].replace(/\+/g," "))};n.utilities.array={};n.utilities.array.distinct=function(n){for(var i,e,f=[],u={},t=0;t<n.length;t++)i=JSON.stringify(n[t]),e=n[t],u[i]===r?(f.push(e),u[i]=1):u[i]++;return f}})(window.egov=window.egov||{},window.jQuery,window._),function(){var t=String,n=t.prototype,i=["aáàảãạăắằẳẵặâấầẩẫậ","AÁÀẢÃẠĂẮẰẲẴẶÂẤẦẨẪẬ","dđ","DĐ","eéèẻẽẹêếềểễệ","EÉÈẺẼẸÊẾỀỂỄỆ","iíìỉĩị","IÍÌỈĨỊ","oóòỏõọơớờởỡợôốồổỗộ","OÓÒỎÕỌƠỚỜỞỠỢÔỐỒỔỖỘ","uưứừửữựúùủũụ","UƯỨỪỬỮỰÚÙỦŨỤ","yýỳỷỹỵ","YÝỲỶỸỴ"];n.trim=function(){return this.replace(/^\s+|\s+$/g,"")};n.trimStart=function(){return this.replace(/^\s+/,"")};n.trimEnd=function(){return this.replace(/\s+$/,"")};n.startWith=function(n,t){if(!String.isString(n))throw"Giá trị truyền vào không hợp lệ";return t=t||!1,n.equals(this.substr(0,n.length),t)};n.endWith=function(n,t){if(!String.isString(n))throw"Giá trị truyền vào không hợp lệ";return t=t||!1,n.equals(this.substr(this.length-n.length),t)};n.equals=function(n,t){if(!String.isString(n))throw"Giá trị truyền vào không hợp lệ";return t=t||!1,t?this.toLowerCase()===n.toLowerCase():this.toString()===n};n.remove=function(n,t){var i;if(typeof n!="number")throw"Start Index phải là một chữ số";return i=this.slice(0,n),t!=undefined&&typeof t=="number"&&(i+=this.slice(n+t)),i};n.replaceAll=function(n,t){if(!String.isString(n)||!String.isString(t))throw"Các tham số truyền vào phải là string";var i=new RegExp(n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g");return this.replace(i,t)};n.contains=function(n){if(!String.isString(n))throw"Tham số truyền vào phải là chuỗi";return this.indexOf(n)>-1};n.toCharArray=function(){return this.split("")};n.reverse=function(){return this.split("").reverse().join("")};n.forEach=function(n){if(typeof n=="function")for(var i=this.length,t=0;t<i;t++)n(this.charAt(t),t)};n.removeVietnamChars=function(){var t=[],r=this,n;return r.forEach(function(r,u){for(t[u]=r,n=0;n<i.length;n++)if(i[n].contains(r)){t[u]=i[n][0];break}}),t.join("")};t.format=function(){return String._toFormattedString(!1,arguments)};t.isNullOrEmpty=function(n){return n===null||n===undefined||n===""};t.isNUllOrWhiteSpace=function(n){return n=n.trim(),String.isNullOrEmpty(n)};t.isString=function(n){return typeof n=="string"};t._toFormattedString=function(n,t){for(var e,u,s,i,o="",f=t[0],r=0;;){if(e=f.indexOf("{",r),u=f.indexOf("}",r),e<0&&u<0){o+=f.slice(r);break}if(u>0&&(u<e||e<0)){if(f.charAt(u+1)!=="}")throw new Error("format stringFormatBraceMismatch");o+=f.slice(r,u+1);r=u+2;continue}if(o+=f.slice(r,e),r=e+1,f.charAt(r)==="{"){o+="{";r++;continue}if(u<0)throw new Error("format stringFormatBraceMismatch");var h=f.substring(r,u),c=h.indexOf(":"),l=parseInt(c<0?h:h.substring(0,c),10)+1;if(isNaN(l))throw new Error("format stringFormatInvalid");s=c<0?"":h.substring(c+1);i=t[l];(typeof i=="undefined"||i===null)&&(i="");o+=i.toFormattedString?i.toFormattedString(s):n&&i.localeFormat?i.localeFormat(s):i.format?i.format(s):i.toString();r=u+1}return o}}(this);bt_util_date_resource={vi:{months:["tháng 1","tháng 2","tháng 3","tháng 4","tháng 5","tháng 6","tháng 7","tháng 8","tháng 9","tháng 10","tháng 11","tháng 12"],shortMonths:["Th1","Th2","Th3","Th4","Th5","Th6","Th7","Th8","Th9","Th10","Th11","Th12"],weeks:["chủ nhật","thứ hai","thứ ba","thứ tư","thứ năm","thứ sáu","thứ bảy"],shortWeeks:["CN","T2","T3","T4","T5","T6","T7"],times:{future:"%s tới",ago:"%s trước",s:"vài giây",m:"một phút",mm:"%d phút",h:"một giờ",hh:"%d giờ",d:"một ngày",dd:"%d ngày",M:"một tháng",MM:"%d tháng",y:"một năm",yy:"%d năm"},calendar:{sameDay:"Hôm nay",nextDay:"Ngày mai",lastDay:"Hôm qua",sameWeek:"Tuần này",nextWeek:"Tuần tới",lastWeek:"Tuần trước",sameMonth:"Tháng này",lastMonth:"Tháng trước"}}},function(){"use strict";var r,t,n,i,s,h,u,o;r=Date;t=r.prototype;n={year:"year",quarter:"quarter",month:"month",week:"week",date:"date",day:"day",hour:"hours",minute:"minutes",second:"seconds",miniSecond:"miniSecond"};s=/(\[[^\[]*\])|(\\)?(MM?M?M?|dd?d?|ww?|q|yy?yy?|a|A|hh?|HH?|mm?|ss?s?|z|.)/g;h="hh:mm dd/MM/yyyy";o="yyyy-MM-ddTHH:mm:ss";i={yy:"yy",yyyy:"yyyy",q:"q",M:"M",MM:"MM",MMM:"MMM",MMMM:"MMMM",w:"w",ww:"ww",d:"d",dd:"dd",ddd:"ddd",h:"h",hh:"hh",H:"H",HH:"HH",a:"a",A:"A",m:"m",mm:"mm",s:"s",ss:"ss",sss:"sss",z:"z"};u=bt_util_date_resource.vi;t.format=function(n){var r,u,t,i,f="";for(n=n||h,r=n.match(s),u=r.length,i=0;i<u;i++)t=r[i].toString(),t=t.replace("[","").replace("]",""),f+=l(t)?this._getFormattingValue(t):t;return f};t.subtract=function(t,i){switch(i){case n.year:this.year(this.year()-t);break;case n.month:this.month(this.month()-t);break;case n.date:return this.date(this.date()-t),this;case n.hour:this.hours(this.hours()-t);break;case n.minute:this.minutes(this.minutes()-t);break;case n.second:this.seconds(this.seconds()-t);break;case n.miniSecond:this.miniSeconds(this.miniSeconds()-t)}return this};t.add=function(t,i){switch(i){case n.year:this.year(this.year()+t);break;case n.month:this.month(this.month()+t);break;case n.date:return this.date(this.date()+t),this;case n.hour:this.hours(this.hours()+t);break;case n.minute:this.minutes(this.minutes()+t);break;case n.second:this.seconds(this.seconds()+t);break;case n.miniSecond:this.miniSeconds(this.miniSeconds()+t)}return this};t.month=function(n){return(n==2&&this.date()>28&&this.date(28),f(n))?(this.setMonth(n-1),this):this.getMonth()+1};t.year=function(n){return f(n)?(this.setFullYear(n),this):this.getFullYear()};t.date=function(n){return f(n)?(this.setDate(n),this):this.getDate()};t.day=function(){return this.getDay()};t.weekOfYear=function(){var n=new Date(this.getFullYear(),0,1);return Math.ceil(((this-n)/864e5+n.day()-1)/7)};t.dayOfYear=function(){var n=new Date(this.getFullYear(),0,1);return Math.ceil((this-n)/864e5)};t.hours=function(n){return f(n)?(this.setHours(n),this):this.getHours()};t.minutes=function(n){return f(n)?(this.setMinutes(n),this):this.getMinutes()};t.seconds=function(n){return f(n)?(this.setSeconds(n),this):this.getSeconds()};t.miniSeconds=function(n){return f(n)?(this.setMilliseconds(n),this):this.getMilliseconds()};t.quarter=function(){return Math.floor((this.month()-1)/3+1)};t.endOf=function(t){if(n[t]===undefined)throw"Đơn vị truyền vào không hợp lệ.";var f,e,u,i,o;f=this.year();e=this.quarter();u=this.month();o=this.date();switch(t){case n.year:this.month(12).date(31).hours(23).minutes(59).seconds(59).miniSeconds(999);break;case n.quarter:u=e*3;i=r.daysInMonth(u,f);this.month(u).date(i).hours(23).minutes(59).seconds(59).miniSeconds(999);break;case n.month:i=r.daysInMonth(u,f);this.date(i).hours(23).minutes(59).seconds(59).miniSeconds(999);break;case n.week:i=o-this.day()+6;this.date(i).hours(23).minutes(59).seconds(59).miniSeconds(999);break;case n.day:this.hours(23).minutes(59).seconds(59).miniSeconds(999);break;case n.hour:this.minutes(59).seconds(59).miniSeconds(999);break;case n.minute:this.seconds(59).miniSeconds(999);break;case n.second:this.miniSeconds(999)}return this};t.startOf=function(t){if(n[t]===undefined)throw"Đơn vị truyền vào không hợp lệ.";var i,r,u,f;i=this.quarter();f=this.date();switch(t){case n.year:this.month(1).date(1).hours(0).minutes(0).seconds(0).miniSeconds(0);break;case n.quarter:r=i*3-2;this.month(r).date(1).hours(0).minutes(0).seconds(0).miniSeconds(0);break;case n.month:this.date(1).hours(0).minutes(0).seconds(0).miniSeconds(0);break;case n.week:u=f-this.day();this.date(u).hours(0).minutes(0).seconds(0).miniSeconds(0);break;case n.day:this.hours(0).minutes(0).seconds(0).miniSeconds(0);break;case n.hour:this.minutes(0).seconds(0).miniSeconds(0);break;case n.minute:this.seconds(0).miniSeconds(0);break;case n.second:this.miniSeconds(0)}return this};t.isLeapYear=function(){return year%4==0&&year%100!=0||year%400==0};t._getFormattingValue=function(n){var t;switch(n){case i.yy:t=this.year().toString().substr(2,2);break;case i.yyyy:t=this.year();break;case i.q:t=this.quarter();break;case i.M:t=this.month();break;case i.MM:t=e(this.month());break;case i.MMM:t=u.shortMonths[this.month()-1];break;case i.MMMM:t=u.months[this.month()-1];break;case i.d:t=this.date();break;case i.dd:t=e(this.date());break;case i.ddd:t=u.weeks[this.day()];break;case i.h:t=c(this.hours());break;case i.hh:t=e(c(this.hours()));break;case i.H:t=this.hours();break;case i.HH:t=e(this.hours());break;case i.m:t=this.minutes();break;case i.mm:t=e(this.minutes());break;case i.s:t=this.seconds();break;case i.ss:t=e(this.seconds());break;case i.S:t=this.miniSeconds();break;case i.Z:t=this.year();break;default:t=""}return t};t.relativeDate=function(){var t=Math.floor((new Date-this)/1e3),n=Math.floor(t/31536e3);return n>1?n+" năm":(n=Math.floor(t/2592e3),n>1)?n+" Thg":(n=Math.floor(t/604800),n>1)?n+" tuần":(n=Math.floor(t/86400),n>1)?n+" ngày":(n=Math.floor(t/3600),n>1)?n+" giờ":(n=Math.floor(t/60),n>1)?n+" phút":"Vừa mới"};t.toServerString=function(){return this.format(o)};t.getVNDay=function(){var n=this.getDay();return bt_util_date_resource.vi.weeks[n]};t.timeInWord=function(){var r=this,t=Date.now(),f=t.format("yyyyMMwwdd"),e=t.subtract(1,n.date).format("yyyyMMwwdd"),o=t.format("yyyyMMww"),s=t.subtract(1,n.week).format("yyyyMMww"),h=t.format("yyyyMM"),c=t.subtract(1,n.month).format("yyyyMM"),l=t.format("yyyy"),i=r.format("yyyyMMwwddhh");return i.indexOf(f)===0?u.calendar.sameDay:i.indexOf(e)===0?u.calendar.lastDay:i.indexOf(o)===0?u.calendar.sameWeek:i.indexOf(s)===0?u.calendar.lastWeek:i.indexOf(h)===0?u.calendar.sameMonth:i.indexOf(c)===0?u.calendar.lastMonth:i.indexOf(l)===0?r.format("[Tháng] MM"):r.format("[Tháng] MM - yyyy")};t.isToday=function(){var n=Date.now().format("yyyyMMdd"),t=this.format("yyyyMMdd");return t===n};t.isYesterday=function(){var t=(new Date).add(-1,n.date).format("yyyyMMdd"),i=this.format("yyyyMMdd");return i===t};r.parse=function(n,t){return(t=t||o,!n)?null:Globalize?Globalize.parseDate(n,t):null};r.parseFromIsoString=function(n){var t=n.split(/[^0-9]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])};r.daysInMonth=function(n,t){return new Date(t,n,0).date()};r.compare=function(){};r.max=function(){};r.min=function(){};r.now=function(){return new Date};var f=function(n){return n!==undefined&&n!==null},yt=function(n){return typeof n=="object"},pt=function(){},e=function(n){return n>9?n:"0"+n},c=function(n){return n>12?n-12:n},l=function(n){return i[n]!==undefined}}(this),function(n){function g(t){var i;return n.Notification?i=new n.Notification(t.title,{icon:u(t.icon)?t.icon:t.icon.x32,body:t.body||c,tag:t.tag||c}):n.webkitNotifications?(i=n.webkitNotifications.createNotification(t.icon,t.title,t.body),i.show()):navigator.mozNotification?(i=navigator.mozNotification.createNotification(t.title,t.body,t.icon),i.show()):n.external&&n.external.msIsSiteMode()&&(n.external.msSiteModeClearIconOverlay(),n.external.msSiteModeSetIconOverlay(u(t.icon)?t.icon:t.icon.x16,t.title),n.external.msSiteModeActivate(),i={ieVerification:l+1}),i}function nt(t){return{close:function(){t&&(t.close?t.close():n.external&&n.external.msIsSiteMode()&&t.ieVerification===l&&n.external.msSiteModeClearIconOverlay())}}}function a(){if(i){var t=d;n.webkitNotifications&&n.webkitNotifications.checkPermission?n.webkitNotifications.requestPermission(t):n.Notification&&n.Notification.requestPermission&&n.Notification.requestPermission(t)}}function s(){var u;if(i)return n.Notification&&n.Notification.permissionLevel?u=n.Notification.permissionLevel():n.webkitNotifications&&n.webkitNotifications.checkPermission?u=w[n.webkitNotifications.checkPermission()]:navigator.mozNotification?u=t:n.Notification&&n.Notification.permission?u=n.Notification.permission:n.external&&n.external.msIsSiteMode()!==undefined&&(u=n.external.msIsSiteMode()!==undefined?t:r),u}function v(n){return n&&b(n)&&k(o,n),o}function tt(){return o.pageVisibility?document.hidden||document.msHidden||document.mozHidden||document.webkitHidden:!0}function y(n){var t,i,r,f;return u(n.title)&&(u(n.icon)||isobject(n.icon))&&(t=g(n),r=e(n.click)?n.click:function(){},t.addEventListener("click",r),f=e(n.close)?n.close:function(){},t.addEventListener("close",f),i=nt(t)),i}function p(){return!it()&&i&&tt()&&s()===t}function it(){return navigator.userAgent.indexOf("MSIE")>-1}var r="default",t="granted",f="denied",w=[t,r,f],h={},c="",i=function(){var t=!1;try{t=!!(n.Notification||n.webkitNotifications||navigator.mozNotification||n.external&&n.external.msIsSiteMode()!==undefined)}catch(i){}return t}(),l=Math.floor(Math.random()*10+1),e=function(n){return n&&n.constructor===Function},u=function(n){return n&&n.constructor===String},b=function(n){return n&&n.constructor===Object},k=function(n,t){var i,r;for(i in t)r=t[i],i in n&&(n[i]===r||i in h&&h[i]===r)||(n[i]=r);return n},d=function(n){Notification&&(Notification.permission=n)},o={pageVisibility:!1,autoClose:0};n.notify={PERMISSION_DEFAULT:r,PERMISSION_GRANTED:t,PERMISSION_DENIED:f,isSupported:i,config:v,createNotification:y,permissionLevel:s,requestPermission:a,hasNotify:p};e(Object.seal)&&(n.PERMISSION_DEFAULT=r,n.PERMISSION_GRANTED=t,n.PERMISSION_DENIED=f,n.isSupported=i,n.config=v,n.createNotification=y,n.permissionLevel=s,n.requestPermission=a,n.hasNotify=p)}(window),function(n){function t(n){try{return eval(n)}catch(t){return n}}function r(){if(egov.utilities)return egov.utilities.url.getQueryStringValue("client")==="tool";require(["util/bkav.utilities"],function(){return egov.utilities.url.getQueryStringValue("client")==="tool"})}if(typeof n===undefined)throw t("egov.resources.notJqueryAlert");var i={Bmail:1,Gmail:2,Yahoo:3,MailExchange:4,MDaemon:5};window.helper={timeShowSoundNotify:6e4,hasHideAfterDisplayNotify:!1,timeOutHideNotify:null,timeHideAfterDisplayNotify:0,change:!0,isLoad:!1,isAllData:!1,isPlayAudio:!1,clearChangeTitle:null,connection:{isLoaded:!1,BmailLink:"?egov=1",KNTCLink:"/TalkingPeople",CalendarLink:"?egov=1&calendar=1",ChatLink:"",CssLinks:[],ContactMobile:"/mobile/#ContactPage",JsLinks:[],MailType:undefined},bkavElements:{bmail:{divContainId:"#div-bmail",iframeName:"bmail",tab:"#tab-bmail",name:t("egov.resources.bmail"),color:"egov-theme",hasShowChat:!0},documents:{divContainId:"#div-document",iframeName:"documents",tab:"#tab-document",name:t("egov.resources.documentslabel"),color:"egov-theme",hasShowChat:!0},chat:{divContainId:"#div-chat",iframeName:"chat",tab:"#tab-chat",name:t("egov.resources.chat"),color:"egov-theme",hasShowChat:!1},calendar:{divContainId:"#div-calendar",iframeName:"calendar",tab:"#tab-calendar",name:t("egov.resources.calendar"),color:"egov-theme",hasShowChat:!0},report:{divContainId:"#div-report",iframeName:"report",tab:"#tab-report",name:t("egov.resources.reportLabel"),color:"egov-theme",hasShowChat:!1},kntc:{divContainId:"#div-kntc",iframeName:"kntc",tab:"#tab-kntc",name:t("egov.resources.kntc"),color:"egov-theme"},links:{divContainId:"#div-links",tab:"#tab-links",name:t("egov.resources.links"),color:"egov-theme"},statistics:{divContainId:"#div-statistics",iframeName:"statistics",tab:"#tab-statistics",name:t("egov.resources.statictisLabel"),color:"egov-theme",hasShowChat:!1},overall:{divContainId:"#div-overall",iframeName:"overall",tab:"#tab-overall",name:t("egov.resources.overall"),color:"egov-theme",hasShowChat:!1},bwss:{divContainId:"#div-bwss",iframeName:"bwss",tab:"#tab-bwss",name:"bwss",color:"egov-theme"},cbcl:{divContainId:"#div-cbcl",iframeName:"cbcl",tab:"#tab-cbcl",name:t("egov.resources.overall"),color:"egov-theme"},calendarregiter:{divContainId:"#div-calendarregiter",iframeName:"calendarregiter",tab:"#tab-calendarregiter",name:t("egov.resources.overall"),color:"egov-theme"}},isTool:r(),getContentWindow:function(n){if(n===undefined)return null;var t=document.getElementsByName(n);return t===undefined||t.length<=0?null:t[0].contentWindow},compareObject:function(n,t,i){var u,e,r,f;if(typeof n!="object"&&typeof t!="object")return n!=t?!1:!0;if(n instanceof Array&&t instanceof Array){if(n.length!==t.length)return!1;if(n.length>0)for(r=0;r<n.length;r++)if(!this.compareObject(n[r],t[r],i,!0))return!1;return!0}try{if(u=Object.getOwnPropertyNames(n),e=Object.getOwnPropertyNames(t),i&&u.length!==e.length)return!1;if(u.length>0)for(r=0;r<u.length;r++)if(f=u[r],!this.compareObject(n[f],t[f],!0))return!1;return!0}catch(o){return!1}},checkExistInArray:function(n,t,i){if(t instanceof Array&&t.length>0&&n)for(var r=0;r<t.length;r++)if(this.compareObject(n,t[r],i))return!0;return!1},playAudio:function(n){var t,i;try{t=this;t.isPlayAudio||(n||(n="../Content/Sound/notify.wav"),i=new Audio(n),i.play(),t.isPlayAudio=!0,window.setTimeout(function(){t.isPlayAudio=!1},t.timeShowSoundNotify))}catch(r){}},loadFrame:function(t,r){var e=this.bkavElements[t],o,f,u,s;e&&(o=document.getElementsByName(t),o.length===0?(f=n("<iframe>").attr("name",t).attr("id",t),u=this,u.connection.isLoaded?(s=u.getAppUrl(t),n(e.divContainId).append(f),f.attr("src",s),n(f).ready(function(){typeof r=="function"&&r()})):n.ajax({url:"/Home/GetConnectionSettings"}).success(function(o){var s,h;u.connection.ParentDomain=o.ParentDomain;u.connection.KNTCLink=o.KNTCLink+u.connection.KNTCLink;u.connection.ChatLink=o.ChatLink;u.connection.MailType=o.MailType;o.MailType==i.Bmail?(u.connection.BmailLink=o.BmailLink+u.connection.BmailLink,u.connection.BmailLink+="&domain"+u.connection.ParentDomain):(s=localStorage.getItem("mdaemonUrl"),s!=undefined?(u.connection.BmailLink=s,u.connection.CalendarLink=s):(u.connection.BmailLink=o.BmailLink,u.connection.CalendarLink=o.BmailLink));u.connection.isLoaded=!0;document.domain=u.connection.ParentDomain;h=u.getAppUrl(t);f.attr("src",h);n(e.divContainId).append(f);n(f).ready(function(){typeof r=="function"&&r()});u.showHideApp(o)})):(t==="kntc"&&(o[0].src=this.connection.KNTCLink),typeof r=="function"&&r()))},displayApp:function(t,i){var r,u;(r=this.bkavElements[t],r)&&(u=n('.menu-items a[data-ng-app = "'+t+'"]'),u.hasClass("active")||(n(".menu-items .active").removeClass("active"),u.addClass("active")),n(r.divContainId).siblings().hide(),n(r.divContainId).show(),r.iframeName&&(n("#colorTheme").attr("class",r.color),this.loadFrame(t,i),this.changeSearchApp(t)),t==="links"&&n(r.divContainId).is(":empty")&&n(r.divContainId).load("/Home/Linkeds"))},isCurrentFrame:function(t){var i,r;return(i=this.bkavElements[t],!i)?!1:(r=n('.menu-items a[data-ng-app = "'+t+'"]'),r.hasClass("active"))},getAppUrl:function(n){var t;switch(n){case"documents":return"/Home/Index";case"chat":return this.connection.ChatLink;case"calendar":return this.connection.CalendarLink;case"contact":return this.connection.ContactMobile;case"report":return"/ReportViewer/Index";case"statistics":return"/statistics/Index";case"overall":return"/Statistics/Index";case"kntc":return this.connection.KNTCLink;case"cbcl":return"/EvaluationCriteria/Index";case"calendarregiter":return"/Calendar/Index";default:return t=this.connection.BmailLink,this.isTool&&(t+="&client=tool"),t}},changeCreateButtonName:function(i){switch(i){case"documents":n(".li-create-new .create-new-label").text(t("egov.resources.lblDocument"));break;case"chat":n(".li-create-new .create-new-label").text(t("egov.resources.lblNewConversion"));break;case"calendar":n(".li-create-new .create-new-label").text(t("egov.resources.lblNewWorkTime"));break;case"bmail":n(".li-create-new .create-new-label").text(t("egov.resources.lblNewMail"));break;default:n(".li-create-new .create-new-label").text(t("egov.resources.lblNewMail"))}},changeSearchApp:function(i){switch(i){case"documents":n(".form-search").show();n(".search-type-btn").show();n("#MainSearchQuery").attr("placeholder",t("egov.resources.searchDocument"));break;case"chat":n(".form-search").hide();break;case"calendar":n(".form-search").hide();break;default:n(".form-search").show();n(".search-type-btn").hide();n("#MainSearchQuery").attr("placeholder",t("egov.resources.searchMail"))}},destroyEvent:function(n){n&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation())},changeTitle:function(n,t){window.document.title=this.change?n:t;this.change=!this.change},timer:function(n){var i="eGovCloud",r=this;helper.clearChangeTitle&&(window.clearInterval(helper.clearChangeTitle),window.document.title=i);n>0&&(helper.clearChangeTitle=window.setInterval(function(){r.changeTitle(t("egov.resources.youHave")+" "+n+" "+t("egov.resources.unreadDocuments"),i)},1e3))},deleteAllLocalStorage:function(){"localStorage"in window&&window.localStorage!==null&&window.localStorage.clear()},deleteAllCookies:function(){for(var i=document.cookie.split(";"),n=0;n<i.length;n++){var t=i[n],r=t.indexOf("="),u=r>-1?t.substr(0,r):t;document.cookie=u+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}},setCookie:function(n,t,i){var r=new Date,u;r.setTime(r.getTime()+i*864e5);u="expires="+r.toUTCString();document.cookie=n+"="+t+"; "+u},getCookie:function(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return""},loadCss:function(t){var i=n("<link>");n("head").append(i);i.attr({rel:"stylesheet",type:"text/css",href:t})},loadJs:function(t){n.getScript(t)},loadBmailResources:function(){var t=this;n.each(this.connection.CssLinks,function(n,i){t.loadCss(i)});n.each(this.connection.JsLinks,function(n,i){t.loadJs(i)})},showHideApp:function(t){(t.BmailLink==undefined||t.BmailLink=="")&&n(".bmail, .calendar").remove();(t.ChatLink==undefined||t.ChatLink=="")&&n(".chat").remove()}}}(window.jQuery),function(n,t,i){"use strict";function c(){window.document.isFocused=!1}function l(){window.document.isFocused=!0}function a(){var n=!1;try{n=typeof window.external.CB_ShowNotify=="function"}catch(t){console.log(t)}return n}function v(n){return typeof n=="function"}function b(n){var i,t;try{i=this;n||(n="../Content/Sound/notify.wav");t=new Audio(n);t.play()}catch(r){}}function k(n){return typeof n=="string"?new Date(n.replace(/T/i," ")):new Date(n)}function d(n,i){if(i==undefined||i==="")return n;var r=t.last(i.split("/"));return n+" đã gửi vào "+g(r)}function g(n){return(n=n.toLowerCase(),n==="inbox")?"Hộp thư đến":n==="sent"?"Hộp thư đi":n==="junk"?"Thư đã xóa":n==="drafts"?"Thư rác":n}var r={getConfig:"/Notification/GetConfig",fetch:"/Parallel/Notification_GetNotSents",getData:"/Notification/GetData",pulling:"/Notification/GetLastestMails",update:"/Notification/Update",removeAll:"/Notification/RemoveAll",remove:"/Notification/Remove",oldAll:"/Notification/OldAll",readAll:"/Notification/ReadAll",read:"/Notification/Read",setBmailFolder:"/Notification/SetMailFolderNotify"},e=function(){this._hasWebNotification=!1;this._instance=null;this._notification=null;this._chromeNotificationTemplateType={basic:"basic",image:"image",list:"list",progress:"progress"};this._chromeNotificationOptions={type:"basic",iconUrl:"",appIconMaskUrl:"",title:"",message:"",contextMessage:"",priority:0,eventTime:0,buttons:[],imageUrl:"",items:[],progress:0,isClickable:!1,requireInteraction:!1};this.Instance=function(){return this._instance||(this._instance=new e,this._checkBrowserNotification()),this};this.show=function(n){if(this._hasWebNotification){var n=this._create(n);return n}};this.showList=function(){};this._create=function(n){var f=n.get("Title"),r=n.get("Body"),e=n.get("Avatar"),u=n.Callback,i=n.get("alternateContent"),t;return i!=undefined&&i!=""&&(r=i),t=new this._notification(f,{body:r,icon:e,silent:!1,sound:"../Content/Sound/notify.wav",requireInteraction:!0}),t.onclick=function(){t.close();v(u)&&u(n)},t};this._checkBrowserNotification=function(){var t=this,n;this._notification=chrome.notifications||window.Notification||window.mozNotification||window.webkitNotification;this._notification||(this._hasWebNotification=!1);n=this._notification.permission;n=="default"?this._notification.requestPermission(function(n){t._hasWebNotification=t.notificationManager.permission!==n}):this._hasWebNotification=n=="granted"}},o=function(){this._isDesktop=!1;this._instance=null;this.type=3;this.Instance=function(){return this._instance||(this._instance=new o,this._isDesktop=this.checkDesktopApp()),this._instance};this.show=function(n){var t=this,r=n.get("Title"),u=n.get("Body"),e=window.location.origin+"/logo.png",o=n.Callback,s=n.get("JsonData"),c=s.SenderUserName,i=n.get("alternateContent"),f;i!=undefined&&i!=""&&(u=i);try{f=[{info:{title:r,content:u,account:"egov",avatar:e,fullname:r,duration:t.type==3?5:0,type:t.type},callback:o,callbackdata:{notificationId:n.get("NotificationId"),type:t.type}}];window.external.CB_ShowNotify(JSON.stringify(f))}catch(h){this._isDesktop=!1;console.log(h)}};this.checkDesktopApp=function(){return a()}},u={mail:{name:"bmail",isActive:!1,displayName:"Thông báo mail",el:".div-bmail-notify",icon:"../Content/bkav.egov/icon egov/egov-11.png",announIcon:"../Content/bkav.egov/icon egov/egov-16.png",total:0,model:[],callback:{frameName:"",api:"readNewMail"},isValidData:function(n){var u=n.title,i=n.folderLocation,r=!1,f=this.followFolders;return u.indexOf("[Spam]")>=0?r:(i.indexOf("/")!=0&&(i="/"+i),t.indexOf(f,i)<0)?r:!0},isFocus:function(){return n(".menu-items .bmail").is(".active")}},egov:{name:"documents",isActive:!1,displayName:"Thông báo xử lý văn bản",el:".div-eGov-notify",icon:"../Content/bkav.egov/icon egov/egov-01.png",announIcon:"../Content/bkav.egov/icon egov/egov-14.png",total:0,model:[],callback:{frameName:"documents",api:"openNotify"},isFocus:function(){return n(".menu-items .egov").is(".active")}},chat:{name:"chat",frameName:"",isActive:!1,displayName:"Thông báo chat",el:".div-chat-notify",icon:"../Content/bkav.egov/icon egov/egov-10.png",announIcon:"../Content/bkav.egov/icon egov/egov-10.png",total:0,model:[],callback:{frameName:"",api:"openChat"},isFocus:function(){return n(".menu-items .chat").is(".active")}}},f=i.Model.extend({defaults:{NotificationId:0,UserId:0,Title:"",Body:"",alternateContent:"",Avatar:"",DateCreated:"",AppName:"",IsNew:!0,IsReaded:!1,OnlyAnnoun:!1,IsCreatedByClient:!1,JsonData:{}}}),s=i.Collection.extend({model:f}),y='<li id="${NotificationId}" app="${AppName}" class="list-group-item {{if IsReaded == false}} unview {{/if}}">  <a href="#" class="open-notify row">    <div class="col-md-3">        <img src="${Avatar}" class="avatar"/>    <\/div>    <div class="col-md-13">         <div>            <div class="notify-usersend">${Title}<\/div>            <div class="notify-content">{{html Body}}<\/div>            <div class="notify-date">${DateCreated}<\/div>         <\/div>    <\/div>    <span class="close-notify" title="Xóa thông báo">x<\/span>    <\/a><\/li>',h=0,p=10,w=i.View.extend({el:"#notificationCenter",events:{"click .notifyBell":"_setOlds"},_isDesktop:!1,_registedApps:{},template:' <a href="#" class="ripple-ef dropdown-toggle" data-toggle="dropdown">     <img src="${icon}" />     <span class="notify-count" data-count="0"><\/span><\/a><div class="dropdown-menu" role="menu">     <div class="headerrow text-right">         <a href="#" class="btnReadAll">Đánh dấu tất cả là đã đọc<\/a>         <a href="#" class="btnCloseAll">Xóa tất cả<\/a>     <\/div>     <ul class="notification list-group"><\/ul>     <div class="text-center loading-image"><\/div><\/div>',model:new s,initialize:function(n){var t=this;t.lastId=0;t.settings=n.settings;t._getNotificationConfig(function(n){t._registedApps=n;t._isDesktop=a()});t.render()},render:function(){var i=this,r,t;i.$(".notifyBell").remove();for(r in i._registedApps)t=i._registedApps[r],t.$el=n(t.el),t.$el.length===0&&(t.$el=n("<li>").addClass("pull-left hidden notifyBell").addClass(t.el).attr("app",r),i.$el.prepend(t.$el)),t.isActive&&t.$el.removeClass("hidden"),t.$el.html(n.tmpl(i.template,{icon:t.icon})),t.$count=t.$el.find(".notify-count"),t.$notificationList=t.$el.find(".notification"),t.model=new s,i._bindNotificationItems(t);this.fetch();this._bindEvents();this._registerApiToGlobal();this._registerTriggers()},fetch:function(){var i=this,u;n.ajax({url:r.fetch,success:function(n){u(n)}});u=function(n){n&&n.length>0&&(i.lastId=t.last(n).NotificationId,i.model.add(n))}},_pulling:function(){var t=this;setInterval(function(){n.ajax({url:r.pulling})},6e4);setInterval(function(){t.fetch()},6e4)},_getNotificationConfig:function(n){var f=this,t=f.settings,i,e,r,o;if(!t){n(null);return}i=[];t.hasshowdocumentnotify&&(e=u.egov,e.isActive=!0,i[e.name]=e);t.hasshowmailnotify&&(r=u.mail,r.isActive=!0,r.followFolders=t.mailfoldernotify===undefined?[]:t.mailfoldernotify.toLowerCase().split(","),i[r.name]=r);t.hasshowchatnotify&&(o=u.chat,o.isActive=!0,i[o.name]=o);f.RemoveRead=t.removeread;f.HasShowDesktop=t.hasshowdesktop;f.HasPlaySound=t.hasplaysound;n(i);return},_bindNotificationItems:function(n){var i=this,t=[];n.$notificationList.empty();this._changeNotifyTotal(n);this.model.each(function(i){i.get("AppName")==n.name&&t.push(i.toJSON())});t=t.reverse();n.$notificationList.html(i._parseNotifyItems(t))},_showNotificationLists:function(n){n.$el.click();n.$el.addClass("open")},_parseNotifyItems:function(t){var r=this,i;return t.defaultAvatar="/AvatarProfile/noavatar.jpg",i=n.tmpl(y,t),i.click(function(n){r._openNotifyInBell(n)}),i.find(".close-notify").click(function(n){r._remove(n)}),i.find(".avatar").error(function(){r.imageError(this)}),i},_bindListAndShowDesktop:function(n,t){var i;if(i=this._getApp(n.get("AppName")),!i)throw"App name không đúng.";this._bindNotificationItems(i);t&&n.get("IsNew")&&this._showDesktop(n)},_changeNotifyTotal:function(n){var t=this.model.where({IsNew:!0,AppName:n.name}).length;n.$count.text(t>99?"99+":t);t>0?n.$count.show():n.$count.hide()},_removeNotify:function(n){var t=n.get("AppName"),i=this._getApp(t);n.view&&n.view.close();this._bindNotificationItems(i)},_registerApiToGlobal:function(){var n=this;window.openNotifyFromExternal=function(t){var i,r;(typeof t=="string"&&(t=JSON.parse(t)),i=n.model.detect(function(n){return n.get("NotificationId")==t.notificationId}),i.length!=0)&&(r=n._getApp(i.get("AppName")),n._openNotify(r,i))};window.registerNotificationApp=function(t){var i=t.AppName,r=n._getApp(i);if(r!=undefined)throw"AppName đã có trong hệ thống";n._registedApps[i]=t;n.render()};window.pushNotifyFromClient=function(t){var i=[];i.push(t);n._postToServer(i);t.IsReaded&&(n._removeSimilarBeforeAdd(t),typeof t!="NotifyModel"&&(t=new f(t)),n.model.add(t))};window.pushNotifyFromServer=function(t){n._removeSimilarBeforeAdd(t);typeof t!="NotifyModel"&&(t=new f(t));n.model.add(t)};window.addBmailNotify=function(t){var i=n._getApp("bmail");if(i!=undefined&&i.isValidData(t)){var u={NotificationType:2,Title:t.fullName,Content:t.title,SenderAvatar:t.avatar,SenderUserName:t.userName,SenderFullName:t.fullName,Date:t.date,ReceiveDate:new Date,MailId:t.mailId,FolderId:t.folderId,FolderLocation:t.folderLocation},f={NotificationId:0,Title:d(t.fullName,t.folderLocation),GroupId:t.mailId,Body:t.title,Avatar:t.avatar,DateCreated:new Date,IsNew:!0,AppName:"bmail",JsonData:JSON.stringify(u)},r=[];r.push(f);n._postToServer(r)}};window.setMailRead=function(t){var i=n.model.detect(function(n){return n.get("GroupId")===t});i!=undefined&&i.set("IsReaded",!0)};window.addChatNotify=function(n){var r,u;if(n&&(r=n.sender,u=n.chatterJid,r&&u)){r=r.split("@")[0];u=u.split("@")[0];var f=t.find(egov.setting.allUsers,function(n){return n.username===r}),s=t.find(egov.setting.allUsers,function(n){return n.username===u}),i={NotificationType:3,Title:f.label,Content:n.content.split("\r\n")[0],SenderAvatar:f.avatar,SenderUserName:f.username,SenderFullName:f.fullname,Date:n.date,ReceiveDate:new Date,ChatId:n.messageId,ChatterJid:n.chatterJid,messageId:n.messageId,IsNewChat:!0};i.Content.indexOf("&amp;message=")>=0&&(i.Content=i.Content.split("&amp;message=")[1]);i.Content=escape(i.Content);var e=!1,h=!e,c=i.Content,o={NotificationId:0,Title:i.Title,Body:c,alternateContent:i.originalContent,Avatar:f.avatar,DateCreated:n.date,AppName:"chat",GroupId:n.chatterJid,IsViewed:!1,UserId:s.value,IsReaded:e,IsNew:h,JsonData:JSON.stringify(i)};console.log(o);pushNotifyFromClient(o)}};window.eGovReadChat=function(t){n.model.each(function(n){n.get("AppName")=="chat"&&n.get("GroupId")==t&&n.set("IsReaded",!0)})};/*@cc_on!@*/!1?(document.onfocusin=l,document.onfocusout=c):(window.onfocus=l,window.onblur=c)},_registerTriggers:function(){var i=this;this.model.on("update",function(f,e){var o=e.changes.added,h,s,l,a,c;o.length>0&&(h=i.HasShowDesktop,s=t.filter(o,function(n){return n.get("IsNew")}),s.length>2&&(l=s[0].get("AppName"),i._showAnnounMessage(l,"Bạn có "+s.length+" thông báo mới."),h=!1),o.forEach(function(n){n.set("DateCreated",k(n.get("DateCreated")).relativeDate());var t=n.get("NotificationId");i.lastId<t&&(i.lastId=t);n.set("Body",unescape(n.get("Body")));i._bindListAndShowDesktop(n,h)}),a=t.find(o,function(n){return n.get("AppName")===u.egov.name}),a&&i._reloadDocumentTree());c=e.changes.removed;c.length>0&&c.forEach(function(t){i._removeNotify(t);var u=t.get("NotificationId");u>0&&n.ajax({url:r.remove,type:"Post",data:{id:t.get("NotificationId")}})})});this.model.on("change:IsReaded",function(t){if(i.RemoveRead){i.model.remove(t);n.ajax({url:r.remove,type:"Post",data:{id:t.get("NotificationId")}});return}var u=i._findNotificationElement(t);u.length>0&&u.removeClass("unview");t.view&&t.view.close();t.get("IsNew")&&(t.set("IsNew",!1),n.ajax({url:r.read,type:"Post",data:{id:t.get("NotificationId")}}))});this.model.on("change:IsNew",function(n){var t=i._getApp(n.get("AppName"));i._changeNotifyTotal(t)})},_reloadDocumentTree:function(){var n,i=this._getApp(u.egov.name),t,r;if(!i||i.isActive===!1)throw"App name không đúng.";(t=window.document.getElementsByName(i.callback.frameName),t!=null&&t.length!=0)&&(n=t[0].contentWindow,n&&n.egov&&n.egov.pubsub&&(r="tree.reload",n.egov.pubsub.publish(r),n.egov.pubsub.publish("tree.reloadSelected")))},_bindEvents:function(){var n=this;n.$(".btnCloseAll").click(function(t){n._removeAll(t)});n.$(".btnReadAll").click(function(t){n._readAll(t)});n.$("ul").scroll(function(t){n._scrollToGetData(t)})},_scrollToGetData:function(t){var r=this,i=n(t.target);i.scrollTop()+i.innerHeight()>=t.target.scrollHeight&&r.getData()},getData:function(){var t=this,i=n("<img/>").attr("src","/Content/Images/ajax-loader-small.gif"),u;n.ajax({url:r.getData,data:{pageIndex:h,pageSize:p},success:function(n){u(n)},beforeSend:function(){t.$(".loading-image").append(i)},complete:function(){i.remove()}});u=function(n){n.length>0&&(t.model.add(n),h++)}},_setOlds:function(t){var f=n(t.target).closest("li"),i=f.attr("app"),u;this.model.each(function(n){n.get("AppName")===i&&n.get("IsNew")==!0&&n.set("IsNew",!1)});u=this._getApp(i);this._changeNotifyTotal(u);n.ajax({url:r.oldAll,type:"Post",data:{appName:i,lastId:this.lastId}})},_removeAll:function(t){var u=n(t.target).closest("li"),i=u.attr("app"),f=this.model.where({AppName:i});this.model.remove(f);n.ajax({url:r.removeAll,type:"Post",data:{appName:i,lastId:this.lastId}})},_readAll:function(t){var u=n(t.target).closest("li"),i=u.attr("app");this.model.each(function(n){n.get("AppName")===i&&n.get("IsReaded")==!1&&n.set("IsReaded",!0)});n.ajax({url:r.readAll,type:"Post",data:{appName:i,lastId:this.lastId}})},_remove:function(t){var u=n(t.target).closest("li"),i=u.attr("id"),f=this.model.detect(function(n){return n.get("NotificationId")==i});this.model.remove(f);n.ajax({url:r.remove,type:"Post",data:{id:i}})},_showAnnounMessage:function(n,t){var i=this._getApp(n),r=new f({NotificationId:0,Title:"Thông báo",Body:t,AppName:n,Avatar:i.AnnounIcon,OnlyAnnoun:!0,JsonData:{}});this._showDesktop(r)},_showDesktop:function(n){if(n.get("IsNew")!=!1){var t=this;if(this._isDesktop){n.Callback="openNotifyFromExternal";n.view=this._showNotifyInDesktop(n);return}if(this._egovTabIsActive(n.get("AppName"))){n.view=this._showNotifyInBrowserTab(n);return}n.Callback=function(n){t._openNotifyDesktop(n)};n.view=(new e).Instance().show(n)}},_showNotifyInBrowserTab:function(){this.HasPlaySound&&b()},_showNotifyInDesktop:function(n){return(new o).show(n)},_openNotifyDesktop:function(n){var t;if(n!=null){if(t=this._getApp(n.get("AppName")),!t||t.isActive===!1)throw"App name không đúng.";if(n.get("OnlyAnnoun")){this._activeTab();return}if(t=this._getApp(n.get("AppName")),!t||t.isActive===!1)throw"App name không đúng.";this._openNotify(t,n)}},_openNotifyInBell:function(t){var i=n(t.target).closest("li"),r=i.attr("app"),u=i.attr("id"),f=this._getApp(r),e=this.model.detect(function(n){return n.get("NotificationId")==u});this._openNotify(f,e)},_openNotify:function(n,t){t&&(this._activeTab(),t.set("IsReaded",!0),this._notifyCallback(n,t))},_notifyCallback:function(n,t){var i,r,u;n.callback&&n.callback.api&&n.callback.api!==""&&(u=function(i){i!==undefined&&(r=i[n.callback.api],v(r)&&r(t.get("JsonData")))},n.callback.frameName==""?(i=window,u(i)):mainApps.openApp(n.name,function(){var t=window.document.getElementsByName(n.callback.frameName);t!=null&&t.length!=0&&(i=t[0].contentWindow,u(i))}))},_postToServer:function(t){t.length!==0&&n.ajax({url:r.update,type:"POST",data:{addeds:JSON.stringify(t)},success:function(){},error:function(){}})},_egovTabIsActive:function(n){var i=window.document.isFocused===!0,t;return i?(t=this._getApp(n),t&&!t.isFocus())?!1:!0:!1},_activeTab:function(){window.focus()},_getApp:function(n){return this._registedApps[n]},_findNotificationElement:function(n){var t=n.get("AppName"),i=n.get("NotificationId"),r=this._getApp(t);return r.$notificationList.find("#"+i)},_removeSimilarBeforeAdd:function(n){var t=this.model.select(function(t){return t.get("AppName")==n.AppName&&t.get("GroupId")==n.GroupId});t.length>0&&this.model.remove(t)},imageError:function(t){n(t).attr("src","/AvatarProfile/noavatar.jpg")},test:function(){this.testInterval;var r=this,n=["tienbv","dambv","tamdn","dunghv","dungnvl","phucnhb","cuongnt","taimv"],i=["Nghẹn ngào giây phút ta chấp nhận sống không cần nhau","Chẳng khác chi trái đất này làm sao tồn tại không có mặt trời","Chỉ biết lặng nhìn em quay lưng bước đi lòng anh thắt lại","Nghĩ đến mình sẽ không gặp lại.","Tình yêu đâu phải ai cũng may mắn tìm được nhau","Chẳng giống như chúng ta tìm được nhau rồi lại hoang phí duyên trời","Lắng Nghe Nước Mắt lyrics on ChiaSeNhac.vn","Tại sao phải rời xa nhau mãi mãi, biết đến khi nào chúng ta","Nhận ra chẳng thể quên được nhau."];this.testInterval=setInterval(function(){var r=t.sample(n),u=t.sample(i);window.pushNotifyFromClient({NotificationId:0,Title:r,GroupId:r,Body:u,Avatar:"https://danhba.bkav.com/avatars/"+r+".bmp",DateCreated:new Date,AppName:"chat",IsNew:!0,JsonData:'{DocumentCopyId: 1778,Compendium: "Phạm Quang Ba (Phòng Khám Nha khoa Sài Gòn Colgate 2) "}'})},5e3)},stopTest:function(){clearInterval(this.testInterval)}});window.eGovNotification=w}(window.jQuery,window._,window.Backbone,window.notify),function(n,t,i){"use strict";var r=n.connection.hubs;n.connection.hub.logging=!1;n.connection.hub.start(function(){});n(window).off("unload").on("unload",function(t){n.connection.hub.disconnected(function(){console.log("disconnected!")});i&&i.destroyEvent(t)});n.connection.hub.reconnected(function(){try{console.log("reconnected!")}catch(n){console.log("Reconnected error!")}});n.connection.hub.error(function(n){if(n)try{console.log(n)}catch(t){console.log(t.message)}});r.client.notification=function(n){try{if(!egov.isMobile&&currentApp&&currentApp.name=="mail"&&document.hasFocus())return;typeof pushNotifyFromServer=="function"&&window.pushNotifyFromServer(n)}catch(t){console.log(t.message)}};r.client.mailNotification=function(n){try{window.bmailNotify.addToModel(JSON.parse(n.JsonData))}catch(t){console.log(t.message)}};r.client.updateViewAllNotify=function(){try{window.eGovNotify.setViewAll()}catch(n){console.log(n.message)}};r.client.updateViewNotify=function(n){try{t.reBindNotify(n)}catch(i){console.log(i.message)}};r.client.reloadPage=function(){try{document.location.reload(!0)}catch(n){console.log(n.message)}}}(window.jQuery,window.eGovNotify,window.helper),function(n){function s(){if(egov.utilities)return egov.utilities.url.getQueryStringValue("client")==="tool";require(["util/bkav.utilities"],function(){return egov.utilities.url.getQueryStringValue("client")==="tool"})}var t=n(".menu-items"),r=n(".site-content"),f=function(n){n.qtip({position:{at:"center right",my:"left center"}})},u=function(n){typeof n=="function"&&n()},e,i;f(n("#btnNewApp"));e='<a href="#" class="list-group-item{{if isCustomApp}} customapp{{/if}}" id="${name}" data-ng-app="${name}" title="${title}"><div class="btnDelete" appid="${id}">x<\/div><img src="${icon}" /><\/a>';window.mainApps={init:function(n){if(n instanceof Array)for(var t=0;t<n.length;t++)mainApps.initApp(n[t]);else mainApps.initApp(n)},isTool:s(),initApp:function(i){var r=n.extend({id:"",name:"",title:"",appUrl:"",icon:"",isActive:!0,isMainApp:!1,isBackgroundApp:!1,isCustomApp:!1},i),u,o;if(r.isActive){u=t.children("[data-ng-app='"+r.name+"']");u.length==0?(u=n.tmpl(e,r),t.children().last().before(u)):u.removeClass("hidden");r.$elItem=u;f(u);mainApps.setConfig(r);r.isMainApp&&mainApps.openApp(r);r.isBackgroundApp&&setTimeout(function(){mainApps.addDivApp(r.name,r.appUrl)},5e3);o=mainApps;u.on("click",function(){o.openApp(r)})}return u},getConfig:function(n){return mainApps[n]},setConfig:function(n){mainApps[n.name]=n},deleteAllLocalStorage:function(){"localStorage"in window&&window.localStorage!==null&&window.localStorage.clear()},destroyEvent:function(n){n&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation())},openApp:function(n,i){var e=this,r,f;(typeof n!="string"||(n=mainApps.getConfig(n),n))&&(f=function(){try{window.currentApp=e.getContentWindow(n.name);window.currentApp.name=n.name;mainApps.changeSearchApp(n.name);localStorage.setItem("appCurrentOpen",n.name)}catch(t){}u(i)},t.children().removeClass("active"),t.children("."+n.name).addClass("active"),n.$el!=undefined&&n.$el.length>0?(r=n.$el,f()):r=mainApps.addDivApp(n.name,n.appUrl,f),egov.chatDesktop&&egov.pubsub&&egov.pubsub.publish("chatdesktop.active",n.hasShowChat),r.siblings().hide(),r.show())},getContentWindow:function(n){try{return r.find("iframe#"+n)[0].contentWindow}catch(t){}},addDivApp:function(t,i,f){var e=r.children("."+t),o;return e.length==0?(e=n("<div class='"+t+"' style='display: none;' id='div-"+t+"' />"),o=n("<iframe>").attr("name",t).attr("id",t),o.attr("src",i),e.append(o),r.append(e),n(o).ready(function(){u(f)})):u(f),mainApps[t].$el=e,e},changeSearchApp:function(t){switch(t){case"documents":n(".form-search").show();n(".search-type-btn").show();n("#MainSearchQuery").attr("placeholder",getResource("egov.resources.searchDocument"));break;case"bmail":n(".form-search").show();n(".search-type-btn").hide();n("#MainSearchQuery").attr("placeholder",getResource("egov.resources.searchMail"));break;default:n(".form-search").hide()}}};var h={Bmail:1,Gmail:2,Yahoo:3,MailExchange:4,MDaemon:5},c=function(t){n.ajax({url:"/Home/GetConnectionSettings"}).success(function(n){localStorage&&localStorage.setItem("connectionSettings",JSON.stringify(n));t(n)})},o=function(n){var r,u,t,i;h.Bmail==n.MailType?(n.BmailLink=n.BmailLink+"?egov=1&domain="+n.ParentDomain,n.CalendarLink=n.BmailLink+"?egov=1&calendar=1&domain="+n.ParentDomain):(r=localStorage.getItem("mdaemonUrl"),r!=undefined&&(n.BmailLink=r,n.CalendarLink=r));systemApps=systemApps.sort(function(n,t){return n.Order-t.Order});for(u in systemApps)t=systemApps[u],i=t.Name,(i==="bmail"||i==="chat")&&t.AppUrl&&(t.AppUrl+=t.AppUrl.indexOf("?")>0?"&domain="+n.ParentDomain:"?domain="+n.ParentDomain),new mainApps.init({id:t.Id,name:t.Name,title:t.Title,icon:t.IconUrl,appUrl:t.AppUrl,isBackgroundApp:t.IsBackgroundApp,isMainApp:t.IsDefaultApp,isActive:t.IsActived,hasShowChat:i==="documents"||i==="bmail"})};localStorage&&(egov=egov||{},i=localStorage.getItem("connectionSettings"),i?(o(JSON.parse(i)),egov.connections=JSON.parse(i)):c(function(n){egov.connections=n;o(n)}))}(window.jQuery),function(){function w(){for(var e,r,f=document.cookie.split(";"),u=0;u<f.length;u++)e=f[u].indexOf("="),r=e>-1?f[u].substr(0,e):f[u],r=r.trim(),r==="bkavAuthen"&&($.cookie(r,"",{domain:document.domain,path:"/",expires:-1}),$.cookie(r,"",{expires:-1}));logoutDesktop();$(window).on("unload",function(){var i=n.getContentWindow(t);i&&i.egov&&i.egov.dataManager&&i.egov.dataManager.reset({success:function(){window.location.reload(!0)}});n.deleteAllLocalStorage()});i.currentUserName!=undefined&&$.get(i.eGovSso+"/User/Logout?userName="+i.currentUserName,{});window.document.location.href="/account/logout"}function b(){var n=$(".panel-container").layout({resizable:!1,closable:!0,spacing_closed:0,spacing_open:0,west__spacing_open:0,west__size:40,west__zIndex:1,west__paneSelector:".west-panel",center__paneSelector:".center-panel"});$(".center-panel").layout({resizable:!1,closable:!0,spacing_closed:0,spacing_open:0,north__spacing_open:0,north__size:45,north__zIndex:1,north__paneSelector:".site-header",center__paneSelector:".site-center"})}function e(){n.openApp(r,function(){window.currentApp.$("#composeMailTab").click()})}function o(i,r,u,f){n.openApp(t,function(){var n=currentApp,e=n.egov.setting.userName,t=[];if(f==undefined||f.length===0){n.egov.views.home.tab.addDocument(i,r,null,!1,null,u);return}$.each(f,function(n,i){t.push({FileName:i.filename,Url:i.filepart})});$.ajax({type:"POST",url:"Attachment/UploadAttachmentInLink",data:{urls:JSON.stringify(t)},success:function(t){var f=[];$.each(t,function(n,t){if(t.error!=="")$(data.id).remove(),egov.message.error(t.name+": "+t.error);else{var i={Id:t.key,Name:t.name,Size:t.size,Extension:t.extension,Versions:[{Version:1,User:e}],isNew:!0};f.push(i)}});n.egov.views.home.tab.addDocument(i,r,null,!1,f,u)},error:function(){}})})}function s(i){i&&n.destroyEvent(i);var r=n.getContentWindow(t);$(window).on("unload",function(){n.deleteAllLocalStorage()});r&&r.egov&&r.egov.dataManager?r.egov.dataManager.reset({success:function(){window.location.reload(!0)}}):window.location.reload(!0)}function k(n){var i=$(".menu-items a.active");i.length!==0&&i.attr("data-ng-app")===t&&currentApp&&currentApp.egov&&currentApp.egov.views.home.documents.clientQuickSearch(n)}function u(){var i=$("#MainSearchQuery").val(),f=parseInt($("#MainSearchType").val()),u=$(".menu-items a.active"),n;if(u.length!==0)if(n=u.attr("data-ng-app"),n===t){if(!currentApp||!currentApp.egov)return;currentApp.egov.views.home.tab.addSearch(i,f)}else n.indexOf(r)>=0&&currentApp.EgovLibrary.doSearch(i)}function h(n,i){var u=!1,r=mainApps.getContentWindow(t);if(r){if(u=r.egov.views.home.tab.hasChangeContent(),u){r.egov.views.home.tab.closeAll(function(){i()});n.preventDefault();return}i()}else i()}function d(){var n=document.getElementById(t).contentWindow;n.showInstallPlugin()}function g(){var n=!1,t=$("#startAbsent").val(),i=$("#endAbsent").val();t!=""&&i!=""&&(n=!0);$.ajax({url:"Account/SaveAbsent",type:"post",data:{hasAbsent:n,startAbsent:t,endAbsent:i},success:function(n){var t=n.hasAbsent?String.format("Tôi sẽ vắng mặt từ: {0} đến {1}",n.data.start,n.data.end):"";egov.pubsub.publish("chat.changestatus",t)}})}function nt(n){var e=$(".new-doctypes"),r,t,i,u,o,f;(e.find(".newDocument").remove(),i=$(".pinnedDocTypes"),u=$(".commonDocTypes"),n!==null&&n.length!==0)&&(r=_.filter(n,function(n){return n.Pinned}),c(r,i,!0),i.append("<li class='divider'><\/li>"),t=n,o=_.uniq(_.pluck(t,"DocFieldId")),f=_.groupBy(t,function(n){return n.DocFieldName}),_.each(f,function(n,t){var r=$.tmpl(p,{DocFieldName:t,Count:n.length}),i;u.append(r);i=r.find(".subDoctype");c(n,i,!1);i.append("<li class='divider'><\/li>");i.hide()}),rt())}function c(n,t,i){(t.empty(),n.length!==0)&&(n=_.sortBy(n,function(n){return n.DocTypeName}),t.html(l(n,i)))}function tt(){var n=$(".commonDocTypes");n.find(".docfield-groups > a").click(function(){return $(this).siblings("ul").toggle(),$(this).find(".icon-arrow-down7").length>0?$(this).find(".icon-arrow").removeClass("icon-arrow-down7").addClass("icon-arrow-right7"):$(this).find(".icon-arrow").removeClass("icon-arrow-right7").addClass("icon-arrow-down7"),!1});$(".li-create-new").hover(function(){$(".li-create-new").removeClass("unactive")},function(){$(".li-create-new").addClass("unactive")});$(".doctypesFilter").click(function(n){return n.preventDefault(),n.stopPropagation(),!1});$("#doctypesSearch").keyup(function(){var n=$(this).val();n.length>0?($(".newDocument[name *= '"+n+"']").removeClass("hidden").show(),$(".newDocument").not("[name *= '"+n+"']").hide().addClass("hidden")):$(".newDocument").show().removeClass("hidden");$(".docfieldCount").each(function(){var n=$(this).parents("li.docfield-groups"),t=n.find("ul.subDoctype li.newDocument:not('.hidden')").length;$(this).text(" ("+t+")")})})}function l(n,t){n=_.each(n,function(n){var t=et(n.ActionLevel);return n.iconName=t,n});var u=t?v:y,r=$.tmpl(u,n);return r.find(".create-new-document").click(function(){var n=$(this).attr("id"),t=$(this).attr("name");o(n,t);$(".li-create-new").addClass("unactive")}),r.find(".pinDocType").click(function(n){var r,t,u;(n.stopPropagation(),r=$(this).attr("id"),t=_.find(i.doctypes,function(n){return n.DocTypeId==r}),t!=undefined)&&($(this).is(".isPined")||!t.Pinned)&&(it(r),t.Pinned=!t.Pinned,t.Pinned?(u=l(t,!0),$(".pinnedDocTypes").prepend(u)):$(this).parents(".newDocument").remove())}),r}function it(n){n!=undefined&&n!==""&&$.ajax({url:"/Account/PinDocType",type:"Post",data:{docTypeId:n}})}function rt(){var n=$(".new-doctypes").find(".divider");n.removeClass("hidden");_.each(n,function(n){$(n).siblings("li").length===0?$(n).addClass("hidden"):$(n).removeClass("hidden")});n.last().addClass("hidden")}function ut(i){var f=n.getContentWindow(t),u;f&&f.egov.views.home.changeSize(i);ft("ViewSize",i,365);u=n.getContentWindow(r);u&&(i===0?$("#layout-doc",u.document).removeClass("medium-size large-size"):($("#layout-doc",u.document).removeClass("medium-size large-size"),$("#layout-doc",u.document).addClass(i==1?"medium-size":"large-size")))}function ft(n,t,i){var r=new Date,u;r.setTime(r.getTime()+i*864e5);u="expires="+r.toUTCString();document.cookie=n+"="+t+"; "+u}function et(n){switch(n){case 1:return"/Content/bkav.egov/times/ico-nam.png";case 2:return"/Content/bkav.egov/times/ico-nuanam.png";case 3:return"/Content/bkav.egov/times/ico-quy.png";case 4:return"/Content/bkav.egov/times/ico-month.png";case 5:return"/Content/bkav.egov/times/ico-week.png";case 6:return"/Content/bkav.egov/times/ico-day.png";default:return"/Content/bkav.egov/times/ico-khancap.png"}}var r="bmail",a="chat",t="documents",n=window.mainApps,f={enter:13,f5:116},v='<li class="newDocument" id="${DocTypeId}" name="${DocTypeName}"><a href="#" class="create-new-document" id="${DocTypeId}" name="${DocTypeName}"><img src="${iconName}" style="width: 25px;"> ${DocTypeName} <img class="pinDocType isPined" src="/Content/Images/Icons/unpin.png" title="Bỏ gắn lên đầu danh sách" id="${DocTypeId}"><\/a><\/li>',y='<li class="newDocument" id="${DocTypeId}" name="${DocTypeName}"><a href="#" class="create-new-document" id="${DocTypeId}" name="${DocTypeName}"><img src="${iconName}" style="width: 25px;"> ${DocTypeName} <img class="pinDocType" src="/Content/Images/Icons/pin.png" title="Gắn lên trên đầu danh sách" id="${DocTypeId}"><\/a><\/li>',p='<li class="docfield-groups"><a href="#"><span class="icon-arrow icon-arrow-right7"><\/span><span>Lĩnh vực ${DocFieldName}<\/span><span class="docfieldCount"> (${Count})<\/span><\/a><ul class="subDoctype" data-docfieldid="${DocFieldName}" style=""><\/ul><\/li>',i={eGovSso:window.eGovSso,currentUserName:window.currentUserName,init:function(){b();$("#logout, .btnlogout").on("click",function(t){n.destroyEvent(t);w()});$(".avatar").error(function(){$(this).attr("src","/AvatarProfile/noavatar.jpg")});$(".app-size").click(function(){var n=$(this).attr("data-value"),t=n==="small-size"?0:n==="medium-size"?1:2;ut(t)});$("li > a.preview").click(function(){var i=$(this).attr("data-value"),n=mainApps.getContentWindow(t);n&&n.egov.views.home.showPreview(i,!0)});$(".create-new").click(function(){e()});$("#resetSystem").on("click",function(n){s(n)});$("#MainSearchQuery").on("click",function(){$(this)[0].setSelectionRange(0,$(this).val().length)});$(".form-group .search-btn").click(function(){u()});$("#installPlugin").on("click",function(){d()});$(".search-type-btn a[role=menuitem]").click(function(){$("#MainSearchType").val(parseInt($(this).data("value")));$("#MainSearchQuery").focus()});$("#absentDialog .datetime").datepicker({dateFormat:"dd/mm",onSelect:function(n,t){$(t.input).val((new Date).format("HH:mm ")+n)}});$("#saveAbsent").click(function(){g()});$("#cancelAbsent").click(function(){$("#absentDialog .datetime").val("")})},initKeyPress:function(){$(document).keyup(function(n){var t=$("#MainSearchQuery").is(":focus");t&&(n.keyCode===f.enter&&u(),k($("#MainSearchQuery").val()))});$(window.document).keydown(function(n){var t=n.keyCode;t===f.f5&&h(n,function(){window.location.reload()})})},initDoctype:function(n){nt(n);tt()},initChat:function(){return},initNotifications:function(n){eGovNotification&&(egov.eGovNotification=new eGovNotification({settings:n}))},registerToGlobal:function(){window.readNewMail=function(t){var i,u;typeof t=="string"&&(t=JSON.parse(t));i=t.MailId;u=t.FolderId;n.openApp(r,function(){var n=$("iframe#bmail")[0].contentWindow;_.isFunction(n.readNewMail)&&n.readNewMail(i,u)})};window.createNewMail=function(){e()};window.openChat=function(t){if(!egov.chatDesktop){var i;typeof t=="string"&&(t=JSON.parse(t));i=t.ChatterJid;n.openApp(a,function(){var n=$("iframe#chat")[0].contentWindow;n.btalk&&n.btalk.APPVIEW&&n.btalk.APPVIEW.notificationClick({chatterJid:i})})}};window.addDocument=function(n,t,i,r){o(n,t,i,r)};window.openDocument=function(n,i){mainApps.openApp(t,function(){setTimeout(function(){var t=currentApp.egov;t.views.home.tab.openDocument(n,i,!0)},400)})};window.getDeptAndUsers=function(n){var i,r;if(_.isFunction(n)){if(i=mainApps.getContentWindow(t),!i||!i.egov||!i.egov.dataManager){n([]);return}r=function(t,i,r){var u=[];_.each(i,function(n){var f=_.filter(r,function(t){return t.departmentid===n.value}),e=_.filter(t,function(n){return _.pluck(f,"userid").indexOf(n.value)>-1}),i=[];_.each(e,function(n){i.push({Username:n.username,FullName:n.fullname})});u.push({DepartmentId:n.value,ParentId:n.parentid,DepartmentName:n.data,DepartmentIdExt:n.idext,DepartmentPath:n.label,Order:n.order,Level:n.level,Users:i})});n(JSON.stringify(u))};i.egov.dataManager.getAllUsers({success:function(n){i.egov.dataManager.getAllDept({success:function(t){i.egov.dataManager.getAllUserDeptPosition({success:function(i){r(n,t,i)}})}})}})}};window.logoutDesktop=function(){var n,t,i;window.external&&_.isFunction(window.external.CB_LoginSuccess)&&(n=[],t={user:window.currentUserName,password:"",remember:"true"},n.push(t),i=JSON.stringify(n),window.external.CB_LoginSuccess(i))};window.onSearchDocumentBegin=function(){u()};window.saveChangeBeforeUnload=function(n){h(n,function(){window.location.reload()})};window.changeBmailResource=function(){};window.resetApplication=function(){s()}},showTooltip:function(){var n=function(n){n.qtip({position:{at:"center right",my:"left center"}})},t=$(".setting-items > a");t.each(function(){n($(this))})}};$(function(){i.init();i.registerToGlobal();i.initKeyPress();i.showTooltip();window.egovMain=i});jQuery.fn.editor=function(n,t){if(this){var r=this,i=mainApps.getContentWindow("documents"),u=!1;if(n=="destroy")return;i.Aloha&&i.Aloha.$toolbar&&(u=!0,n.find(i.Aloha.$toolbar).length==0&&n.html(i.Aloha.$toolbar));i.Aloha.ready(function(){i.Aloha.jQuery(r).aloha();$(r).attr("spellcheck",!1);u||(i.Aloha.trigger("aloha-editable-activated",{oldactive:undefined,editable:i.Aloha.editables[0]}),n.html(i.Aloha.$toolbar));typeof t=="function"&&t()})}}}(),function(n){n.pubsub=function(){var n=[],t={};return t.publish=function(t,i,r){var e,o,u=0,f=n[t];f&&(o=setInterval(function(){if(f[u]){try{e=f[u].context||this;f[u].callback.call(e,i,r)}catch(n){console.log('Có lỗi xảy ra khi thực thi một trong những hàm callback cho sự kiện "'+t+'"');console.log('Lỗi đó là: "'+n+'"')}u+=1}else clearInterval(o)},0))},t.subscribe=function(t,i,r){n[t]||(n[t]=[]);n[t].push({callback:i,context:r})},t.unsubscribe=function(t,i,r){n[t]&&n[t].pop({callback:i,context:r})},t}()}(this.egov=this.egov||{},jQuery),function(n){var t=["pdf","png","gif","jpg","jpeg","bmp"],i=/(.doc|.docx|.pdf|.xls|.xlsx)$/i,r={getFileName:function(n){var t=n.lastIndexOf(".");return t===-1?n:n.substring(0,t)},getExtension:function(n){var t=n.lastIndexOf("."),i;return t===-1?"":(i=n.substring(t+1,n.length),i.toLowerCase())},getExtensionWithDot:function(n){var t=this.getExtension(n);return t===""?"":"."+t},isPdf:function(n){var t=this.getExtensionWithDot(n);return t===".pdf"},isMsOfficeFile:function(n){var t=this.getExtensionWithDot(n);return t===".doc"||t===".docx"},isReadonly:function(n){var i=this.getExtension(n);return t.indexOf(i)>=0},isForSign:function(n){var t=this.getExtensionWithDot(n);return i.test(t)},getSizeText:function(n){var t=1024,i=1048576,r=1073741824;return n>=r?Math.round(n/r)+" GB":n>=i?Math.round(n/i)+" MB":n>=t?Math.round(n/t)+" KB":n+" bytes"},downloadUri:function(n,t){var i=document.createElement("a");i.download=t;i.href=n;i.style.display="none";document.body.appendChild(i);i.click();document.body.removeChild(i);delete i}};n.fileExtension=r}(window.egov||{});Base.prototype.isReady=function(){};Base.prototype.isPluginExist=function(){};Base.prototype.openURL=function(){};Base.prototype.openFile=function(){};Base.prototype.signWord=function(){};Base.prototype.signPdf=function(){};Base.prototype.getCertIndex=function(){};Base.prototype.writeFileBase64=function(){};Base.prototype.readFileBase64=function(){};Base.prototype.getTempFolder=function(){};Base.prototype.transferPdf=function(){};Base.prototype.transferDoc=function(){};Base.prototype.closeAllOfficeDocuments=function(){};Base.prototype.cancelTransferImage=function(){};Base.prototype.isWordInstalled=function(){};Base.prototype.isChangeContent=function(){};Base.prototype.getAllScanner=function(){};Base.prototype.imageCrop=function(){};Base.prototype.readFileScanBase64=function(){};Base.prototype.imageRotate=function(){};Base.prototype.imageAdjustBrightness=function(){};Base.prototype.imageAdjustContrast=function(){};Base.prototype.transferImage=function(){};ChromeNativeApp.version="1.0.2016.0801";ChromeNativeApp.prototype.version=ChromeNativeApp.version;ChromeNativeApp.prototype=new Base;ChromeNativeApp.prototype.constructor=ChromeNativeApp;ChromeNativeApp.EXTENSION_ID="cngndmpehahbhkdhihanbpobckmkdkkk";ChromeNativeApp.EXTENSION_URL="";ChromeNativeApp.Egov_Event={GetMd5:"Egov_GetMd5",OpenFile:"Egov_OpenFile",CloseFile:"Egov_CloseFile",WriteFileBase64:"Egov_WriteFileBase64",ReadFileBase64:"Egov_ReadFileBase64",DeleteFile:"Egov_DeleteFile",DeleteFolder:"Egov_DeleteFolder",GetCertIndex:"Egov_GetCertIndex",SignFile:"Egov_SignFile",SignFileByPoint:"Egov_SignFileByPoint",HasAppendModeVersion:"HasAppendModeVersion",ScanFile:"Egov_ScanFile",TransferPdf:"Egov_TransferPdf",TransferDoc:"Egov_TransferDoc",CancelTransferImage:"Egov_CancelTransferImage",IsWordInstalled:"Egov_IsWordInstalled",IsChangeContent:"Egov_isChangeContent",GetAllScanner:"Egov_GetAllScanner",ImageCrop:"Egov_ImageCrop",ReadFileScanBase64:"Egov_ReadFileScanBase64",ImageRotate:"Egov_ImageRotate",ImageAdjustBrightness:"Egov_ImageAdjustBrightness",ImageAdjustContrast:"Egov_ImageAdjustContrast",TransferImage:"Egov_TransferImage",Acquire:"Egov_Acquire",GetTempFolder:"Egov_GetTempFolder",IsExistExtension:"IsExistExtension",Convert:"Egov_Convert",GetMAC:"Egov_GetMAC",OpenUrl:"Egov_OpenUrl"};ChromeNativeApp.getInstance=function(){return this._instance||(this._instance=new ChromeNativeApp),this._instance};ChromeNativeApp.callbacks={};ChromeNativeApp.responseEventReady=!1;ChromeNativeApp.sendToContent=function(n,t){var i,r,u,f;ChromeNativeApp.responseEventReady||(i=function(n){var t=n.detail,r=t.sender==null?null:t.sender.callbackid,i;if(r&&(i=ChromeNativeApp.callbacks[r],i)){if(delete ChromeNativeApp.callbacks[r],typeof i=="function"){i(t);return}if(t)return t}},parent.document.removeEventListener("BkaveGovChromeExtension_Response",i,!1),parent.document.addEventListener("BkaveGovChromeExtension_Response",i),ChromeNativeApp.responseEventReady=!0);r=(new Date).getTime();ChromeNativeApp.callbacks[r]=t;n.sender=n.sender||{};n.sender.hasAppendModeVersion=ChromeNativeApp.hasAppendMode||egov.hasPluginAppendMode;n.sender.callbackid=r;u=document.createEvent("CustomEvent");u.initCustomEvent("BkaveGovChromeExtension_Request",!0,!0,n);f=parent.document.dispatchEvent(u)};ChromeNativeApp.prototype.isReady=function(n){if(typeof n=="function")n(!0);else return!0};ChromeNativeApp.prototype.isPluginExist=function(n){ChromeNativeApp.sendToContent({message:"installed"},function(t){n(t.isInstalled)})};ChromeNativeApp.prototype.hasAppendWriteMode=function(n){var t={action:ChromeNativeApp.Egov_Event.HasAppendModeVersion,fileName:"test.txt",data:"MTIz",mode:!1};ChromeNativeApp.sendToContent(t,function(t){n(t.hasAppendWriteMode)})};ChromeNativeApp.prototype.openFile=function(n,t){var i={action:ChromeNativeApp.Egov_Event.OpenFile,fileName:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.closeFile=function(n,t){var i={action:ChromeNativeApp.Egov_Event.CloseFile,fileName:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.writeFileBase64=function(n,t,i,r){var u={action:ChromeNativeApp.Egov_Event.WriteFileBase64,fileName:n,data:t,mode:i};return ChromeNativeApp.sendToContent(u,r)};ChromeNativeApp.prototype.readFileBase64=function(n,t){var i={action:ChromeNativeApp.Egov_Event.ReadFileBase64,fileName:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.existsFile=function(n,t){var i={action:ChromeNativeApp.Egov_Event.ExistsFile,fileName:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.getMd5=function(n,t){var i={action:ChromeNativeApp.Egov_Event.GetMd5,fileName:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.deleteFile=function(n,t,i){t=t||!1;var r={action:ChromeNativeApp.Egov_Event.DeleteFile,fileName:n,mode:t};return ChromeNativeApp.sendToContent(r,i)};ChromeNativeApp.prototype.deleteFolder=function(n,t,i){t=t||!1;var r={action:ChromeNativeApp.Egov_Event.DeleteFolder,fileName:n,mode:t};return ChromeNativeApp.sendToContent(r,i)};ChromeNativeApp.prototype.signFile=function(n,t,i,r){var u={action:ChromeNativeApp.Egov_Event.SignFile,idxCert:i,fileName:n,config:t};return ChromeNativeApp.sendToContent(u,r)};ChromeNativeApp.prototype.signFileByPoint=function(n,t,i,r){var u={action:ChromeNativeApp.Egov_Event.SignFileByPoint,idxCert:i,fileName:n,config:t};return ChromeNativeApp.sendToContent(u,r)};ChromeNativeApp.prototype.getCertIndex=function(n){var t={action:ChromeNativeApp.Egov_Event.GetCertIndex};return ChromeNativeApp.sendToContent(t,n)};ChromeNativeApp.prototype.getTempFolder=function(n){var t={action:ChromeNativeApp.Egov_Event.GetTempFolder};return ChromeNativeApp.sendToContent(t,n)};ChromeNativeApp.prototype.transferPdf=function(n,t,i){var r={action:ChromeNativeApp.Egov_Event.TransferPdf,listpath:n};return ChromeNativeApp.sendToContent(r,i)};ChromeNativeApp.prototype.transferDoc=function(n,t){var i={action:ChromeNativeApp.Egov_Event.TransferDoc,listpath:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.cancelTransferImage=function(n){var t={action:ChromeNativeApp.Egov_Event.CancelTransferImage,path:n};return ChromeNativeApp.sendToContent(t)};ChromeNativeApp.prototype.isWordInstalled=function(n){var t={action:ChromeNativeApp.Egov_Event.isWordInstalled};return ChromeNativeApp.sendToContent(t,n)};ChromeNativeApp.prototype.isChangeContent=function(n,t){var i={action:ChromeNativeApp.Egov_Event.IsChangeContent,filename:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.getAllScanner=function(n,t){var i={action:ChromeNativeApp.Egov_Event.GetAllScanner,reload:n};return ChromeNativeApp.sendToContent(i,t)};ChromeNativeApp.prototype.acquire=function(n,t,i,r,u,f){var e={action:ChromeNativeApp.Egov_Event.Acquire,showui:n,sourceIndex:t,pixelType:i,resolution:r,enableDuplex:u};return ChromeNativeApp.sendToContent(e,f)};ChromeNativeApp.prototype.imageCrop=function(n,t,i,r,u,f,e){var o={action:ChromeNativeApp.Egov_Event.ImageCrop,path:n,left:t,top:i,bottom:r,right:u,width:f,height:e};return ChromeNativeApp.sendToContent(o)};ChromeNativeApp.prototype.readFileScanBase64=function(n,t,i,r){var u={action:ChromeNativeApp.Egov_Event.ReadFileScanBase64,start:t,length:i,path:n};return ChromeNativeApp.sendToContent(u,r)};ChromeNativeApp.prototype.imageRotate=function(n,t,i){var r={action:ChromeNativeApp.Egov_Event.ImageRotate,path:n,angle:t};return ChromeNativeApp.sendToContent(r,i)};ChromeNativeApp.prototype.imageAdjustBrightness=function(n,t,i){var r={action:ChromeNativeApp.Egov_Event.ImageAdjustBrightness,path:n,percentage:t};return ChromeNativeApp.sendToContent(r,i)};ChromeNativeApp.prototype.imageAdjustContrast=function(n,t,i){var r={action:ChromeNativeApp.Egov_Event.ImageAdjustContrast,path:n,percentage:t};return ChromeNativeApp.sendToContent(r,i)};ChromeNativeApp.prototype.transferImage=function(n,t){var i={action:ChromeNativeApp.Egov_Event.TransferImage,path:n,imageformat:t};return ChromeNativeApp.sendToContent(i)};ChromeNativeApp.prototype.openURL=function(n){var t={action:ChromeNativeApp.Egov_Event.OpenUrl,url:n};return ChromeNativeApp.sendToContent(t)};ChromeNativeApp.prototype.getMAC=function(n){var t={action:ChromeNativeApp.Egov_Event.GetMAC};return ChromeNativeApp.sendToContent(t,n)};ChromeNativeApp.prototype.convertToPdf=function(n,t){var i={action:ChromeNativeApp.Egov_Event.Convert,fileType:35,fileNameArr:n};return ChromeNativeApp.sendToContent(i,t)};PluginFactory.getInstance=function(){return navigator.isMobile?BChromeCAPlugin.getInstance():PluginFactory.isChrome()?ChromeNativeApp.getInstance():null};PluginFactory.isChrome=function(){return navigator.userAgent.indexOf("Chrome")!=-1?!0:!1},function(){function t(n){for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t="",u=0,e=n.length,r,f,o;u<e;){if(r=n.charCodeAt(u++)&255,u==e){t+=i.charAt(r>>2);t+=i.charAt((r&3)<<4);t+="==";break}if(f=n.charCodeAt(u++),u==e){t+=i.charAt(r>>2);t+=i.charAt((r&3)<<4|(f&240)>>4);t+=i.charAt((f&15)<<2);t+="=";break}o=n.charCodeAt(u++);t+=i.charAt(r>>2);t+=i.charAt((r&3)<<4|(f&240)>>4);t+=i.charAt((f&15)<<2|(o&192)>>6);t+=i.charAt(o&63)}return t}function i(n){var t=new XMLHttpRequest;return t.open("GET",n,!1),t.overrideMimeType("text/plain; charset=x-user-defined"),t.send(null),t.responseText}var n={extension:null,signatureConfig:[],appendPlugin:function(n){(egov.extension||(egov.extension=PluginFactory.getInstance()),egov.extension)&&egov.extension.isReady(function(t){t?this.checkNativeAppVersion(n):egov.extension.isPluginExist(function(t){t?egov.extension.injectPlugin("egovPlugin",function(){this.appendPlugin(n)}.bind(this)):this.showDialogDownloadPlugin(function(){this.appendPlugin(n)}.bind(this))}.bind(this))}.bind(this))},checkNativeAppVersion:function(n){egov.extension.hasAppendMode!=null||egov.hasPluginAppendMode!=null||setTimeout(function(){egov.extension.hasAppendWriteMode(function(t){egov.extension.hasAppendMode=t;egov.hasPluginAppendMode=t;egov.callback(n)})},2e3);egov.callback(n);return},showDialogDownloadPlugin:function(n){var i,t;i=this;t=$('<div><p style="font-size:16px;font-weight:bold;">'+egov.resources.plugin.noplugin+"<\/p><p>"+egov.resources.plugin.pluginrequire+'<\/p><p style="color:red">'+egov.resources.plugin.needrestartbrowser+'<\/p><center><div style="text-align:center;width:180px"><input type="button" value="'+egov.resources.plugin.downloadtosetup+'" /><\/div><\/center><\/div>');t.find("input").bind("click",function(){i._startDownload();i._dowloadingPlugin(t,n)});t.dialog({width:"800px",resizable:!1,title:egov.resources.common.alert,buttons:[{text:egov.resources.common.closeButton,click:function(){t.dialog("destroy")}}]})},_startDownload:function(){document.location="/Download/EOfficePlusPlugin"},_dowloadingPlugin:function(n){var i,t;i=this;t=$('<a class="retry">'+egov.resources.main.installPlugin.reDownload+"<\/a>");t.on("click",function(){i._startDownload()});n.empty();n.append(t)},callSignSuccess:function(n){this.tempFolderLoc&&this.deleteFolder(this.tempFolderLoc);this.currentSignOptions={withChoosePoint:!1};egov.callback(this.signSuccess,n)},sign:function(n,t){var i,u,r,f;if(i=this,i.currentSignOptions={withChoosePoint:!1},i.tempFolderLoc=(new Date).getTime().toString()+"_forsign",i.hasDeleteOldFile=!1,i.signatureConfig=egov.signatureConfig||[],i.signSuccess=t,r=egov.setting.signerConfig,r.length===0){egov.pubsub.publish(egov.events.status.error,"Bạn chưa cấu hình chữ ký số, vui lòng vào Thiết lập cá nhân/Cấu hình chữ ký để tạo mới.");i.callSignSuccess(!1);return}f=$.isArray(r)?r.slice(0,r.length):$.extend(!0,{},r);i.document=n;i._writeImageSignature(f,function(){u=n.getAttachmentsForSign();u.length>0?(i.confirmSignFiles=u,i._displaySignDialog(u,t)):i.callSignSuccess(!1)})},_displaySignDialog:function(n){var t,r,i;t=this;t.isPreviewing=!1;require([egov.template.document.signer],function(u){r=$("<div><\/div>");r.append(u);r.find(".sign-list").append($.tmpl('<li class="list-group-item"><div><label><input type="checkbox" data-id="${Id}"> ${Title}<\/label><\/div><\/li>',t.signatureConfig));t.signatureConfig.length===1&&r.find(".sign-list :checkbox").attr("checked","checked");var e=_.map(n,function(n){return n.toJSON()}),o=_.groupBy(e,"Compendium"),f=r.find(".att-list");_.each(o,function(n,t){f.append('<li class="list-group-item"><b>'+t+"<\/b><\/li>");f.append($.tmpl('<li class="list-group-item"><div><label><input type="checkbox" data-id="${Id}" checked> ${Name}<\/label><\/div><\/li>',n))});r.appendTo("body");t.$confirmDialog=r;i={};i.width=500;i.height="auto";i.autoResize=!0;i.title="Ký số điện tử";i.buttons=[{text:"Xem trước",className:"btn-warning",click:function(){t._signPreviewBtn()}},{text:"Chuyển",className:"btn-primary",click:function(){t._signAndSendBtn()}},{text:"Bỏ qua",className:"btn-default",click:function(){t.isPreviewing=!1;t.$confirmDialog.dialog("destroy");t.callSignSuccess(!1)}}];i.confirm={text:"Xóa tệp cũ sau khi ký",id:"deleleOldFile",style:{float:"left","font-weight":"normal","font-size":"13px"},click:function(n){t.hasDeleteOldFile=n},hasAutoClick:!1,disabled:!1};t.$confirmDialog.dialog(i)})},_getSelectedFiles:function(n){var r=this,u=r.$confirmDialog.find(".att-list input:checked"),t,i;return u.length<=0?[]:(t=[],u.each(function(n,i){t.push($(i).attr("data-id"))}),i=_.filter(n,function(n){return _.contains(t,n.get("Id").toString())}),r.currentSignOptions.selectedFiles=i,i)},_getSelectedSignerConfig:function(n){var i=this,f=!1,e=i.$confirmDialog.find(".sign-list input:checked"),r,t,u,o;return e.length<=0?[]:(r=[],e.each(function(n,t){r.push($(t).attr("data-id"))}),t=_.filter(n,function(n){return _.contains(r,n.Id.toString())}),u={sameToken:_.where(t,{hasSameToken:!0})},_.each(_.where(t,{hasSameToken:!1}),function(n){f=!0;u[n.Id]=[n]}),o=_.values(u),i.currentSignOptions.config=o,i.currentSignOptions.hasShowAlertChooseToken=f,t)},_writeFileBase64:function(n,t,i){var s=this,f,u,h,o;if(!n){i();return}if(f=Object.keys(n),f.length===0){i();return}var e=f[0],c=n[e],r=t.filter(function(n){return n.get("Id")==e});r=r[0];u=r.get("Extension");u.indexOf(".")!=0&&(u="."+u);h=r.get("Name").toLowerCase();o=s.tempFolderLoc+"\\"+h;egov.extension.writeFileBase64(o,c,!0,function(u){var f=u.returnCode===1;if(f)r.set("fileData",o),r.set("md5",u.md5),delete n[e],s._writeFileBase64(n,t,i);else{egov.pubsub.publish(egov.events.status.error,egov.resources.common.errorMessage);return}})},_writeImageSignature:function(n,t){var i=this,r,f;if(n.length===0||egov.isWriteSigner){egov.isWriteSigner=!0;egov.signatureConfig=i.signatureConfig;_.each(egov.signatureConfig,function(n){if(n.SignType!==0){var t=i.document.isTransferTheoLo?"":i.document.model.get("DocCode");n.ReplaceText=t.split("/")[0]}});t(i.signatureConfig);return}if(r=n.pop(),r==undefined){t(i.signatureConfig);return}if(f=r.ImagePath&&r.SignType===0,f)var e=""+(new Date).getTime()+r.Ext,o=(new Date).getTime().toString(),u=o+"\\"+e,s=egov.extension.writeFileBase64(u,r.ImagePath,!0,function(f){if(f.returnCode==1)u=u.replace(/\//g,"\\"),r.ImagePath=u,i.signatureConfig.push(r),i._writeImageSignature(n,t);else{egov.pubsub.publish(egov.events.status.error,egov.resources.common.errorMessage);return}});else r.ImagePath="",r.ReplaceText=i.document.isTransferTheoLo?"":i.document.model.get("DocCode"),i.signatureConfig.push(r),i._writeImageSignature(n,t)},_signAndSendBtn:function(){var n=this,t=function(t,i){if(!t||i.length===0){n.$confirmDialog.dialog("destroy");n.callSignSuccess(!1);return}egov.pubsub.publish(egov.events.status.success,"Kí file thành công!");n._uploadAndSend(i)};this._doSign(t)},_signPreviewBtn:function(){var n=this,t;n.isPreviewing||(n.isPreviewing=!0,t=function(t,i){if(!t||i.length===0){n.$confirmDialog.dialog("destroy");n.callSignSuccess(!1);return}n._openPreviewSinged(i)},this._doSign(t))},_signWithPositionAndPreview:function(){if(this.currentSignOptions){var n=this,t=function(t,i){if(!t||i.length===0){n.$confirmDialog.dialog("destroy");n.callSignSuccess(!1);return}n._openPreviewSinged(i)};n.currentSignOptions.withChoosePoint=!0;egov.pubsub.publish(egov.events.status.info,"Vui lòng quét chuột chọn vị trí cần hiển thị chữ ký.");n._writeFilesAndSign(t)}},_openPreviewSinged:function(n){for(var f,r,e,i=this,t=$("<div>"),u=0;u<n.length;u++)f=n[u],r=$("<object>"),r.css({width:"100%",height:"350px",border:"none"}),r.attr("data","data:application/pdf;base64,"+f.value),t.append(r);t.appendTo("body");e={width:1e3,height:400,autoResize:!0,title:"Ký số điện tử",buttons:[{text:"Quét chọn vị trí khác",className:"btn-warning",click:function(){t.dialog("destroy");i.deleteFolder(i.tempFolderLoc,function(){i._signWithPositionAndPreview()})}},{text:"Chuyển",className:"btn-primary",click:function(){t.dialog("destroy");i._uploadAndSend(n)}},{text:"Bỏ qua",className:"btn-default",click:function(){i.isPreviewing=!1;t.dialog("destroy")}}]};t.dialog(e)},_doSign:function(n){var i,u,r=[],f=[],t=this,e;if(i=t._getSelectedFiles(t.confirmSignFiles),u=t._getSelectedSignerConfig(t.signatureConfig),i.length<=0||u.length<=0){egov.pubsub.publish(egov.events.status.warning,"Bạn chưa chọn tệp hoặc chữ ký để ký số. Vui lòng thử lại.");t.$confirmDialog.dialog("destroy");n(!1,[]);return}e=i.filter(function(n){return!n.get("fileData")||!egov.setting.publish.detectPdfChangeContent&&egov.fileExtension.isReadonly(n.get("Name"))});$.each(e,function(n,t){t.get("isNew")?egov.isMobile?r.push(t.get("Id")+"."+t.get("Extension")):r.push(t.get("Id")):f.push(t.get("Id"))});egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing);egov.request.downloadAttachmentForSignBase64({data:{fileIds:f,fileTempIds:r,convertWordTopdf:!1},success:function(i){t.currentSignOptions.base64OfAttachmentFiles=$.extend(!0,{},i.files);t._writeFilesAndSign(n)},error:function(){t.isPreviewing=!1;egov.pubsub.publish(egov.events.status.error,egov.resources.common.errorMessage)}})},_writeFilesAndSign:function(n){var t=this,u=t.currentSignOptions.hasShowAlertChooseToken,i=_.clone(t.currentSignOptions.config),r=_.clone(t.currentSignOptions.selectedFiles),f=_.clone(t.currentSignOptions.base64OfAttachmentFiles),e=function(){var e=[],f=i.pop(),o;f.length===0&&(f=i.pop());o=function(){if(i.length===0){n(!0,e);return}f=i.pop();t._signFileWithCertIndex(r,f,e,o,u)};t._signFileWithCertIndex(r,f,e,o,u)};this._writeFileBase64(f,r,e)},_signFileWithCertIndex:function(n,t,i,r,u){var e,s,f,o;if(t.length===0)return r();if(u&&(e=_.pluck(t,"Title").join(","),s=String.format("Đang ký số cho chữ ký {0}. /nVui lòng cắm token vào máy và nhấn Ok để chọn.",e),alert("Chọn Token cho chữ ký "+e)),f=this,this.currentSignOptions&&this.currentSignOptions.idxCert){this._signFile(n,i,t,this.currentSignOptions.idxCert,function(){r()},this.currentSignOptions.withChoosePoint);return}o=function(u){var e=parseInt(u.idxCert);if(isNaN(e)||e<=-1){f.isPreviewing=!1;egov.pubsub.publish(egov.events.status.error,"Vui lòng kiểm tra lại chữ kí số đã sẵn sàng trước khi kí!");return}f.currentSignOptions.idxCert=e;f._signFile(n,i,t,e,function(){r()},f.currentSignOptions.withChoosePoint)};egov.extension.getCertIndex(o)},_signFile:function(n,t,i,r,u,f){if(n.length===0){u();return}f=f||!1;var o=n.pop(),e=o.get("fileData"),a=egov.fileExtension.isForSign(e),l=i.slice(0);if(a){var s=l.pop(),h=$.extend(!0,{SignAuthor:egov.setting.userName,SignReason:"Bkav eGov - Ký số điện tử"},s),c=function(a){if(s=l.pop(),a.returnCode==1){if(s!=undefined){egov.fileExtension.isMsOfficeFile(e)&&(e=egov.fileExtension.getFileName(e)+".pdf");h=$.extend(!0,{SignAuthor:egov.setting.userName,SignReason:"Bkav eGov - Ký số điện tử"},s);this._signSelectFile(e,h,r,c);return}var v=egov.fileExtension.getFileName(o.get("Name"));v.match(/_Signed$/)||(v=v+"_Signed");v=v+".pdf";t.push({id:""+o.get("Id"),documentCopyId:o.get("DocumentCopyId"),name:v,originName:a.fileName,value:a.base64});this._signFile(n,t,i,r,u,f)}else{egov.pubsub.publish(egov.events.status.error,egov.resources.common.errorMessage+": "+a.returnMessage);return}}.bind(this);f?this._signByPoint(e,h,r,c):this._signSelectFile(e,h,r,c)}},_signSelectFile:function(n,t,i,r){egov.extension.signFile(n,t,parseInt(i),function(n){r(n)}.bind(this))},_signByPoint:function(n,t,i,r){egov.extension.signFileByPoint(n,t,parseInt(i),function(n){r(n)}.bind(this))},_uploadAndSend:function(n){var t=this;this._uploadSignedFile(n,this.document,function(){t.$confirmDialog.dialog("destroy");t.callSignSuccess(!0);egov.pubsub.publish(egov.events.status.success,"Đính kèm file đã kí vào văn bản thành công!")})},_uploadSignedFile:function(n,t,i){t.uploadSignFiles(n,i)},openAttachment:function(n,t){var r,u,i;r=n.model.get("Id");u=n.parent.storePrivateId;n.model.get("isNew")?n.model.get("isOpen")&&n.model.get("fileData")?egov.extension.openFile(n.model.get("fileData")):egov.request.downloadAttachmentTemp({data:{id:r},success:function(t){var r=JSON.parse(t),i,u,f;r&&(r.error?egov.pubsub.publish(egov.events.status.error,r.error):(i=n.model.get("Extension"),i.indexOf(".")!=0&&(i="."+i),u=n.model.get("Id")+i,f=(new Date).getTime().toString(),filePath=f+"\\"+u,egov.extension.writeFileBase64(filePath,r.content,!0,function(t){t.returnCode==1&&(n.model.set("fileData",filePath),n.model.set("md5",t.md5),egov.extension.openFile(filePath,function(){n.model.set("isOpen",!0)}))}.bind(this))))}.bind(this),error:function(){egov.pubsub.publish(egov.events.status.error,egov.resources.document.attachment.errorDownload)},complete:function(){egov.pubsub.publish(egov.events.status.destroy)}}):(i=t==n.model.get("LastestVesion"),n.model.get("isOpen")&&(!t||i)?egov.extension.openFile(n.model.get("fileData")):(egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing),egov.request.downloadAttachment({data:{id:r,storePrivateId:u,version:t?i?null:t:null},success:function(r){var f=JSON.parse(r),u,e,o;f&&(f.error?egov.pubsub.publish(egov.events.status.error,f.error):(u=n.model.get("Extension"),u.indexOf(".")!=0&&(u="."+u),e=n.model.get("Id")+u,o=(new Date).getTime().toString(),filePath=o+"\\"+e,egov.extension.writeFileBase64(filePath,f.content,!0,function(r){r.returnCode==1&&((i||!t)&&n.model.set("fileData",filePath),n.model.set("md5",r.md5),egov.extension.openFile(filePath,function(){(i||!t)&&n.model.set("isOpen",!0)}))}.bind(this))))}.bind(this),error:function(){egov.pubsub.publish(egov.events.status.error,_resource.errorDownload)},complete:function(){egov.pubsub.publish(egov.events.status.destroy)}})))},openStoreAttachment:function(n){egov.request.storePrivateOpenFile({data:{id:n},success:function(n){var t=JSON.parse(n),i,r;t&&(t.error?egov.pubsub.publish(egov.events.status.error,t.error):(i=t.fileName,r=(new Date).getTime().toString(),filePath=r+"\\"+i,egov.extension.writeFileBase64(filePath,t.content,!0,function(n){n.returnCode==1&&egov.extension.openFile(filePath,function(){})}.bind(this))))},error:function(){egov.pubsub.publish(egov.events.status.error,_resource.errorDownload)},complete:function(){egov.pubsub.publish(egov.events.status.destroy)}})},confirmAttachments:function(n,t){var r=this,i=n.model.select(function(t){var i=!t.get("isRemoved")&&t.get("isOpen");return n.isPublishing&&egov.setting.publish.detectPdfChangeContent||(i=i&&!egov.fileExtension.isReadonly(t.get("Name"))),i});if(i.length===0){egov.callback(t);return}$(document).on("checkModifySuccess",function(n){$(document).off("checkModifySuccess");egov.callback(t);egov.helper.destroyClickEvent(n)});this._confirmSaveAttachment(i,n)},_confirmSaveAttachment:function(n,t){if(n.length===0){$(document).trigger("checkModifySuccess");return}var u=this,i=n[0],r=n.splice(1,n.length-1);this._closeFile(i,t,r)},_closeFile:function(n,t,i){var r=this;egov.extension.closeFile(n.get("fileData"),function(u){u.returnCode==1||u.returnCode==2?(u.returnCode=="2"&&console.log("egov.extension.closeFile: "+n.get("Name")+" đã đóng trước đó"),egov.extension.readFileBase64(n.get("fileData"),function(u){if(u.returnCode==1)if(n.get("md5")!=u.md5){var f=n.get("Name");egov.message.show(String.format(egov.resources.document.attachment.fileChanged,f),null,egov.message.messageButtons.YesNo,function(){t.modifiedFiles[n.get("Id")]=u.base64;r._confirmSaveAttachment(i,t)},function(){r._confirmSaveAttachment(i,t)})}else r._confirmSaveAttachment(i,t);else u.returnCode==2?console.log("egov.plugin::_confirmSaveAttachment::warning: Đọc nội dung file không tồn tại!!! Cần check lại code."):console.log("egov.plugin::_confirmSaveAttachment::Error: lỗi không thể lưu nội dung file")})):egov.message.show(String.format("Vui lòng đóng phần mềm đang mở file {0} và thử lại.",n.get("Name")),"Thông báo",egov.message.messageButtons.Ok)})},openFileUri:function(n,r){var o=(new Date).getTime().toString(),u=o+"\\"+r,f,e;egov.extension||(egov.extension=PluginFactory.getInstance());f=i(n);e=t(f);egov.extension.writeFileBase64(u,e,!0,function(n){n.returnCode==1&&egov.extension.openFile(u)})},getMAC:function(n){if(egov.extension||(egov.extension=PluginFactory.getInstance()),!egov.extension){egov.callback(n,"");return}egov.extension.getMAC(function(t){egov.callback(n,t.mac)})},deleteFolder:function(n,t){egov.extension.deleteFolder(n,!0,function(){egov.callback(t)})}};return window.Plugin=n,n}();