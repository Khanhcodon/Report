(function(){function t(t,i){n=t;i&&(this.su=this.getMsgSubject(),this.e=this.getMsgSender(),this.d=this.getMsgDate());this.attach=[];this.getAllMsgPart();this.body=-1;this._msg=n;this.inlineImages=[];this.getMsgContent(n.m[0]);this.getImageInline(n.m[0])}function i(n){var t=1024,i=1048576,r=1073741824;return n>=r?Math.floor(n/r)+" GB":n>=i?Math.floor(n/i)+" MB":n>=t?Math.floor(n/t)+" KB":n+" bytes"}var n,r,u;t.prototype.getImageInline=function(n){var i,u,t;if(n&&n.mp)for(i=n.mp,u=i.length,t=0;t<u;t++){if((i[t].cd&&(i[t].cd=="attachment"||i[t].cd=="inline")||!i[t].cd&&i[t].filename||i[t].ci)&&i[t].ct!="application/pkcs7-mime"&&i[t].ci){var r=i[t].ci,r=r.substring(1,r.length-1),f=i[t].filename,e=i[t].part;this.body.indexOf(r)!=-1&&this.inlineImages.push({filename:f,ci:r,part:e,s:i[t].s})}i[t].mp&&this.getImageInline(i[t])}};t.prototype.getContentType=function(){return n.m[0].mp[0].ct};t.prototype.getNumberOfPart=function(){return n.m[0].mp.length};t.prototype.getMsgPart=function(t){return n.m[0].mp[t]};t.prototype.getId=function(){return n.m[0].id};t.prototype.getLocationId=function(){return n.m[0].l};r="text/plain";u="text/html";t.prototype.getMsgContent=function(n){var u,r;if(n&&n.mp){for(var t=n.mp,f=t.length,i=0,i=0;i<f;i++)t[i].body&&(t[i].ct=="text/html"||t[i].ct=="text/plain")&&(this.body=t[i].content);if(this.body==-1)for(u=!0,r=0;u;)if(this.getMsgContent(t[r]),this.body!=-1)u=!1;else if(r++,r==5)break}};t.prototype.getMsgDate=function(){return new Date(n.m[0].d)};t.prototype.displayImageInline=function(){var n,i,t;if(this.body.indexOf("dfsrc")!=-1&&(this.body=this.body.replace(/dfsrc/gi,"src")),this.inlineImages.length>0)for(n=0;n<this.inlineImages.length;n++)i="https://"+Util.readCookie("ipServer")+"/service/home/~/"+this.inlineImages[n].filename+"?authToken=co&id="+this.getMsgId()+"&part="+this.inlineImages[n].part,t=this.inlineImages[n].ci,t="cid:"+t,this.body.indexOf(t)!=-1&&(this.body=this.body.replace(new RegExp(t,"g"),i))};t.prototype.getMsgSubject=function(){return n.m[0].su};t.prototype.getMsgSender=function(){if(n&&n.m[0]&&n.m[0].e)for(var t=0;t<n.m[0].e.length;t++)if(n.m[0].e[t].t=="f")return n.m[0].e[t].a;return""};t.prototype.getMsgTo=function(){var i=[],t;if(n&&n.m[0]&&n.m[0].e)for(t=0;t<n.m[0].e.length;t++)n.m[0].e[t].t=="t"&&i.push(n.m[0].e[t].a);return i};t.prototype.getMsgId=function(){return n.m[0].id};t.prototype.getMsgCc=function(){var i=[],t;if(n&&n.m[0]&&n.m[0].e)for(t=0;t<n.m[0].e.length;t++)n.m[0].e[t].t=="c"&&i.push(n.m[0].e[t].a);return i};t.prototype.getMsgBcc=function(){var i=[],t;if(n&&n.m[0]&&n.m[0].e)for(t=0;t<n.m[0].e.length;t++)n.m[0].e[t].t=="b"&&i.push(n.m[0].e[t].a);return i};t.prototype.getMsgDisplayName=function(){for(var t=0;t<n.m[0].e.length;t++)if(n.m[0].e[t].t=="f")return n.m[0].e[t].p;return""};t.prototype.getAllMsgPart=function(){for(var r,i=n.m[0].mp,t=0;t<i.length;t++)Util.isUndefined(i[t].mp)?Util.isUndefined(i[t].ct)||(r=i[t].ct,this._readMsgContent(r,i[t])):this._getAllMsgPart(i[t].mp)};t.prototype.contentTxt="";t.prototype.contentHtml="";t.prototype.inlineImages=[];t.prototype._getAllMsgPart=function(n){for(var i,t=0;t<n.length;t++)Util.isUndefined(n[t].mp)?Util.isUndefined(n[t].ct)||(i=n[t].ct,this._readMsgContent(i,n[t])):this._getAllMsgPart(n[t].mp)};t.prototype._readMsgContent=function(n,t){var f;n==r?Util.isUndefined(t.content)||(this.contentTxt=t.content):n==u&&(Util.isUndefined(t.content)||(this.contentHtml=t.content));Util.isUndefined(t.cd)||(f=t.filename.split("."),Util.isUndefined(t.ci)?(f=t.filename.split("."),this.attach.push({fileName:f[0],extension:f[1],part:t.part,size:i(t.s)})):this.inlineImages.push({fileName:f[0],extension:f[1],part:t.part,size:i(t.s)}))};window.MsgUtil=t})();