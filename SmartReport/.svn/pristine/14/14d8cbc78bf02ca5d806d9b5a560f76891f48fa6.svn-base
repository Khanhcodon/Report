define([egov.template.returnResult],function(n){var t=egov.resources.document.returnResult;return Backbone.View.extend({template:n,events:{"input input.paper-name":"_addPaper","input input.fee-name":"_addFee"},initialize:function(n){this.document=n.document;this.success=n.callback;var t=this;return t.hasShowPrintPreview=!0,egov.request.getReturnResult({data:{documentCopyId:t.document.model.get("DocumentCopyId")},success:function(n){t.model=n;t.render()}}),t},render:function(){this.$el.html($.tmpl(this.template,this.model));this.$el.bindResources();var n=this,i={width:800,height:"auto",draggable:!0,keyboard:!0,modal:!0,title:t.dialogTitle,buttons:[{text:t.updateAndPrintButton,className:"btn-primary "+(n.model.PrintTemplates.length==0?"hidden":""),disabled:n.model.PrintTemplates.length==0,click:function(){n.$el.dialog("hide");n._updateAndPrint()}},{text:t.updateButton,className:"btn-primary",click:function(){n.$el.dialog("hide");n._update()}},{text:egov.resources.common.closeButton,click:function(){n.$el.dialog("hide")}},]};return n.model.PrintTemplates.length>0&&(i.confirm={className:"pull-left",text:egov.resources.common.showPreviewPrint,checked:!0,click:function(t){n.hasShowPrintPreview=t}}),n.$el.dialog(i),n.$(".resultComment").focus(),n.$newPaper=n.$(".ul-papers>li:last-child").clone(!0),n.$newFee=n.$(".ul-fees>li:last-child").clone(!0),n},_update:function(n){var t,u,f,i,r,e;t=this;u=t.document.model.get("DocumentCopyId");f=t.$(".resultComment").val();e=t.$("#finishProcess").is(":checked");i=[];r=[];t.$(".ul-papers > li").each(function(){var n=$(this).find(":checked"),r=n.val()==0?$(this).find(".paper-name").val():$(this).find(".paper-name").text();n.length>0&&r!==""&&i.push({PaperName:r,Amount:$(this).find(".paper-amount").val(),Type:egov.enum.feeType.TraCongDan,IsRequired:!0,DocumentId:t.$("[name='DocumentId']").val()})});t.$(".ul-fees > li").each(function(){var n=$(this).find(":checked"),i=n.val()==0?$(this).find(".fee-name").val():$(this).find(".fee-name").text();n.length>0&&i!==""&&r.push({FeeName:i,Price:$(this).find(".fee-price").val(),Type:egov.enum.paperType.TraCongDan,IsRequired:!0,DocumentId:t.$("[name='DocumentId']").val()})});egov.request.updateReturn({data:{documentCopyId:u,note:f,isFinish:e,fees:JSON.stringify(r),papers:JSON.stringify(i)},success:function(i){egov.callback(n,i);egov.callback(t.success,i);t.$el.dialog("hide")}})},_updateAndPrint:function(){var n=this,t=function(){n.print()};this._update(t)},print:function(){var n=this,t=n.$("#ddlTemplate").val(),i=n.document.model.get("DocumentCopyId");require(["print"],function(r){var r=new r({docCopyId:[i],docId:n.document.model.get("DocumentId"),suppId:0,printId:t,displayPreview:n.hasShowPrintPreview})});n.$el.dialog("hide")},_addPaper:function(n){var t=this.$(n.target),i=t.parent("li");i.is(":last-child")&&this.$(".ul-papers").append(this.$newPaper.clone(!0))},_addFee:function(n){var t=this.$(n.target),i=t.parent("li");i.is(":last-child")&&this.$(".ul-fees").append(this.$newFee.clone(!0))}})});