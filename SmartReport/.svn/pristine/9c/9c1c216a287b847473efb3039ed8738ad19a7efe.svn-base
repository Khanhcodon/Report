define([],function(){"use strict";var n={xemvanban:{className:"xemvanbanClass",name:egov.resources.documents.contextmenu.name.xemvanban,iconClass:"icon-xemvanban",commandName:"xemvanban"},suavanban:{className:"suavanbanClass",name:egov.resources.documents.contextmenu.name.suavanban,iconClass:"icon-pencil3",commandName:"suavanban"},guiykien:{className:"guiykienClass",name:egov.resources.documents.contextmenu.name.guiykien,iconClass:"icon-comment",commandName:"guiykien"},xinykien:{className:"xinykienClass",name:egov.resources.documents.contextmenu.name.xinykien,iconClass:"icon-chat",commandName:"xinykien"},bangiao:{className:"bangiaoClass",name:egov.resources.documents.contextmenu.name.bangiao,iconClass:"icon-forward4",commandName:"bangiao"},thongbao:{className:"thongbaoClass",name:egov.resources.documents.contextmenu.name.thongbao,iconClass:"icon-users3",commandName:"thongbao"},laylaivanban:{className:"laylaivanbanClass",name:egov.resources.documents.contextmenu.name.laylaivanban,iconClass:"icon-back",commandName:"laylaivanban"},xacnhanbangiao:{className:"xacnhanbangiaoClass",name:egov.resources.documents.contextmenu.name.xacnhanbangiao,iconClass:"icon-xacnhanbangiao",commandName:"xacnhanbangiao"},xacnhanxuly:{className:"xacnhanxulyClass",name:egov.resources.documents.contextmenu.name.xacnhanxuly,iconClass:"",commandName:"xacnhanxuly"},yeucaubosung:{className:"yeucaubosungClass",name:egov.resources.documents.contextmenu.name.yeucaubosung,iconClass:"icon-yeucaubosung",commandName:"yeucaubosung"},tiepnhanbosung:{className:"tiepnhanbosungClass",name:egov.resources.documents.contextmenu.name.tiepnhanbosung,iconClass:"icon-tiepnhanbosung",commandName:"tiepnhanbosung"},kyduyet:{className:"kyduyetClass",name:egov.resources.documents.contextmenu.name.kyduyet,iconClass:"icon-signup",commandName:"kyduyet"},ketthucxuly:{className:"ketthucxulyClass",name:egov.resources.documents.contextmenu.name.ketthucxuly,iconClass:"icon-checkmark3",commandName:"ketthucxuly"},huyvanban:{className:"huyvanbanClass",name:egov.resources.documents.contextmenu.name.huyvanban,iconClass:"icon-remove",commandName:"huyvanban"},capnhatketquaxulycuoi:{className:"capnhatketquaxulycuoiClass",name:egov.resources.documents.contextmenu.name.capnhatketquaxulycuoi,iconClass:"icon-capnhatketquaxulycuoi",commandName:"capnhatketquaxulycuoi"},inphieutrinh:{className:"inphieutrinhClass",name:egov.resources.documents.contextmenu.name.inphieutrinh,iconClass:"icon-inphieutrinh",commandName:"inphieutrinh"},intomtat:{className:"intomtatClass",name:egov.resources.documents.contextmenu.name.intomtat,iconClass:"icon-intomtat",commandName:"intomtat"},capnhattiendo:{className:"capnhattiendoClass",name:egov.resources.documents.contextmenu.name.capnhattiendo,iconClass:"icon-capnhattiendo",commandName:"capnhattiendo"},xoakhoiduthao:{className:"xoakhoiduthaoClass",name:egov.resources.documents.contextmenu.name.xoakhoiduthao,iconClass:"icon-remove",commandName:"xoakhoiduthao"},contextheodoi:{className:"contextheodoiClass",name:egov.resources.documents.contextmenu.name.contextheodoi,iconClass:"icon-contextheodoi",commandName:"contextheodoi"},dungxuly:{className:"dungxulyClass",name:egov.resources.documents.contextmenu.name.dungxuly,iconClass:"icon-dungxuly",commandName:"dungxuly"},giahanxuly:{className:"giahanxulyClass",name:egov.resources.documents.contextmenu.name.giahanxuly,iconClass:"icon-giahanxuly",commandName:"giahanxuly"},chitietvanban:{className:"chitietvanbanClass",name:egov.resources.documents.contextmenu.name.chitietvanban,iconClass:"icon-info4",commandName:"chitietvanban"},danhdauchuadoc:{className:"chitietvanbanClass",name:egov.resources.documents.contextmenu.name.danhdauchuadoc,iconClass:"icon-danhdauchuadoc",commandName:"danhdauchuadoc"},danhdaudadoc:{className:"chitietvanbanClass",name:egov.resources.documents.contextmenu.name.danhdaudadoc,iconClass:"icon-danhdaudadoc",commandName:"danhdaudadoc"},molaivanban:{className:"molaivanbanClass",name:egov.resources.documents.contextmenu.name.molaivanban,iconClass:"icon-molaivanban",commandName:"molaivanban"},exportToXML:{className:"exportToXML",name:"Xuất danh sách ra tệp XML",iconClass:"icon-file-xml",commandName:"exportToXML"}},t=Backbone.View.extend({initialize:function(n){this.parent=n.parent},getContextmenu:function(n,t,i,r){this.selectedModels=t;this.clickModel=i;this.docCopyIdSelected=n;this.docCopyIdClick=this.clickModel.model.get("DocumentCopyId");var u=this,f=[],e=this.collection.length;u.collection.each(function(n,t){u._getItemContext(n.get("value"),function(n){$.each(n,function(n,t){f.push(t)});t===e-1&&typeof r=="function"&&r(f)})})},_getItemContext:function(t,r){var u=this,e=this.docCopyIdSelected.length,f={},c,o,l;if($.extend(f,{movanban:n.movanban}),n.movanban.callback=function(){u.parent.openDocuments(u.selectedModels)},t&egov.enum.permission.suavanban&&$.extend(f,{suavanban:n.suavanban}),e===1&&t&egov.enum.permission.guiykien&&(n.guiykien.callback=function(){egov.message.prompt(egov.resources.document.sendComment.dialogTitle,egov.resources.document.sendComment.dialogButton,function(n){if(n==null||n===""){egov.message.error("Bạn chưa nhập ý kiến!.");return}egov.message.processing(egov.resources.common.transfering,!1);egov.request.sendComment({data:{documentCopyId:u.docCopyIdClick,comment:n},success:function(n){n.error?egov.message.error(n.error):egov.message.success(egov.resources.document.sendComment.sendSuccess)},error:function(){egov.message.error(egov.resources.document.sendComment.sendFail)}})},!0)}),t&egov.enum.permission.bangiao&&$.extend(f,{bangiao:n.bangiao}),e===1&&t&egov.enum.permission.thongbao&&(n.thongbao.callback=function(){require(["announcementView"],function(n){egov.announcementForm===undefined&&(egov.announcementForm=new n);egov.announcementForm.render(u.docCopyIdClick)})}),t&egov.enum.permission.xinykien&&(n.xinykien.callback=function(){require(["consultView"],function(n){egov.consultView===undefined&&(egov.consultView=new n);egov.consultView.renderForContext(u.docCopyIdClick)})}),e===1&&(t&egov.enum.permission.xacnhanbangiao&&(n.xacnhanbangiao.callback=function(){require(["views/document/functions/ConfirmTransferOrProcess"],function(n){new n({docCopyId:u.docCopyIdClick,isTransfer:!0})})}),t&egov.enum.permission.xacnhanxuly&&(n.xacnhanxuly.callback=function(){require(["views/document/functions/ConfirmTransferOrProcess"],function(n){new n({docCopyId:u.docCopyIdClick,isTransfer:!1})})})),t&egov.enum.permission.yeucaubosung,t&egov.enum.permission.tiepnhanbosung,e===1&&t&egov.enum.permission.kyduyet&&($.extend(f,{kyduyet:n.kyduyet}),n.kyduyet.callback=function(){require(["views/document/functions/approver"],function(n){new n({docCopyId:u.docCopyIdClick})})}),t&egov.enum.permission.traketqua,e===1&&t&egov.enum.permission.giahanxuly&&($.extend(f,{giahanxuly:n.giahanxuly}),n.giahanxuly.callback=function(){require(["jquery","libs/jquery/jquery.validate.min"],function(){require(["libs/jquery/jquery.validate.unobtrusive.min"],function(){require(["views/document/functions/addtime"],function(n){new n({docCopyId:u.docCopyIdClick})})})})}),t&egov.enum.permission.dungxuly&&$.extend(f,{dungxuly:n.dungxuly}),t&egov.enum.permission.ketthucxuly&&($.extend(f,{ketthucxuly:n.ketthucxuly}),n.ketthucxuly.callback=function(){u.parent.finishs(u.selectedModels)}),t&egov.enum.permission.huyvanban&&($.extend(f,{huyvanban:n.huyvanban}),n.huyvanban.callback=function(){egov.message.show("Bạn có đồng ý loại bỏ văn bản/hồ sơ này không?",null,egov.message.messageButtons.YesNo,function(){egov.request.removeDocument({data:{documentCopyIds:u.docCopyIdSelected},success:function(n){n.success?(u.parent.removeDocuments(u.selectedModels),egov.message.notification(n.success,egov.message.messageTypes.success)):egov.message.show(n.error)},error:function(){egov.message.notification("Có lỗi trong quá trình loại bỏ văn bản/hồ sơ.",egov.message.messageTypes.error)}})})}),t&egov.enum.permission.capnhatketquaxulycuoi&&$.extend(f,{capnhatketquaxulycuoi:n.capnhatketquaxulycuoi}),e===1&&($.extend(f,{chitietvanban:n.chitietvanban}),n.chitietvanban.callback=function(){i(u.clickModel.model.toJSON())}),c=_.filter(u.parent.model.toArray(),function(n){return n.get("Status")===2&&n.get("UserCurrentId")===egov.setting.userId}),c.length>0){var s=[],h=[],a=u.selectedModels.length;for(o=0;o<a;o++)u.selectedModels[o].get("IsViewed")==!0?s.push(u.selectedModels[o]):h.push(u.selectedModels[o]);h.length>=s.length?($.extend(f,{danhdaudadoc:n.danhdaudadoc}),n.danhdaudadoc.callback=function(){u.parent.setViewed(h,!0)}):($.extend(f,{danhdauchuadoc:n.danhdauchuadoc}),n.danhdauchuadoc.callback=function(){u.parent.setViewed(s,!1)})}l=this.clickModel.model.get("UserCurrentId")!==egov.setting.userId&&(this.clickModel.model.get("Status")===2||this.clickModel.model.get("Status")===16);l?t&egov.enum.permission.laylaivanban&&egov.request.getContextItemForUndoTransfering({data:{documentCopyId:u.docCopyIdClick},success:function(n){var t;if(!n.error){for(!$.isEmptyObject(f)&&n.length>0&&$.extend(f,{name:"---"}),t=0;t<n.length;t++){var e=n[t].DateCreated,o={className:"laylaivanbanClass",name:n[t].Name,dateCreated:e,iconClass:"icon-undo2",commandName:"laylaivanban"+t,callback:function(n){var t=f[n.get("key")].dateCreated,i=Globalize.format(t,"F");require(["views/document/functions/retrieve"],function(n){new n({docCopyId:u.docCopyIdClick,dateCreated:i,callback:function(){u.clickModel.$el.remove();var n=u.clickModel.model.toJSON();u.parent.removeDocuments([u.clickModel.model]);egov.locache.get("documentOfUsers",function(t){var f,s,e,r,i,u,o,h;if(t&&!(t.length<=0)){for(i=0;i<t.length;i++)if(t[i].userId===egov.setting.userId){f=t[i];s=i;break}if(f&&f.localCache&&(e=f.localCache,r=e.documentTrees,r&&!(r.length<=0))){for(i=0;i<r.length;i++)if(u=r[i].documents,u&&u.length>0)if(u[0].Status===2&&u[0].UserCurrentId===egov.setting.userId){n.Status=2;n.IsDocumentImportant=!1;n.UserCurrentId=egov.setting.userId;n.UserCurrentFullName=egov.setting.fullName;o=egov.setting.fullName.split(" ");h=o[o.length-1];n.UserCurrentFirstName=h;u.push(n);r[i].documents=u;break}else continue;e.documentTrees=r;f.localCache=e;t[s]=f;egov.locache.update("documentOfUsers",t)}}})}})})}},i={};i["laylaivanban"+t]=o;$.extend(f,i)}r(f)}}}):r(f)}}),i=function(n){require(["documentDetail"],function(t){var i=new t({model:n}),r={width:900,height:450,title:egov.resources.documents.title.documentDetail,buttons:[{text:egov.resources.common.closeButton,className:"btn-default",click:function(){i.$el.dialog("destroy")}}],draggable:!0,keyboard:!0};i.$el.dialog(r)})};return t});