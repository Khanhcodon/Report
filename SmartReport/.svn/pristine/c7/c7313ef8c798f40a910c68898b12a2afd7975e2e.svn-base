define(["jquery",],function(n){var i=Backbone.View.extend({initialize:function(n){this.frame=n.frame;this.docCopyId=n.docCopyId;this.open()},open:function(){var e=this,t={},i=new dialogAdapter,r=f();n(document).off("checkModifySuccess");n(document).on("checkModifySuccess",function(r,u){t.width=790;t.height=615;t.title="Lưu sổ phát hành";t.buttons=[{text:"Lưu",click:function(){e.publish(u)}},{text:"Bỏ qua",click:function(){i.close()}}];var f=n('<div id="publishDialog"><\/div>');f.appendTo("body");n.ajax({url:"/Transfer/GetPublish",data:{docCopyId:e.docCopyId},beforeSend:function(){f.html('<img src="../../Content/Images/ajax-loader.gif" />');i.openexist(f,t)},success:function(n){f.html(n);i.openexist(f,t)}})});r.length>0?(egov.plugin.closeAllOfficeDocuments(),u(egov.plugin,r)&&confirmSaveAttachment(r,{},egov.plugin)):n(document).trigger("checkModifySuccess",{})},publish:function(t){var c=r(egov.common.targetForComments,egov.database.allUserDepartments),e=this,l=n("input[name='__RequestVerificationToken']","#TransferTransferPublish").val(),a=egov.views.base.dialog,o=n("#DocumentPublish").find(":input,select").serializeObject(),i,u,f,s,h;(o.hdfaddressIds==""&&egov.message.show("Bạn chưa chọn nơi phát hành văn bản.","Phát hành văn bản"),i=document.getElementById(e.frame).contentWindow,u=i.egov.cshtml.document.getDoc(),u!=null)&&(f=i.egov.cshtml.document.getSelectedFiles(),n.each(f,function(n,i){t[n]&&(i.content=t[n],delete t[n])}),s=i.egov.cshtml.document.getRemoveFiles(),h={documentCopyId:e.docCopyId,doc:JSON.stringify(u),files:JSON.stringify(f),modifiedFiles:JSON.stringify(t),removeAttachmentIds:s,publishinfo:JSON.stringify(o),usersConsult:c,__RequestVerificationToken:l},n.ajax({type:"POST",url:"/Transfer/TransferPublish",dataType:"json",traditional:!0,data:h,success:function(){a.close();egov.cshtml.home.tab.closeActiveTab();egov.cshtml.home.reloadData()},error:function(){}}))}}),t={jobtitlesItem:"jobtitlesItem",jobtitlesDeptItem:"jobtitlesDeptItem",allUsers:"allUsers",deptItem:"deptItem",userItem:"userItem"},r=function(i,r){var e=[],o,f,u;if(i!=undefined&&i.length>0)for(o=0;o<i.length;o++){if(f=i[o],f.value==t.allUsers)return _.pluck(r,"userid");f.value==t.userItem?e.push(f.item.userid):f.value==t.jobtitlesItem?(u=_.filter(r,function(n){return n.jobtitleid==f.item.jobtitleid}),u.length>0&&(u=_.pluck(u,"userid"),n.extend(e,u))):f.value==t.deptItem?(u=_.filter(r,function(n){return n.departmentid==f.item.deptid||n.idext.indexOf("."+f.item.deptid+".")>0}),u.length>0&&(u=_.pluck(u,"userid"),n.extend(e,u))):f.value==t.jobtitlesDeptItem&&(u=_.filter(r,function(n){return n.jobtitleid==f.item.jobtitleid&&(n.departmentid==f.item.deptid||n.idext.indexOf("."+f.item.deptid+".")>0)}),u.length>0&&(u=_.pluck(u,"userid"),n.extend(e,u)))}return _.uniq(e,!1)},u=function(n,t){for(var i=0;i<t.length;i++)if(/(.doc|.docx|.xls|.xlsx|.ppt|.pptx)$/i.test(t[i].name)&&n.readFileBase64(t[i].name,0,-1)=="")return egov.message.show("Bản phải đóng các chương trình đang mở tệp đính kèm trước khi lưu"),!1;return!0},f=function(){var t=[];return n("#tblFiles tbody tr").each(function(i,r){var u=n(r),f;u.hasClass("disabletemp-attachment")||u.attr("data-file")&&(f=u.hasClass("temp-attachment")?u.attr("id").replace("temp",""):u.attr("id").replace("attachment",""),t.push({id:f,name:u.attr("data-file"),value:u.attr("data-filename")}))}),t};return i});
//# sourceMappingURL=publishment-view.min.js.map
