define([egov.template.document.announcement],function(n){"use strict";var t=egov.resources.document.announcement;return Backbone.View.extend({template:n,events:{"click .private-anoun .checkbox":"uncheckPrivateAnoun"},initialize:function(){return this.$el.html(this.template),this.$el.bindResources(),this.$dg=this.$(".dg-view"),this.$privateAnounc=this.$(".private-anoun ul:first"),this},render:function(n){return this.$privateAnounc.empty(),this.documentCopyId=n,this._destroyDg(),this._openDialog(),this},uncheckPrivateAnoun:function(n){if(egov.views.dg){var t=$(n.target).parent().find(":checkbox");if(t.length===0)return;egov.views.dg.uncheckPrivateAnoun(t.val());this._selectDg()}},_openDialog:function(){this._showDg();var n=this;this.$el.dialog({title:t.dialogTitle,width:"650px",height:"220px",draggable:!0,buttons:[{text:t.announcementButton,className:"btn-primary",click:function(){n._announcement()}},{text:egov.resources.common.closeButton,click:function(){n._destroyDg();n.$el.dialog("hide")}}]})},_showDg:function(){var n=this;n.$dg.is(":not(:empty)")||(egov.views.dg?(egov.views.dg.render(!1,!1,function(){n._selectDg()}),n.$dg.append(egov.views.dg.$el)):require(["transferExtend"],function(t){egov.views.dg=new t;egov.views.dg.render(!1,!1,function(){n._selectDg()},function(){n.$dg.append(egov.views.dg.$el)})}))},_selectDg:function(){this.$privateAnounc.empty();egov.views.dg.selectDg(this.$privateAnounc)},_announcement:function(){var r=egov.views.dg.getDestination(),i=egov.views.dg.getUserConsults(),n;if(i.length===0){egov.pubsub.publish(egov.events.status.warning,t.noReceiver);return}n=this;egov.pubsub.publish(egov.events.status.processing,egov.resources.transfering);egov.request.TransferAnnouncement({data:{documentCopyId:this.documentCopyId,ccUsers:i,targetForComments:JSON.stringify(r)},success:function(i){i.error?egov.pubsub.publish(egov.events.status.error,t.sendFail):(egov.pubsub.publish(egov.events.status.success,t.sendSuccess),n.$el.dialog("hide"),n._destroyDg())},error:function(){egov.pubsub.publish(egov.events.status.error,t.sendFail)}})},_resetForm:function(){this._destroyDg();$("#FilterDepartment").jstree("uncheck_node",$("#FilterDepartment").find("li"));$("#DeptForJobtitle").jstree("uncheck_node",$("#DeptForJobtitle").find("li"));$("#JobtitleForDept").find("input[type=checkbox]").removeAttr("checked")},_destroyDg:function(){egov.views.dg&&egov.views.dg.destroy()}})});