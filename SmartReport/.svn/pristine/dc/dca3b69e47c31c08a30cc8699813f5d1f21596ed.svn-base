define(["jquery",egov.template.document.checkCitizenInfo],function(n,t){"use strict";var i=egov.resources.document.documentOnline,u=Backbone.View.extend({id:"checkCitizenInfo",items:[],initialize:function(n){this.template=t;this.document=n.document;this.render()},events:{"click thead .col-extend-info":"changeColInfo"},render:function(){var n=this;this.renderDialog();this.renderExistDocument()},renderDialog:function(){var t=this,r={title:egov.resources.searching.result,width:"1000px",draggable:!0,keyboard:!0,height:"auto",buttons:[{id:"closeCheckCitizenInfo",className:"btn-close",text:egov.resources.common.closeButton,click:function(){t.$el.dialog("destroy")}}]};this.$el.html(n.tmpl(this.template,this.model));this.model.isOnline?this.$el.addClass("isOnlineDialog"):r.buttons.unshift({id:"insertRelationDocs",className:"btn-primary disabled",text:i.insertRelations,click:function(){t.insertRelationDocs(function(){t.$el.dialog("destroy")})}});this.$el.dialog(r)},renderRegisterDocument:function(){var n=this,t=this.$(".registerDocumentZone"),u=egov.views.home.documents.model.models.filter(function(t){return t.get("IdCard")==n.model.idCard});u.length>0?_.each(u,function(i){var u={docCode:i.get("DocCode"),compendium:i.get("Compendium"),dateCreated:i.get("DateRecieved"),docId:i.get("Id"),isWaitting:!0,statusText:""},f=new r({parent:n.document,model:u,dialog:n.$el,isCurrent:i.get("id")==n.document.id});t.append(f.$el)}):t.append("<span class='noData'>"+i.noData+"<\/span>")},renderExistDocument:function(){var n=this,t=this.$(".acceptDocumentZone");n.items=[];egov.request.checkDocument({data:n.model,success:function(u){if(u.length>0){n.$("#insertRelationDocs").removeClass("disabled");var f=[];!n.model.isOnline&&n.document.relations&&(f=n.document.relations.model.filter(function(n){return n.get("IsRemoved")==!1}));_.each(u,function(i){var e=f.find(function(n){return n.id==i.docCopyId}),u=new r({parent:n.document,model:i,dialog:n.$el,curentCopyId:n.document.id,isCheck:e!=undefined});t.append(u.$el);n.items.push(u)})}else t.append("<span class='noData'>"+i.noData+"<\/span>");egov.pubsub.publish(egov.events.status.destroy)},error:function(){egov.pubsub.publish(egov.events.status.error,i.getExistDocumentError)}})},insertRelationDocs:function(n){var t,i;this.model.isOnline||(t=this,t.document.relations.model.reset(),i=this.items.filter(function(n){return n.model.isCheck==!0}),_.each(i,function(n){t.document.relations.model.add(new egov.models.relation({RelationCopyId:n.model.docCopyId,RelationId:n.model.documentId,RelationType:1,IsAddNext:!1,IsNew:!0,Compendium:n.model.compendium,CitizenName:n.model.citizenName,DocCode:n.model.docCode,DateCreated:n.model.dateCreated,CategoryName:n.model.categoryName}))}),egov.callback(n))},changeColInfo:function(t){var i=this.$("#checkCitizenInfoDialog"),r=n(t.currentTarget);i.find(".col-extend-info").hide();r.hasClass("phone")?i.find(".col-extend-info.email").show():r.hasClass("idcard")?i.find(".col-extend-info.phone").show():i.find(".col-extend-info.idcard").show()}}),r=Backbone.View.extend({curentDocCopyId:0,isCurrent:!1,isCheck:!1,tagName:"tr",className:"checkItem",initialize:function(n){var t=this;this.parent=n.parent;this.curentDocCopyId=n.curentCopyId;this.model.isCheck=n.isCheck;this.model.isCurrent=this.model.docCopyId==t.parent.id;this.model.isCurrent&&(this.model.canView=!1);this.model.createdDate=new Date(this.model.dateCreated).format("dd/MM/yyyy");this.model.statusText||(this.model.statusText=egov.resources.search["status"+this.model.status]);this.dialog=n.dialog;this.render()},events:{click:"select",dblclick:"openDocument","click .chkrelationdocument":"addRelation"},render:function(){var t=this;require([egov.template.document.checkCitizenInfoItem],function(i){t.$el.html(n.tmpl(i,t.model))})},select:function(){this.$el.hasClass("selected")?this.$el.removeClass("selected"):(this.$el.siblings().removeClass("selected"),this.$el.addClass("selected"))},openDocument:function(){this.select();this.model.canView&&egov.views.home.tab.openDocument(this.modeldocCopyId,this.modelcompendium,!0,function(){that.dialog.dialog("destroy")})},addRelation:function(t){n(t.currentTarget).closest(".checkbox").hasClass("checked")?n(t.currentTarget).closest(".checkbox").removeClass("checked"):n(t.currentTarget).closest(".checkbox").addClass("checked");this.model.isCheck=n(t.currentTarget).is(":checked")}});return u});
//# sourceMappingURL=checkCitizenInfo.min.js.map
