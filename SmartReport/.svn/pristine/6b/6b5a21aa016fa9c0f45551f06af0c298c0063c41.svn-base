define([egov.isMobile?egov.template.transfer.transferExtendMobile:egov.template.transfer.transferExtend],function(n){"use strict";var s=egov.resources.document.transfer,r,i,a=Backbone.View.extend({className:"transfer-extend",template:n,initialize:function(){return this},render:function(n,t,i,r){var u,e,f;if($("body .transfer-extend").length>0&&$("body .transfer-extend").remove(),this.$el.html(this.template),this.$el.bindResources(),this.$el.appendTo("body"),this.$dgOption=this.$(".dg-option"),this.$relationOption=this.$(".relation-option"),this.onselect=i,this.onloaded=r,this.forTransfer=n,this.showRelation=t,u=this,egov.dataManager)return e=egov.setting.typePositionTitleJob,e===undefined&&(e=0),f=egov.dataManager,f.getAllUsers({success:function(n){u.allUsers=n;e===0?f.getAllJobtitle({success:function(n){u.allPosition=n;f.getAllDept({success:function(n){u.allDepts=n;f.getAllUserDeptPosition({success:function(n){u.allUserDeptPosition=n;u._bind(u.onloaded)}})}})}}):f.getAllPosition({success:function(n){u.allPosition=n;f.getAllDept({success:function(n){u.allDepts=n;f.getAllUserDeptPosition({success:function(n){u.allUserDeptPosition=n;u._bind(u.onloaded)}})}})}})}}),this},reRender:function(n,t,i){this.onselect=i;this.hasDg=n;this.showRelation=t;this._show();this._bindCallback();that.$("#dgUser").focus()},destroy:function(){this.$("#dgUsers, #dgJobtitle, #dgDeptJob, #dgUserGiamsats").each(function(){$(this).customDropdown("destroy")});this.$el.remove()},callback:function(){egov.callback(this.onselect)},serialize:function(){return this.result={isDg:!0,isAllUser:!1,isAllDept:!1,isAllJobtitle:!1,users:[],depts:[],jobDepts:[],jobtitlies:[],userGs:[],deptGs:[]},this._getUsersDept(),this._getJobtitlesDept(),this._getUserGs(),this._processResult()},getDestination:function(){var n=this.serialize(),t=[],r=egov.enum.transferType,i=n.isDg?r.dongxuly:r.thongbao,u;if(n.isAllUserGs?t.push({label:s.sendAll,value:"all",type:r.giamsat}):(n.deptGs.forEach(function(n){t.push({label:n.data,value:"FilterDepartment-"+n.value,type:r.giamsat})}),n.userGs.forEach(function(n){t.push({label:n.fullname+" - "+n.username,value:"FilterDepartment-user_"+n.value,type:r.giamsat})})),n.isAllUser||n.isAllDept&&n.isAllJobtitle)return t.push({label:s.sendAll,value:"all",type:i}),t;if(n.depts.forEach(function(n){t.push({label:n.data,value:"FilterDepartment-"+n.value,type:i})}),n.users.forEach(function(n){t.push({label:n.fullname+" - "+n.username,value:"FilterDepartment-user_"+n.value,type:i})}),n.isAllDept){if(n.jobtitlies.length>0){var f=" thuộc "+n.jobDepts[0].data,e=_.pluck(n.jobtitlies,"label").join(", ")+f,u=_.pluck(n.jobtitlies,"value").join(",");t.push({label:e,value:String.format("JobtitleForDept-{0}_{1}",n.jobDepts[0].idext,u),type:i})}}else n.isAllJobtitle?n.isAllDept||n.jobDepts.forEach(function(n){t.push({label:n.data,value:String.format("JobtitleForDept-{0}_{1}",n.idext,0),type:i})}):n.jobtitlies.length>0&&(u=_.pluck(n.jobtitlies,"value").join(","),n.jobDepts.forEach(function(r){var f=_.pluck(n.jobtitlies,"label").join(", ")+" thuộc "+r.data;t.push({label:f,value:String.format("DeptForJobtitle-{0}_{1}",r.idext,u),type:i})}));return t},getUserConsults:function(){var n=this.result,t=[],f,i,e,r;return n===undefined?t:(f=egov.setting.typePositionTitleJob,f===undefined&&(f=0),i=this.allUserDeptPosition,e=this.allUsers,n.isAllUser||n.isAllDept&&n.isAllJobtitle)?_.pluck(e,"value"):(n.users.length>0&&(t=_.union(t,_.pluck(n.users,"value"))),n.depts.length>0&&(t=_.union(t,u(_.pluck(n.depts,"value"),i))),n.isAllDept?!n.isAllJobtitle&&n.jobtitlies.length>0&&(r=f!==0?_.filter(i,function(t){return _.find(n.jobtitlies,function(n){return n.value===t.positionid})}):_.filter(i,function(t){return _.find(n.jobtitlies,function(n){return n.value===t.jobtitleid})}),r.length>0&&(t=_.union(t,u(_.pluck(r,"departmentid"),i)))):n.isAllJobtitle?!n.isAllDept&&n.jobDepts.length>0&&(r=_.filter(i,function(t){return _.find(n.jobDepts,function(n){return n.departmentid===t.departmentid})}),r.length>0&&(t=_.union(t,u(_.pluck(r,"departmentid"),i)))):n.jobtitlies.length>0&&(r=f!==0?_.filter(i,function(t){var i=_.find(n.jobDepts,function(n){return n.value===t.departmentid}),r=_.find(n.jobtitlies,function(n){return n.value===t.positionid});return i&&r}):_.filter(i,function(t){var i=_.find(n.jobDepts,function(n){return n.value===t.departmentid}),r=_.find(n.jobtitlies,function(n){return n.value===t.jobtitleid});return i&&r}),r.length>0&&(t=_.union(t,u(_.pluck(r,"departmentid"),i)))),_.uniq(t,!1))},getUserThongBao:function(){var t=this.result,n=[],i,r;return t===undefined?n:(i=this.allUserDeptPosition,r=this.allUsers,t.isAllUserGs)?_.union(n,_.pluck(r,"value")):(t.userGs.length>0&&(n=_.union(n,_.pluck(t.userGs,"value"))),t.deptGs.length>0&&(n=_.union(n,u(_.pluck(t.deptGs,"value"),i))),_.uniq(n,!1))},getUserReceiveDocument:function(){var n=[],t=this.allUserDeptPosition,i=this.allUsers,r=this.allDepts;return $("#FilterDepartment").jstree("get_checked",null,!1).each(function(){var o=$(this),u=this.id,c=o.attr("hasreceivedocument")==="true",l=o.attr("rel")==="dept",f,s,h,e;l?(f=_.find(r,function(n){return n.value==u}),f&&(f.idext.indexOf(".")<0?(s=_.filter(t,function(n){return n.hasReceiveDocument==!0}),n=_.union(n,_.pluck(s,"userid"))):(h=_.filter(t,function(n){return n.departmentid==f.value&&n.hasReceiveDocument==!0}),n=_.union(n,_.pluck(h,"userid"))))):c&&(u=u.replace("user_",""),e=_.find(i,function(n){return n.value==u}),e&&(_.contains(n,e)||n.push(e)))}),n},getExtInfo:function(){if(!this.result)return null;var n={isAllUser:!1,isAllDept:!1,isAllJobtitle:!1,users:[],jobtitlies:[],jobDepts:[],depts:[]};return this.result.isAllUser?(n.isAllUser=!0,n):this.result.isAllJobtitle?(n.isAllJobtitle=!0,this.result.isAllDept&&(n.isAllDept=!0),n):(this.result.users&&this.result.users.length>0&&(n.users=_.pluck(this.result.users,"value")),this.result.jobtitlies&&this.result.jobtitlies.length>0&&(n.jobtitlies=_.pluck(this.result.jobtitlies,"value")),this.result.jobDepts&&this.result.jobDepts.length>0&&(n.jobDepts=_.pluck(this.result.jobDepts,"value")),this.result.depts&&this.result.depts.length>0&&(n.depts=_.pluck(this.result.depts,"value")),n)},checkIsDongGui:function(){return this.forTransfer},selectDg:function(n,t){var u=this.getDestination(),f,i,e,r;if(u&&!(u.length<=0))for(f=0;f<u.length;f++){if(i=u[f].value,e=u[f].type,t&&e==egov.enum.transferType.giamsat){t.append(l(i,u[f].label,"user"));continue}r="user";i==="all"?r="all":i===""?r="allJobtitle":i.indexOf("FilterDepartment-user_")!==-1?r="dept-user":i.indexOf("FilterDepartment-")!==-1?r="dept":i==="JobtitleForDept"?r="jobtitleForDept":i.indexOf("DeptForJobtitle-")!==-1&&(r="deptForJobtitle");n.append(l(i,u[f].label,r))}},uncheckPrivateAnoun:function(n){var t=n.split("-"),f=t[0]==="all",e=t[0]==="FilterDepartment",o=t[0]==="DeptForJobtitle"||t[0]==="JobtitleForDept",i,r,u;if(f){$("#JobtitleForDept").find("input[type=checkbox]").removeAttr("checked");$("#DeptForJobtitle").jstree("uncheck_node",$("#DeptForJobtitle").find("li"));$("#FilterDepartment").jstree("uncheck_node",$("#FilterDepartment").find("li"));return}if(e){$("#"+t[0]).jstree("uncheck_node",$("#"+t[0]).find("li#"+t[1]));return}o&&(i=t[1].split("_")[1].split(","),r=t[1].split("_")[0],$("#DeptForJobtitle").jstree("uncheck_node",$("#DeptForJobtitle").find("li[idext='"+r+"']")),u=$("#DeptForJobtitle").jstree("get_checked",null,!1),u.length===0&&_.each(i,function(n){n==0?$("#JobtitleForDept").find("input:checkbox").removeAttr("checked"):$("#JobtitleForDept").find("input:checkbox[value='"+n+"']").removeAttr("checked")}))},uncheckThongBao:function(n){var i=$(n.target),t;i.is(":checkbox")&&(t=i.val().split("-"),t[0]==="FilterDepartment"&&$("#FilterDepartmentGiamSat").jstree("uncheck_node",$("#FilterDepartmentGiamSat").find("li#"+t[1])))},_bind:function(){var n=this,r=this.$("#dgUser"),u=this.$(".filterDeparment#FilterDepartment"),i,t;n._bindUsers(r,u);n.forTransfer&&(i=this.$("#dgUserGiamsat"),t=this.$(".filterDeparment#FilterDepartmentGiamSat"),t.empty(),n._bindUsers(i,t));n._bindDepartments(function(){n._bindJobtitlies(function(){n.forTransfer||(n.$dgOption.hide(),n.$(".thongbao").hide(),n.$(".dgText").hide());n.showRelation||n.$relationOption.hide();n._show();n._bindCallback();egov.callback(n.onloaded);n.$el.bindResources()})})},_bindUsers:function(n,u){var o=n,f=this,u=u,e=f.allUserDeptPosition;o.autocomplete({source:f.allUsers,focus:function(n,t){return o.val(t.item.username),!1},select:function(n,s){var p=_.filter(e,function(n){return n.userid===s.item.value}),v,c,k,y,h,l,a,w,b;if(p){for(v=0;r=p.length,v<r;v++)if(c=p[v].idext.split("."),c)for(k="li#user_"+s.item.value,y=u.find(k),typeof y!="undefined"&&y.length>0&&u.jstree("check_node",y),h=0;i=c.length,h<i;h++){if(l=c[h],a=u.find("li[id="+l+"]"),a.length>0){a.hasClass("jstree-closed")&&a.children("ul").length===0&&t(a,parseInt(l),!0,!0,f.allDepts,f.allUsers,e);continue}w=$("");b=0;h>0&&(w=u.find("li[id="+c[h-1]+"]"),b=parseInt(c[h-1]));t(w,b,!0,!0,f.allDepts,f.allUsers,e);h===i-1&&t(u.find("li[id="+l+"]"),parseInt(l),!0,!0,f.allDepts,f.allUsers,e)}u.jstree("check_node",u.jstree("get_unchecked",null,!0).find("li[rel!=dept][id=user_"+s.item.value+"]"))}return o.val(""),!1}}).data("autocomplete")._renderItem=function(n,t){return n.addClass("dropdown-menu").css("zIndex","1060"),$("<li><\/li>").data("item.autocomplete",t).append("<a>"+t.label+"<\/a>").appendTo(n)}},_bindDepartments:function(n){var t=this,i=t.allDepts;require(["jstree"],function(){o(t.$el.find("#FilterDepartment"),!0,!0,!1,i,t.allUsers,t.allUserDeptPosition,null,[]);o(t.$el.find("#FilterDepartmentGiamSat"),!0,!0,!1,i,t.allUsers,t.allUserDeptPosition,null,[]);o(t.$el.find("#DeptForJobtitle"),!1,!0,!1,i,[],[],null,[]);typeof n=="function"&&n()})},_bindJobtitlies:function(n){var t,r,e,i,u,f;for(this.$jobtitlies=this.$(".dgJobtitlies"),t=this,r=t.allPosition,i=0;e=r.length,i<e;i++)u=r[i],f=$("<li>").addClass("list-group-item"),f.append(String.format('<label><input type="checkbox" value="{0}"> {1}<\/label>',u.value,u.label)),t.$jobtitlies.append(f);egov.isMobile&&t.$jobtitlies.find(".mdl-checkbox").materialCheckbox();$("#JobtitleForDept #allJobsForDept").checkAll($("#JobtitleForDept :checkbox").not(":first"));t.$(".jobtitlies #allJobs").checkAll(t.$(".jobtitlies :checkbox").not(":first"));typeof n=="function"&&n()},_bindCallback:function(){var n=this;$("#FilterDepartment, #DeptForJobtitle, #FilterDepartmentGiamSat").bind("change_state.jstree",function(){n.callback()});$("#JobtitleForDept :checkbox").on("click",function(){n.callback()});n.$('[name="isDg"]').on("click",function(){n.callback()})},_getUsersDept:function(){var n=this.result,t=this,i=t.allDepts,r=t.allUsers;$("#FilterDepartment").jstree("get_checked",null,!1).each(function(){var e=$(this),t=this.id,o=e.attr("rel")==="dept",u,f;if(o){if(u=_.find(i,function(n){return n.value==t}),u){if(u.idext.indexOf(".")<0){n.isAllUser=!0;return}n.depts.push(u)}}else t=t.replace("user_",""),f=_.find(r,function(n){return n.value==t}),f&&(_.contains(n.users,f)||n.users.push(f))})},_getUserGs:function(){var n=this.result,t=this,i=t.allDepts,r=t.allUsers;$("#FilterDepartmentGiamSat").jstree("get_checked",null,!1).each(function(){var e=$(this),t=this.id,o=e.attr("rel")==="dept",u,f;if(o){if(u=_.find(i,function(n){return n.value==t}),u){if(u.idext.indexOf(".")<0){n.isAllUserGs=!0;return}n.deptGs.push(u)}}else t=t.replace("user_",""),f=_.find(r,function(n){return n.value==t}),f&&(_.contains(n.userGs,f)||n.userGs.push(f))})},_getJobtitlesDept:function(){var n=this.result,t=!1,i=[],r=this,e;$("#JobtitleForDept :checked").each(function(){var u=$(this).val(),n;if(u==="0"){t=!0;return}n=_.find(r.allPosition,function(n){return n.value==u});n&&i.push(n)});var r=this,u=r.allDepts,f=$("#DeptForJobtitle").jstree("get_checked",null,!1);if(f.length===0){n.isAllDept=!0;n.isAllJobtitle=t;n.jobtitlies=i;e=_.find(u,function(n){return n.idext.indexOf(".")<0});n.jobDepts.push(e);return}f.each(function(){var o=$(this),e=this.id,r=_.find(u,function(n){return n.value==e}),f;if(r){if(f=r.idext.indexOf(".")<0,f){if(t){n.isAllDept=!0;n.isAllJobtitle=!0;return}n.isAllDept=!0;n.jobDepts.push(r);n.jobtitlies=i;return}t?(n.isAllJobtitle=!0,n.jobDepts.push(r)):(n.jobtitlies=i,n.jobDepts.push(r))}})},_processResult:function(){var n=this;return this.result.depts.forEach(function(t){n.result.jobDepts=_.reject(n.result.jobDepts,function(n){return n.idext.split(".").indexOf(""+t.value)>=0})}),this.result},_resetForm:function(){$("#FilterDepartment").jstree("uncheck_node",$("#FilterDepartment").find("li"));$("#DeptForJobtitle").jstree("uncheck_node",$("#DeptForJobtitle").find("li"));$("#JobtitleForDept").find("input[type=checkbox]").removeAttr("checked")},_show:function(){var n=this;n.$("#dgUsers, #dgJobtitle, #dgDeptJob, #dgUserGiamsats").each(function(){$(this).customDropdown({css:{width:300,height:"auto"}})});n._resetForm()},bindDataInTransferView:function(n,t){n?this.$('input[name="isDg"][value="1"]').prop("checked",!0):this.$('input[name="isDg"][value="0"]').prop("checked",!0);this.bindDataView(t)},bindDataView:function(n){if(n&&typeof n=="object"){if(n.isAllUser){this._showAllUser();return}if(n.isAllJobtitle){if(this._showAllJobtitle(),n.isAllDept){this._showAllJobDepts();return}}else this._showJobtitle(n.jobtitlies);n.isAllDept?this._showAllJobDepts():this._showJobDepts(n.jobDepts);this._showDepts(n.depts);this._showUsers(n.users)}},_showUsers:function(n){var u,o,l,s,a,e,w,v,f,h,c,y,p;if(n&&!(n.length<=0)&&(u=this,this.$filterDept=this.$(".filterDeparment"),o=u.allUserDeptPosition,l=_.filter(o,function(t){return _.contains(n,t.userid)}),l))for(s=0;s<n.length;s++){for(a=0;r=l.length,a<r;a++)if(e=l[a].idext.split("."),e)for(w="li#user_"+n[s],v=u.$filterDept.find(w),typeof v!="undefined"&&v.length>0&&u.$filterDept.jstree("check_node",v),f=0;i=e.length,f<i;f++){if(h=e[f],c=u.$filterDept.find("li[id="+h+"]"),c.length>0){c.hasClass("jstree-closed")&&c.children("ul").length===0&&t(c,parseInt(h),!0,!0,u.allDepts,u.allUsers,o);continue}y=$("");p=0;f>0&&(y=u.$filterDept.find("li[id="+e[f-1]+"]"),p=parseInt(e[f-1]));t(y,p,!0,!0,u.allDepts,u.allUsers,o);f===i-1&&t(u.$filterDept.find("li[id="+h+"]"),parseInt(h),!0,!0,u.allDepts,u.allUsers,o)}u.$filterDept.jstree("check_node",u.$filterDept.jstree("get_unchecked",null,!0).find("li[rel!=dept][id=user_"+n[s]+"]"))}},_showAllUser:function(){this.$(".filterDeparment").jstree("check_all")},_showAllJobtitle:function(){this.$(".jobtitleForDept :checkbox").prop("checked",!0)},_showJobtitle:function(n){if(n)for(var t=0;t<n.length;t++)this.$('.jobtitleForDept :checkbox[value="'+n[t]+'"]').prop("checked",!0)},_showAllJobDepts:function(){this.$(".deptForJobtitle").jstree("check_all")},_showJobDepts:function(n){var u,o,l,s,a,e,w,v,f,h,c,y,p;if(n&&!(n.length<=0)&&(u=this,this.$deptForJobtitle=this.$(".deptForJobtitle"),o=u.allDepts,l=_.filter(o,function(t){return _.contains(n,t.value)}),l))for(s=0;s<n.length;s++){for(a=0;r=l.length,a<r;a++)if(e=l[a].idext.split("."),e)for(w="li#"+n[s],v=u.$deptForJobtitle.find(w),typeof v!="undefined"&&v.length>0&&u.$deptForJobtitle.jstree("check_node",v),f=0;i=e.length,f<i;f++){if(h=e[f],c=u.$deptForJobtitle.find("li[id="+h+"]"),c.length>0){c.hasClass("jstree-closed")&&c.children("ul").length===0&&t(c,parseInt(h),!0,!0,o,[],[]);continue}y=$("");p=0;f>0&&(y=u.$deptForJobtitle.find("li[id="+e[f-1]+"]"),p=parseInt(e[f-1]));t(y,p,!0,!0,o,[],[]);f===i-1&&t(u.$deptForJobtitle.find("li[id="+h+"]"),parseInt(h),!0,!0,o,[],[])}u.$deptForJobtitle.jstree("check_node",u.$deptForJobtitle.jstree("get_unchecked",null,!0).find("li[rel=dept][id="+n[s]+"]"))}},_showDepts:function(n){var u,o,l,s,a,e,w,v,f,h,c,y,p;if(n&&!(n.length<=0)&&(u=this,this.$filterDept=this.$(".filterDeparment"),o=u.allUserDeptPosition,l=_.filter(o,function(t){return _.contains(n,t.departmentid)}),l))for(s=0;s<n.length;s++){for(a=0;r=l.length,a<r;a++)if(e=l[a].idext.split("."),e)for(w="li#"+n[s],v=u.$filterDept.find(w),typeof v!="undefined"&&v.length>0&&u.$filterDept.jstree("check_node",v),f=0;i=e.length,f<i;f++){if(h=e[f],c=u.$filterDept.find("li[id="+h+"]"),c.length>0){c.hasClass("jstree-closed")&&c.children("ul").length===0&&t(c,parseInt(h),!0,!0,u.allDepts,u.allUsers,o);continue}y=$("");p=0;f>0&&(y=u.$filterDept.find("li[id="+e[f-1]+"]"),p=parseInt(e[f-1]));t(y,p,!0,!0,u.allDepts,u.allUsers,o);f===i-1&&t(u.$filterDept.find("li[id="+h+"]"),parseInt(h),!0,!0,u.allDepts,u.allUsers,o)}u.$filterDept.jstree("check_node",u.$filterDept.jstree("get_unchecked",null,!0).find("li[rel=dept][id="+n[s]+"]"))}}}),h='<li id="${value}" label="${attr.label}" rel="${attr.rel}" idext="${attr.idext}" class="jstree-${state}"><ins class="jstree-icon">&nbsp;<\/ins><a href="#" class="">',c;h+='<ins class="jstree-icon">&nbsp;<\/ins>${data}<\/a><\/li>';c='<li id="${value}" rel="${attr.rel}" idext="${attr.idext}" hasReceiveDocument="${attr.hasReceiveDocument}" class="jstree-${state}"><ins class="jstree-icon">&nbsp;<\/ins><a href="#" class=""><ins class="jstree-checkbox">&nbsp;<\/ins><ins class="jstree-icon">&nbsp;<\/ins>${data}<\/a><\/li>';var f=["themes","json_data","ui","crrm"],e=function(n,t,i,r,u){var f=_.filter(i,function(t){return t.parentid==n}),o=_.filter(u,function(t){return t.departmentid===n}),c,s,h,l;if(f.length>0)for(c=0;c<f.length;c++)(e(f[c].value,!1,i,[],[]).length>0||t&&o.length>0)&&(f[c].state="closed");if(t&&o.length>0)for(s=0;s<o.length;s++)h=_.find(r,function(n){return n.value===o[s].userid}),h&&(l={value:"user_"+h.value,data:h.fullname,parentid:n,state:"leaf",metadata:{id:"user_"+h.value},attr:{id:"user_"+h.value,rel:"people",idext:o[s].idext,hasReceiveDocument:o[s].hasReceiveDocument}},f.push(l));return f},o=function(n,i,r,u,o,s,h){var c=_.find(o,function(n){return n.parentid===0}),l;r&&f.push("checkbox");u&&f.push("dnd");c&&(l=e(c.value,i,o,s,h),n.jstree({json_data:{data:[{data:c.data.toString(),metadata:{id:c.value},state:"closed",attr:{id:c.value,rel:"dept",idext:c.idext,label:c.label},children:l}]},crrm:u==!1?{}:{move:{check_move:function(n){var i=_.find(o,function(t){return t.value===parseInt(n.o.attr("id"))}),t;return i?i.level!=1?!1:(t=this._get_parent(n.o),!t)?!1:(t=t==-1?this.get_container():t,t===n.np)?!0:t[0]&&n.np[0]&&t[0]===n.np[0]?!0:!1:!1}}},dnd:u==!1?{}:{drop_target:!1,drag_target:!1},plugins:f}).bind("loaded.jstree",function(u,f){var e=1;f.inst.get_container().find("li").each(function(){f.inst.get_path($(this)).length<=e&&f.inst.open_node($(this))});n.bind("open_node.jstree",function(n,u){u.inst._get_children(u.rslt.obj).length==0&&t(u.rslt.obj,parseInt(u.rslt.obj.attr("id")),i,r,o,s,h)})}))},t=function(n,t,i,r,u,f,o){var l=e(t,i,u,f,o),s;l.length>0&&(s=$("<ul><\/ul>"),s.appendTo(n),r?($.tmpl(c,l).appendTo(s),$(n).find("li").each(function(t,i){$(i).addClass(n.hasClass("jstree-checked")?"jstree-checked":"jstree-unchecked")})):$.tmpl(h,l).appendTo(s),s.children("li:last").addClass("jstree-last"))},u=function(n,t){var i=[];return n.forEach(function(n){var r=_.filter(t,function(t){return t.departmentid===n||t.idext.indexOf("."+n+".")>0});r.length>0&&(i=_.union(i,_.pluck(r,"userid")))}),i=_.uniq(i,!1)},l=function(n,t,i){var r;return r=$(String.format('<li class="list-group-item {2}">                                <div class="row">                                    <label class="mdl-checkbox mdl-js-checkbox checkbox document-color">                                       <input class="mdl-checkbox__input" name="checkbox[]" value="{0}" type="checkbox" checked="checked">                                        <span class="document-color-1"><i class="icon-check"><\/i><\/span>                                    <\/label>                                    <span style="margin-left: 15px;">{1}<\/span>                                <\/div>                            <\/li>',n,t,i)),egov.isMobile&&$(r).find(".mdl-checkbox").materialCheckbox(),r};return a});