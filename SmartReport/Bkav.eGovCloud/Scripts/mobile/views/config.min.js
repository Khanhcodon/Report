define(function(){"use strict";var n=Backbone.View.extend({el:"body",setting:{},avatarTheme:"troll1",isAutoSaveConfig:!0,maxUnreadLabel:99,settingResources:egov.resources.mobile.usersetting,startApp:"documents",pageSize:50,fontFamily:1,fontSize:1,notifyType:1,language:"Vietnamese",showUserAvatar:!0,showPageInPopup:!1,initialize:function(){this.initSetting();this.userConfigRender();egov.mobile.config=this},events:{"click .btnconfig":"showUserConfig","change #showAvatar":"userAvatar","change .ddlApps":"changeStartApp","change .ddlFontFamily":"changeFontFamily","change .ddlNotifyType":"changeNotifyType","change .ddlFontSize":"changeFontSize","change .ddlPageSize":"changePageSize","change .ddlLanguage":"changeLanguage"},initSetting:function(){egov.mobile.startApp=this.startApp;this.setting=egov.setting;this.userSetting=this.setting.user.userSetting;this.fontFamily=this.userSetting.MFontFamily||this.fontFamily;this.notifyType=this.userSetting.MNotifyType||this.notifyType;this.fontSize=this.userSetting.MFontSize;this.language=this.userSetting.Language;this.showUserAvatar=this.userSetting.MUseAvatar;this.showPageInPopup=this.userSetting.MUsePopup;this.setUserSetting()},setUserSetting:function(){egov.userConfig={startApp:this.startApp,pageSize:this.pageSize,fontFamily:this.fontFamily,notifyType:this.notifyType,fontSize:this.fontSize,showAvatar:!0,usePopUp:this.showPageInPopup,language:this.language};this.showUserAvatar&&egov.mobile.$egov.addClass("showRealAvatar")},userConfigRender:function(){this._changeFontSize(this.fontSize)},render:function(){var n=this,t={};t.userConfig=egov.userConfig;t.apps=[{value:appType.documents,text:this.settingResources.appType.documents},{value:appType.bmail,text:this.settingResources.appType.bmail},{value:appType.chat,text:this.settingResources.appType.chat},{value:appType.calendar,text:this.settingResources.appType.calendar},{value:appType.contacts,text:this.settingResources.appType.contacts},];t.fontSizes=[{value:"0",text:this.settingResources.fontsizeType.small},{value:"1",text:this.settingResources.fontsizeType.normal},{value:"2",text:this.settingResources.fontsizeType.large}];n.configDialog?n.configDialog.dialog("show"):require([egov.template.mobile.userConfig],function(i){var r=$.tmpl(i,t),u={title:egov.resources.main.config,keyboard:!0};u.height="auto";u.buttons=[{id:"close",text:egov.resources.common.closeButton,className:"btn-close",click:function(){r.dialog("hide")}}];n.isAutoSaveConfig||u.buttons.unshift({id:"submit",text:egov.resources.common.confirmButton,className:"btn-primary",click:function(){n.saveUserSetting(function(n){n.result=="success"?egov.pubsub.publish(egov.events.status.success,egov.resources.userConfig.saveSuccess):egov.pubsub.publish(egov.events.status.error,egov.resources.userConfig.saveError);r.dialog("hide")})}});r.dialogSetting=u;r.dialog(u);r.parent().parent().css("top","150px");n.configDialog=r;componentHandler.upgradeDom()})},showUserConfig:function(n){egov.helper.destroyClickEvent(n);this.render();egov.mobile.hidePanel()},userAvatar:function(n){egov.helper.destroyClickEvent(n);this.showUserAvatar=$(n.currentTarget).is(":checked");this.isAutoSaveConfig&&this.autoSaveSetting()},changeStartApp:function(n){egov.helper.destroyClickEvent(n);this.startApp=$(n.currentTarget).find("option:selected").val();this.isAutoSaveConfig&&this.autoSaveSetting()},changeFontFamily:function(n){egov.helper.destroyClickEvent(n);this.fontFamily=$(n.currentTarget).find("option:selected").val();this.isAutoSaveConfig&&this.autoSaveSetting()},changeNotifyType:function(n){egov.helper.destroyClickEvent(n);this.notifyType=$(n.currentTarget).find("option:selected").val();this.isAutoSaveConfig&&this.autoSaveSetting()},changeFontSize:function(n){egov.helper.destroyClickEvent(n);this.fontSize=$(n.currentTarget).find("option:selected").val();this._changeFontSize(this.fontSize);this.isAutoSaveConfig&&this.autoSaveSetting()},changePageSize:function(n){egov.helper.destroyClickEvent(n);this.pageSize=$(n.currentTarget).find("option:selected").val();this.isAutoSaveConfig&&this.autoSaveSetting()},changeLanguage:function(n){egov.helper.destroyClickEvent(n);this.language=$(n.currentTarget).find("option:selected").val();this.isAutoSaveConfig&&this.autoSaveSetting()},autoSaveSetting:function(){this.saveUserSetting(function(n){n.result!="success"&&console.log(n)})},saveUserSetting:function(n){var t=this,i={startApp:this.startApp,pageSize:this.pageSize,fontFamily:this.fontFamily,notifyType:this.notifyType,fontSize:this.fontSize,showAvatar:!0,usePopup:this.showPageInPopup,language:this.language};egov.request.setMobileUserConfig({data:i,success:function(i){t.setUserSetting();egov.callback(n(i))},error:function(t){egov.callback(n({result:"error",info:t}))}})},_changeFontSize:function(n){switch(parseInt(n)){case 0:$("body").attr("font-size","small");break;case 2:$("body").attr("font-size","large");break;default:$("body").attr("font-size","")}}});return new n});