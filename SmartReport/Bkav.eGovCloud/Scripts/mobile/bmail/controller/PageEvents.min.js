function PageEvents(){}autoCompleteResult=[];PageEvents.ContactAutoCompleteClickEvent=function(n,t,i){$(n).children("li").bind("click",function(){var f=$(this).attr("id"),t,r,u;$(n).children().remove();t=$(i).val();r="";t.indexOf(";")!=-1&&(u=t.lastIndexOf(";"),u<t.length-1&&(r=t.substring(0,u+1)));r=r+f+";";$(i).val(r);$(n).html("")})};PageEvents.addressClickEvent=function(n){$(n).children("#displayAddress").bind("click",function(){$(this).remove()});$(n).children("#displayAddress").bind("taphold",function(){$(this).css("background","green")})};PageEvents.AddressInputKeyEvent=function(n,t,i,r){$(n).bind(t,function(t){var o=$(i),u=$(this).val(),a,l,s,c,h;if(Util.needToSendAutoComplete(t.keyCode,u,t.charCode))if(u.length>0)if(u.indexOf(";")!=-1){if(h=u.lastIndexOf(";"),h<u.length-1){var v=u.substring(h+1),e={},f=new SOAPRequest;f.initParams();f.makeJsonHeader(e);f.makeAutoCompleteJsonBody(e,v);f.sendJsonRequest("AutoCompleteRequest",e,o,r,n)}}else if(u.indexOf(",")!=-1){if(h=u.lastIndexOf(","),h<u.length-1){var v=u.substring(h+1),e={},f=new SOAPRequest;f.initParams();f.makeJsonHeader(e);f.makeAutoCompleteJsonBody(e,v);f.sendJsonRequest("AutoCompleteRequest",e,o,r,n)}}else{var v=u,e={},f=new SOAPRequest;f.initParams();f.makeJsonHeader(e);f.makeAutoCompleteJsonBody(e,v);f.sendJsonRequest("AutoCompleteRequest",e,o,r,n)}else o.html("");else if(u.length>0){if(o.html(""),a=$(r).html(),l=[],(t.charCode==";"||t.charCode==",")&&l.push($(this).val().substr(0,$(this).val().length-1)),l.length!=0){a+=Util.displayBubbleAddress(l);$(r).html(a);PageEvents.addressClickEvent(r);$(n).val("");return}if(autoCompleteResult.length!=0){for(s=[],c=0;c<autoCompleteResult.length;c++)s.push("<li id='"),s.push(autoCompleteResult[c].email),s.push("'>"),s.push(autoCompleteResult[c].name),s.push("<\/li>");o.html(s.join(""))}else o.html("");PageEvents.ContactAutoCompleteClickEvent(o,r,n)}})};PageEvents.pullUpToLoadMoreMsgs=function(){if(more){var n=new SOAPRequest,t=[];n.makeHeader(t,"js");checkSearch?n.makeSearchBody(t,"SearchRequest","zimbraMail",mailIndex,queryStringSearch,20,!0):n.makeSearchBody(t,"SearchRequest","zimbraMail",mailIndex,folder.ACTIVE_FOLDER,20);n.sendRequest("SearchRequest",t)}};PageEvents.pullDownToLoadNewMsgs=function(){var n=new SOAPRequest,t=[],i;n.makeHeader(t,"js");i=mailIndex||20;checkSearch?n.makeSearchBody(t,"SearchRequest","zimbraMail",0,queryStringSearch,0,!0):n.makeSearchBody(t,"SearchRequest","zimbraMail",0,folder.ACTIVE_FOLDER,i);n.sendRequest("SearchRequest",t)};PageEvents.pullDownToLoadOlderChat=function(){isLoadOlderChat=!0;var n=new SOAPRequest,t=[];n.makeHeader(t,"js");messageIndex[currentFriend]||(messageIndex[currentFriend]=0);n.makeIMGetMessageHistoryRequest(t,"IMGetMessageHistoryRequest","zimbraIM",currentFriend,messageIndex[currentFriend],4);n.sendRequest("IMGetMessageHistoryRequest",t)};PageEvents.sendTyping=function(n){var t=new SOAPRequest,i=[];t.makeHeader(i,"js");t.makeIMSendTypingBody(i,"IMSendMessageRequest","zimbraIM",currentFriend);t.sendRequest("IMSendTypingRequest",i,n)};PageEvents.sendChatMsg=function(n){var t=$("#chatInput").html(),f,u,i,r;t!=""&&($("#chatInput").html(""),f="",oAvatar!=""&&(f="https://"+window.location.host+"/mail/"+oAvatar),t=reVertImg(t),u=removeTag(t),u=u.replace(/&nbsp;/gi," "),t=t.replace(/(<br>)*$/gi,""),t=t.replace(/(<div><br><\/div>)*$/gi,""),t=t.replace(/&/gi,"&amp;"),t=t.replace(/</gi,"&lt;"),t=t.replace(/>/gi,"&gt;"),t.indexOf("&nbsp")!=-1&&(t=t.replaceAll("&nbsp;&nbsp;"," &nbsp;"),t=t.replaceAll("&nbsp;","&amp;nbsp;")),i=new SOAPRequest,r=[],i.makeHeader(r,"js"),i.makeIMSendMessageBody(r,"IMSendMessageRequest","zimbraIM",currentFriend,t),i.sendRequest("IMSendMessageRequest",r,n),$("#chatInput").focus())};PageEvents.pageEvents=function(){$("#backButton").bind("click",function(){});$("#mailBack").bind("click",function(){folder.ACTIVE_FOLDER==null||folder.ACTIVE_FOLDER==""?getFolderMailList(0,folder.ACTIVE_FOLDER,20):(folder.ACTIVE_FOLDER="inbox",getFolderMailList(0,"inbox",20))});$("#chatBack").bind("click",function(){$("#bmailChat:visible").listview("refresh");$("#bmailChat").listview("refresh")});$("#chatGo").bind("click",function(){$("#bmailChat:visible").listview("refresh");$("#bmailChat").listview("refresh")})};PageEvents.bindScroll=function(n,t,i){var u=0,f=0,r=0,e,o=!1,s=function(){$(n).animate({top:"0"});$(n).find(".iconLoadding").css("background-image","url('/mail/cssmobile/images/imagesforall/loading.gif')");$(n).find(".textcontent").html("Đang lấy thêm thư...");$(n).animate({top:"0"},1500,function(){})},h=function(){$(n).animate({top:"0"},200,function(){$(n).find(".headscroll").remove();o=!1})};$(n).bind("touchstart",function(n){u=n.originalEvent.touches[0].pageY;e=(new Date).getTime()});$(n).bind("touchmove",function(t){var e=$(n).find(".headscroll").length,i;f=t.originalEvent.touches[0].pageY;i=f-u;!e&&i>=40&&i<250&&($(n).css("top","81px"),$(n).find(".iconLoadding").length==0&&$(n).prepend('<div class="headscroll"><span class="iconLoadding" ><\/span><span class="textcontent">Kéo thả để cập nhật...<\/span><\/div>'));r=parseInt($(n).css("top"));r>80&&($(n).find(".iconLoadding").css("transform","rotate(180deg)"),$(n).find(".textcontent").html("Thả để cập nhật.."))});$(n).bind("touchend",function(){r>80&&(s(),i(),u=0,f=0,r=0);h()})};PageEvents.unbindScroll=function(n){$(n).unbind("touchend");$(n).unbind("touchstart");$(n).unbind("touchmove");$("#Mainpage").find(".headscroll").length==1&&($("#Mainpage").animate({top:"0"},200,function(){$("#Mainpage").find(".headscroll").remove();isShow=!1}),$("#Mainpage").find("#mailListWrapper").css("top","10px"))};PageEvents.updatecontent=function(n,t,i){var r=!1;$(window).scroll(function(){var u;if($.mobile.activePage.attr("id")=="Mainpage")if(u=$(document).height()-$(window).height()-$(window).scrollTop(),u>120&&(r=!1),u==$(document).height()-$(window).height())PageEvents.bindScroll(n,t,i);else if(u<120){if($(document).height()>$(window).height()){var f=0,e=0,s=0,o=$(n).find("#loadding_Mail");u<120&&(o.length||r!=!1||($("#mailListWrapper").append('<div id="loadding_Mail">Đang lấy thêm thư...<\/div>'),$(window).scrollTop($(document).height()-$(window).height()),setTimeout(function(){t();$("#mailListWrapper").find("#loadding_Mail").remove();r=!0},2e3)));$(window).scrollTop==$(document).height()-$(window).height()&&($(n).bind("touchstart",function(n){f=n.originalEvent.touches[0].pageY}),$(n).bind("touchmove",function(t){var i=$(n).find(".headscroll").length;e=t.originalEvent.touches[0].pageY;s=e-f}),$(n).bind("touchend",function(){$(n).unbind("touchstart");$(n).unbind("touchmove");$(n).unbind("touchend");o.length||r!=!1||(r=!0,$("#mailListWrapper").append('<div id="loadding_Mail">Đang lấy thêm thư...<\/div>'),$(window).scrollTop($(document).height()-$(window).height()));setTimeout(function(){t();$("#mailListWrapper").find("#loadding_Mail").remove()},2e3)}))}}else PageEvents.unbindScroll(n)});r=!1};PageEvents.updatecontentChat=function(n){var f=$.mobile.activePage.attr("id");if(f=="chatForm"){var n=n,i=0,r=0,t=0,e,u=!1,o=function(){$(n).animate({top:"0"});$(n).find(".iconLoadding").css("background-image","url('/mail/cssmobile/images/imagesforall/loading.gif')");$(n).find(".textcontent").html("Đang lấy thêm tin nhắn");$(n).animate({top:"0"},1e3,function(){PageEvents.pullDownToLoadOlderChat();console.log("ok")})},s=function(){$(n).animate({top:0},10,function(){$(n).find(".headscroll").remove();u=!1})};$(n).bind("touchstart  ",function(n){i=n.originalEvent.touches[0].pageY});$(n).bind("touchmove",function(f){var h=$(n).find(".headscroll").length,o,s;r=f.originalEvent.touches[0].pageY;o=r-i;t=parseInt($(n).css("top"),"10");s=r-i;$(window).scrollTop()==0&&o>=40&&o<250&&!u&&$(n).css("top",s);!h&&t>44&&($(n).prepend('<div class="headscroll"><span class="iconLoadding" ><\/span><span class="textcontent">Kéo thả để lấy thêm tin nhắn...<\/span><\/div>'),e=$(n).find(".headscroll").height());t>50&&($(n).find(".iconLoadding").css("transform","rotate(180deg)"),$(n).find(".textcontent").html("Thả để lấy tin nhắn.."))});$(n).bind("touchend",function(){t>0&&(o(),u=!0,s())})}};
//# sourceMappingURL=PageEvents.min.js.map
