(function(){function t(n){return(n=n.toLowerCase(),n==="inbox")?"Thư cá nhân":n==="drafts"?"Thư nháp":n==="junk"?"Thư rác":n==="sent"?"Thư đã gửi":n==="trash"?"Thư đã xóa":n}function i(n){return(n=n.toLowerCase(),n==="inbox")?"inbox":n==="drafts"?"drafts":n==="junk"?"error":n==="sent"?"send":n==="trash"?"delete":"label"}function n(n){try{this.response=eval("("+n+")");this.returnCode=0;Util.isUndefined(this.response)||Util.isUndefined(this.response.Header.Fault)||(this.returnCode=this.getResponseCode(this.response.Header.Fault));Util.isUndefined(this.response.Header.context.session)||(sessionId=this.response.Header.context.session.id,bmail.mailSessionId=sessionId,egov.mobile.setAppInfo());this.type="json"}catch(r){try{this.response=this.xmlProcessor(n);var t=this.response.find("Code").text();t.indexOf("service.AUTH_EXPIRED")!=-1&&Util.pageLogout("exprired");this.type="xml"}catch(i){console.log(i)}}}function r(n){return _.find(egov.setting.allUsers,function(t){return t.username===n})}n.prototype.getResponseName=function(){var n=Object.keys(this.response.Body);return n[0]};n.prototype.jsonProcessor=function(n){return $.parseJSON(n)};n.prototype.xmlProcessor=function(n){var t=$.parseXML(n);return $(t)};n.prototype.getSessionId=function(){return this.sessionId=this.response.Header.context.session.id};n.prototype.getResponseCode=function(n){return n.Detail.Error.Code=="mail.SEND_ABORTED_ADDRESS_FAILURE"?1:0};n.prototype.getResponseReturnCode=function(){return this.returnCode};n.prototype.getFolderList=function(){var f=[],u=this.response,r,h,o,e,n;if(!u||!u.Header||!u.Header.context.refresh||!u.Header.context.refresh.folder||(r=u.Header.context.refresh.folder[0],r==null||r.length===0))return f;for(h=r.folder,o=r.link,_.each(h,function(n){var u;if(n!=undefined&&(u=!0,n.view!==undefined&&(n.view!="message"||n.name=="Chats")&&(u=!1),u!=!1)){var e=n.absFolderPath.indexOf("/")===0?n.absFolderPath.substring(1,n.absFolderPath.length):n.absFolderPath,o=t(e),s={path:e,pathName:o,name:o,icon:i(e),id:parseInt(n.id),visible:u,parentid:r.id,totalUnread:n.uuid,hasChildren:!1,isPublicFolder:!1};f.push(s)}}),e=0;e<o.length;e++)if(n=o[e],n!=undefined){var c=n.folder!=null&&n.folder.length>0,s=n.absFolderPath.indexOf("/")===0?n.absFolderPath.substring(1,n.absFolderPath.length):n.absFolderPath,l={path:s,name:s,pathName:s,id:parseInt(n.id),visible:!0,parentid:r.id,totalUnread:n.uuid,hasChildren:c,isPublicFolder:!0,icon:"label"};f.push(l)}return f};n.prototype.getUserInfo=function(){var r=this.response,n=this.response.Body.GetInfoResponse,t=new AttributesConstant,i;return n.prefs&&n.prefs._attrs&&n.prefs._attrs.zimbraPrefFromDisplay&&(t.displayName=n.prefs._attrs.zimbraPrefFromDisplay),t.email=n.name,i="",n.signatures&&n.signatures.signature&&n.signatures.signature[0]&&n.signatures.signature[0].content[0]&&n.signatures.signature[0].content[0]._content&&(i=n.signatures.signature[0].content[0]._content),t.signature={useSignature:n.attrs._attrs.bmailPrefUseSignature=="TRUE",content:i},t};n.prototype.getContact=function(){for(var r=this.response,t=r.Body.GetContactsResponse,i=[],n=0;n<t.cn.length;n++)i.push({id:t.cn[n].id,name:Util.isUndefined(t.cn[n]._attrs.firstName)?"":t.cn[n]._attrs.firstName,email:Util.isUndefined(t.cn[n]._attrs.email)?"":t.cn[n]._attrs.email});return i};n.prototype.getAutocompleteContact=function(){var n=this.response.Body.AutoCompleteResponse,r=[],t,u,i;if(!Util.isUndefined(n)&&!Util.isUndefined(n.match))for(t=0;t<n.match.length;t++)u=n.match[t].email.substring(n.match[t].email.indexOf("<",0)+1,n.match[t].email.indexOf(">",0)),i=n.match[t].email.replace("<","("),i=i.replace(">",")"),r.push({email:u,ranking:n.match[t].ranking,name:i});return r};n.prototype.getDataList=function(){var u=this.response.Body.SearchResponse,s=[],i;if(!Util.isUndefined(u.m))for(i=0;i<u.m.length;i++){var n=u.m[i],h=n.id.replace(/:/gi,""),f=n.e==null?null:n.e[0].a,e=f==null?"":f.split("@")[0],t=r(e),o=new Date(n.d),c={d:n.d,groupDate:o.timeInWord(),date:o.format("d [thg] M"),detailDate:o.format("HH:mm, dd [thg] MM, yyyy"),location:n.l,conversationId:n.cid,id:n.id,trimId:h,domId:"maillist_"+h,avatar:t==null?egov.setting.noavatar:t.avatar,sender:{fulladdress:f,address:e,name:t==null?e:t.fullname,fullname:t==null?n.a:t.fullname},hasAttach:n.f==undefined?!1:n.f.indexOf("a")!=-1,subject:Util.getSubject(n.su),subcontent:n.fr,unread:n.f&&n.f=="u",isSelected:!1};s.push(c)}return s};n.prototype.getMsgData=function(){return this.response.Body.GetMsgResponse};n.prototype.numberFriendsOnline=0;n.prototype.getFriendsOnline=function(){var n=this.response.Body.IMGetUserOnlineResponse,i={},r=[],u=[],f=[],e=[],t;if(!Util.isUndefined(n.user)){for(t=0;t<n.user.length;t++)Util.updateFriendStatus(n.user[t].addr,"online"),n.user[t].addr.indexOf("@yahoo",0)!=-1?r.push({addr:n.user[t].addr,name:n.user[t].name}):n.user[t].addr.indexOf("@facebook",0)!=-1?u.push({addr:n.user[t].addr,name:n.user[t].name}):n.user[t].addr.indexOf("@gtalk",0)!=-1?f.push({addr:n.user[t].addr,name:n.user[t].name}):e.push({addr:n.user[t].addr,name:n.user[t].name});i.yahoo=r;i.gtalk=f;i.facebook=u;i.bmail=e;this.numberFriendsOnline=n.user.length}return i};n.prototype.isFullHistory=function(){return Util.isUndefined(this.response.Body.IMGetMessageHistoryResponse.list)?!1:!0};n.prototype.getMsgHistories=function(){var t=[],n;if(this.response.Body.IMGetMessageHistoryResponse.chat)for(n=0;n<this.response.Body.IMGetMessageHistoryResponse.chat.length;n++)t.push(this.response.Body.IMGetMessageHistoryResponse.chat[n].message);return t};n.prototype.getLastMessage=function(){var t=[],n;if(this.response.Body.IMGetMessageHistoryResponse.chat&&this.response.Body.IMGetMessageHistoryResponse.chat[0]&&this.response.Body.IMGetMessageHistoryResponse.chat[0].message)for(n=0;n<this.response.Body.IMGetMessageHistoryResponse.chat[0].message.length;n++)t.push(this.response.Body.IMGetMessageHistoryResponse.chat[0].message[n]);return t};n.prototype._getMsgHistories=function(n){for(var t,r={},i=0;i<n.length;i++)t=n[i],t&&(r[t[0].jid]=t[0].body[0]._content);return r};n.prototype.getRawData=function(){return this.response};n.prototype.getRawHeaderData=function(){return this.response.Header};window.SOAPResponse=n})();