(function(n,t,i){"use strict";var e=function(){return this._initialize()},r,o,u,f;e.prototype._initialize=function(){return this._storage={},this.hasSupport=!0,this};e.prototype.get=function(i,r){var e=this,f,u;if(f=this._storage[i],f)try{t.callback(r,JSON.parse(f))}catch(o){u=JSON.parse(n.hashBase64.fromBase64(f));u.value==null||u.value==undefined?t.locache.get(i,function(n){u.value=n;t.locache.update(i,u);t.callback(r,u)}):t.callback(r,u)}else t.callback(r)};e.prototype.insert=function(n,i,r){this._storage[n]=JSON.stringify({key:n,value:i,dateModified:new Date});t.callback(r,i)};e.prototype.update=function(n,i,r){this._storage[n]=JSON.stringify({key:n,value:i,dateModified:new Date});t.callback(r,i)};e.prototype.delete=function(n,i){this._storage[n]&&(this._storage[n]=null);t.callback(i,n)};e.prototype.reset=function(n){this._storage={};t.callback(n)};r=function(){if(i.localstorage)return this._storage,this._initialize()};r.prototype._initialize=function(){return this.hasSupport=this._hasSupport(),this._storage=n.localStorage,this};r.prototype.get=function(i,r){var e=this,f,u;if(f=this._storage[i],f)try{t.callback(r,JSON.parse(f))}catch(o){u=JSON.parse(n.hashBase64.fromBase64(f));u.value==null||u.value==undefined?t.locache.get(i,function(n){u.value=n;t.locache.update(i,u);t.callback(r,u)}):t.callback(r,u)}else t.callback(r)};r.prototype.insert=function(n,i,r){this._storage.setItem(n,JSON.stringify({key:n,value:i,dateModified:new Date}));t.callback(r,i)};r.prototype.update=function(n,i,r){this._storage.setItem(n,JSON.stringify({key:n,value:i,dateModified:new Date}));t.callback(r,i)};r.prototype.delete=function(n,i){this._storage[n]&&this._storage.removeItem(n);t.callback(i,n)};r.prototype.reset=function(n){this._storage.clear();t.callback(n)};r.prototype._hasSupport=function(){if("localStorage"in n&&n.localStorage!==null)try{return n.localStorage.setItem("egov","Bkav Corporation"),n.localStorage.removeItem("egov"),!0}catch(t){return!1}else return!1};o={READ_WRITE:"readwrite",READ_ONLY:"readonly"};u=function(){var n;if(i.indexeddb)return n=this,n._storage,n._storageName="eGovStore",n._tableName="eGovObjectStore",n.version=1,n.hasSupport=!0,n._initialize()};u.prototype._initialize=function(){var t,r,i=this;return t=n.indexedDB.open(i._storageName,i.version),t.onerror=function(n){i.hasSupport=!1;console.log("Database error: "+n.target.errorCode)},t.onupgradeneeded=function(n){r=n.target.result;r.createObjectStore(i._tableName,{keyPath:"key"})},t.onsuccess=function(){i._storage=t.result},this};u.prototype.get=function(n,i){var u,r,f=this;u=f._getObjectStore(o.READ_WRITE);r=u.get(n);r.onerror=function(){console.log("Database error: "+this.error.message)};r.onsuccess=function(){!r.result;t.callback(i,r.result)}};u.prototype.insert=function(n,i,r){var f,u,e=this;f=e._getObjectStore(o.READ_WRITE);u=f.add({key:n,value:i,dateModified:new Date});u.onsuccess=function(){console.log("Add success: "+n);t.callback(r,i)};u.onerror=function(){console.log("Add error! "+this.error.message)}};u.prototype.update=function(n,i,r){var f,u,e=this;f=e._getObjectStore(o.READ_WRITE);u=f.get(n);u.onsuccess=function(){u.result&&(u.result.value=i,u.result.dateModified=new Date,f.put(u.result));console.log("Update success."+n);t.callback(r,i)};u.onerror=function(){console.log("Update error! "+this.error.message)}};u.prototype.delete=function(n,i){var u,r;u=this._getObjectStore(o.READ_WRITE);r=u.delete(n);r.onerror=function(){console.log("delete error! "+this.error.message)};r.onsuccess=function(){console.log("delete success.");t.callback(i)}};u.prototype.reset=function(n){var r,i;r=this._getObjectStore(o.READ_WRITE);i=r.clear();i.onerror=function(){console.log("reset error! "+this.error.message)};i.onsuccess=function(){console.log("Reset success.");t.callback(n)}};u.prototype._getObjectStore=function(t){t=t?t:o.READ_WRITE;var i;if(this._storage==null){console.log("Cache not loaded.");n.location.reload();return}return i=this._storage.transaction([this._tableName],t),i.objectStore(this._tableName)};f=function(n){return this._localStorage=i.localstorage,this._indexeddb=i.indexeddb,this._fileReader=i.filereader,this._hasSupportCache,this._storage,this._cacheSize,this._cacheName=n,this._initialize()};f.prototype._initialize=function(){if(this._hasSupportCache=this._localStorage||this._indexeddb||this._fileReader,!this._hasSupportCache)return new e;if(this._fileReader||this._cacheName!="fileApi"?this._indexeddb||this._cacheName!="indexedDb"||(this._cacheName="storage"):this._cacheName="indexedDb",this._cacheName)switch(this._cacheName){case"storage":return new r;case"indexedDb":return new u;case"fileApi":return;default:console.log("Giá trị khởi tạo không đúng");return}return this._indexeddb?new u:this._localStorage?new r:this._fileReader?void 0:this};f.prototype.get=function(n,i){t.callback(i)};f.prototype.insert=function(){console.log("Locache chưa được khởi tạo")};f.prototype.update=function(){console.log("Locache chưa được khởi tạo")};f.prototype.delete=function(){console.log("Locache chưa được khởi tạo")};f.prototype.reset=function(){console.log("Locache chưa được khởi tạo")};t.CacheManager=f})(this,this.egov=this.egov||{},this.Modernizr);