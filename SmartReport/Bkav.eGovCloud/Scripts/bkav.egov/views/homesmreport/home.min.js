define(function(){"use strict";var n={small:0,medium:1,large:2};return Backbone.View.extend({el:".egov",events:{"click .tab-root":"activeRootTab","click #NewDocument":"showDocType","click #ListSearchIcon":"quickSearchToggle","touchend #NewDocument":"showDocType","touchend #ListSearchIcon":"quickSearchToggle"},initialize:function(){var i=this,t;egov.isMobile||this.initLayout();this.render(function(){if(t=egov.cookie.viewSize(),(t===undefined||isNaN(t))&&(t=n.large),i.changeSize(t),!egov.isMobile){$(window.document).keydown(function(n){var t=n.keyCode;t===116&&window.parent.saveChangeBeforeUnload(n)});$("body").on("click contextmenu",function(n){i.hideAllContext(n);$(window.parent.document.body).click()})}i._disableRightClick();$("body").on("contextmenu",function(){return!1})})},initLayout:function(){var n=function(){egov.views.home.documentLayout&&(egov.views.home.documentLayout.resizeAll(),$(".grid-content").css({height:"auto"}))},t,i,r;$("#center").layout({resizable:!1,closable:!1,north__spacing_open:0,north__size:38,center__paneSelector:"#tabContents",north__paneSelector:"#ulTabs",onresize:function(){n()}});t={resizable:!0,closable:!1,spacing_closed:4,spacing_open:1,north__spacing_open:0,north__size:42,north__paneSelector:".toolbar",center__paneSelector:".document-list",onresize:function(){n()}};$(".document-process-main").layout(t);i={resizable:!0,closable:!0,east__initClosed:!0,south__initClosed:!0,south__spacing_open:5,spacing_closed:0,spacing_open:1,center__paneSelector:".document-process-main",south__paneSelector:".preview-below",east__paneSelector:".preview-right",east__minWidth:300,east__size:383,south__size:250,onresize:function(){n()}};this.layout=$(".document-process").layout(i);r=egov.cookie.getQuickView();this.showPreview(r)},render:function(n){var t=this;egov.isMobile?(this.renderMobile(),egov.callback(n)):this.renderDefault(n)},renderDefault:function(n){var t=this,i=function(){typeof n=="function"&&n()};require(["tabView"],function(n){t.tab=new n;require(["treeView"],function(n){t.tree=new n({subscribe:egov.pubsub.subscribe});i()});t._showDocumentNotificationSelected()})},renderMobile:function(){var n=this;require(["treeView"],function(t){n.tree=new t({subscribe:egov.pubsub.subscribe});$("body").on("tap",function(t){n.hideAllContext(t)})})},hideAllContext:function(n){if(n){var t=$(n.target);this.showingContext&&!t.is(this.showingContext.selector)&&this.showingContext.selector.find(t).length===0&&this.showingContext.hide();t.is(".custom-dropdown")||$(".custom-dropdown").find(t).length!==0||$(".custom-dropdown").hide()}},showDocType:function(){var n=this,t;this.$DoctypeList.append($("<li>").append(egov.helper.loading));egov.dataManager.getCurrentDoctypes({success:function(i){var f,r,u,e;if(n.$DoctypeList.find(".loading").parent().remove(),i===null){n.$DoctypeList.append($("<li>").text(egov.resources.home.docType.message.error.loading));return}for(n.$DoctypeList.find("ul").empty(),f=0;t=i.length,f<t;f++)r=i[f],u=$('<a href="#">'),u.text(r.DocTypeName),u.attr("id",r.DocTypeId).attr("name",r.DocTypeName),u.bind("click",function(){n.tab.addDocument($(this).attr("id"),$(this).attr("name"))}),e=$("<li>").addClass("list-group-item").html(u),r.CategoryBusinessId===egov.enum.businessType.vbden?n.$("#vbDen ul").append(e):r.CategoryBusinessId===egov.enum.businessType.vbdi?n.$("#vbDi ul").append(e):n.$("#hsmc ul").append(e),n.$DoctypeList.find("li > ul").each(function(){$(this).find("li").length===0&&$(this).parent().hide()})}})},getActiveTab:function(){return $("#ulTabs").children("li.tabs-active")},editDynamicForm:function(n){require(["knockout"],function(){require(["views/document/toolbar/editFormDynamic-view"],function(t){new t({frame:n.frame,doctypeId:n.doctypeId,contentId:n.contentId,isMain:n.isMain,contentName:n.contentName})})})},editHtmlForm:function(n){require(["views/document/toolbar/editFormHTML-view"],function(t){new t({frame:n.frame,doctypeId:n.doctypeId,contentId:n.contentId})})},renderDynamicForm:function(n){require(["knockout"],function(){require(["views/document/toolbar/formDynamic-view"],function(t){new t({target:n.target,formJson:n.formJson,isView:n.isView,frame:n.frame})})})},changeSize:function(t){t===n.small?this.$("#colorTheme").removeClass("medium-size large-size"):t===n.medium?(this.$("#colorTheme").addClass("medium-size"),this.$("#colorTheme").removeClass("large-size")):(this.$("#colorTheme").addClass("large-size"),this.$("#colorTheme").removeClass("medium-size"));egov.cookie.viewSize(t)},showPreview:function(n,t){n===undefined||isNaN(n)?n=egov.enum.quickViewType.below:typeof n!="number"&&(n=parseInt(n));egov.setting.user.userSetting.quickView=n;n===egov.enum.quickViewType.hide?(this.layout.close("south"),this.layout.close("east")):n===egov.enum.quickViewType.right?(this.layout.close("south"),this.layout.open("east")):(this.layout.close("east"),this.layout.open("south"));egov.cookie.setQuickView(n);egov.views&&egov.views.home&&egov.views.home.documents&&egov.views.home.documents.reQuickView();t&&egov.request.setUserConfig({data:{QuickView:n}})},_disableRightClick:function(){this.$el.bind("contextMenu",function(n){n.preventDefault();that.hideAllContext(n)})},_showDocumentNotificationSelected:function(){}})});