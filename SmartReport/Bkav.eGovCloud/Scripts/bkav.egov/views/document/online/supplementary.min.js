define(["jquery",egov.template.document.supplementaryOnline],function(n,t){"use strict";var i=egov.resources.document.supplementary;return Backbone.View.extend({$txtRequire:undefined,docId:0,id:"supplementaryOnline",initialize:function(n){var i=this;i.docId=n.docId;i.template=t;i.onlineModel=n.onlineModel;i.document=n.document;i.render()},events:{"blur #addRequire":"addRequire_Blur","keyup #addRequire":"addRequire_KeyUp","click .removeItem":"removeRequire"},render:function(){var t=this,r={title:i.name,width:"800px",draggable:!0,keyboard:!0,height:"auto",buttons:[{id:"btnSendSuplementary",className:"btn-primary",text:i.sendSuplementRequire,click:function(){t.sendSuplementRequire(function(){t.document.tab.close3();t.$el.dialog("destroy")})}},{id:"btnHideSupForm",className:"btn-close",text:egov.resources.common.closeButton,click:function(){t.$el.dialog("destroy")}}]};this.$el.html(n.tmpl(this.template,{}));this.$txtRequire=this.$("#addRequire");this.$el.dialog(r)},addRequire_KeyUp:function(n){n.keyCode==13&&this.addRequire()},addRequire_Blur:function(n){egov.helper.destroyClickEvent(n);this.addRequire()},addRequire:function(){var n=this.$txtRequire.val(),t,i;n.length>0&&(t=this.$("#supItemZone").children(".suppItem").length+1,i="<div class='row suppItem'><div class='col-md-1 sttrow'>"+t+".<\/div><div class='col-md-14 wraptext'>"+n+"<\/div><div class='col-md-1 removeItem'><span class='icon icon-close'><\/span><\/div><\/div>",this.$("#supItemZone").append(i),this.$txtRequire.val(""))},removeRequire:function(t){egov.helper.destroyClickEvent(t);for(var r=n(t.currentTarget).closest(".row"),u=r.index(),i=r.next(".row");i.length>0;)i.find(".sttrow").html(++u+"."),i=i.next(".row");r.remove()},sendSuplementRequire:function(t){var i=this,e=this.$("#supItemZone").children(".suppItem"),u,r,f;if(e.length==0){this.$txtRequire.focus();return}if(u=this.$("#txtComment").val(),u.length==0){this.$("#txtComment").focus();return}if(r=this.$("#expireDate").val(),r.length==0||parseInt(r)<=0){this.$("#expireDate").focus();return}f="";_.each(e,function(t){f+=n(t).find(".wraptext").text()+"-----"});egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing);egov.request.additionalRequirements({data:{docId:i.docId,phone:i.onlineModel.Phone,mail:i.onlineModel.Email,comment:u,expireDate:r,supplement:f,compendium:i.onlineModel.Compendium,doctypeId:i.onlineModel.DoctypeId,docFieldId:i.onlineModel.DocfieldId,docCode:i.onlineModel.DocCode,citizenName:i.onlineModel.FullName,dateRegister:i.onlineModel.DateRecieved,token:i.onlineModel.Token},success:function(n){if(n.error){egov.pubsub.publish(egov.events.status.error,n.error);return}n.success&&(egov.pubsub.publish(egov.events.status.success,n.success),i.tab&&i.tab.close3(),egov.views.home.tree.reloadOnlineRegistration());egov.callback(t)},error:function(){egov.pubsub.publish(egov.events.status.destroy);egov.callback(t)}})}})});