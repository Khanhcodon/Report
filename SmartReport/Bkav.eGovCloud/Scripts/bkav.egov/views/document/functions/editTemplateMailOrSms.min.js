define([egov.template.document.editTemplateMailOrSms],function(n){"use strict";function i(n){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(n)}function r(n){return/^\+?[0-9]{8,14}$/i.test(n)}var t=Backbone.Model.extend({defaults:{templateId:0,templateName:"",isMail:!0,content:"",email:"",phone:"",userNameRecive:""}});return Backbone.View.extend({template:n,initialize:function(){return this},render:function(n){return this.model=new t(n.model),this.$el.html($.tmpl(this.template,this.model.toJSON())),this.model.get("isMail")&&this._enableEditor(),this._renderDialog(),this},_renderDialog:function(){var n=this,t={title:this.model.get("templateName"),width:"750px",draggable:!0,keyboard:!0,height:"auto",buttons:[{id:"sendMailOrSms",text:egov.resources.common.confirmButton,className:"btn-primary",click:function(t){n._send(t)}},{id:"closeSend",text:egov.resources.common.closeButton,className:"btn-close",click:function(){n.$el.dialog("hide")}}]};this.$el.dialog(t)},_send:function(n){var e=this,u=this._getContent(),t,f;if(u!=null&&u!=undefined){if(t={content:u},this.model.get("isMail")){if(t.email=this.$("#email").val(),!i(t.email)){egov.pubsub.publish(egov.events.status.error,egov.resources.document.validateEmail);return}t.subject=this.model.get("templateName");f="sendMailToPeople"}else{if(t.phone=this.$("#phone").val(),!r(t.phone)){egov.pubsub.publish(egov.events.status.error,egov.resources.document.validatePhone);return}f="sendSmsToPeople"}egov.request[f]({data:t,success:function(t){if(egov.callback(n),t.error){egov.pubsub.publish(egov.events.status.error,t.error);return}t.success&&(egov.pubsub.publish(egov.events.status.success,t.success),e.$el.dialog("hide"))},error:function(n){egov.pubsub.publish(egov.events.status.error,n.message)}})}},_disableEditor:function(){this.$("#content").editor("destroy")},_enableEditor:function(){this.$("#content").editor(this.$("#toolbar"))},_getContent:function(){var n="";return this.model.get("isMail")?(this._disableEditor(),n=this.$("#content").html()):n=this.$("#content").val(),escape(n)}})});