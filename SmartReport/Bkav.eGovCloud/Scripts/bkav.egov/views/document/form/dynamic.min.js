define(["knockout","eFormJqueryGlobal","eFormJsutilt","eFormLibdata","eFormControls","eFormLib","eFormDB","eFormTool","eFormResize","eFormBkavEgateApplet","eFormBkavEgate","eFormBkavEgateCompiler","eFormJqueryMaskedinput","eFormJqueryMeioMask"],function(n){"use strict";window.ko=n;var t=function(t,i){eForm.Lib.Init();eForm.efTools.init(null,i,t.formid);fformModel.fromCatalog(t.collections);eForm.efTools.LoadForm(t.schema,t.maxRow);var r=fformModel.fromSchema(eForm.database.GetAll(t.formid),t.formid);$.extend(fformModel,r);n.applyBindings(fformModel,document.getElementById(i));eForm.efTools.ArrowKeys.init()};return Backbone.View.extend({initialize:function(n){this.id=n.id;this.document=n.document;this.isView=!1;var t=this,i=this.document.isCreate==!0;egov.request.getFormContent({data:{contentId:t.id,isCreate:i,doctypeId:t.document.model.get("DocTypeId")},success:function(n){var i=JSON.parse(n),r;$("head").append("<style>.icontainer:hover {background: none !important;}#pnl_root, .pnl_root {background-color: transparent;}<\/style>");t.model=i instanceof Array?i:[i];t.render();return}})},render:function(){var e=this,i,u;for(this.$el.css({"margin-bottom":"80px"}),i=0;i<this.model.length;i++){var n=this.model[i],f=Math.floor(Math.random()*99999+1),r={collections:n.JssCatalog,schema:n.JssForm,formid:n.FormId,maxRow:n.MaxRow};n.originalFormId=n.FormId;n.FormId=f+n.FormId;r.formid=n.FormId.replace(/-/gi,"");u="div"+f+"_"+r.formid;this.$el.addClass("pnl_root sub_pnl_root").append("<div id='"+u+"'><\/div>");t(r,u)}return egov.mobile&&egov.mobile.niceScrollIOS(this.document.$(".autoscroll")),this},loadForm:function(n,i){var u,r,f;this.isView==undefined&&(i=!1);u=this;r={};r.height=600;r.width=1e3;r.title=u.contentName;i||(r.buttons=[{text:"Cập nhật",click:function(){var n=u.update();n!==""&&(egov.views.base.dialog.close(),u.rebindForm(n))}},{text:"Đóng",click:function(){$("#div"+n.formid).remove();egov.views.base.dialog.close()}}]);$("#div"+n.formid).remove();f=$("<div><\/div>").attr("id","div"+n.formid);f.addClass("pnl_root sub_pnl_root").appendTo("body");eForm.Lib.Init();t(n,"div"+n.formid,!1);egov.views.base.dialog.openexist($("#div"+n.formid),r,null,null,!1)},serialize:function(){for(var r=[],i=0;i<this.model.length;i++){var n=this.model[i],t="{",u=n.FormId.replace(/[\-&]+/g,""),f=eForm.database.JsonSerialize3(u);t+='"FormId": "'+n.originalFormId+'",';t+='"GlobalCode":"'+n.GlobalCode+'",';t+='"Description":"'+n.Description+'",';t+='"DocFieldJson":'+f;t+="}";n.Content=t;n.FormTypeId=egov.enum.formType.dynamic;r.push(JSON.stringify(n))}return r}})});