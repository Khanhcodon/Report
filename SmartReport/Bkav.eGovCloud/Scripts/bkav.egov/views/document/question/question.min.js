define([egov.isMobile?egov.template.question.mobileDetail:egov.template.question.detail],function(n){"use strict";return Backbone.View.extend({className:"tabquestion",template:n,isGeneral:!1,document:null,events:{"click #btnAnswer":"answerQuestion","click #btnForward":"forwardQuestion","click #btnReject":"rejectQuestion","click #btnRejectAnswer":"rejectAnswer","click #btnViewDocumentDetail":"openDocument","click .divUserComment .title":"toggleCommentList"},initialize:function(n){this.questionId=n.questionId;this.model=n.question;this.tab=n.tab;this.initData();this.render()},initData:function(){var n,t;this.model.set("IsAdminHolder",parent.egov.isAdmin);this.isGeneral=this.model.get("IsGeneralQuestion");this.document=this.model.get("Document");n=this.model.get("AnswerHolder");n&&this.model.set("isMe",n.UserId==egov.setting.userId);t=this.model.get("UserComments");_.each(t,function(n){n.Date=new Date(n.CommentDate).format("hh:mm dd/MM/yyyy")})},render:function(){var t=this,i;return egov.mobile&&(this.model.set("UserAvatar",egov.mobile.showUserAvatar?String.format(egov.setting.avatarPath,getUsername(this.model.get("Email"))):getUserAvatar()),this.model.set("DateLabel",egov.commonFn.util.getDetailDate(this.model.get("Date"),"hh:mm dd/MM/yyyy"))),t.$el.html($.tmpl(n,t.model.toJSON())),egov.isMobile?(t.$(".mdl-button").materialButton(),i=t.$(".comment-detail"),i.doubleTap(function(){i.toggleClass("collapseView")})):this.enableEditor(),this},answerQuestion:function(){var r=this.$el.find("#txtAnswer"),n="",t,i;if(egov.isMobile?r.val():n=this.$el.find(".editor-iframe").eq(0).contents().find("body").html(),n.trim()==""){r.focus();return}t=this;i=this.questionId;egov.request.answerQuestion({data:{questionId:i,answer:escape(n),isActive:!0},success:function(){egov.isMobile?(egov.mobile.hideDetailPage(),egov.views.home.tree.getNewDocuments(),t.$el.remove()):($("tr#question-"+i).remove(),t.tab.close())},error:function(){}})},rejectQuestion:function(){var n=this;egov.message.prompt(egov.resources.question.reject,egov.resources.question.rejectConfirm,function(t){if(t===""){n.rejectQuestion(egov.resources.question.rejectConfirm);return}egov.pubsub.publish(egov.events.status.processing,egov.resources.common.transfering);var i=n.questionId;egov.request.rejectQuestion({data:{questionId:i,comment:t},success:function(){$("tr#question-"+i).remove();n.tab.close();egov.pubsub.publish(egov.events.status.destroy)},error:function(){}})})},rejectAnswer:function(){var n=this;egov.message.prompt(egov.resources.question.reject,egov.resources.question.rejectConfirm,function(t){if(t===""){n.rejectQuestion(egov.resources.question.rejectConfirm);return}egov.pubsub.publish(egov.events.status.processing,egov.resources.common.transfering);var i=n.questionId;egov.request.rejectAnswer({data:{questionId:i,comment:t},success:function(){$("tr#question-"+i).remove();n.tab.close();egov.pubsub.publish(egov.events.status.destroy)},error:function(){}})})},forwardQuestion:function(){var n=this;require(["questionForward"],function(t){var i=new t({questionId:n.questionId,question:n});n.$el.append(i.$el)})},disableEditor:function(){this.$el.editor("destroy")},enableEditor:function(){var t=this.$el,n=this.$el.find(".alhToolbar"),i=this;this.$el.find(".txtAnswer").editor(n,function(){$(".txtAnswer").focus()});this.model.IsEdited=!0},openDocument:function(){var n=this;this.isGeneral},toggleCommentList:function(){this.$(".divUserComment").toggleClass("open")}})});