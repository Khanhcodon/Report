define(function(){var n=Backbone.View.extend({className:"dropdown-menu",tagName:"ul",initialize:function(){return this.selector=this.model.get("selector"),$("body").append(this.$el),this.$el.css(this.model.get("style")),this.model.get("isShowLoading")&&this.renderLoading(),this.$el.hide(),egov.views.home.showingContext&&egov.views.home.showingContext.hide(),this},render:function(){var n=this;(egov.views.home.showingContext&&egov.views.home.showingContext.hide(),egov.views.home.showingContext=n,n.show(),n.$el.html()==="")&&(n.model.get("isDatePicker")?n.showDatePickerContent(function(t,i){typeof n.model.get("callback")=="function"&&n.model.get("callback")(i,t);n.hide()}):typeof n.model.get("data")=="function"?(n.renderLoading(),n.model.set("data",n.model.get("data")()),n.bind()):n.model.get("data")===null?(egov.pubsub.publish(egov.events.status.processing,egov.resources.common.processing),n.renderLoading(),this.isGettingData=$.get(n.model.get("dataUrl"),n.model.get("param")).done(function(t){n.model.set("data",new egov.models.contextMenuList(t));n.bind()}).always(function(){n.removeLoading();egov.pubsub.publish(egov.events.status.destroy)})):n.bind())},bind:function(){var i,h,r,o,c,s,l;this.show();this.isLoading()&&this.removeLoading();i=this;this.model.get("data")instanceof egov.models.contextMenuList||this.model.set("data",new egov.models.contextMenuList(this.model.get("data")));this.model.get("data").each(function(n){var r=new t({model:n});i.$el.append(r.$el);r.on("callback",function(){i.hide();typeof i.model.get("callback")=="function"&&i.model.get("callback")(n,n.get("text"))})});h=this.model.get("data").length;r=this.model.get("position");r.of==undefined&&(r.of=this.selector);this.$el.position(r);var n=this.$el.outerHeight(),u=$(document).height(),f=r.of.pageX,e=u-f;u<n?this.$el.css({height:"100%",overflow:"auto",top:"0px"}):e<n&&f<n?this.$el.css({overflow:"auto",top:"0px"}):this.$el.position().top<0&&(o=n-f,c=o+"px",this.$el.css({top:0,bottom:"auto"}));this.$el.position().top+n>u&&(s=n-e,l=s+"px",this.$el.css({top:"auto",bottom:0}))},renderLoading:function(){this.$el.addClass("dropdown-loading");var n=this.model.get("position");n.of==undefined&&(n.of=this.selector);this.$el.position(n);this.show()},isLoading:function(){return this.$el.hasClass("dropdown-loading")},removeLoading:function(){this.$el.removeClass("dropdown-loading");this.model.get("height")!==0?this.$el.height(this.model.get("height")):this.$el.height("auto")},show:function(){this.$el.show();egov.views.hasContextmenu=!0},showDatePickerContent:function(n){var i=this,t;this.$el.html($("<div>").datepicker({dateFormat:"dd/mm/yy",onSelect:function(t,r){i.hide();typeof n=="function"&&n(t,r)}}));t=this.model.get("position");t.of==undefined&&(t.of=this.selector);this.$el.position(t)},hide:function(){egov.views.hasContextmenu=!1;this.isGettingData&&this.isGettingData.abort();this.$el.fadeOut("fast")}}),t=Backbone.View.extend({tagName:"li",className:"",selectedClass:"active",separatedClass:"divider",events:{click:"select",contextmenu:"select"},initialize:function(){if(this.model.get("name")==="---")this.renderSeparated();else{this.render();this.model.view=this;this.model.get("className")&&this.$el.addClass(this.model.get("className"));var n=this;this.model.on("change:selected",function(t,i){i&&t.collection.each(function(n){n.get("selected")&&n.get("text")!==t.get("text")&&n.set("selected",!1)});n.$el.siblings().removeClass(n.selectedClass);n.$el.addClass(n.selectedClass)})}},renderSeparated:function(){this.$el.addClass(this.separatedClass)},render:function(){var n={iconClass:this.model.get("iconClass"),text:this.model.get("text")};this.$el.html($.tmpl('<a href="#"><div><span class="icon ${iconClass}"><\/span><span>${text}<\/span><\/div><\/a>',n)).addClass("contextMenuTest")},select:function(n){n&&(this.model.set("selected",!0),this.trigger("callback"),typeof this.model.get("callback")=="function"&&this.model.get("callback")(this.model))}});window.ContextMenu=n});