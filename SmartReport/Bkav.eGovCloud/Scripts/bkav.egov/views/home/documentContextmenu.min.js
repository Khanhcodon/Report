define(function(){"use strict";var n={xemvanban:{className:"xemvanbanClass",name:egov.resources.documents.contextmenu.name.xemvanban,iconClass:"icon-xemvanban",commandName:"xemvanban"},suavanban:{className:"suavanbanClass",name:egov.resources.documents.contextmenu.name.suavanban,iconClass:"icon-pencil3",commandName:"suavanban"},guiykien:{className:"guiykienClass",name:egov.resources.documents.contextmenu.name.guiykien,iconClass:"icon-comment",commandName:"guiykien"},bangiao:{className:"bangiaoClass",name:egov.resources.documents.contextmenu.name.bangiao,iconClass:"icon-forward4",commandName:"bangiao"},thongbao:{className:"thongbaoClass",name:egov.resources.documents.contextmenu.name.thongbao,iconClass:"icon-users3",commandName:"thongbao"},laylaivanban:{className:"laylaivanbanClass",name:egov.resources.documents.contextmenu.name.laylaivanban,iconClass:"icon-back",commandName:"laylaivanban"},xacnhanbangiao:{className:"xacnhanbangiaoClass",name:egov.resources.documents.contextmenu.name.xacnhanbangiao,iconClass:"icon-checkmark",commandName:"xacnhanbangiao"},xacnhanxuly:{className:"xacnhanxulyClass",name:egov.resources.documents.contextmenu.name.xacnhanxuly,iconClass:"icon-checkmark3",commandName:"xacnhanxuly"},yeucaubosung:{className:"yeucaubosungClass",name:egov.resources.documents.contextmenu.name.yeucaubosung,iconClass:"icon-yeucaubosung",commandName:"yeucaubosung"},tiepnhanbosung:{className:"tiepnhanbosungClass",name:egov.resources.documents.contextmenu.name.tiepnhanbosung,iconClass:"icon-tiepnhanbosung",commandName:"tiepnhanbosung"},kyduyet:{className:"kyduyetClass",name:egov.resources.documents.contextmenu.name.kyduyet,iconClass:"icon-signup",commandName:"kyduyet"},ketthucxuly:{className:"ketthucxulyClass",name:egov.resources.documents.contextmenu.name.ketthucxuly,iconClass:"icon-checkmark3",commandName:"ketthucxuly"},huyvanban:{className:"huyvanbanClass",name:egov.resources.documents.contextmenu.name.huyvanban,iconClass:"icon-remove",commandName:"huyvanban"},capnhatketquaxulycuoi:{className:"capnhatketquaxulycuoiClass",name:egov.resources.documents.contextmenu.name.capnhatketquaxulycuoi,iconClass:"icon-capnhatketquaxulycuoi",commandName:"capnhatketquaxulycuoi"},inphieutrinh:{className:"inphieutrinhClass",name:egov.resources.documents.contextmenu.name.inphieutrinh,iconClass:"icon-inphieutrinh",commandName:"inphieutrinh"},intomtat:{className:"intomtatClass",name:egov.resources.documents.contextmenu.name.intomtat,iconClass:"icon-intomtat",commandName:"intomtat"},capnhattiendo:{className:"capnhattiendoClass",name:egov.resources.documents.contextmenu.name.capnhattiendo,iconClass:"icon-capnhattiendo",commandName:"capnhattiendo"},xoakhoiduthao:{className:"xoakhoiduthaoClass",name:egov.resources.documents.contextmenu.name.xoakhoiduthao,iconClass:"icon-remove",commandName:"xoakhoiduthao"},contextheodoi:{className:"contextheodoiClass",name:egov.resources.documents.contextmenu.name.contextheodoi,iconClass:"icon-contextheodoi",commandName:"contextheodoi"},dungxuly:{className:"dungxulyClass",name:egov.resources.documents.contextmenu.name.dungxuly,iconClass:"icon-dungxuly",commandName:"dungxuly"},giahanxuly:{className:"giahanxulyClass",name:egov.resources.documents.contextmenu.name.giahanxuly,iconClass:"icon-giahanxuly",commandName:"giahanxuly"},chitietvanban:{className:"chitietvanbanClass",name:egov.resources.documents.contextmenu.name.chitietvanban,iconClass:"icon-info4",commandName:"chitietvanban"},danhdauchuadoc:{className:"danhdauchuadocClass",name:egov.resources.documents.contextmenu.name.danhdauchuadoc,iconClass:"icon-eye-blocked",commandName:"danhdauchuadoc"},danhdaudadoc:{className:"danhdaudadocClass",name:egov.resources.documents.contextmenu.name.danhdaudadoc,iconClass:"icon-eye",commandName:"danhdaudadoc"},movanban:{className:"movanbanClass",name:egov.resources.documents.contextmenu.name.movanban,iconClass:"icon-eye2",commandName:"movanban"},molaivanban:{className:"molaivanbanClass",name:egov.resources.documents.contextmenu.reOpenDocument.text,iconClass:"icon-eye2",commandName:"molaivanban"},exportToExcell:{className:"movanbanClass",name:egov.resources.documents.contextmenu.name.exportToExcell,iconClass:"icon-file-excel",commandName:"exportToExcell"},exportToWord:{className:"molaivanbanClass",name:egov.resources.documents.contextmenu.name.exportToWord,iconClass:"icon-file-word",commandName:"exportToWord"},removefromstoreprivate:{className:"removefromstoreprivate",name:egov.resources.documents.contextmenu.name.removefromstoreprivate,iconClass:"icon-close",commandName:"removefromstoreprivate"},exportToXML:{className:"exportToXML",name:"Xuất danh sách ra tệp XML",iconClass:"icon-file-xml",commandName:"exportToXML"}},t=Backbone.View.extend({initialize:function(n){return this.parent=n.parent,this},getContextmenu:function(n,t,i,r){this.selectedModels=t;this.clickModel=i;this.docCopyIdSelected=n;this.docCopyIdClick=this.clickModel.model.get("DocumentCopyId");var f=this,u=[],e=this.collection.length;this.collection.each(function(n,t){f._getItemContext(n.get("value"),function(n){$.each(n,function(n,t){u.push(t)});t===e-1&&typeof r=="function"&&r(u)})})},_getItemContext:function(t,r){var u=this,e=this.docCopyIdSelected.length,s=!1,f={},l,o,a;if($.extend(f,{movanban:n.movanban}),$.extend(f,{exportToXML:n.exportToXML}),n.exportToXML.callback=function(){u.parent.exportToXML("XML")},n.movanban.callback=function(){u.parent.openDocuments(u.selectedModels)},f["---"]=null,t&egov.enum.permission.xoavanbankhoihoso&&($.extend(f,{removefromstoreprivate:n.removefromstoreprivate}),n.removefromstoreprivate.callback=function(){egov.message.show("Bạn có đồng ý xóa văn bản/hồ sơ này không?",null,egov.message.messageButtons.YesNo,function(){egov.request.removeStorePrivateDocument({data:{documentCopyIds:u.docCopyIdSelected,storeId:u.parent.node.model.get("id")},success:function(n){n.success?(u.parent.removeDocumentsAndSetSelected(u.selectedModels),egov.pubsub.publish(egov.events.status.success,n.success)):egov.pubsub.publish(egov.events.status.error,n.error)},error:function(){egov.pubsub.publish(egov.events.status.error,"Có lỗi trong quá trình loại bỏ văn bản/hồ sơ.")}})})}),t&egov.enum.permission.suavanban&&$.extend(f,{suavanban:n.suavanban}),t&egov.enum.permission.molaivanban&&($.extend(f,{molaivanban:n.molaivanban}),n.molaivanban.callback=function(){egov.request.reOpenDocument({data:{docIds:JSON.stringify(u.docCopyIdSelected)},success:function(n){if(n.success){egov.pubsub.publish(egov.events.status.success,egov.resources.documents.contextmenu.reOpenDocument.success);return}egov.pubsub.publish(egov.events.status.error,egov.resources.documents.contextmenu.reOpenDocument.error)}})}),s&&e===1&&t&egov.enum.permission.guiykien&&($.extend(f,{guiykien:n.guiykien}),n.guiykien.callback=function(){egov.message.prompt(egov.resources.document.sendComment.dialogTitle,egov.resources.document.sendComment.dialogButton,function(n){if(n==null||n===""){egov.pubsub.publish(egov.events.status.error,egov.resources.document.sendComment.requireMessage);return}egov.pubsub.publish(egov.events.status.processing,egov.resources.common.transfering);egov.request.sendComment({data:{documentCopyId:u.docCopyIdClick,comment:n},success:function(n){n.error?egov.pubsub.publish(egov.events.status.error,n.error):egov.pubsub.publish(egov.events.status.success,egov.resources.document.sendComment.sendSuccess)},error:function(){egov.pubsub.publish(egov.events.status.error,egov.resources.document.sendComment.sendFail)}})},!0)}),t&egov.enum.permission.bangiao&&$.extend(f,{bangiao:n.bangiao}),s&&e===1&&t&egov.enum.permission.thongbao&&($.extend(f,{thongbao:n.thongbao}),n.thongbao.callback=function(){require(["announcementView"],function(n){egov.announcementForm===undefined&&(egov.announcementForm=new n);egov.announcementForm.render(u.docCopyIdClick)})}),e===1&&(t&egov.enum.permission.xacnhanbangiao&&($.extend(f,{xacnhanbangiao:n.xacnhanbangiao}),n.xacnhanbangiao.callback=function(){require(["confirmTransferOrProcess"],function(n){new n({docCopyId:u.docCopyIdClick,isTransfer:!0})})}),t&egov.enum.permission.xacnhanxuly&&($.extend(f,{xacnhanxuly:n.xacnhanxuly}),n.xacnhanxuly.callback=function(){require(["confirmTransferOrProcess"],function(n){new n({docCopyId:u.docCopyIdClick,isTransfer:!1})})})),t&egov.enum.permission.yeucaubosung&&$.extend(f,{yeucaubosung:n.yeucaubosung}),s&&t&egov.enum.permission.tiepnhanbosung&&$.extend(f,{tiepnhanbosung:n.tiepnhanbosung}),t&egov.enum.permission.kyduyet&&($.extend(f,{kyduyet:n.kyduyet}),n.kyduyet.callback=function(){require(["views/document/functions/approver"],function(n){new n({docCopyIds:u.docCopyIdSelected})})}),t&egov.enum.permission.traketqua,e===1&&t&egov.enum.permission.giahanxuly&&($.extend(f,{giahanxuly:n.giahanxuly}),n.giahanxuly.callback=function(){require(["jquery","libs/jquery/jquery.validate.min"],function(){require(["libs/jquery/jquery.validate.unobtrusive.min"],function(){require(["views/document/functions/addtime"],function(n){new n({docCopyId:u.docCopyIdClick})})})})}),s&&t&egov.enum.permission.dungxuly&&$.extend(f,{dungxuly:n.dungxuly}),t&egov.enum.permission.ketthucxuly&&($.extend(f,{ketthucxuly:n.ketthucxuly}),n.ketthucxuly.callback=function(){u.parent.finishs(u.selectedModels,function(){})}),t&egov.enum.permission.huyvanban&&($.extend(f,{huyvanban:n.huyvanban}),n.huyvanban.callback=function(){egov.message.show("Bạn có đồng ý loại bỏ văn bản/hồ sơ này không?",null,egov.message.messageButtons.YesNo,function(){egov.request.removeDocument({data:{documentCopyIds:u.docCopyIdSelected},success:function(n){n.success?(u.parent.removeDocumentsAndSetSelected(u.selectedModels),egov.pubsub.publish(egov.events.status.success,n.success)):egov.pubsub.publish(egov.events.status.error,n.error)},error:function(){egov.pubsub.publish(egov.events.status.error,"Có lỗi trong quá trình loại bỏ văn bản/hồ sơ.")}})})}),s&&t&egov.enum.permission.capnhatketquaxulycuoi&&$.extend(f,{capnhatketquaxulycuoi:n.capnhatketquaxulycuoi}),e===1&&($.extend(f,{chitietvanban:n.chitietvanban}),n.chitietvanban.callback=function(){i(u.clickModel.model.toJSON())}),l=_.filter(this.selectedModels,function(n){return n.get("Status")===2&&(n.get("UserCurrentId")===egov.setting.userId||u.parent.node.model.get("hasUyQuyen"))&&_.contains([1,2,4,32,64],parseInt(n.get("DocumentCopyType")))}),l.length>0){var h=[],c=[],v=u.selectedModels.length;for(o=0;o<v;o++)u.selectedModels[o].get("IsViewed")==!0?h.push(u.selectedModels[o]):c.push(u.selectedModels[o]);c.length>=h.length?($.extend(f,{danhdaudadoc:n.danhdaudadoc}),n.danhdaudadoc.callback=function(){u.parent.setViewed(c,!0)}):($.extend(f,{danhdauchuadoc:n.danhdauchuadoc}),n.danhdauchuadoc.callback=function(){u.parent.setViewed(h,!1)})}if(this.parent&&this.parent.hasExportFile==!0&&($.extend(f,{exportToExcell:n.exportToExcell}),n.exportToExcell.callback=function(){u.parent.exportToExcel("EXCELL")},$.extend(f,{exportToWord:n.exportToWord}),n.exportToWord.callback=function(){u.parent.exportToWord("WORD")}),e>1)r(f);else{if(a=this.clickModel.model.get("UserCurrentId")!==egov.setting.userId&&(this.clickModel.model.get("Status")===2||this.clickModel.model.get("Status")===16),!a){r(f);return}t&egov.enum.permission.laylaivanban&&egov.request.getContextItemForUndoTransfering({data:{documentCopyId:u.docCopyIdClick},success:function(n){var t;if(!n.error){if(n.length==0){r(f);return}for(!$.isEmptyObject(f)&&n.length>0&&$.extend(f,{name:"---"}),t=0;t<n.length;t++){var e=n[t].DateCreated,o={className:"laylaivanbanClass",name:n[t].Name,dateCreated:e,iconClass:"icon-undo2",commandName:"laylaivanban"+t,callback:function(n){var t=f[n.get("key")].dateCreated,i=Globalize.format(t,"F");require(["retrieve"],function(n){new n({docCopyId:u.docCopyIdClick,dateCreated:i,callback:function(){u.clickModel.$el.remove();var n=u.clickModel.model.toJSON();u.parent.removeDocumentsAndSetSelected([u.clickModel.model])}})})}},i={};i["laylaivanban"+t]=o;$.extend(f,i)}r(f)}}})}}}),i=function(n){require(["documentDetail"],function(t){var i=new t({model:n}),r={width:800,height:310,title:egov.resources.documents.title.documentDetail,buttons:[{text:egov.resources.common.closeButton,className:"btn-default",click:function(){i.$el.dialog("destroy")}}],draggable:!0,keyboard:!0};i.$el.dialog(r)})};return t});