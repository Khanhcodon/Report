function getInputAcc(){if(localStorage){var n=localStorage.getItem("inputedAccount");if(n)return JSON.parse(n)}return[]}function saveInputAcc(n){localStorage&&localStorage.setItem("inputedAccount",JSON.stringify(n))}function removeInputAcc(){localStorage&&localStorage.removeItem("inputedAccount")}function loginDesktop(){var n,r;if(typeof window.external.CB_GetLoginInfo=="function"){console.log("Login desktop.");n=window.external.CB_GetLoginInfo();n=n.replace("&user=","");n=n.replace("password=","");var u=n.split("&"),o=u[0],f=u[1];if($("#Username").val(o),!f)return;$("#Password").val(f);$("#RememberMe").prop("checked",!0);var s="https://"+location.host+"?egov=1&client=tool",h=$("#Username").val(),c=$("#Password").val(),l=function(){loginNormal($("form:first").attr("action"),h,c,$("#RememberMe").prop("checked"),s)},t=5,e=$("#expireLoginTime"),i=$("#auto-login-desktop");i.removeClass("hidden");e.text(t);r=window.setInterval(function(){t--;e.text(t);t==0&&(l(),i.addClass("hidden"),clearInterval(r))},1e3);$(document).one("keypress",function(){i.addClass("hidden");clearInterval(r)})}}function validField(){var u=!0,n=$("#Username"),t=n.parents(".field").find(".field-validation-valid"),i=$("#Password"),r=i.parents(".field").find(".field-validation-valid");return n.val()==""?(t.html("<span>Bạn chưa nhập tài khoản.<\/span>"),t.add("class","field-validation-error"),n.addClass("input-validation-error"),u=!1):(t.html(""),t.attr("class","field-validation-valid"),n.addClass("valid")),i.val()==""?(r.html("<span>Bạn chưa nhập mật khẩu.<\/span>"),r.attr("class","field-validation-error"),i.addClass("input-validation-error"),u=!1):(r.html(""),r.attr("class","field-validation-valid"),i.addClass("valid")),$("input.input-validation-error").first().focus(),u}function showLoading(n){n?$("#loginProcess").show():$("#loginProcess").hide()}function login(){var r;if(!validField())return!1;$("#error").empty();showLoading(!0);var n=$("#Username").val(),t=$("#Password").val(),i=inputedAccount.filter(function(t){return t.account==n})[0];i?i.lastDate=new Date:inputedAccount.push({account:n,lastDate:new Date});r=function(i){var u,r,f;if(i!=undefined&&i){if(!i.Success||i.Token==""){showLoading(!1);u=!1;maximumUserInput>0&&(inputedAccount=inputedAccount.filter(function(n){return(new Date-new Date(n.lastDate))/1e3<30}),saveInputAcc(inputedAccount),u=inputedAccount.length>maximumUserInput);u?($("#error").hide(),$("#captchaWrap").show(),$("#captcha a").click()):$("#error").text(i.error||i.Message).show();return}if(i.Success){loginExteralMail(n,t);return}r=!1;$(".login").find("input[type='checkbox']").length&&(r=$("#RememberMe").attr("checked")=="checked");f=i.Token;$.get(ssoDomain+"/User/LoginToken?callback=?",{token:f,domain:"",remember:r},function(i){var u=i.LoginTokenResult.Status=="SUCCESS";if(!u){showLoading(!1);$("#error").text("Đăng nhập không thành công!").show();return}setDesktopInfo(n,t,r);loginExteralMail(n,t)},"jsonp").fail(function(n){console.log("Login token");console.log(n)})}};$.ajaxSetup({async:!1});$.post("/Account/LoginSso",{username:n,password:t,UseCaptcha:$("#captchaWrap").is(":visible"),CaptchaDeText:$("#CaptchaDeText").val(),CaptchaInputText:$("#CaptchaInputText").val()},r).fail(function(n){console.log("Login normal");console.log(n)});$.ajaxSetup({async:!0})}function getParameterByName(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"/":decodeURIComponent(t[1].replace(/\+/g," "))}function loginExteralMail(n,t){loginOtherSystemWithForm.enable?loginExternalSystem(n,t,function(){reloadPage()}):reloadPage()}function reloadPage(){window.document.location.href=returnUrl}function setDesktopInfo(n,t,i){var u;if(typeof window.external.CB_LoginSuccess=="function"){var e=i?t:"",r=[],f={user:n,password:i?t:"",remember:"true"};r.push(f);u=JSON.stringify(r);window.external.CB_LoginSuccess(u)}}var maximumUserInput=4,inputedAccount=getInputAcc();(function(){try{loginDesktop()}catch(n){}$("#Username").focus();$("#login").click(function(){return login(),!1});$("form").submit(function(){return!1})})();