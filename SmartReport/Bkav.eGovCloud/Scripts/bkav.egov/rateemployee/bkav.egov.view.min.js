function clearModal(){$("#setparentrate").find("option[value='0']").prop("selected",!1);$("#namecriteria").find("textarea").val("");$("#pointcriteria").find("input").val("");$("#descriptioncriteria").find("textarea").val("");$("#departmentmodalname").prop("disabled",!1);$("#searchbydepartmentmodal").show()}function getDataCriteria(n){var r,i,t,f,u,e,o;for($("#tbody_rateemployee").html(""),r=n,t=0;t<r.length;t++)r[t].ParentId===undefined&&(r[t].ParentId=null);for(i={data:r},t=0;t<i.data.length;t++)if(i.data[t].ParentId==null)for(f=new RateEmployee(i.data[t]),listcriterias.add(f),u=0;u<i.data.length;u++)i.data[u].ParentId==i.data[t].RateEmployeeId&&(e=new RateEmployee(i.data[u]),listcriterias.add(e));o=$("#InfoParentRateTemplate").tmpl(i);$("#setparentrate").html(o)}var departmentid={},departmentiddefault={},CriteriaView=Backbone.View.extend({tagName:"tr",events:{"click .addcriteria":"createRow","click .editcriteria":"editRow","click .deletecriteria":"removeRow","click .detail":"showdialog","click .togglerow":"togglechildren"},initialize:function(){this.listenTo(this.model,"destroy",this.remove);this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html($("#RateTemplate").tmpl(this.model.toJSON())),this},createRow:function(){$(".modal-title > b").text("Thêm mới tiêu chí");clearModal();$("#namecriteria").find("input[name=RateEmployeeId]").val("");$(".selectparent").prop("disabled",!1);$("#choosedepartment").find("#selectdepartmentrate").prop("disabled","");$("#setparentrate").find("option[value="+this.model.get("RateEmployeeId")+"]").prop("selected",!0);$("#RateEmployeeModal").modal("show");$(".modal-backdrop.fade.in").removeClass("modal-backdrop");$("#choosedepartmentloadmodal").jstree("deselect_all");$("#choosedepartmentloadmodal").jstree("select_node",this.model.get("DepartmentId"))},editRow:function(){$(".modal-title > b").text("Sửa tiêu chí");clearModal();$(".selectparent").prop("disabled",!0);$("#departmentmodalname").val(this.model.get("DepartmentPath"));$("#departmentmodalname").prop("disabled",!0);$("#searchbydepartmentmodal").parent().parent().removeClass("open");$("#searchbydepartmentmodal").hide();$("#namecriteria").find("input[name=RateEmployeeId]").val(this.model.get("RateEmployeeId"));this.model.get("ParentId")!=null?$("#setparentrate").find("option[value="+this.model.get("ParentId")+"]").prop("selected",!0):$("#setparentrate").find("option[value=0]").prop("selected",!0);departmentid={id:this.model.get("DepartmentId"),name:this.model.get("DepartmentName")};$("#namecriteria").find("textarea").val(this.model.get("Name"));$("#pointcriteria").find("input").val(this.model.get("Point"));$("#descriptioncriteria").find("textarea").val(this.model.get("Description"));$("#RateEmployeeModal").modal("show");$(".modal-backdrop.fade.in").removeClass("modal-backdrop")},removeRow:function(){var n=this.model;bootbox.confirm("Bạn có muốn xoá tiêu chí này?",function(t){if(t==!0)if(n.get("ParentId")==null){var i=listcriterias.remaining(n.get("RateEmployeeId")).length;i>0?bootbox.alert("bạn cần xóa các thanh phần con trước",function(){}):DeleteCriterias(Number(n.get("RateEmployeeId")),function(t){t!="Delete"?bootbox.alert(t,function(){}):n.destroy()})}else DeleteCriterias(Number(n.get("RateEmployeeId")),function(t){t!="Delete"?bootbox.alert(t,function(){}):n.destroy()})})},showdialog:function(){$("#dialog > p").text(this.model.get("Description"));$("#dialog").dialog({open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'><\/span>")},autoOpen:!1,show:{},hide:{}});$("#dialog").dialog("open")},togglechildren:function(){var t=this.model.get("RateEmployeeId"),n=this.$(".togglerow");n.hasClass("icon-arrow-down7")?(n.removeClass("icon-arrow-down7"),n.addClass(" icon-arrow-right7")):(n.addClass("icon-arrow-down7"),n.removeClass(" icon-arrow-right7"));$("#tbody_rateemployee>tr").each(function(){var n=$(this);$(this).find("input[name='ParentId']").val()==t&&n.toggle()})}});