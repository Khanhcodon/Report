define(["qtip",],function(n,t){"use strict";if(typeof n!="function")throw"Trang chưa có Jquery";var w=".shortkey",b="#SearchQuery",et="#AlertNotifier",k=".tab-focus",a="tab-focus",f=[{object:"#newDocuments",children:["button"],isDropdownList:!0},{object:"#menu-document",children:["li"],isLevel:!0,isVerticalAlign:!0,isClickWhenFocus:!0},{object:"#ulTabs",children:["li"],isClickWhenFocus:!0},{object:"ul.toolbar",children:["li"],isMultiTab:!0,isLevel:!0},{object:"table.table-main",children:["th"],isTableHeader:!0},{object:".grid-content",children:["tr"],isVerticalAlign:!0,isDocuments:!0,isClickWhenFocus:!0}],r=0,i,u=0,s,h=!1,ot=t.View.extend({el:window,events:{keyup:"keyUp"},clickEvent:function(t){for(var s,o,h=this.$(t.target),u=0;u<f.length;u++)for(s=n(f[u].object).find(f[u].children[0]),o=0;o<s.length;o++)s.eq(o).find(t.target).length>0&&(r=u,i=e(u,0).eq(o))},keyUp:function(t){var f,u;if(t.ctrlKey){ct();switch(t.keyCode){case 49:t.preventDefault();lt();break;case 51:t.preventDefault();at();break;case 52:t.preventDefault();vt();break;case 66:t.preventDefault();f=!1;d(f);break;case 70:t.preventDefault();ht();break;case 71:t.preventDefault();yt();break;case 72:t.preventDefault();f=!0;d(f);break;case 73:t.preventDefault();pt();break;case 79:t.preventDefault();wt();break;case 82:u=egov.home.tab.getActiveTab().index();u===0&&(t.preventDefault(),bt())}}if(u=egov.home.tab.getActiveTab().index(),u===0||n(":focus").length===0)switch(t.keyCode){case 9:t.preventDefault();u!==0&&r===3?(i.parents(".tab-content").find("input[type=text],textarea,select,input[type=checkbox]").eq(0).focus(),i.blur()):l();break;case 13:t.preventDefault();st();break;case 27:t.preventDefault();gt(t);break;case 36:kt();break;case 37:ri();break;case 38:ui();break;case 39:ii();break;case 40:fi();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(n("*:focus").length>0)break;dt(t.keyCode-49)}},focusFirstTab:function(){i=e(0,0).first();r=0;u=0;o()}}),st=function(){i.length==1&&i.click()},ht=function(){parent.window.postMessage("focusToMainSearch","*")},v=!1,ei=function(){v&&(n(w).qtip("hide"),v=!1)},ct=function(){v||(v=!0,n(w).qtip("show"))},lt=function(){n(et).click()},at=function(){n("#child0 li:first > a").click()},vt=function(){n("#tblListDocument tbody tr:first").click()},oi=function(n){n.preventDefault()},yt=function(){n(b).show();n(b).focus()},d=function(t){t?n(".btn-create-hs").click():n(".btn-create-vb").click()},pt=function(){},wt=function(){parent.window.postMessage("openOptionPanel","*")},bt=function(){egov.home.tab.addReport()},kt=function(){egov.home.tab.activeTab(0)},dt=function(n){egov.home.tab.activeTab(n)},gt=function(n){var t=f[r];t.isDocuments?i.dblclick():n.target!==document.body?n.target.click():(i.click(),i.children("a:first").click(),i.find("input[type=checkbox]").click())},o=function(){i.is("input")&&i.focus();n(k).removeClass(a);i.addClass(a);f[r].isClickWhenFocus&&i.click()},c=function(){h=!1;i&&i.qtip("hide")},o=function(){i.is("input")&&i.focus();n(k).removeClass(a);i.addClass(a);f[r].isClickWhenFocus&&i.click()},y=function(n){var i=f[r].children[n],t;return i==undefined?{object:undefined}:(t={},typeof i=="object"?t=i:(t.object=i,t.isTip=!1),t)},ni=function(){var n=i.children("a").children("span.menu-icon");n.hasClass("closed")?n.click():n.parent("a").hasClass("collapsed")&&n.click()},ti=function(){var n=i.children("a").children("span.menu-icon");n.hasClass("open")?n.click():n.parent("a").hasClass("collapsed")||n.hasClass("closed")||n.click()},st=function(){i.length==1&&i.click()},g=function(){var h,l,t,c,s;if(r==f.length-1?r=0:r++,h=f[r],h.isMultiTab?(l=i.find("a").attr("href"),i=n(l).find("ul.toolbar").children("li").first()):(u=0,i=e(r,u).first()),t=i.parents("div#documentList").children("[data-key=tblListDocument]"),t.length>0){for(c=0,s=0;s<t.length;s++)if(t.eq(s).css("display")=="none"&&(c=h.children[0]=="tr"?c+t.eq(s).find(h.children[0]).length-1:c+t.eq(s).find(h.children[0]).length),t.eq(s).css("display")!="none")break;i=e(r,u).eq(c)}o()},p=function(){var h,s,n,t;for(r!=0&&r--,h=f[r],u=f[r].children.length-1,i=e(r,u).last(),s=i.parents("div").children("[data-key=tblListDocument]"),n=0,t=0;t<s.length;t++)s.eq(t).css("display")=="none"&&(n=h.children[0]=="tr"?n+s.eq(t).find(h.children[0]).length-1:n+s.eq(t).find(h.children[0]).length);n!==0&&(i=e(r,u).eq(n));o()},e=function(t,i){return n(f[t].object+" "+y(i).object)},nt=function(){it(s);o()},tt=function(){rt(s);o()},it=function(t){for(var o,s,e,u=0;u<t.length;u++)if(n(t[u]).is(i)){for(u==t.length-1?i=n(t[0]):(o=f[r],i=o.isVerticalAlign&&i.children("ul").length>0&&!i.children("ul").hasClass("in")&&!i.children("ul").hasClass("open")?n(t[u+i.children("ul").find("li").length+1]):!o.isVerticalAlign&&i.children("ul").length>0&&!i.children("ul").hasClass("open")&&!i.children("ul").hasClass("in")?n(t[u+i.children("ul").find("li").length+1]):n(t[u+1])),i.length===0&&l(),s=i.parents(),e=s.length-1;e>=0;e--)if(s.eq(e).css("display")=="none"){l();break}return}i=t.first()},rt=function(t){for(var h,u,e,o=0;o<t.length;o++)if(n(t[o]).is(i)){if(o!=0)if(h=f[r],h.isLevel){var u=n(t[o-1]).parents("ul"),c=u.eq(u.length),s=0;if(u.length>0)for(e=u.length-2;e>=0;e--)if(!u.eq(e).hasClass("in")){s=s+u.eq(e).find("li").length;break}i=n(t[o-1-s])}else i=n(t[o-1]);for(u=i.parents(),e=u.length-1;e>=0;e--)if(u.eq(e).css("display")=="none"){p();break}return}i=t.last()},l=function(){i==undefined?(i=e(0,0).first(),r=0,u=0,o()):(c(),g())},ii=function(){c();var n=f[r];n.isVerticalAlign?n.isLevel&&ni():ut()},ri=function(){c();var n=f[r];n.isVerticalAlign?n.isLevel&&ti():ft()},ui=function(){var l=f[r],e=y(u),t,o;if(l.isVerticalAlign){ft();return}if(e.isTip){if(h){tt();return}if(t=i.attr("data-hasqtip"),t!=undefined){o=n("#qtip-"+t);o.is(":visible")&&!h?i.qtip("hide"):(s!=undefined&&(s=n(e.tipElement)),tt());return}}c();p()},fi=function(){var a=f[r],e=y(u),t,o;if(a.isVerticalAlign){ut();return}if(e.isTip){if(h){nt();return}if(t=i.attr("data-hasqtip"),t!=undefined){o=n("#qtip-"+t);o.is(":visible")?(s=n(e.tipElement),h=!0,nt()):i.qtip("show");return}}i!==undefined?(c(),g()):l()},ut=function(){if(r!=undefined&&u!=undefined){var n=e(r,u);i&&(i.is(n.last())?u!==f[r].children.length-1?(u++,i=e(r,u).first()):l():it(n),o())}},ft=function(){if(r!=undefined&&u!=undefined){var n=e(r,u);i&&(i.is(n.first())?u!==0?(u--,i=e(r,u).last()):p():rt(n),o())}};return ot});