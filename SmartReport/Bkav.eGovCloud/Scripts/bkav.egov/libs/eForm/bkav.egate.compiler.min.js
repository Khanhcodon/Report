(function(n,t,i,r,u,f){var ut=console&&console.log?console.log:window.alert,v="";t=t||{};var o={string:"string",text:"Text",object:"object",set:"set",boolean:"boolean",integer:"integer",signedinteger:"signedinteger",decimal:"decimal",dateTime:"datetime",timeSpan:"timespan",uri:"uri",email:"email",cmtnd:"cmtnd",IDCard:"idcard",mobile:"mobile",year:"year",monthyear:"monthyear",custom:"custom"},h={required:"p13",maxLength:"p22",arrange:"p23",validateCsharp:"p27",jsExpression:"p28",regex:"p29",nonNegative:"p30"},k=["false",""," ","no","off","n","undefined","null","nope","negative"],c={integer:"n0",decimal:"n2",datetime:"dd/MM/yyyy"},s={string:"",integer:0,decimal:"0,00",datetime:i.global.format(new Date,c.datetime,i.global.culture),boolean:!1},l={patterns:{quarter:new RegExp("^Q[1-4]/\\d{4}$"),period:new RegExp("^K[1-2]/\\d{4}$"),month:new RegExp("^([1-9]|0[1-9]|1[0-2])/(19\\d{2}|2[0-3]\\d{2})$"),year:new RegExp("^(19\\d{2}|2[0-3]\\d{2})$"),cmtnd:new RegExp("^\\d{9}$"),mobile:new RegExp("^0(9[0-9]{8}|1[0-9]{9})$")},parseEmail:function(n){if(!n)return"";if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(n))throw new Error("Địa chỉ email không đúng");return n},parseCmtnd:function(n){if(!n)return"";if(!this.patterns.cmtnd.test(n))throw new Error("Định dạng CMTND không hợp lệ");return n},parseYear:function(n){if(!n)return"";if(!this.patterns.year.test(n))throw new Error("Định dạng Năm không hợp lệ");var t=i.global.parseInt(n.toString(),10,i.global.culture);if(t<1900||t>3e3)throw new Error("Năm không được nhỏ hơn 1900 hoặc lớn hơn 2300");return t.toString()},parseMonthYear:function(n){if(!n)return"";if(!this.patterns.month.test(n))throw new Error("Tháng/Năm nhập không đúng");var t=parseInt(n.split("/")[0],10),i=parseInt(n.split("/")[1],10);if(i<1900||i>3e3)throw new Error("Năm không được nhỏ hơn 1900 hoặc lớn hơn 2300");if(t<1||t>12)throw new Error("Tháng không được nhỏ hơn 1 hoặc lớn hơn 12");return t+"/"+i},parseMobile:function(n){if(!n)return"";if(!this.patterns.mobile.test(n))throw new Error("Số Di động nhập không đúng");return n}},y=function(n,t){var f={},r=[],i,u;if(n)for(i=0,u=n.length;i<u;i++)p(n[i],t,f,r);return r},p=function(n,t,i,r){var f,u,e;if(!i.hasOwnProperty(n.getKey())||i[n.getKey()]!==!0){for(i[n.getKey()]=!0,f=t(n),u=0,e=f.length;u<e;u++)p(f[u],t,i,r);r.push(n)}},d=function(n){var r={},t,u,i;if(n)for(t=0,u=n.length;t<u;t++)i=n[t],r[i.key]=i;return r},a=function(n,i){var r,u,e;if(i.hasOwnProperty(n))u=i[n];else if(t.hasOwnProperty(n))u=t[n];else return f;return ko.isObservable(u)?(r=u(),(r===null||r===f)&&(r=""),e=u.fParse,e&&typeof e=="function"&&(r=e(r))):r=u,r},e={object:function(n){var t;if(typeof n=="string")try{t=r.parse(n)}catch(i){t=n}else t=n;return t},boolean:function(n){var t=!0;return(n===f||n===null||n.toString().toLowerCase()in k)&&(t=!1),t},string:function(n){return n?n.toString():s.string},integer:function(n){var t=n?i.global.parseInt(n.toString(),10,i.global.culture):s.integer;if(isNaN(t))throw new Error("Dữ liệu không phải số");return t},signedinteger:function(n){var t=n?i.global.parseInt(n.toString(),10,i.global.culture):s.integer;if(isNaN(t))throw new Error("Dữ liệu không phải số");if(t<0)throw new Error("Dữ liệu không phải là số > 0");return t},decimal:function(n){var t=n?i.global.parseFloat(n.toString(),10,i.global.culture):s.decimal;if(t!=s.decimal&&isNaN(t))throw new Error("Dữ liệu không phải số");return t},dateTime:function(n,t){var r=n?i.global.parseDate(n.toString(),t||c.datetime,i.global.culture):"";if(r==null)throw new Error("Dữ liệu không phải ngày/tháng/năm");return r},monthyear:function(n){return l.parseMonthYear(n)},year:function(n){return l.parseYear(n)},mobile:function(n){return l.parseMobile(n)},cmtnd:function(n){return l.parseCmtnd(n)},email:function(n){return l.parseEmail(n)}},g=function(n){var t,r=n.getControlMask(),i;switch(r.toLowerCase()){case o.string:case o.text:t=e.string;break;case o.integer:t=e.integer;break;case o.signedinteger:t=e.signedinteger;break;case o.decimal:t=e.decimal;break;case o.dateTime:t=e.dateTime;break;case o.email:t=e.email;break;case o.cmtnd:t=e.cmtnd;break;case o.IDCard:t=e.cmtnd;break;case o.mobile:t=e.mobile;break;case o.monthyear:t=e.monthyear;break;case o.year:t=e.year;break;case o.object:t=e.object;break;case o.custom:i=n.customTypeName;t=i?e[i.toLowerCase()]:e.string;break;default:t=e.object}return t},nt={decimal:function(n){return n?i.global.format(n||s.decimal,c.decimal,i.global.culture):""},integer:function(n){return n?i.global.format(n||s.integer,c.integer,i.global.culture):""},signedinteger:function(n){return n?i.global.format(n||s.integer,c.integer,i.global.culture):""},datetime:function(n){return n?i.global.format(n,c.datetime,i.global.culture):null}},tt=function(n,i){for(var b,s,c,l,a,k,v=[],y=n.getProperties(),o=0,d=y.length;o<d;o++){var e="",u="",p="",f=null,r=y[o];switch(r.getId()){case h.required:r.getValue().toLowerCase()=="true"&&(f=function(n){return n?!0:!1},u="Dữ liệu bắt buộc nhập");break;case h.nonNegative:r.getValue().toLowerCase()=="true"&&(f=function(n){return n>=0?!0:!1},u="Dữ liệu là Số không âm");break;case h.regex:!r.getValue()||(e=r.getValue().split("@")[0],u=r.getValue().split("@")[1],b=new RegExp(e),f=function(n){return b.test(n)});break;case h.maxLength:s=parseInt(e)||-1;!r.getValue()||s==-1||(e=r.getValue(),u="Không nhập quá "+e+" kí tự.",f=function(n){return(n+"").length<=s});break;case h.arrange:!r.getValue()||r.getValue().split("-").length!=2||(c=r.getValue().split("-")[0],l=r.getValue().split("-")[1],f=function(n){return n>=c&&n<=l},u="Dữ liệu phải nằm trong khoảng: ["+c+","+l+"]");break;case h.jsExpression:!r.getValue()||(e=r.getValue().split("@")[0].replace(/\s+/g,""),p=r.getValue().split("@")[1].replace(/\s+/g,"").split(","),u=r.getValue().split("@")[2],a=e,a&&(k=new Function("with(this){ return "+a+" }"),f=function(n){var r=w(p,i,t,n);return k.call(r)}))}f&&(u||(u="Dữ liệu không hợp lệ"),v.push({validate:f,message:u,isWarning:!1}))}return v},ft=function(n,i){var f=!1,r,e,u;if(n&&n.length)for(r=0,e=n.length;r<e;r++)if(u=n[r],i.hasOwnProperty(u))continue;else if(t.hasOwnProperty(u))continue;else{f=!0;break}return f},it=function(n){var t,i=n.getExpressionOfValue(),r=n.getDependenciesOfValue();if(!i)return!1;try{t=new Function("with(this){ return "+i+" }")}catch(u){return!1}return t},w=function(n,t,i,r){var u=new Date,f,e,s,o;if(u.Year=u.getFullYear(),u.Month=u.getMonth()+1,u.Day=u.getDate(),u.ToString=u.toString,f={form:i,container:t,now:u,value:r},n&&n.length)for(e=0,s=n.length;e<s;e++){o=n[e];try{f[o]=a(o,t)}catch(h){f[o]=null}}return f},b=function(n,i){var u,e;n.key=n.getKey();n.value=n.getControlValue();n.parser=g(n);n.formatter=nt[n.getControlMask().toLowerCase()];n.evaluator=it(n,i);n.evaluator?u=ko.dependentObservable(function(){var u=n.getDependenciesOfValue(),f=w(u,i,t),r=n.evaluator.call(f);return n.formatter&&(r=n.formatter(r)),n.setControlValue(r),r},t):(e=n.value,n.formatter&&(e=n.formatter(e)),u=ko.observable(e));n.parser&&(u.fParse=n.parser);i[n.key]=u;n.validators=tt(n,i);n.getTypeId()=="c10"&&(i[n.key+"CatalogSelected"]=ko.dependentObservable(function(){var r=i[n.key](),u="catalog"+n.key;return ko.utils.arrayFirst(t[u],function(n){return n.catalogid===r})},t));i[n.key+"Warning"]=ko.observable("");i[n.key+"Error"]=ko.dependentObservable(function(){var t,u=0,r,e;try{if(r=a(n.key,i),(r===null||r===f)&&(t="Sai định dạng dữ liệu"),r=="")return""}catch(o){t=o}while(!t&&u<n.validators.length){e=n.validators[u];try{if(!e.validate(r,n)){t=e.message;break}}catch(o){t=o}u++}return t},t);i[n.key+"DismissError"]=function(){};i[n.key+"DismissWarning"]=function(){i[n.key+"Warning"]("")};i[n.key+"Validate"]=function(){var u,t;try{u=a(n.key,i)}catch(e){u=""}(u===null||u===f)&&(u="");n.formatter&&(u=n.formatter(u));n.setControlValue(u);try{t=a(n.key+"CatalogSelected",i)}catch(e){t=""}(t===null||t===f)&&(t="");typeof t=="object"&&(t=r.stringify(t),t=t.replace(/"/g,'\\"'));n.setCatalogSelected(t)}},rt=function(t){for(var e,o=function(n,t,r){var e=this,u,h,f,l;this.index=ko.dependentObservable(function(){return t?t.indexOf(this)+1:-1},this);this.isLast=ko.dependentObservable(function(){var n=t?t().length:0;return e.index()==n},this);this.rowClass=ko.dependentObservable(function(){return e.isLast()?"frow last":"frow"},this);var o=t.colDict=d(n),c=function(n){var u=[],i,t,f,r;if(n.dependencies&&n.dependencies.length)for(i=n.dependencies,t=0,f=i.length;t<f;t++)if(r=i[t],o.hasOwnProperty(r))u.push(o[r]);else return[];return u},s=y(n,c);for(u=0,h=s.length;u<h;u++)f=s[u],l=f.key,b(f,this,r);this.remove=function(){t&&t.remove(this);i(document).triggerHandler("rowRemoved",[t,this,t.indexOf(this)])}.bind(this)},c=function(t,r,u){return function(f){var e=new o(t.cols,r,u);f&&n.utils.copyDataToObservable(f,e);i(document).triggerHandler("rowLoaded",[t.key,e]);r.push(e);i(document).triggerHandler("rowAdded",[t.key,e,r.indexOf(e)])}},s=function(n){var r=[],h=n.getDependenciesOfValue(),c=n.getDependenciesOfValidate(),f,t,o,s,e;if(n.dependencies=i.merge(h,c),n&&n.dependencies&&n.dependencies.length)for(f=n.dependencies,t=0,o=f.length;t<o;t++)if(s=f[t],e=u.database.FindControlsByProp("p15",s,v),e.length==1)r.push(e[0]);else{r=[];break}return r},f=y(t,s),r=0,h=f.length;r<h;r++)e=f[r],b(e,this);this.detach=function(){n.utils.detachForm(this,t.key);i(document).triggerHandler("partUnloaded",[t.key,this])}.bind(this)};t.fromSchema=function(n,t){return v=t,new rt(n)};t.fromCatalog=function(n){for(var e,i,r,o,s,h,c=function(n){this.catalogid=n.catalogid;this.catalogname=n.catalogname;this.globalcode=n.globalcode}.bind(this),f=0,l=n.length;f<l;f++){for(e=[],i=n[f],r=0,o=i.lstItem.length;r<o;r++)s=i.lstItem[r],h=new c(s),e.push(h);t["catalog"+u.efTools._formId_+"_"+i.Id+"c10"]=e}}})(window.f=window.f||{},window.fformModel=window.fformModel||{},jQuery,JSON,eForm);
//# sourceMappingURL=bkav.egate.compiler.min.js.map
