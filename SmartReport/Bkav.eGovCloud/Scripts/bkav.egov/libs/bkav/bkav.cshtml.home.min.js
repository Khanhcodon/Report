(function(egov,$,_,n,t,i){var ui;if(typeof $=="undefined")throw"Thư viện này sử dụng jQuery, hãy tải thư viện jQuery trước khi sử dụng";if(typeof _=="undefined")throw"Thư viện này sử dụng Underscore, hãy tải thư viện Underscore trước khi sử dụng";var b={},bi=0,tu="tabContentPanel_Create_",vt="tabContentPanel_Edit_",ki="/Document/Create",di="/Document/Edit/",iu="/ReportViewer/Index",ru="/Print/ExpressPrint",uu="/Home/Setting",gi,fi,o,k=[],ei="RecentTabs",tt={};userId;var idTableDocuments="#tblListDocument",kt,nr,oi,r={},dt={},tr=[],c,d,ct,rowIndex=0,gt=!1,si=/\d{4}-[0-1]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-6]\d$/,rowIdSelected=[],et,g=[],yt=!1,pt=!1,wt=!1,hi="",f,ot="eOfficePlus",s="",p="",l=0,a=0,e=0,u=[],lt=250,v,ir,rr,ur,fr,ci,li,er,ai={"2":".jpg","13":".png","25":".gif","18":".tif","0":".bmp",PDF:".pdf",DOC:".doc"},st={home:"home.png",report:"report.png",option:"settings.png",newDocument:"new-document.png",document:"document.png",search:"search.png",print:"print.png"},vi={cursorborderradius:0,cursorcolor:"#555",cursorborder:"none"},it=function(){v=$.Jcrop("#imageScan",{onChange:or,onSelect:or,bgColor:"black",bgOpacity:.9})},or=function(n){ir=n.x;rr=n.y;ur=n.x2;fr=n.y2;ci=n.w;li=n.h},ni=function(){var n=u[e],t,i;s=n.url;p=n.ext;l=n.width;a=n.height;v.destroy();t=lt/n.width*n.height;i=$('<img width="'+lt+'px" height="'+t+'px" id="imageScan" src="data:image/'+n.ext+";base64,"+n.data+'" />');$("#imagePreviewPanel").html(i);it();$("#addToContent").prop("checked",n.addToContent);$("#pagePosition").text("Trang: "+(e+1)+"/"+u.length)},fu=function(n){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(n)},rt=function(n,t,r,u,f,e){var s,h,l,c;return o.children("li.tabs-active").removeClass("tabs-active"),s=$('<li title="'+n+'" class="tabs-active qtooltip"><\/li>'),e!=i&&e.class&&(s.addClass(e.class),delete e.class),s.append("<div class='hover'><\/div>"),h=$('<a href="#'+t+'"><\/a>'),h.append(n),s.append(h),r&&s.append('<span class="ui-icon ui-icon-close">x<\/span>'),e&&s.attr(e),s.click(function(n){if(n.preventDefault(),n.stopImmediatePropagation(),r){if(n.button===0||n.button==i)hr($(this));else if(n.button===1){var t=$(this).find("span.ui-icon.ui-icon-close");t.length>0&&t.trigger("click")}}else hr($(this));return!1}),u!=null&&u>-1?(l=o.children("li").length,u>l-1?o.append(s):(c=o.children("li:eq("+(u-1)+")"),c.length>0&&c.after(s))):o.append(s),cr(),vu(s),s},ht=function(n,t,i){var u=$('<div id="'+t+'" style="display:block; height: 100%"><\/div>'),r,f;return fi.append(u),u.siblings("div:visible").hide(),eGovMessage.notification("Đang tải...",eGovMessage.messageTypes.processing,!1),r=$('<iframe name="iframe_'+t+'" id="iframe_'+t+'" scr="" height="100%" width="100%" style="border:none"><\/iframe>'),u.append(r),f=r[0],f.src=n,$(f).load(function(){i&&typeof i=="function"&&i(r.attr("id"));eGovMessage.notification("hide")}),r},sr=function(n,t){var i=$('<div id="'+n+'" style="display:block; height: 100%"><\/div>');fi.append(i);i.siblings("div:visible").hide();t&&i.append(t)},ut=function(n,t,i){var r=i?i[0].name:null,u=t.find("span.ui-icon.ui-icon-close");$(u).on("close",function(){y(t)});$(u).click(function(){var i,u;return r&&document.getElementById(r)?(i=document.getElementById(r).contentWindow,i.egov?n?(u=new egov.document.transfer(0,r),i.egov.cshtml.document.isHoso?eGovMessage.show("Bạn có đồng ý tiếp nhận hồ sơ này không?",null,eGovMessage.messageButtons.YesNo,function(){u.transferSpecialCreate(u.actionSpecial.TiepNhanHoSo,t)},function(){y(t)}):eGovMessage.show("Bạn có đồng ý lưu dự thảo?",null,eGovMessage.messageButtons.YesNo,function(){u.saveDocDraft(t)},function(){y(t)})):(u=new egov.document.transfer(i.egov.cshtml.document.documentCopyId,r),i.egov.cshtml.document.luuvanbanPermission?i.egov.cshtml.document.isFormChange?eGovMessage.show("Văn bản/hồ sơ có sự thay đổi, bạn có muốn lưu lại không?",null,eGovMessage.messageButtons.YesNo,function(){u.saveDoc(t)},function(){y(t)}):y(t):y(t)):y(t)):y(t),!1})},hr=function(n){var i="tabs-active",r,t,u;n.hasClass(i)||(r=n.children("a[href]")[0],r&&(n.addClass(i),n.siblings("li."+i).removeClass(i),t=$(r).attr("href"),$(t).length==0&&(u=di+t.replace("#"+vt,""),ht(u,t.replace("#",""))),$(t).show(),n.is('[egovtab="print"]')&&egov.cshtml.home.tab.reloadActiveTab(n),$(t).siblings("div:visible").hide()))},y=function(n){var f=n.index(),e=n.children("a"),t,i,r,u;f==o.children("li.tabs-active").index()&&(t=n.prev(),t.length===0&&(t=n.next()),t.addClass("tabs-active"),i=t.children("a[href]"),i&&(r=i.attr("href"),$(r).show(),$(r).siblings("div:visible").hide()));u=e.attr("href");egov.cshtml.home.tab.config.isSaveOpenTab&&k.length>0&&(k=_.reject(k,function(n){return n.id==u.replace("#"+vt,"")}),tt[userId]=k,$.cookie(ei,JSON.stringify(tt),{secure:!0}));n.data("onclosed")&&n.data("onclosed")();$(n).qtip("destroy");n.remove();$(u).remove();$(".tabs-ul li").length===0&&egov.cshtml.home.tab.activeRootTab();cr()},cr=function(){var r=$(document).outerWidth(),t=o.find("li"),i=t.length,u=i-1,f=r-10-u,n=Math.floor(f/i)-12;n>95&&(n=95);t.each(function(t,i){$(i).css("width",n+"px")})},nt=function(){return $($(egov.cshtml.home.idPanelTreeDocument).jstree("get_selected"))},lr=function(n){var t,i;oi=$("#dtypeSelect");r[n].isFilterByDocFieldDocType?($("#DTypeSelect").show(),t=[],$.each(r[n].documentsObject,function(n,i){t.push(i.DocTypeId)}),t=egov.utilities.array.distinct(t),i=_.filter(egov.cshtml.home.doctypes,function(n){return _.contains(t,n.DocTypeId)}),i.length>0?(oi.html("").append($("#doctypeTemplate").tmpl(i)),oi.find("span.doctype-item").bind("click",function(){var t,i;$(this).siblings(".selected").removeClass("selected");$(this).addClass("selected");$("#DTypeSelect a.edropdown").qtip("hide");t=$(this).attr("value");$(".grid-content").scrollTop(0);t==""?ft(n,r[n].columnSetting,r[n].documentsObject):(i=t===""?r[n].documentsObject:_.filter(r[n].documentsObject,function(n){return n.DocTypeId===t}),r[n].doctypeColumnSettings?r[n].doctypeColumnSettings[t]?ft(n+t,r[n].doctypeColumnSettings[t],i):($(idTableDocuments+" tbody").html(h(i,r[n].columnSetting)),$(idTableDocuments+" tr:odd").addClass("trodd"),w()):($(idTableDocuments+" tbody").html(h(i,r[n].columnSetting)),$(idTableDocuments+" tr:odd").addClass("trodd"),w()))})):$("#DTypeSelect").hide()):$("#DTypeSelect").hide()},yi=function(n,t,i,u){var f={},e;i&&i.length>0&&(f.reloadFunctionIds=i);r[n]&&(r[n].documentsObject.length>0?(e=_.max(r[n].documentsObject,function(n){return Date.parse(n.DateReceived)}),f.lastDate=e.DateReceived,f.currentDocCopyIds=_.pluck(r[n].documentsObject,"DocumentCopyId")):f.lastDate=null);egov.cshtml.home.pagingByScroll||(f.pagesize=egov.cshtml.home.listdocuments.pageSize());u&&eGovMessage.notification("Đang lấy dữ liệu...",eGovMessage.messageTypes.processing);$.ajaxSetup({traditional:!0});$.post(t,f,function(t){var f,u,i,o;if(pt=t.listDocuments.isOverdueFilter,wt=t.listDocuments.isDateFilter,hi=t.listDocuments.dateFilterView,pt?$("#DateOverdueSelect").show():$("#DateOverdueSelect").hide(),wt?$("#GotoDateSelect").hide():($("#GotoDateSelect").show(),$("#GotoDateSelect a").text().indexOf(hi)||$("#GotoDateSelect a").prepend(hi)),c=t.listDocuments.page,d=t.listDocuments.pageSize,ct=t.listDocuments.totalDocuments,t.listDocuments.totalUnread>0?$("#"+n).children("a:first").children("span:first").html(t.listDocuments.totalUnread).attr("data-totalunread",""+t.listDocuments.totalUnread):$("#"+n).children("a:first").children("span:first").html(" ").attr("data-totalunread",""+t.listDocuments.totalUnread),t.reloadFunctions){try{f=JSON.parse(t.reloadFunctions)}catch(s){f=[]}$.each(f,function(n,t){var i=t.id+(t.param?"_"+t.param:"");t.totalDocumentUnread>0?$("#"+i).children("a:first").children("span:first").html(t.totalDocumentUnread).attr("data-totalunread",""+t.totalDocumentUnread):$("#"+i).children("a:first").children("span:first").html(" ").attr("data-totalunread",""+t.totalDocumentUnread)})}try{u=JSON.parse(t.listDocuments.documents)}catch(s){u=[]}r[n]&&r[n].documentsObject.length>0&&egov.cshtml.home.pagingByScroll?(t.listDocuments.removeDocumentCopyIds&&t.listDocuments.removeDocumentCopyIds.length>0&&($.each(t.listDocuments.removeDocumentCopyIds,function(n,t){$(idTableDocuments).find("tbody tr[id=documentCopy_"+t+"]").remove()}),r[n].documentsObject=_.reject(r[n].documentsObject,function(n){return _.contains(t.listDocuments.removeDocumentCopyIds,n.DocumentCopyId)})),u=_.reject(u,function(n){return n.DocumentCopyId==e.DocumentCopyId}),i=r[n].columnSetting,i||(i=[]),_.find(i,function(n){return n.ColumnName=="STT"})||i.push({ColumnName:"STT",DisplayName:"STT",Width:30,EnableSort:!1,Order:-1}),!_.find(i,function(n){return n.ColumnName=="Checkmask"}),_.find(i,function(n){return n.ColumnName=="Color"})||i.push({ColumnName:"Color",DisplayName:"",Width:50,EnableSort:!1,Order:-1}),i=_.sortBy(i,function(n){return n.Order}),o=h(u,i),$(idTableDocuments).find("tbody tr:first").before(o),$(idTableDocuments).find("tbody tr").each(function(n,t){$(t).attr("id")!=="rowGetDocumentOlder"&&$(t).children("td:first").html(n+1+"")}),w(),$.each(u,function(t,i){r[n].documentsObject.push(i)}),r[n].documentsObject=_.sortBy(r[n].documentsObject,function(n){return Date.parse(n.DateReceived)}).reverse()):(r[n]=t.listDocuments,r[n].reload=!1,r[n].documentsObject=u,r[n].isOverdueFilter=pt,r[n].isDateFilter=wt,lr(n),ft(n,r[n].columnSetting,r[n].documentsObject),at(n));yt=!1}).fail(function(){eGovMessage.notification("Có lỗi xảy ra",eGovMessage.messageTypes.error)}).complete(function(){u&&eGovMessage.notification("hide");$.ajaxSetup({traditional:!1})})},ar=function(n,t){var i={cols:"",headers:"",rows:""},r;t.length===0?(n=_.sortBy(n,function(n){return n.Order}),$.each(n,function(n,t){i.cols+=t.Width?'<col style="width: '+t.Width+'px"/>':"<col/>";i.headers+='<th data-column="'+t.ColumnName+'">'+t.DisplayName+"<\/th>"}),i.rows=""):(n=_.sortBy(n,function(n){return n.Order}),$.each(n,function(n,t){i.cols+=t.Width?'<col style="width: '+t.Width+'px"/>':"<col/>";i.headers+=t.EnableSort?'<th data-column="'+t.ColumnName+'"><a id="'+(t.SortName?t.SortName:t.ColumnName)+'" href="javascript:egov.cshtml.home.listdocuments.sort(\''+(t.SortName?t.SortName:t.ColumnName)+"')\">"+t.DisplayName+"<\/a><\/th>":'<th data-column="'+t.ColumnName+'">'+t.DisplayName+"<\/th>"}),i.rows=h(t,n));$(egov.cshtml.home.idPanelListDocument).html($("#listDocumentTemplate").tmpl(i));egov.cshtml.home.pagingByScroll||($("#tblListDocument").append($("#pagingTemplate").tmpl()),r=Math.ceil(ct/d),$("#tblListDocument tfoot li:last").text("Trang "+c+" / "+r))},ft=function(t,i,u){var f,e,o,s;if(i||(i=[]),_.find(i,function(n){return n.ColumnName=="STT"})||i.push({ColumnName:"STT",DisplayName:"STT",Width:30,EnableSort:!1,Order:-1}),!_.find(i,function(n){return n.ColumnName=="Checkmask"}),_.find(i,function(n){return n.ColumnName=="Color"})||i.push({ColumnName:"Color",DisplayName:"",Width:50,EnableSort:!1,Order:-1}),f="function"+t,e=$.cookie(f),e){try{o=JSON.parse(e)}catch(h){o=null}$.each(o,function(n,t){var r=_.find(i,function(t){return t.ColumnName==n});r&&(r.Width=t)})}pt=r[t].isOverdueFilter;wt=r[t].isDateFilter;pt?$("#DateOverdueSelect").show():$("#DateOverdueSelect").hide();wt?$("#GotoDateSelect").hide():$("#GotoDateSelect").show();ar(i,u);$(idTableDocuments).grid({isUsingCustomScroll:!1,isResizeColumn:!0,isFixHeightContent:!0,isAddHoverRow:!1,isUseCookie:!1,isRenderPanelGrid:!1,onresizefinish:function(){var i={},n=[],r=0,o=$(egov.cshtml.home.idPanelListDocument+" .grid-header table th"),s=$(egov.cshtml.home.idPanelListDocument+" .grid-header table colgroup col"),h=$(egov.cshtml.home.idPanelListDocument+" .grid-content table"),u,e,t;if(s.each(function(t,u){var f=o.eq(t);$(u).width()==0?n.push(f.attr("data-column")):r+=$(u).width();i[f.attr("data-column")]=$(u).width()}),n.length>0)for(u=h.width()-r,e=u/n.length,t=0;t<n.length;t++)i[n[t]]=e;$.cookie(f,JSON.stringify(i),{expires:7,path:"/",secure:!0})}});w();n.initTooltip();n.initNotifier();egov.cshtml.home.pagingByScroll&&(s=$('<tr id="rowGetDocumentOlder"><td colspan="'+i.length+'" style="text-align:center"><img id="imgGetDocumentOlder" src="/Content/Images/ajax-loader.gif" width="24px" height="24px" style="display:none" /><a id="linkGetDocumentOlder" href="javascript:void(0)">Lấy thêm các văn bản, hồ sơ<\/a><\/td><\/tr>'),s.click(function(){gt||r[t].isLoadAllData||vr(t)}),s.appendTo(idTableDocuments+" tbody"));egov.cshtml.home.documentProcessingLayout.initContent("center")},at=function(n){r[n].enablePaging&&egov.cshtml.home.pagingByScroll&&($(".grid-content").unbind("scroll"),$(".grid-content").scroll(function(){$(".grid-header-wrap").scrollLeft($(this).scrollLeft());gt||r[n].isLoadAllData||this.offsetHeight+this.scrollTop>=this.scrollHeight-50&&vr(n)}))},vr=function(t){gt=!0;$("#imgGetDocumentOlder").show();$("#linkGetDocumentOlder").hide();var f=$("#"+t),i=$("#SearchQuery").val(),u=_.min(i===""?r[t].documentsObject:tr,function(n){return Date.parse(n.DateReceived)}),e=f.children("a").attr("href").replace("/Home/GetDocument/","/Home/GetDocumentPaging/");$.post(e,{lastDate:u.DateReceived,quickSearch:i},function(i){var c=r[t].documentsObject.length,f,o,e,s;try{f=JSON.parse(i.documents)}catch(l){f=[]}f=_.reject(f,function(n){return n.DocumentCopyId==u.DocumentCopyId});f.length>0?(r[t].isLoadAllData=!1,$.each(f,function(n,i){r[t].documentsObject.push(i)})):r[t].isLoadAllData=!0;$("#imgGetDocumentOlder").hide();$("#linkGetDocumentOlder").show();$("#rowGetDocumentOlder").before(h(f,r[t].columnSetting,c));n.initTooltip();$(idTableDocuments+" tr:odd").addClass("trodd");$("#rowGetDocumentOlder").removeClass("trodd");w();o=$("#doctypeid:visible");o.length>0&&(e=[],$.each(r[t].documentsObject,function(n,t){e.push(t.DocTypeId)}),e=egov.utilities.array.distinct(e),s=_.filter(doctypes,function(n){return _.contains(e,n.DocTypeId)}),$.each(s,function(n,t){o.children("option[value="+t.DocTypeId+"]").length===0&&$("#doctypeTemplate").tmpl(t).appendTo(o)}));gt=!1})},h=function(n,t,i){var o,s,r,u,f,h,e;for(i||(i=0),o=$("<tbody>"),s=_.filter(t,function(n){return n.ColumnName!="STT"&&n.ColumnName!="Checkmask"&&n.ColumnName!="Color"}),r=0;r<n.length;r++)u=$("<tr><\/tr>"),n[r].IsFile?(u.attr("id","attachment_"+n[r].DocumentCopyId),u.attr("ondblclick","egov.cshtml.home.plugin.openAttachment("+n[r].DocumentCopyId+")")):(u.attr("id","documentCopy_"+n[r].DocumentCopyId),u.attr("data-color",n[r].Color?n[r].Color:""),u.addClass(n[r].IsViewed?"":"documentUnread"),u.attr("ondblclick","openDocument('"+n[r].DocumentCopyId+"','"+n[r].Compendium+"')")),u.append($("<td style='text-align: center;'>").text(i+1)),f=$("<td style='text-align: center'><\/td>"),n[r].IsFile||(n[r].IsDocumentImportant=="0"?f.append('<span class="document-important qtooltip" index="'+r+'" title="Gắn quan trọng cho văn bản này"  onclick="documentImportant(this,'+n[r].DocumentCopyId+');" ><\/span>'):f.append('<span class="document-important important qtooltip" index="'+r+'" title="Bỏ gắn quan trọng văn bản này" onclick="documentImportant(this,'+n[r].DocumentCopyId+');" ><\/span>')),h=au(n[r].Color),n[r].IsFile?(e=n[r].Compendium?n[r].Compendium.split(".").pop():"",e==="7z"&&(e="sevenz"),f.append('<span class="icon-attachment '+e+'"><\/span>')):f.append('<span class="document-color '+(n[r].Color?"documentColor"+n[r].Color:"")+' qtooltip" title="'+h+'"><\/span>'),u.append(f),$.each(s,function(t,i){var e=n[r][i.ColumnName],f,o;si.test(e)?(f=e.split(/[^0-9]/),o=new Date(f[0],f[1]-1,f[2],f[3],f[4],f[5]),u.append("<td>"+Globalize.format(new Date(o),"dd/MM/yyyy hh:mm tt")+"<\/td>")):u.append("<td>"+(e?e:"")+"<\/td>")}),i++,u.appendTo(o);return o.html()},eu=function(n){if(n.id!=0){var t=$(n),i=t.children("a:first").attr("href").split("/");$.get("/Home/GetTotalDocumentUnread/"+i[i.length-1],{},function(n){n&&(n>0?t.find("span:first").text(n):t.find("span:first").text(" "),t.find("span:first").attr("data-totalunread",n))})}},w=function(){var n=idTableDocuments+" tbody tr:not(tr#rowGetDocumentOlder)";$(n).unbind("mouseup");$(n).mouseup(function(t){var f,u,i,r,s,e,h,o;if(t.button===2){if($.contextMenu("destroy",n),f=$(this),f.hasClass("rowSelected")||changeColor(f),u=f.attr("id"),u.indexOf("documentCopy_")===0?(i=u.replace("documentCopy_",""),r="văn bản"):(i=u.replace("attachment_",""),r="tài liệu"),s=[],e=[],$(idTableDocuments+" tbody tr.rowSelected").each(function(n,t){if($(t).attr("id").indexOf("attachment_")===0)return h=!0,!1;var i=$(t).attr("id").replace("documentCopy_","");e.push(parseInt(i))}),h){$.contextMenu({selector:n,trigger:"right",build:function(){var n={open:{name:"Xem chi tiết "+r,icon:"openattach",callback:function(){var n=$(this);n.attr("id").indexOf("attachment_")===0?egov.cshtml.home.plugin.openAttachment(i):n.dblclick()}}};return u.indexOf("attachment_")===0&&(n.download={name:"Tải "+r,icon:"download",callback:function(){var n="/StorePrivate/DownloadAttachment/"+i;$.fileDownload(n,{failCallback:function(n){var i=$(n),t;try{t=JSON.parse(i.text());eGovMessage.show(t.error)}catch(r){eGovMessage.show('"@Localizer("Common.Error")" khi tải file')}}})}}),n.speperator="--------",n.removeDocumentInStorePrivate={name:"Loại "+r+" khỏi hồ sơ",icon:"remove",callback:function(){var n=$(this),t=$($(egov.cshtml.home.idPanelTreeStorePrivate).jstree("get_selected"));t.hasClass("storeitem")?eGovMessage.show("Bạn chắc chắn muốn loại "+r+" này khỏi hồ sơ chứ?",null,eGovMessage.messageButtons.YesNo,function(){var f="/Document/RemoveDocumentInStorePrivate",u=$("input[name='__RequestVerificationToken']","#DocumentRemoveDocumentInStorePrivate").val(),e={storePrivateId:t.attr("data-storeprivateid"),documentCopyId:i,__RequestVerificationToken:u};n.attr("id").indexOf("attachment_")===0&&(u=$("input[name='__RequestVerificationToken']","#StorePrivateRemoveAttachment").val(),f="/StorePrivate/RemoveAttachment",e={id:i,__RequestVerificationToken:u});$.post(f,e,function(t){t&&(t.error?eGovMessage.notification(t.message,eGovMessage.messageTypes.error):(eGovMessage.notification("Loại "+r+" khỏi hồ sơ thành công!",eGovMessage.messageTypes.success),n.remove()))})}):eGovMessage.show("Bạn không có quyền xóa tài liệu này")}},{items:n}}});$(n).contextMenu({x:t.clientX,y:t.clientY});return}o=$('<img src="/Content/Images/ajax-loader.gif" width="20" height="20" style="position:fixed; z-index:100; top:'+(t.clientY-10)+"px; left: "+(t.clientX-10)+'px;" />');$.support.fixedPosition||o.css({position:"absolute"});o.appendTo("body");$.ajax({type:"GET",data:{documentCopyIds:e},url:"/Document/GetDocumentPermission",traditional:!0,success:function(r){if(r.error)eGovMessage.notification(r.error,eGovMessage.messageTypes.error);else{s=_.uniq(r);var u=egov.document.permission.getContextmenu(s,e,i);yt&&(u.speperator="---------",u.removeDocumentInStorePrivate={name:"Loại văn bản khỏi hồ sơ",icon:"remove",callback:function(){var t=this,n=$($(egov.cshtml.home.idPanelTreeStorePrivate).jstree("get_selected"));n.hasClass("storeitem")&&eGovMessage.show("Bạn chắc chắn muốn loại văn bản này khỏi hồ sơ chứ?",null,eGovMessage.messageButtons.YesNo,function(){var r=$("input[name='__RequestVerificationToken']","#DocumentRemoveDocumentInStorePrivate").val();$.post("/Document/RemoveDocumentInStorePrivate",{storePrivateId:n.attr("data-storeprivateid"),documentCopyId:i,__RequestVerificationToken:r},function(n){n&&(n.error?eGovMessage.notification(n.message,eGovMessage.messageTypes.error):(eGovMessage.notification("Loại văn bản khỏi hồ sơ thành công!",eGovMessage.messageTypes.success),$(t).remove()))})})}});$.contextMenu({selector:n,trigger:"right",build:function(){return{items:u}}});$(n).contextMenu({x:t.clientX,y:t.clientY})}},error:function(n){eGovMessage.notification(n.statusText,eGovMessage.messageTypes.error)},complete:function(){o.remove()}})}});$("body").unbind("keydown");$("body").keydown(function(n){n.ctrlKey&&(n.keyCode==65||n.keyCode==97)&&(n.preventDefault(),$(idTableDocuments+" tbody tr").hasClass("rowSelected")&&egov.cshtml.home.tab.getActiveTab().attr("egovtab")=="document"?$(idTableDocuments+" tbody tr").each(function(n,t){var i=$(this),r;i.attr("data-color")!=""?(r=i.attr("data-color"),i.addClass("documentBgColor"+r+" rowSelected")):$(t).addClass("rowSelected")}):$("#listRelations").length>0&&$("#listRelationsAdded").length>0&&($("#listRelations tbody tr").hasClass("rowSelected")&&$("#listRelations tbody tr").removeClass("rowSelected").addClass("rowSelected"),$("#listRelationsAdded tbody tr").hasClass("rowSelected")&&$("#listRelationsAdded tbody tr").removeClass("rowSelected").addClass("rowSelected")))});ou()},ou=function(){var selector=idTableDocuments+" tbody tr:not(tr#rowGetDocumentOlder)";egov.cshtml.home.showQuickView&&(quickView($(idTableDocuments+" tbody tr:first").attr("id")),$(idTableDocuments+" tbody tr:first").hasClass("rowSelected")||$(idTableDocuments+" tbody tr:first").addClass("rowSelected"));$(selector).unbind("click");$(selector).click(function(e){var $row,i,$rowShift,detectBrowser,os;if(e.preventDefault(),$row=$(this),e.shiftKey){rowIdSelected=[];var currentIndex=$row.index(),beginRow=rowIndex<=currentIndex?rowIndex:currentIndex,endRow=rowIndex<=currentIndex?currentIndex:rowIndex;for(i=beginRow;i<=endRow;i++)$rowShift=$(idTableDocuments+" tbody tr:eq("+i+")"),setRowSelected($rowShift),rowIdSelected.push($rowShift.attr("id"));$(selector).each(function(n,t){var i=$(t).index();(i>endRow||i<beginRow)&&removeRowSelected($(t))});egov.cshtml.home.showQuickView&&quickView($(idTableDocuments+" tbody tr:eq("+currentIndex+")").attr("id"));return}if(e.ctrlKey){rowIndex=$row.index();$row.hasClass("rowSelected")?(removeRowSelected($row),rowIdSelected=_.reject(rowIdSelected,function(n){return n==$row.attr("id")}),egov.cshtml.home.showQuickView&&quickView(rowIdSelected[rowIdSelected.length-1])):(setRowSelected($row),rowIdSelected.push($row.attr("id")),egov.cshtml.home.showQuickView&&quickView($row.attr("id")));return}rowIndex=$row.index();rowIdSelected=[];rowIdSelected.push($row.attr("id"));changeColor(this);egov.cshtml.home.showQuickView&&quickView($row.attr("id"));detectBrowser=new browserDetect;detectBrowser.detect();os=detectBrowser.getOS();(os==="iPhone"||os==="iPad"||os=="Android"||os==="Windows Phone")&&eval($row.attr("ondblclick"))})},quickView=function(n){if(n.indexOf("documentCopy_")===0){n=n.replace("documentCopy_","");var u=nt().attr("id"),t=r[u]?_.find(r[u].documentsObject,function(t){return t.DocumentCopyId==n}):null,i=!1;t?dt[n]?($(".document-preview").html($("#quickviewTemplate").tmpl(dt[n].document)),t.DateReceived!=dt[n].date&&(i=!0)):i=!0:i=!0;$.get("/Home/QuickViewDocument/"+n,function(i){i&&($(".document-preview").html($("#quickviewTemplate").tmpl(i)),dt[n]={document:i,date:t?t.DateReceived:""})}).fail(function(){eGovMessage.notification('@Localizer("Common.Error")',eGovMessage.messageTypes.error)})}else n=n.replace("attachment_",""),$.get("/StorePrivate/GetAttachment/"+n,function(n){n&&$(".document-preview").html($("#quickviewAttachmentTemplate").tmpl(n))}).fail(function(){eGovMessage.notification('@Localizer("Common.Error")',eGovMessage.messageTypes.error)})},bt=function(n,t){var f=$("#SearchQuery").val(),i=nt(),u=i.attr("id"),e=i.children("a").attr("href").replace("/Home/GetDocument/","/Home/GetDocumentPaging/"),o=$("input[name='__RequestVerificationToken']","#HomeGetDocumentPaging").val();$.post(e,{quickSearch:f,page:n,pagesize:t,__RequestVerificationToken:o},function(i){var f,e;try{f=JSON.parse(i.documents);c=i.page;d=i.pageSize;ct=i.totalDocuments}catch(o){f=[]}c===1&&(r[u].documentsObject=f);$("#tblListDocument tbody").html(h(f,r[u].columnSetting,(n-1)*t));$(idTableDocuments+" tr:odd").addClass("trodd");w();$(".grid-content").scrollTop(0);e=Math.ceil(ct/d);$(".grid-pager li:first").text("Trang "+c+" / "+e);c>1?($("#firstPage img").removeClass("disabled"),$("#prevPage img").removeClass("disabled")):($("#firstPage img").addClass("disabled"),$("#prevPage img").addClass("disabled"));c<e?($("#lastPage img").removeClass("disabled"),$("#nextPage img").removeClass("disabled")):($("#lastPage img").addClass("disabled"),$("#nextPage img").addClass("disabled"));egov.cshtml.home.listdocuments.pageSize(t)})},removeRowSelected=function(n){n.removeClass("rowSelected")},setRowSelected=function(n){$(n).addClass("rowSelected")},changeColor=function(n){var t=$(n);setRowSelected(t);t.siblings("tr").removeClass("rowSelected")},yr=function(n){$("#userJoined").autocomplete({minLength:1,source:n,focus:function(){return!1},selectFirst:!0,select:function(n,t){$("#userJoined").val("");var i=_.find(g,function(n){return n===t.item.value});return i||(g.push(t.item.value),pr(t.item)),!1}}).data("autocomplete")._renderItem=function(n,t){return $("<li><\/li>").data("item.autocomplete",t).append("<a>"+t.label+"<\/a>").appendTo(n)};$(".ui-autocomplete-input").bind("autocompleteopen",function(){var n=$(this).data("autocomplete"),t=n.menu;n.options.selectFirst&&t.activate($.Event({type:"mousehover"}),t.element.children().first())})},pr=function(n){var t=$("<tr><\/tr>"),i,r;t.append("<td>"+n.label+"<\/td>");i=$('<td style="width:30px"><\/td>');r=$('<a href="javascript:void(0)">Xóa<\/a>');r.click(function(){$(this).parents("tr:first").remove();g=_.reject(g,function(t){return t===n.value})});i.append(r);t.append(i);$("#tblUserJoined").append(t);$("#panelUserJoined").getNiceScroll().resize()},wr=function(n){var t={},i;t.width=425;t.height=230;t.title="Thêm tài liệu";t.buttons=[{text:"Thêm",click:function(){$("#attachmentName").val()!==""&&$("#uploadStorePrivateAttachment").click()}},{text:"Bỏ qua",click:function(){$("#addStorePrivateAttachment").dialog("close")}}];$("#attachmentName").val("");$("#descStorePrivateAttachment").val("");$("#addStorePrivateAttachment .fileinput-button").html('Chọn tệp <input id="storePrivateAttachment" type="file" name="file" class="file" data-url="/StorePrivate/AddAttachment">');$("#uploadStorePrivateAttachment").unbind("click");su(n);i=new dialogAdapter;i.openexist($("#addStorePrivateAttachment"),t,null,null,!1)},su=function(n){$("#storePrivateAttachment").fileupload({dataType:"json",autoUpload:!1,add:function(n,t){var i=t.files[0];$("#attachmentName").val(i.name);$("#uploadStorePrivateAttachment").unbind("click");$("#uploadStorePrivateAttachment").click(function(){t.submit()})},start:function(){$("#addStorePrivateAttachment").blockpanel({text:"Đang tải...",borderWidth:1});$("#toolbar").block({message:"",css:{border:"none"}})},stop:function(){$("#addStorePrivateAttachment").unblockpanel();$("#addStorePrivateAttachment").dialog("close")},done:function(){$("li[data-storeprivateid="+n+"] a").click()},fail:function(){eGovMessage.show('"@Localizer("Common.Error")" khi tải tệp lên')}}).bind("fileuploadsubmit",function(t,i){i.formData={id:n,desc:$("#descStorePrivateAttachment").val()}})},pi=function(n){var t={},i;t.width=425;t.height=400;t.title="Tạo mới hồ sơ";t.buttons=[{text:"Tạo mới",click:function(){if($.trim($("#storePrivateName").val())==="")$("#storePrivateName").addClass("input-validation-error").focus().siblings("span").show();else{$("#storePrivateName").removeClass("input-validation-error").siblings("span").hide();var t=$("input[name='__RequestVerificationToken']","#StorePrivateCreate").val();$.ajax({type:"POST",url:"/StorePrivate/Create",traditional:!0,data:{storePrivateName:$("#storePrivateName").val(),descStorePrivate:$("#descStorePrivate").val(),parentId:n,userIdJoined:g,__RequestVerificationToken:t},success:function(t){t&&(t.error?eGovMessage.notification(t.message,eGovMessage.messageTypes.error):t.validateMessage?($("#storePrivateName").addClass("input-validation-error").focus().siblings("span").show(),eGovMessage.notification(t.validateMessage,eGovMessage.messageTypes.error)):($(egov.cshtml.home.idPanelTreeStorePrivate).jstree("create",n?$("#storePrivate li[data-storeprivateid="+n+"]"):$("#storePrivate"),"last",{attr:{"data-storeprivateid":t.id,"class":"storeitem active"},data:{title:$("#storePrivateName").val(),attr:{href:"#"}}},null,!0),$("#treeStorePrivateSave").jstree("create",n?$("#storePrivateSave li[data-storeprivateid="+n+"]"):$("#storePrivateSave"),"last",{attr:{"data-storeprivateid":t.id},data:{title:$("#storePrivateName").val(),attr:{href:"#"}}},null,!0),$("#createStorePrivate").dialog("close"),kr()))},error:function(){eGovMessage.notification("Có lỗi trong quá trình tạo mới hồ sơ cá nhân.",eGovMessage.messageTypes.error)}})}}},{text:"Bỏ qua",click:function(){$("#createStorePrivate").dialog("close")}}];g=[];$("#storePrivateName").val("");$("#descStorePrivate").val("");n?$("#storePrivateParentId").val(n):$("#storePrivateParentId").val("");$("#tblUserJoined tr").remove();i=new dialogAdapter;et?i.openexist($("#createStorePrivate"),t,null,null,!1):$.get("/Transfer/GetAllUsers",{},function(n){n&&(et=JSON.parse(n),yr(_.filter(et,function(n){return n.value!=userId})),i.openexist($("#createStorePrivate"),t,null,null,!1),$("#panelUserJoined").niceScroll(vi))})},br=function(n){$.get("/StorePrivate/Get",{id:n},function(t){var r,u,i;t&&(t.error?eGovMessage.notification(t.message,eGovMessage.messageTypes.error):($("#storePrivateName").val(t.storePrivateName),$("#descStorePrivate").val(t.descStorePrivate),$("#tblUserJoined tr").remove(),g=t.userIdJoined,r=_.filter(et,function(n){return _.contains(g,n.value)}),$.each(r,function(n,t){pr(t)}),u=new dialogAdapter,i={},i.width=425,i.height=370,i.title="Cập nhật hồ sơ",i.buttons=[{text:"Cập nhật",click:function(){if($.trim($("#storePrivateName").val())==="")$("#storePrivateName").addClass("input-validation-error").focus().siblings("span").show();else{$("#storePrivateName").removeClass("input-validation-error").siblings("span").hide();var t=$("input[name='__RequestVerificationToken']","#StorePrivateUpdate").val();$.ajax({type:"POST",url:"/StorePrivate/Update",traditional:!0,data:{id:n,storePrivateName:$("#storePrivateName").val(),descStorePrivate:$("#descStorePrivate").val(),userIdJoined:g,__RequestVerificationToken:t},success:function(t){t&&(t.error?eGovMessage.notification(t.message,eGovMessage.messageTypes.error):t.validateMessage?($("#storePrivateName").addClass("input-validation-error").focus().siblings("span").show(),eGovMessage.notification(t.validateMessage,eGovMessage.messageTypes.error)):($("li[data-storeprivateid="+n+"]").children("a").html('<ins class="jstree-icon">&nbsp;<\/ins>'+$("#storePrivateName").val()),$("#createStorePrivate").dialog("close")))},error:function(){eGovMessage.notification("Có lỗi trong quá trình cập nhật hồ sơ cá nhân.",eGovMessage.messageTypes.error)}})}}},{text:"Bỏ qua",click:function(){$("#createStorePrivate").dialog("close")}}],u.openexist($("#createStorePrivate"),i,null,null,!1),$("#panelUserJoined").getNiceScroll().remove(),$("#panelUserJoined").niceScroll(vi)))})},hu=function(){$.contextMenu("destroy","#treeStorePrivate #storePrivate");$.contextMenu({selector:"#treeStorePrivate #storePrivate",zIndex:3,build:function(){return{items:{addStorePrivate:{name:"Tạo hồ sơ mới",icon:"add2",callback:function(){pi()}}}}}})},kr=function(){$.contextMenu("destroy","#treeStorePrivate li.storeitem");$.contextMenu({selector:"#treeStorePrivate li.storeitem",zIndex:3,build:function(n){var t=n.hasClass("active");return{items:{addStorePrivate:{name:"Tạo hồ sơ mới",icon:"add2",callback:function(){var t=n.attr("data-storeprivateid");pi(t)}},addFile:{name:"Thêm tài liệu",icon:"add",callback:function(){var t=n.attr("data-storeprivateid");wr(t)}},closeStorePrivate:{name:t?"Đóng hồ sơ":"Mở hồ sơ",icon:t?"cancel":"accept",callback:function(){var n=this,i=t?"/StorePrivate/Close":"/StorePrivate/Open",r=t?"#StorePrivateClose":"#StorePrivateOpen",u=$("input[name='__RequestVerificationToken']",r).val();eGovMessage.show("Bạn có chắc muốn "+(t?"đóng":"mở")+" hồ sơ này không",null,eGovMessage.messageButtons.YesNo,function(){$.post(i,{id:$(n).attr("data-storeprivateid"),__RequestVerificationToken:u},function(i){i&&(i.error?eGovMessage.notification(i.message,eGovMessage.messageTypes.error):(t?$(n).removeClass("active"):$(n).addClass("active"),eGovMessage.notification((t?"Đóng":"Mở")+" hồ sơ thành công",eGovMessage.messageTypes.success)))}).fail(function(){eGovMessage.notification('@Localizer("Common.Error")',eGovMessage.messageTypes.error)})})}},editStorePrivate:{name:"Cập nhật hồ sơ",icon:"edit",callback:function(){var n=this;et?br($(n).attr("data-storeprivateid")):$.get("/Transfer/GetAllUsers",{},function(t){t&&(et=JSON.parse(t),yr(_.filter(et,function(n){return n.value!=userId})),br($(n).attr("data-storeprivateid")))})}},sep1:"---------",deleteStorePrivate:{name:"Xóa hồ sơ",icon:"remove",callback:function(){var n=this;eGovMessage.show("Bạn có chắc muốn xóa hồ sơ này không",null,eGovMessage.messageButtons.YesNo,function(){var t=$("input[name='__RequestVerificationToken']","#StorePrivateDelete").val();$.post("/StorePrivate/Delete",{id:$(n).attr("data-storeprivateid"),__RequestVerificationToken:t},function(t){t&&(t.error?eGovMessage.notification(t.message,eGovMessage.messageTypes.error):(eGovMessage.notification("Xóa hồ sơ thành công",eGovMessage.messageTypes.success),$(egov.cshtml.home.idPanelTreeStorePrivate).jstree("remove",$(n)),$(egov.cshtml.home.idPanelTreeStorePrivate).jstree("deselect_node")))}).fail(function(){eGovMessage.notification('"@Localizer("Common.Error")" khi xóa hồ sơ',eGovMessage.messageTypes.error)})})}}}}}})},cu=function(){$.contextMenu("destroy","#treeStorePrivate li.storeshareitem");$.contextMenu({selector:"#treeStorePrivate li.storeshareitem",zIndex:3,build:function(n){return{items:{addFile:{name:"Thêm tài liệu",icon:"add",callback:function(){var t=n.attr("data-storeprivateid");wr(t)}}}}}})},lu=function(n){var t=[];for(var i in n)t.push(i);return t},dr=function(n,t,i,r,u,f){egov.cshtml.home.tab.add(n,t,0,egov.cshtml.home.tabIcons.newDocument,function(t){gr(t,n,i,r,u,f)},function(){b[n][i].splice(0,1);b[n][i].length>0&&dr(n,t,i,r,u,f)})},gr=function(n,t,i,r,u,e){var s=b[t][i][0],h,c,o,l;c=s.indexOf(".pdf",s.length-4)!==-1?f.readPdfToImage(s,egov.cshtml.home.transferMultiDocument.startImage,egov.cshtml.home.transferMultiDocument.endImage,egov.cshtml.home.transferMultiDocument.bitcount,egov.cshtml.home.transferMultiDocument.quality,egov.cshtml.home.transferMultiDocument.grayscale):f.readImage(s,egov.cshtml.home.transferMultiDocument.startImage,egov.cshtml.home.transferMultiDocument.endImage,egov.cshtml.home.transferMultiDocument.bitcount,egov.cshtml.home.transferMultiDocument.quality,egov.cshtml.home.transferMultiDocument.grayscale);c&&(h=JSON.parse(c),o=document.getElementById(n).contentWindow,o.egov.cshtml.document.allowTransferMultiDocument=!1,l=s.split("\\"),o.egov.cshtml.document.uploadImageScan([{name:l[l.length-1],value:h.attachment}],r,u,e),o.CKEDITOR.instances.editor1?ri(o,h.images,"jpg"):o.egov.cshtml.document.enableEditor($("#"+n).contents().find("#mainForm .content")[0],function(){ri(o,h.images,"jpg")}))},ti=function(n){var t,i;for(n=_.sortBy(n,function(n){return n.Level}),t=n.length-1;t>=0;t--)i=_.find(n,function(i){return i.StorePrivateId==n[t].ParentId}),i?(i.Children||(i.Children=[]),i.Children.push(n[t])):n[t].root=!0;return n=_.filter(n,function(n){return n.root})};egov.cshtml||(egov.cshtml={});egov.cshtml.home={documentProcessingLayout:null,searchDocumentLayout:null,contentLayout:null,showQuickView:!0,pagingByScroll:!0,idPanelListDocument:"",idPanelTreeDocument:"#treeDocument",idPanelTreeStorePrivate:"#treeStorePrivate",doctypes:[],tabIcons:st,userid:null,fullnameAndEmail:""};egov.cshtml.home.tab={config:{documentTabContentId:"documentProcessing",reportTabContentId:"report",searchTabContentId:"searchDocument",printTabContentId:"printTab",profileConfigTabContentId:"profileConfig",settingTabContentId:"setting",changePasswordTabContentId:"changePassword",isSaveOpenTab:!0,userId:null},init:function(n,t,i){if(gi=$(n),fi=$(t),userId=i.userId,$.extend(this.config,i||{}),o=$('<ul class="tabs-ul"><\/ul>'),o.attr("class","tabs-ul"),this.config.isSaveOpenTab){if(!userId)throw"Nếu bạn sử dụng chức năng lưu lại các tab đang mở, bạn phải gán giá trị cho tham số userId";try{tt=JSON.parse($.cookie(ei));k=tt[userId]?tt[userId]:[]}catch(r){tt={};k=[]}$.each(k,function(n,t){var i=rt(t.name,vt+t.id,!0,null,t.icon);ut(!1,i)})}o.appendTo(gi)},add:function(n,t,i,r,u,f){var e,s,h=fu(n),c,l,a,v;if(h)e=tu+bi,s=i?ki+"?id="+n+"&documentCopyRelationId="+i:ki+"/"+n,bi++;else{if(e=vt+n,c=o.find("li a[href=#"+vt+n+"]"),c.length>0){this.activeTab(c.parent());return}s=di+n}l=rt(t,e,!0,null,r);f&&typeof f=="function"&&l.data("onclosed",f);a=ht(s,e,u);ut(h,l,a);this.config.isSaveOpenTab&&!h&&(v=_.find(k,function(t){return t.id==n}),v||(k.push({id:n,name:t,icon:r}),tt[userId]=k,$.cookie(ei,JSON.stringify(tt),{secure:!0})))},addDocument:function(n,t){this.add(n,t,null,egov.cshtml.home.tabIcons.document,function(){egov.cshtml.home.listdocuments.updateIsViewed(n)})},addReport:function(){var n=o.find("li a[href=#"+this.config.reportTabContentId+"]"),t,i;if(n.length>0){this.activeTab(n.parent());return}t=rt("Báo cáo thống kê",this.config.reportTabContentId,!0,null,st.report,{egovtab:"report"});i=ht(iu,this.config.reportTabContentId);ut(!1,t)},addTabSetting:function(){var n=o.find("li a[href=#"+this.config.settingTabContentId+"]"),t,i;if(n.length>0){this.activeTab(n.parent());return}t=rt("Thiết lập",this.config.settingTabContentId,!0,null,st.option,{egovtab:"setting"});i=ht(uu,this.config.settingTabContentId);ut(!1,t)},addTabProfileConfig:function(){var n=o.find("li a[href=#"+this.config.profileConfigTabContentId+"]"),t,i;if(n.length>0){this.activeTab(n.parent());return}t=rt("Thiết lập thông tin",this.config.profileConfigTabContentId,!0,null,st.option,{egovtab:"profileConfig"});i=ht(urlProfileConfig,this.config.profileConfigTabContentId);ut(!1,t)},addTabChangePassWord:function(){var n=o.find("li a[href=#"+this.config.changePasswordTabContentId+"]"),t,i;if(n.length>0){this.activeTab(n.parent());return}t=rt("Đổi mật khẩu",this.config.changePasswordTabContentId,!0,null,st.option,{egovtab:"changePassword"});i=ht(urlChangePassword,this.config.changePasswordTabContentId);ut(!1,t)},addTabSearch:function(n){var t=o.find("li a[href=#"+this.config.searchTabContentId+"]"),i;if(t.length>0){this.activeTab(t.parent());$("#"+this.config.searchTabContentId).remove();sr(this.config.searchTabContentId,n);return}i=rt("Tìm kiếm",this.config.searchTabContentId,!0,2,st.search,{egovtab:"search"});sr(this.config.searchTabContentId,n);ut(!1,i)},addPrint:function(){var n=o.find("li a[href=#"+this.config.printTabContentId+"]"),t,i;if(n.length>0){this.activeTab(n.parent());return}t=rt("Trang in",this.config.printTabContentId,!0,null,st.print,{egovtab:"print"});i=ht(ru,this.config.printTabContentId);ut(!1,t)},getActiveTab:function(){return o.children("li.tabs-active")},activeTab:function(n){if(n!=null){var t;if(n instanceof jQuery)n.length>0&&n[0].tagName==="LI"&&n.parent()[0].tagName==="UL"&&(n.hasClass("tabs-active")||n.trigger("click"));else if(typeof n=="number"){if(n===0){this.activeRootTab();return}t=o.children("li").eq(n-1);t.length>0&&(t.hasClass("tabs-active")||t.trigger("click"))}else typeof n=="string"&&(t=o.children("li[egovtab="+n+"]"),t.length>0&&(t.hasClass("tabs-active")||t.trigger("click")))}},reloadActiveTab:function(n){if(n!=null){var t=$(n).find("a").attr("href");if($(t).length===0)return;window.document.getElementById("iframe_"+t.replace("#","")).contentWindow.location.reload()}},activeRootTab:function(){if(!$("#documentProcessing").is(":visible")){var n=this.getActiveTab();n!=i&&(n.removeClass("tabs-active"),$($(n.children("a[href]")[0]).attr("href")).hide());$("#documentProcessing").show()}},close:function(n){if(n!=null){var t;n instanceof jQuery?n.length>0&&n[0].tagName==="LI"&&n.parent()[0].tagName==="UL"&&y(n):typeof n=="number"?(t=o.children("li").eq(n),t.length>0&&y(t)):typeof n=="string"&&(t=o.children("li[egovtab="+n+"]"),t.length>0&&y(t))}},closeActiveTab:function(){var n=o.children("li.tabs-active");y(n)}};egov.cshtml.home.tree={document:{init:function(n){var t={plugins:["themes","html_data","ui","types","crrm"],ui:{select_multiple_modifier:!1},types:{valid_children:["root"],types:{root:{hover_node:!1,select_node:function(){return!1}}}}};kt=$("<ul><\/ul>");kt.appendTo($(egov.cshtml.home.idPanelTreeDocument));$("#treeTemplate").tmpl(n).appendTo(kt);$(egov.cshtml.home.idPanelTreeDocument).jstree(t).bind("loaded.jstree",function(n,t){var i=$(egov.cshtml.home.idPanelTreeDocument+" ul:first ul:first li:first a:first");i.length>0&&(i.addClass("jstree-clicked"),$(egov.cshtml.home.idPanelTreeDocument+" ul:first").children("li:first").attr("rel","root"),t.inst.get_container().find("li").each(function(){if(t.inst.get_path($(this)).length<=1)return t.inst.open_node($(this)),!1}),i.trigger("click"))}).bind("open_node.jstree",function(n,t){if(t.inst._get_children(t.rslt.obj).length==0&&t.rslt.obj.attr("id")>0){t.rslt.obj.children("a:first").addClass("jstree-loading");var i=parseInt(t.rslt.obj.attr("id"));$.get("/Home/GetFunctionByParentId",{id:i},function(n){var i,r,u,o;if(n){var f=_.sortBy(JSON.parse(n),function(n){return n.order}),s=[],e=0;for(i=0;i<f.length;i++)for(r=_.filter(f,function(n){return n.order==f[i].order}),r=_.sortBy(r,function(n){return egov.utilities.string.stripVietnameseChars(n.name)}),u=0;u<r.length;u++)o=_.clone(r[u]),o.order=e,s.push(o),e++,i=e-1;$("<ul><\/ul>").appendTo(t.rslt.obj);$("#treeItemTemplate").tmpl(s).appendTo(t.rslt.obj.children("ul:first"));t.rslt.obj.children("ul:first").children("li:last-child").addClass("jstree-last");t.rslt.obj.children("ul:first").parents("li").each(function(n,t){eu(t)});$("#SystemTree").getNiceScroll().resize()}}).complete(function(){t.rslt.obj.children("a:first").removeClass("jstree-loading")}).fail(function(){eGovMessage.notification('@Localizer("Common.Error")',eGovMessage.messageTypes.error)})}}).bind("select_node.jstree",function(n,t){$(egov.cshtml.home.idPanelTreeStorePrivate).jstree("deselect_node");var u=$(t.rslt.obj[0]),i=u.attr("id");$(".grid-content").scrollTop(0);r[i]?(ft(i,r[i].columnSetting,r[i].documentsObject),r[i].reload==!0?yi(i,u.children("a").attr("href"),null,!0):(lr(i),at(i),yt=!1)):yi(i,u.children("a").attr("href"),null,!0)})}},storeprivate:{init:function(){var n={json_data:{data:[{data:"Hồ sơ công việc",state:"closed",attr:{rel:"root","class":"storefolder"}}]},plugins:["themes","json_data","ui","types","crrm"],ui:{select_multiple_modifier:!1},types:{valid_children:["root"],types:{root:{hover_node:!1,select_node:function(){return!1}}}}};nr=$("<ul><\/ul>");nr.appendTo($(egov.cshtml.home.idPanelTreeStorePrivate));$(egov.cshtml.home.idPanelTreeStorePrivate).jstree(n).bind("loaded.jstree",function(){$(egov.cshtml.home.idPanelTreeStorePrivate).find("a").attr("rel","root")}).bind("open_node.jstree",function(n,t){t.inst._get_children(t.rslt.obj).length==0&&(t.rslt.obj.children("a:first").addClass("jstree-loading"),$.get("/StorePrivate/Gets",{},function(n){if(n){var r=[{id:"storePrivate",name:"Hồ sơ cá nhân",className:"storeitem",list:ti(n.storePrivate)},{id:"storeShare",name:"Hồ sơ chia sẻ",className:"storeshareitem",list:ti(n.storeShare)}],i=$("<ul><\/ul>");i.appendTo(t.rslt.obj);$("#treeItemStorePrivateTemplate").tmpl(r).appendTo(t.rslt.obj.children("ul:first"));i.find("li:last-child").addClass("jstree-last");i.find("#storePrivate li").addClass("storeitem");i.find("#storeShare li").addClass("storeshareitem")}}).complete(function(){t.rslt.obj.children("a:first").removeClass("jstree-loading");hu();kr();cu()}).fail(function(){eGovMessage.notification('@Localizer("Common.Error")',eGovMessage.messageTypes.error)}))}).bind("select_node.jstree",function(n,t){var i=parseInt(t.rslt.obj.attr("data-storeprivateid"));$.get("/StorePrivate/GetDocuments",{id:i},function(n){ar([{ColumnName:"STT",DisplayName:"STT",Width:"50",EnableSort:!1,Order:-1},{ColumnName:"Color",DisplayName:"",Width:"50",EnableSort:!1,Order:0},{ColumnName:"Compendium",DisplayName:"Trích yếu",SortName:"",Width:"300",EnableSort:!0,Order:2},{ColumnName:"Email",DisplayName:"Người soạn thảo",SortName:null,Width:100,EnableSort:!1,Order:3},{ColumnName:"DateCreated",DisplayName:"Ngày tạo",SortName:"",Width:"150",EnableSort:!0,Order:4},{ColumnName:"DateAppointed",DisplayName:"Ngày hết hạn",Width:"150",EnableSort:!0,Order:5},{ColumnName:"LastComment",DisplayName:"Ý kiến xử lý cuối",SortName:null,Width:null,EnableSort:!1,Order:6}],JSON.parse(n));$(idTableDocuments).grid({isUsingCustomScroll:!0,isResizeColumn:!0,isFixHeightContent:!0,isAddHoverRow:!1,isUseCookie:!0,isRenderPanelGrid:!1});yt=t.rslt.obj.hasClass("storeitem")?!0:!1;w();$(".grid-content").getNiceScroll().remove();egov.cshtml.home.documentProcessingLayout.initContent("center");$(".grid-content").niceScroll(vi)});$(egov.cshtml.home.idPanelTreeDocument).jstree("deselect_node")})},openDialogSave:function(n,t,i){var h=[{id:"storePrivateSave",name:"Hồ sơ cá nhân",className:"storeitem",list:ti(n.storePrivate)},{id:"storeShareSave",name:"Hồ sơ chia sẻ",className:"storeshareitem",list:ti(n.storeShare)}],u,f=$('<div id="treeStorePrivateSave"><\/div>'),e=$("<ul><\/ul>"),s,r,o;e.appendTo(f);$("#treeSaveStorePrivateTemplate").tmpl(h).appendTo(e);e.find("li:last-child").addClass("jstree-last");s={core:{initially_open:["storePrivateSave","storeShareSave"]},plugins:["themes","html_data","ui","types","crrm"],ui:{select_multiple_modifier:!1},types:{valid_children:["root"],types:{root:{hover_node:!1,select_node:function(){return!1}}}}};f.appendTo($("body"));f.jstree(s).bind("select_node.jstree",function(n,t){u=parseInt($(t.rslt.obj[0]).attr("data-storeprivateid"))});r={};r.height=350;r.title="Chọn hồ sơ để lưu văn bản";r.buttons=[{text:"Tạo mới",click:function(){pi(u)}},{text:"Lưu",click:function(){u?t&&typeof t=="function"&&t(u):eGovMessage.show("Bạn phải chọn hồ sơ để lưu")}},{text:"Không lưu",click:function(){i&&typeof i=="function"&&i()}}];o=new dialogAdapter;o.close();o.openexist(f,r)}}};egov.cshtml.home.reloadData=function(n){var i=nt().attr("id"),u=$("#"+i),t=[];kt.find("li").each(function(n,i){var r=parseInt($(i).attr("data-functionid"));r!=0&&(isNaN(r)||t.push(r))});t=egov.utilities.array.distinct(t);$.each(r,function(n,t){n!==i&&(t.reload=!0)});yi(i,u.children("a").attr("href"),t,n)};egov.cshtml.home.listdocuments={};egov.cshtml.home.listdocuments.quickSearch=function(n){clearTimeout(this.searching);this.searching=setTimeout(function(){var i=nt(),t=i.attr("id"),e=$(n).val(),u,f;e===""?(ft(t,r[t].columnSetting,r[t].documentsObject),at(t)):(u=i.children("a").attr("href").replace("/Home/GetDocument/","/Home/GetDocumentPaging/"),f=$("input[name='__RequestVerificationToken']","#HomeGetDocumentPaging").val(),$.post(u,{quickSearch:$(n).val(),__RequestVerificationToken:f},function(n){var i;try{i=JSON.parse(n.documents)}catch(u){i=[]}tr=i;ft(t,r[t].columnSetting,i);at(t)}))},300)};egov.cshtml.home.listdocuments.sort=function(n){var i=$(".grid-header table th a[id="+n+"]"),c=nt(),e=$("#DocumentImportantSelect .selected"),o=$("#DocumentViewSelect .selected"),u=c.attr("id"),s,t,f;r[u]&&(s=r[u].documentsObject.length,t=r[u].documentsObject,t=e.hasClass("important")?_.filter(t,function(n){return n.IsDocumentImportant==1}):e.hasClass("important")?t:_.filter(t,function(n){return n.IsDocumentImportant==0}),t=o.hasClass("docIsView")?_.filter(t,function(n){return n.IsViewed==1}):o.hasClass("docNotView")?_.filter(t,function(n){return n.IsViewed==0}):t,s>0&&(f=_.sortBy(t,function(t){if(si.test(t[n])){var i=Date.parse(t[n]);return isNaN(i)?typeof t[n]=="string"?egov.utilities.string.stripVietnameseChars(t[n]):t[n]:i}return typeof t[n]=="string"?egov.utilities.string.stripVietnameseChars(t[n]):t[n]}),$(egov.cshtml.home.idPanelListDocument+" .grid-header table th a.sort").attr("id")!=n&&$(egov.cshtml.home.idPanelListDocument+" .grid-header table th a.sort").removeClass("sort").removeClass("asc").removeClass("desc"),i.hasClass("sort")?i.hasClass("asc")?($(idTableDocuments+" tbody").html(h(f.reverse(),r[u].columnSetting)),i.removeClass("asc").addClass("desc")):i.hasClass("desc")&&($(idTableDocuments+" tbody").html(h(f,r[u].columnSetting)),i.removeClass("desc").addClass("asc")):($(idTableDocuments+" tbody").html(h(f,r[u].columnSetting)),i.addClass("sort asc")),$(idTableDocuments+" tr:odd").addClass("trodd"),w()))};egov.cshtml.home.listdocuments.sortByTypeAndIsView=function(){var e=nt(),o=$("#DocumentImportantSelect1 .document-important.selected").length>0,s=$("#DocumentImportantSelect1 .document-unread.selected").length>0,t=e.attr("id"),f,i,u,n;r[t]&&(f=r[t].documentsObject.length,i=r[t].documentsObject,i=_.filter(r[t].documentsObject,function(n){return o?n.IsDocumentImportant==1:s?n.IsViewed==0:!0}),f>0&&(u=$(egov.cshtml.home.idPanelListDocument+" .grid-header table th a"),u.hasClass("sort")?(n=u.attr("id"),i=_.sortBy(i,function(t){if(si.test(t[n])){var i=Date.parse(t[n]);return isNaN(i)?typeof t[n]=="string"?egov.utilities.string.stripVietnameseChars(t[n]):t[n]:i}return typeof t[n]=="string"?egov.utilities.string.stripVietnameseChars(t[n]):t[n]}),u.hasClass("asc")?$(idTableDocuments+" tbody").html(h(i,r[t].columnSetting)):u.hasClass("desc")&&$(idTableDocuments+" tbody").html(h(i.reverse(),r[t].columnSetting))):$(idTableDocuments+" tbody").html(h(i,r[t].columnSetting)),$(idTableDocuments+" tr:odd").addClass("trodd"),w()))};egov.cshtml.home.listdocuments.setDoccumentImportant=function(n,t){var e=nt(),u=e.attr("id"),i=$(n),f=i.hasClass("important")?!0:!1;f?(i.removeClass("important"),i.attr("title","Gắn quan trọng cho văn bản này")):(i.addClass("important"),i.attr("title","Bỏ gắn quan trọng văn bản này"));$.ajax({dataType:"json",data:{documentCopyId:t,isImportant:!f},url:"/Home/SetDocumentImportant",success:function(n){var o,e;if(n.success){if(r[u])for(o=r[u].documentsObject.length,e=0;e<o;e++)r[u].documentsObject[e].DocumentCopyId==t&&(r[u].documentsObject[e].IsDocumentImportant=f?0:1)}else i.addClass("important"),i.attr("title","Bỏ gắn quan trọng văn bản này"),eGovMessage.notification(n.message,eGovMessage.messageTypes.error)},error:function(){i.addClass("important");i.attr("title","Bỏ gắn quan trọng văn bản này");eGovMessage.notification("")("Common.Error");eGovMessage.messageTypes.error}})};egov.cshtml.home.listdocuments.nextpage=function(){if(!$("#nextPage").hasClass("disabled")){var n=Math.ceil(ct/d);c<n&&bt(c+1,d)}};egov.cshtml.home.listdocuments.lastpage=function(){if(!$("#lastPage").hasClass("disabled")){var n=Math.ceil(ct/d);c<n&&bt(n,d)}};egov.cshtml.home.listdocuments.prevpage=function(){$("#prevPage").hasClass("disabled")||c>1&&bt(c-1,d)};egov.cshtml.home.listdocuments.firstpage=function(){$("#firstPage").hasClass("disabled")||c>1&&bt(1,d)};egov.cshtml.home.listdocuments.changePageSize=function(n){bt(1,n)};egov.cshtml.home.listdocuments.pageSize=function(n){return n&&typeof n=="number"?($.cookie("PageSizeHome_"+egov.cshtml.home.userid,n,{secure:!0}),n):$.cookie("PageSizeHome_"+egov.cshtml.home.userid)===null?null:parseInt($.cookie("PageSizeHome_"+egov.cshtml.home.userid))};egov.cshtml.home.listdocuments.updateIsViewed=function(n){$("#documentCopy_"+n).removeClass("documentUnread");$.each(r,function(t,i){var r=_.find(i.documentsObject,function(t){return t.DocumentCopyId==n});r&&(r.IsViewed=1)})};egov.cshtml.home.plugin={};egov.cshtml.home.plugin.getPlugin=function(n){return n&&(f=n),f};egov.cshtml.home.plugin.showDialogDownloadPlugin=function(n){var i={modal:!0,minHeight:30,width:"auto",resizable:!1,open:function(){var n=this;$(".ui-widget-overlay").css("background","transparent none");$(".ui-widget-overlay").click(function(){$(n).dialog("close")})},title:"Thông báo",close:function(){$(this).remove()}},t=$('<div><p style="font-size:16px;font-weight:bold;">Bạn chưa cài đặt plugin<\/p><p>Bạn cần tải về và cài đặt plugin này để sử dụng chức năng mở tệp đính kèm và quét ảnh<\/p><p style="color:red">Nếu bạn vẫn thấy thông báo này sau khi cài đặt plugin, hãy khởi động lại trình duyệt<\/p><center><div style="text-align:center;width:180px"><input type="button" value="Tải về và cài đặt" /><div id="imgDownloadingPlugin" style="float:left;display:none"><img src="/Content/Images/ajax-loader.gif" width="24px" height="24px" /><\/div><div id="msgDowloadingPlugin" style="float:left;padding-top:5px;display:none">&nbsp;Đang chờ cài đặt plugin...<\/div><\/div><\/center><\/div>');t.find("input").click(function(){var i=this;document.location="/Download/EOfficePlusPlugin";$(i).hide();$(i).siblings("div").show();t.find("#imgDownloadingPlugin").show();t.find("#msgDowloadingPlugin").show();FireBreath.waitForInstall(ot,function(){$(i).parents("div.ui-dialog-content").dialog("close");n&&typeof n=="function"&&n()})});t.dialog(i)};egov.cshtml.home.plugin.openAttachment=function(n){var t=this;f||$("#plugin").length!==0?($("#center").blockpanel({text:"Đang tải...",borderWidth:1}),$.get("/StorePrivate/DownloadAttachmentBase64/"+n,{},function(n){var t=JSON.parse(n),i;t&&(t.error?eGovMessage.show(t.error):(i=f.writeFileBase64(t.fileName,t.content,!1),f.openFile(t.fileName,!1)))}).fail(function(){eGovMessage.show('"@Localizer("Common.Error")" khi tải tài liệu!')}).complete(function(){$("#center").unblockpanel()})):FireBreath.isPluginInstalled(ot)?$("body").append(FireBreath.injectPlugin(ot,"plugin",function(){f=document.getElementById("plugin");t.openAttachment(n)})):t.showDialogDownloadPlugin(function(){t.openAttachment(n)})};egov.cshtml.home.scan={isLoadedListScaner:!1};egov.cshtml.home.scan.showDialogScan=function(n,t,i,r,o){var c=this,h;f||$("#pluginScan").length!==0?(c.isLoadedListScaner?c.reloadListScanner(!1):(c.reloadListScanner(!0),c.isLoadedListScaner=!0),s="",p="",l=0,a=0,e=0,u=[],t&&t!=""?$("#filename").val(t):$("#filename").val("image"),$("#pagePosition").text("Trang: 0/0"),$("#addToContent").prop("checked",!1),$("#preImage, #nextImage, #addToContent, #removeImageScan, #removeAllImageScan").attr("disabled","disabled"),h={},h.title="eGovCloud - Quét tài liệu",h.width=595,h.height=570,h.modal=!0,h.draggable=!0,h.resizable=!0,h.open=function(){$(".ui-widget-overlay").css("background","transparent none");$(".ui-widget-overlay").click(function(){$("#scanPanel").dialog("close")})},h.close=function(){$.each(u,function(n,t){f.cancelTransferImage(t.url)})},h.buttons=[{text:"Chuyển ảnh",click:function(){var f=this,t=document.getElementById(n).contentWindow,e;u&&u.length>0?(e=_.filter(u,function(n){return n.addToContent}),e.length>0?$("#"+n).contents().find("#mainForm").length>0&&t.CKEDITOR&&(t.CKEDITOR.instances.editor1?(ri(t,e),wi(t,f,i,r,o)):t.egov.cshtml.document.enableEditor($("#"+n).contents().find("#mainForm .content")[0],function(){ri(t,e);wi(t,f,i,r,o)})):wi(t,f,i,r,o)):$(f).dialog("close")}},{text:"Đóng",click:function(){$(this).dialog("close")}}],$("#scanPanel").length>0?er=_.clone($("#scanPanel")):$("body").append(er),v&&(v.destroy(),$("#imageScan").remove()),$("#scanPanel").dialog(h)):FireBreath.isPluginInstalled(ot)?$("body").append(FireBreath.injectPlugin(ot,"pluginScan",function(){f=document.getElementById("pluginScan");c.reloadListScanner(!0);c.isLoadedListScaner=!0;c.showDialogScan(n,t,i,r,o)})):egov.cshtml.home.plugin.showDialogDownloadPlugin(function(){c.showDialogScan(n,t,i,r,o)})};var ii=function(n,t){var i=new Image;i.src="data:image/"+t+";base64,"+n;var r=768,u=i.width,f=i.height;return i.width>=r&&(u=r,f=r/i.width*i.height),'<img width="'+u+'px" height="'+f+'px" src="data:image/'+t+";base64,"+n+'" />'},ri=function(n,t,i){var r=n.CKEDITOR.instances.editor1,e=new n.CKEDITOR.focusManager(r);if(e.focus(),r.getData()==="")$.each(t,function(n,t){if(typeof t=="object")t.addToContent&&(r.insertHtml("<p><\/p>"),r.insertHtml("<p>"+ii(t.data,t.url.indexOf(".bmp",t.url.length-4)!==-1?"bmp":"jpg")+"<\/p>"));else if(typeof t=="string"){var u=new Image;u.src="data:image/"+i+";base64,"+t;r.insertHtml("<p>"+ii(t,i)+"<\/p>")}});else{var o=r.getSelection(),u=o.getRanges()[0],s=u.startContainer.getAscendant({div:1,b:1,p:1,span:1,em:1,u:1},!0),f=new n.CKEDITOR.dom.range(u.document);f.moveToPosition(s,n.CKEDITOR.POSITION_BEFORE_START);f.select();$.each(t,function(n,t){if(typeof t=="object")t.addToContent&&(r.insertHtml("<p><\/p>"),r.insertHtml("<p>"+ii(t.data,t.url.indexOf(".bmp",t.url.length-4)!==-1?"bmp":"jpg")+"<\/p>"));else if(typeof t=="string"){var u=new Image;u.src="data:image/"+i+";base64,"+t;r.insertHtml("<p>"+ii(t,i)+"<\/p>")}})}},wi=function(n,t,i,r,e){var o=[],c,s,l,h;$("#imageformat").val()=="PDF"?u.length>0&&(c=$("#filename").val()+ai[$("#imageformat").val()],s=f.transferPdf(_.pluck(u,"url")),s!==""&&o.push({name:c,value:s})):$("#imageformat").val()=="DOC"?u.length>0&&(f.isWordInstalled()?(l=$("#filename").val()+ai[$("#imageformat").val()],h=f.transferDoc(_.pluck(u,"url")),h!==""&&o.push({name:l,value:h})):eGovMessage.show("Bạn cần cài đặt Microsoft Word để sử dụng chức năng này!")):$.each(u,function(n,t){var r=$("#filename").val()+"_"+n+ai[$("#imageformat").val()],i=f.transferImage(t.url,$("#imageformat").val());i!==""&&o.push({name:r,value:i})});o.length>0&&n.egov.cshtml.document.uploadImageScan(o,i,r,e);u=[];$(t).dialog("close")};egov.cshtml.home.scan.reloadListScanner=function(n){$("#listScanner").html("");$("#acquire").attr("disabled","disabled");var t=JSON.parse(f.getAllScanner(n));t&&t.length>0&&($("#acquire").removeAttr("disabled"),$.each(t,function(n,t){$("#listScanner").append("<option value='"+n+"'>"+t+"<\/option>")}))};egov.cshtml.home.scan.acquire=function(){f.acquire($("#showui").prop("checked"),$("#listScanner").val(),$("#pixeltype").val(),$("#resolution").val(),$("#duplex").prop("checked"),egov.cshtml.home.scan.showImage)};egov.cshtml.home.scan.showImage=function(n,t,i){var o,r,h;s=n;l=t;a=i;o=lt/t*i;r=f.readFileScanBase64(s,0,-1);p=s.indexOf(".bmp",s.length-4)!==-1?"bmp":"jpg";h=$('<img width="'+lt+'px" height="'+o+'px" id="imageScan" src="data:image/'+p+";base64,"+r+'" />');$("#imagePreviewPanel").html(h);it();u.push({url:n,data:r,ext:p,width:t,height:i,addToContent:!1});e=u.length-1;$("#pagePosition").text("Trang: "+(e+1)+"/"+u.length);u.length>1?($("#preImage").removeAttr("disabled"),$("#nextImage").attr("disabled","disabled")):u.length===1&&$("#addToContent, #removeImageScan, #removeAllImageScan").removeAttr("disabled")};egov.cshtml.home.scan.setRotate=function(n){var r,t;if(s!==""&&f.imageRotate(s,n)){v.destroy();var o=$("#imageScan").width(),h=$("#imageScan").height(),i=f.readFileScanBase64(s,0,-1),c=$('<img width="'+h+'px" height="'+o+'px" id="imageScan" src="data:image/'+p+";base64,"+i+'" />');$("#imageScan").remove();$("#imagePreviewPanel").html(c);it();r=a;a=l;l=r;t=u[e];t.width=l;t.height=a;t.data=i}};egov.cshtml.home.scan.setZoom=function(n){if(s!==""){var r=$("#imageScan").width(),u=$("#imageScan").height(),t=r+n,i=t/(r/u);t>0&&i>0&&(v.destroy(),$("#imageScan").css({width:t+"px",height:i+"px"}),$("#imageScan").attr("width",t+"px").attr("height",i+"px"),it())}};egov.cshtml.home.scan.setActualSize=function(){s!==""&&(v.destroy(),$("#imageScan").css({width:l+"px",height:a+"px"}),$("#imageScan").attr("width",l+"px").attr("height",a+"px"),it())};egov.cshtml.home.scan.crop=function(){var t,i,r,o,n;s!==""&&(t=$("#imageScan").width(),i=$("#imageScan").height(),f.imageCrop(s,ir,rr,ur,fr,t,i)&&(v.destroy(),r=f.readFileScanBase64(s,0,-1),o=$('<img width="'+lt+'px" height="'+lt/ci*li+'px" id="imageScan" src="data:image/'+p+";base64,"+r+'" />'),$("#imagePreviewPanel").html(o),it(),l=ci/t*l,a=li/i*a,n=u[e],n.width=l,n.height=a,n.data=r))};egov.cshtml.home.scan.setBrightness=function(n){var i,r,t,o;s!==""&&f.imageAdjustBrightness(s,n)&&(i=$("#imageScan").width(),r=$("#imageScan").height(),v.destroy(),t=f.readFileScanBase64(s,0,-1),o=$('<img width="'+i+'" height="'+r+'px" id="imageScan" src="data:image/'+p+";base64,"+t+'" />'),$("#imagePreviewPanel").html(o),it(),u[e].data=t)};egov.cshtml.home.scan.setContrast=function(n){var i,r,t,o;s!==""&&f.imageAdjustContrast(s,n)&&(i=$("#imageScan").width(),r=$("#imageScan").height(),v.destroy(),t=f.readFileScanBase64(s,0,-1),o=$('<img width="'+i+'" height="'+r+'px" id="imageScan" src="data:image/'+p+";base64,"+t+'" />'),$("#imagePreviewPanel").html(o),it(),u[e].data=t)};egov.cshtml.home.scan.preImage=function(){e>=1&&(e--,ni(),$("#nextImage").removeAttr("disabled"),e===0&&$("#preImage").attr("disabled","disabled"))};egov.cshtml.home.scan.nextImage=function(){e<=u.length-2&&(e++,ni(),$("#preImage").removeAttr("disabled"),e===u.length-1&&$("#nextImage").attr("disabled","disabled"))};egov.cshtml.home.scan.removeImageScan=function(){if(u.length>0){var n=u.length;f.cancelTransferImage(u[e].url);u.splice(e,1);e===n-1?e>0?(e--,ni()):(v.destroy(),$("#imageScan").remove(),$("#pagePosition").text("Trang: 0/0")):ni();e===0?($("#preImage").attr("disabled","disabled"),u.length<=1&&$("#nextImage").attr("disabled","disabled")):e===u.length-1&&$("#nextImage").attr("disabled","disabled");u.length===0&&(s="",p="",l=0,a=0,e=0,$("#removeImageScan, #removeAllImageScan, #addToContent").attr("disabled","disabled"))}};egov.cshtml.home.scan.removeAllImageScan=function(){u.length>0&&(v.destroy(),$("#imageScan").remove(),$("#pagePosition").text("Trang: 0/0"),s="",p="",l=0,a=0,e=0,$.each(u,function(n,t){f.cancelTransferImage(t.url)}),u=[],$("#removeImageScan, #removeAllImageScan, #nextImage, #preImage, #addToContent").attr("disabled","disabled"))};egov.cshtml.home.scan.addToContent=function(){var n=u[e];n.addToContent=$("#addToContent").prop("checked")};egov.cshtml.home.transferMultiDocument={startImage:1,endImage:0,bitcount:24,quality:50,grayscale:!0};egov.cshtml.home.transferMultiDocument.add=function(n,t,i,r,u,e){var s=this,h,o;f||$("#pluginScan").length!==0?(h=i?"Hồ sơ mới":"Văn bản mới",f.openfiledialog(function(i){var f,s,c,l;i&&(f=JSON.parse(i),f.length>0&&(b[t]?(s=lu(b[t]),c=_.max(s,function(n){return parseInt(n)}),o=c+1+"",b[t][o]=f):(o="0",b[t]={},b[t][o]=f),l=egov.cshtml.home.tab.getActiveTab(),l.data("onclosed",function(){b[t][o].splice(0,1);b[t][o].length>0&&dr(t,h,o,r,u,e)}),gr(n,t,o,r,u,e)))})):FireBreath.isPluginInstalled(ot)?$("body").append(FireBreath.injectPlugin(ot,"pluginScan",function(){f=document.getElementById("pluginScan");s.add(n,t,i,r,u,e)})):egov.cshtml.home.plugin.showDialogDownloadPlugin(function(){s.add(n,t,i,r,u,e)})};egov.cshtml.home.expressPrinter={};egov.cshtml.home.expressPrinter.index=function(n){var t=$("<div id='expressPrinter'>"),i;t.load(n);i={width:700,height:500,title:"Trang in",buttons:[{text:"In",title:"In danh sách được chọn",click:function(){egov.cshtml.home.expressPrinter.print(t)}},{text:"Đóng",click:function(){t.dialog("destroy");t.remove()}}],open:function(){$(".ui-dialog-buttonset").prepend("<span style='margin-right: 16px;' checked> Xem trước khi in<\/span>");$(".ui-dialog-buttonset").prepend("<input type='checkbox'>")},close:function(){t.remove()}};t.dialog(i)};egov.cshtml.home.expressPrinter.print=function(n){var t=[],i,r;if(n.find(".print-list-item :checked").each(function(){t.push($(this).val())}),t.length===0){eGovMessage.show("Bạn chưa chọn hồ muốn in.");return}i=n.find(".printTemplateList").val();r=new egov.document.egovprint("",t,"");r.open(i)};egov.cshtml.home.feedback=function(){Feedback({label:"Gửi phản hồi",header:"Gửi phản hồi",url:"/Feedback/Send",nextLabel:"Tiếp tục",reviewLabel:"Xem trước",sendLabel:"Gửi",closeLabel:"Đóng",messageSuccess:"Gửi thành công! Cảm ơn bạn đã góp ý!",messageError:"Gửi không thành công! Chúng tôi rất tiếc về sự cố này, Bạn vui lòng thử lại!",h2cPath:"scripts/feedback/html2canvas.js"}).open()};ui=[];egov.cshtml.home.setting={addDoctypeShortkey:function(n,t){ui.length===0?$.ajax({url:"/Account/GetDocDefaultByUser",type:"GET",success:function(i){i&&(ui=i,nu(n,i,t))}}):nu(n,ui,t)}};var nu=function(n,i,r){var f,u={},e;u.width=440;u.height=300;u.title="Danh sách các văn bản ,hồ sơ mặc định";u.buttons=[{text:"Thêm",click:function(){var t=[];$("#listDocDefaults tbody input[type=checkbox]").each(function(){var n=$(this);n.prop("checked")&&t.push({argument:n.attr("data-id"),functionName:n.parent().siblings().text(),shortKey:"",keyName:""})});$("#tbDocDefaultSetting",$("#"+n).contents()).append($("#tmpRowDocDefault",$("#"+n).contents()).tmpl(t));u.close()}},{text:"Bỏ qua",click:function(){u.close()}}];e=_.filter(i,function(n){return!_.contains(r,n.DocTypeId)});f=$('<div id="addDocDefault"><\/div>').html($("#tmpListRowDocDefault",$("#"+n).contents()).tmpl({items:e}));t.open(f,u,function(){$("#listDocDefaults #checkAll").change(function(){$("#listDocDefaults tbody input[type=checkbox]").prop("checked",$(this).prop("checked"))});$("#listDocDefaults").grid({isResizeColumn:!1,isFixHeightContent:!1,isAutoHideScroll:!1})},null)},au=function(n){return n===2?"Văn bản đồng xử lý":n===3?"Văn bản sắp hết hạn (còn 1 ngày)":n===4?"Văn bản khẩn hoặc quá hạn xử lý":n===5?"Văn bản quá hạn hồi báo":n===6?"Văn bản hỏa tốc":"Văn bản bình thường"},vu=function(t){n.bind(t)};egov.cshtml.home.datefilter=function(n){var f=nt(),t=f.attr("id"),i,u;$(".grid-content").scrollTop(0);n===""?(ft(t,r[t].columnSetting,r[t].documentsObject),at(t)):(i=r[t].dateFilter,i!=""&&(u=_.filter(r[t].documentsObject,function(t){return t[i].indexOf(n)}),$(idTableDocuments+" tbody").html(h(u,r[t].columnSetting)),$(idTableDocuments+" tr:odd").addClass("trodd"),w()))};egov.cshtml.home.overduefilter=function(n){var u=nt(),t=u.attr("id"),i;$(".grid-content").scrollTop(0);n===""?(ft(t,r[t].columnSetting,r[t].documentsObject),at(t)):(n=Globalize.parseDate(n,"yyyy-MM-dd"),i=_.filter(r[t].documentsObject,function(t){var i=Globalize.parseDate(t.DateAppointed,"yyyy-MM-dd'T'HH:mm:ss");return i!=null?i.getDate()==n.getDate()&&i.getMonth()==n.getMonth()&&i.getYear()==n.getYear():!1}),$(idTableDocuments+" tbody").html(h(i,r[t].columnSetting)),$(idTableDocuments+" tr:odd").addClass("trodd"),w())}})(window.egov=window.egov||{},window.jQuery,window._,window.etip,new dialogAdapter);